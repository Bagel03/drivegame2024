{
  "version": 3,
  "sources": ["../node_modules/.pnpm/sdp@3.2.0/node_modules/sdp/sdp.js", "../src/engine/polyfills.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/utils/logger.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/archetype.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/utils/walk.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/utils/polyfills.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/storage.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/custom_storages.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/types.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/component.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/utils/setFns.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/utils/class.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/query.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/system.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/system_manager.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/utils/await_worker.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/worker_manager.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/utils/bits.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/relationships.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/hierarchy.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/world.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/entity.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/blueprint.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/ecs/resource.ts", "../node_modules/.pnpm/file+..+BagelECS+bagelecs-0.0.3.tgz/node_modules/bagelecs/src/exports/index.ts", "../node_modules/.pnpm/peerjs-js-binarypack@2.0.0/node_modules/peerjs-js-binarypack/dist/lib/binarypack.ts", "../node_modules/.pnpm/peerjs-js-binarypack@2.0.0/node_modules/peerjs-js-binarypack/dist/lib/bufferbuilder.ts", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/utils.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/chrome/getusermedia.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/firefox/getusermedia.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/safari/safari_shim.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/common_shim.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/adapter_factory.js", "../node_modules/.pnpm/webrtc-adapter@8.2.3/node_modules/webrtc-adapter/src/js/adapter_core.js", "../node_modules/.pnpm/cbor-x@1.5.4/node_modules/cbor-x/decode.js", "../node_modules/.pnpm/cbor-x@1.5.4/node_modules/cbor-x/encode.js", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/exports.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/util.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/BufferedConnection/binaryPackChunker.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/supports.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/utils/validateId.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/utils/randomToken.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/peer.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/logger.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/socket.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/node_modules/eventemitter3/index.js", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/enums.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/package.json", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/mediaconnection.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/negotiator.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/baseconnection.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/peerError.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/api.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/BufferedConnection/BinaryPack.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/BufferedConnection/BufferedConnection.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/DataConnection.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/BufferedConnection/Raw.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/BufferedConnection/Json.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/cborPeer.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/StreamConnection/Cbor.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/StreamConnection/StreamConnection.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/msgPackPeer.ts", "../node_modules/.pnpm/peerjs@1.5.1/node_modules/peerjs/dist/lib/dataconnection/StreamConnection/MsgPack.ts", "../node_modules/.pnpm/tweakpane@4.0.1/node_modules/tweakpane/dist/tweakpane.js", "../src/engine/diagnostics.ts", "../src/engine/resource.ts", "../src/engine/multiplayer/network.ts", "../src/test.ts"],
  "sourcesContent": ["/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nconst SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substring(2, 12);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(line => line.trim());\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  const parts = blob.split('\\nm=');\n  return parts.map((part, index) => (index > 0 ?\n    'm=' + part : part).trim() + '\\r\\n');\n};\n\n// Returns the session description.\nSDPUtils.getDescription = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// Returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(line => line.indexOf(prefix) === 0);\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\n// Input can be prefixed with a=.\nSDPUtils.parseCandidate = function(line) {\n  let parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  const candidate = {\n    foundation: parts[0],\n    component: {1: 'rtp', 2: 'rtcp'}[parts[1]] || parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7],\n  };\n\n  for (let i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compatibility.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag. Don't overwrite.\n        if (candidate[parts[i]] === undefined) {\n          candidate[parts[i]] = parts[i + 1];\n        }\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\n// This does not include the a= prefix!\nSDPUtils.writeCandidate = function(candidate) {\n  const sdp = [];\n  sdp.push(candidate.foundation);\n\n  const component = candidate.component;\n  if (component === 'rtp') {\n    sdp.push(1);\n  } else if (component === 'rtcp') {\n    sdp.push(2);\n  } else {\n    sdp.push(component);\n  }\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  const type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// Sample input:\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substring(14).split(' ');\n};\n\n// Parses a rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  let parts = line.substring(9).split(' ');\n  const parsed = {\n    payloadType: parseInt(parts.shift(), 10), // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generates a rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  const channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses a extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1],\n    attributes: parts.slice(2).join(' '),\n  };\n};\n\n// Generates an extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri +\n      (headerExtension.attributes ? ' ' + headerExtension.attributes : '') +\n      '\\r\\n';\n};\n\n// Parses a fmtp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  const parsed = {};\n  let kv;\n  const parts = line.substring(line.indexOf(' ') + 1).split(';');\n  for (let j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates a fmtp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  let line = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    const params = [];\n    Object.keys(codec.parameters).forEach(param => {\n      if (codec.parameters[param] !== undefined) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses a rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  const parts = line.substring(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' '),\n  };\n};\n\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  let lines = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(fb => {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses a RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  const sp = line.indexOf(' ');\n  const parts = {\n    ssrc: parseInt(line.substring(7, sp), 10),\n  };\n  const colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substring(sp + 1, colon);\n    parts.value = line.substring(colon + 1);\n  } else {\n    parts.attribute = line.substring(sp + 1);\n  }\n  return parts;\n};\n\n// Parse a ssrc-group line (see RFC 5576). Sample input:\n// a=ssrc-group:semantics 12 34\nSDPUtils.parseSsrcGroup = function(line) {\n  const parts = line.substring(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(ssrc => parseInt(ssrc, 10)),\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// Returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  const mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substring(6);\n  }\n};\n\n// Parses a fingerprint line for DTLS-SRTP.\nSDPUtils.parseFingerprint = function(line) {\n  const parts = line.substring(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1].toUpperCase(), // the definition is upper-case in RFC 4572.\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint),\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  let sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(fp => {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  const parts = keyParams.substring(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES parameters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  const ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  const pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substring(12),\n    password: pwd.substring(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  let sdp = 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n  if (params.iceLite) {\n    sdp += 'a=ice-lite\\r\\n';\n  }\n  return sdp;\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  const description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: [],\n  };\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  description.profile = mline[2];\n  for (let i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    const pt = mline[i];\n    const rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      const codec = SDPUtils.parseRtpMap(rtpmapline);\n      const fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(line => {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  const wildcardRtcpFb = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-fb:* ')\n    .map(SDPUtils.parseRtcpFb);\n  description.codecs.forEach(codec => {\n    wildcardRtcpFb.forEach(fb=> {\n      const duplicate = codec.rtcpFeedback.find(existingFeedback => {\n        return existingFeedback.type === fb.type &&\n          existingFeedback.parameter === fb.parameter;\n      });\n      if (!duplicate) {\n        codec.rtcpFeedback.push(fb);\n      }\n    });\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  let sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' ' + (caps.profile || 'UDP/TLS/RTP/SAVPF') + ' ';\n  sdp += caps.codecs.map(codec => {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(codec => {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  let maxptime = 0;\n  caps.codecs.forEach(codec => {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(extension => {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  const encodingParameters = [];\n  const description = SDPUtils.parseRtpParameters(mediaSection);\n  const hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  const hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  const ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(parts => parts.attribute === 'cname');\n  const primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  let secondarySsrc;\n\n  const flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(line => {\n      const parts = line.substring(17).split(' ');\n      return parts.map(part => parseInt(part, 10));\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(codec => {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      let encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red',\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc,\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  let bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substring(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substring(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(params => {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  const rtcpParameters = {};\n\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  const remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(obj => obj.attribute === 'cname')[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  const rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attr\u0456bute.\n  // Note that Edge does not support unmuxed RTCP.\n  const mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\nSDPUtils.writeRtcpParameters = function(rtcpParameters) {\n  let sdp = '';\n  if (rtcpParameters.reducedSize) {\n    sdp += 'a=rtcp-rsize\\r\\n';\n  }\n  if (rtcpParameters.mux) {\n    sdp += 'a=rtcp-mux\\r\\n';\n  }\n  if (rtcpParameters.ssrc !== undefined && rtcpParameters.cname) {\n    sdp += 'a=ssrc:' + rtcpParameters.ssrc +\n      ' cname:' + rtcpParameters.cname + '\\r\\n';\n  }\n  return sdp;\n};\n\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  let parts;\n  const spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substring(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  const planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(msidParts => msidParts.attribute === 'msid');\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  const mline = SDPUtils.parseMLine(mediaSection);\n  const maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  let maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substring(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  const sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substring(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize,\n    };\n  }\n  const sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    const parts = sctpMapLines[0]\n      .substring(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize,\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  let output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n',\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n',\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 22);\n};\n\n// Write boiler plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  let sessionId;\n  const version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  const user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  const lines = SDPUtils.splitLines(mediaSection);\n  for (let i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substring(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  return mline[0].substring(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const parts = lines[0].substring(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' '),\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  const line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  const parts = line.substring(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5],\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  const lines = SDPUtils.splitLines(blob);\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n", "declare global {\r\n    interface Promise<T> {\r\n        /** will reject the promise after a certain amount of time if it has not been fulfilled */\r\n        timeout(ms: number): Promise<T>;\r\n    }\r\n\r\n    interface PromiseConstructor {\r\n        timeout(ms: number): Promise<never>;\r\n    }\r\n}\r\n\r\nPromise.timeout = function (ms: number) {\r\n    return new Promise((res) => setTimeout(res, ms));\r\n};\r\n\r\nconsole.log(Promise.timeout);\r\n\r\nPromise.prototype.timeout = function (ms: number) {\r\n    return Promise.race([this, Promise.timeout(ms)]);\r\n};\r\nexport {};\r\n", "const IS_WORKER = typeof importScripts == \"function\";\r\n\r\nexport class Logger {\r\n    public context: string;\r\n    private color: string;\r\n\r\n    constructor(...context: string[]) {\r\n        this.context =\r\n            typeof context === \"string\" ? context : context.join(\" > \");\r\n\r\n        this.color = `hsl(${\r\n            JSON.stringify(context)\r\n                .split(\"\")\r\n                .reduce(\r\n                    (seed, val) => val.charCodeAt(0) + ((seed << 5) - seed),\r\n                    0\r\n                ) % 360\r\n        }, 70%, 60%)`;\r\n    }\r\n\r\n    group(...data: any[]) {\r\n        console.group(\r\n            ...this.generateContextPrefix(\"\u2800\u2800\", \"I\", \"bgWhite\", data)\r\n        );\r\n    }\r\n\r\n    groupCollapsed(...data: any[]) {\r\n        console.groupCollapsed(\r\n            ...this.generateContextPrefix(\"\u2800\u2800\", \"I\", \"bgWhite\", data)\r\n        );\r\n    }\r\n\r\n    groupEnd() {\r\n        console.groupEnd();\r\n    }\r\n\r\n    log(...data: any[]) {\r\n        this.info(...data);\r\n    }\r\n\r\n    logOk(...data: any[]) {\r\n        console.log(...this.generateContextPrefix(\"\u2714\uFE0F\", \"O\", \"bgGreen\", data));\r\n    }\r\n\r\n    debug(...data: any[]) {\r\n        console.log(...this.generateContextPrefix(\"\u2800\u2800\", \"D\", \"bgGray\", data));\r\n    }\r\n\r\n    info(...data: any[]) {\r\n        console.info(...this.generateContextPrefix(\"\u2800\u2800\", \"I\", \"bgWhite\", data));\r\n    }\r\n\r\n    warn(...data: any[]) {\r\n        console.warn(\r\n            ...this.generateContextPrefix(\"\u26A0\uFE0F\", \"W\", \"bgYellow\", data)\r\n        );\r\n    }\r\n\r\n    error(...data: any[]) {\r\n        console.error(...this.generateContextPrefix(\"\u274C\", \"!\", \"bgRed\", data));\r\n    }\r\n\r\n    generateContextPrefix(\r\n        emoji: string,\r\n        type: string,\r\n        bgColor: string,\r\n        data: any[]\r\n    ) {\r\n        let col = this.color,\r\n            extra = \"\";\r\n\r\n        switch (type) {\r\n            case \"O\":\r\n                col = \"lime\";\r\n                break;\r\n            case \"!\":\r\n                col = \"red\";\r\n                break;\r\n            case \"W\":\r\n                col = \"yellow\";\r\n                break;\r\n            case \"D\":\r\n                col = \"#888\";\r\n                extra = data.join(\" \");\r\n                data = [];\r\n                break;\r\n            case \"I\":\r\n                col = this.color;\r\n                break;\r\n        }\r\n\r\n        if (IS_WORKER) {\r\n            emoji = \"\u2699\uFE0F\";\r\n        }\r\n\r\n        return [\r\n            `%c ${emoji} %c ` + this.context.padEnd(30, \" \") + \" %c \" + extra,\r\n            `background: ${col}; color: #fff; padding: 2px 5px 0 5px;  border-top-left-radius: 3px; border-bottom-left-radius: 3px;`,\r\n            `background: #333438; color: ${col}; border-top-right-radius: 3px; border-bottom-right-radius: 3px; padding-top: 2px`,\r\n            \"color: gray\",\r\n            ...data,\r\n        ];\r\n    }\r\n}\r\n", "import { Entity } from \"./entity\";\r\nimport { World } from \"./world\";\r\nimport { Logger } from \"../utils/logger\";\r\n\r\nconst logger = new Logger(\"Archetype Manager\");\r\nexport class Archetype {\r\n    public readonly graph = {\r\n        added: new Map<number, Archetype>(),\r\n        removed: new Map<number, Archetype>(),\r\n    };\r\n\r\n    // Use the [length, ...data] syntax to sync archetypes between threads\r\n    public readonly entities: Int32Array;\r\n\r\n    // Keep track of modifications so we dont have to diff the whole archetype every time\r\n    // I would like to use something other than time for this, but theres a whole host of bugs that\r\n    // come with using a combination of the last function (add, remove) and the entity.\r\n    public lastModified: number;\r\n\r\n    constructor(\r\n        public readonly id: number,\r\n        public readonly components: Set<number>,\r\n        expectedSize: number\r\n    ) {\r\n        this.entities = new Int32Array(\r\n            new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT * (expectedSize + 1))\r\n        );\r\n        this.lastModified = performance.now();\r\n    }\r\n\r\n    addEntity(entity: Entity) {\r\n        // TODO: Check if max length is reached\r\n        this.entities[++this.entities[0]] = entity;\r\n\r\n        this.lastModified = performance.now();\r\n    }\r\n\r\n    removeEntity(entity: Entity) {\r\n        for (let i = 1; i <= this.entities[0]; i++) {\r\n            if (this.entities[i] === entity) {\r\n                // Swap the entity and the last one\r\n                this.entities[i] = this.entities[this.entities[0]--];\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.lastModified = performance.now();\r\n    }\r\n\r\n    /** @internal */\r\n    resize(size: number) {\r\n        const newArr = new Int32Array(\r\n            new SharedArrayBuffer((size + 1) * Int32Array.BYTES_PER_ELEMENT)\r\n        );\r\n        newArr.set(this.entities);\r\n\r\n        //@ts-expect-error\r\n        this.entities = newArr;\r\n    }\r\n}\r\n\r\nexport class ArchetypeManager {\r\n    public readonly archetypes: Map<number, Archetype> = new Map();\r\n    public readonly entityArchetypes: Int32Array;\r\n    private nextArchetypeId = 1;\r\n\r\n    public readonly defaultArchetype: Archetype = new Archetype(0, new Set(), 1);\r\n\r\n    constructor(private world: World) {\r\n        // Set the default archetype, which isn't expected to have a lot of components\r\n        this.archetypes.set(0, this.defaultArchetype);\r\n\r\n        this.entityArchetypes = new Int32Array(\r\n            new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT * world.maxEntities)\r\n        );\r\n    }\r\n\r\n    loadFromData(data: any): void {\r\n        logger.log(\"Loading from data dump:\", data);\r\n\r\n        //@ts-ignore\r\n        this.defaultArchetype = Object.create(\r\n            Archetype.prototype,\r\n            Object.getOwnPropertyDescriptors(data.defaultArchetype)\r\n        );\r\n\r\n        data.archetypes.forEach((archetype: Archetype, id: number) => {\r\n            this.archetypes.set(\r\n                id,\r\n                Object.create(\r\n                    Archetype.prototype,\r\n                    Object.getOwnPropertyDescriptors(archetype)\r\n                )\r\n            );\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.entityArchetypes = data.entityArchetypes;\r\n    }\r\n\r\n    createNewArchetype(components: Set<number>) {\r\n        logger.log(\"Creating new archetype for components:\", components);\r\n\r\n        const newArchetype = new Archetype(\r\n            this.nextArchetypeId++,\r\n            components,\r\n            this.world.maxEntities\r\n        );\r\n        this.world.queryManager.onNewArchetypeCreated(newArchetype);\r\n        this.world.workerManager.onNewArchetypeCreated(newArchetype);\r\n        this.archetypes.set(newArchetype.id, newArchetype);\r\n\r\n        return newArchetype;\r\n    }\r\n\r\n    getOrCreateArchetype(components: Set<number>): Archetype {\r\n        for (const [_, archetype] of this.archetypes) {\r\n            if (archetype.components.size !== components.size) continue;\r\n\r\n            let hasAll = true;\r\n            for (const needed of components) {\r\n                if (!archetype.components.has(needed)) {\r\n                    hasAll = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (hasAll) return archetype;\r\n        }\r\n\r\n        return this.createNewArchetype(components);\r\n    }\r\n\r\n    moveWithoutGraph(entity: Entity, from: Archetype, to: Archetype) {\r\n        from.removeEntity(entity);\r\n        to.addEntity(entity);\r\n        this.entityArchetypes[entity] = to.id;\r\n    }\r\n\r\n    addEntity(entity: Entity) {\r\n        this.entityArchetypes[entity] = 0;\r\n        this.defaultArchetype.addEntity(entity);\r\n    }\r\n\r\n    entityAddComponent(entity: Entity, component: number) {\r\n        if (entity.has(component)) {\r\n            logger.warn(\r\n                \"Entity\",\r\n                entity,\r\n                \"tried to add component (ID:\",\r\n                component,\r\n                \") which it already had\"\r\n            );\r\n            return;\r\n        }\r\n        // TODO: Make this faster\r\n        const firstArchetype = this.archetypes.get(this.entityArchetypes[entity])!;\r\n\r\n        firstArchetype.removeEntity(entity);\r\n\r\n        if (!firstArchetype.graph.added.has(component)) {\r\n            // Slow route\r\n            for (const [id, candidateArchetype] of this.archetypes.entries()) {\r\n                // Check length to make it a bit faster\r\n                if (\r\n                    candidateArchetype.components.size ==\r\n                    firstArchetype.components.size + 1\r\n                ) {\r\n                    // Make sure it has all the old ones plus the new one\r\n                    if (\r\n                        candidateArchetype.components.has(component) &&\r\n                        firstArchetype.components.every((c) =>\r\n                            candidateArchetype.components.has(c)\r\n                        )\r\n                    ) {\r\n                        firstArchetype.graph.added.set(\r\n                            component,\r\n                            candidateArchetype\r\n                        );\r\n\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!firstArchetype.graph.added.has(component)) {\r\n                // If we get here, we need to create a new archetype\r\n                const newArchetype = this.createNewArchetype(\r\n                    firstArchetype.components.concat(component)\r\n                );\r\n                firstArchetype.graph.added.set(component, newArchetype);\r\n            }\r\n        }\r\n\r\n        // Finally add everything\r\n        const newArchetype = firstArchetype.graph.added.get(component)!;\r\n        newArchetype.addEntity(entity);\r\n        this.entityArchetypes[entity] = newArchetype.id;\r\n    }\r\n\r\n    entityRemoveComponent(entity: Entity, component: number) {\r\n        if (!entity.has(component)) {\r\n            logger.warn(\r\n                \"Entity\",\r\n                entity,\r\n                \"tried to remove component (ID:\",\r\n                component,\r\n                \") which it did not have\"\r\n            );\r\n            return;\r\n        }\r\n\r\n        // Very similar to entityAddComponent, check there for comments\r\n        const firstArchetype = this.archetypes.get(this.entityArchetypes[entity])!;\r\n\r\n        firstArchetype.removeEntity(entity);\r\n\r\n        if (!firstArchetype.graph.removed.has(component)) {\r\n            for (const [id, candidateArchetype] of this.archetypes) {\r\n                if (\r\n                    candidateArchetype.components.size ==\r\n                    firstArchetype.components.size - 1\r\n                ) {\r\n                    if (\r\n                        candidateArchetype.components.every(\r\n                            (c) =>\r\n                                c !== component && firstArchetype.components.has(c)\r\n                        )\r\n                    ) {\r\n                        firstArchetype.graph.removed.set(\r\n                            component,\r\n                            candidateArchetype\r\n                        );\r\n\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!firstArchetype.graph.removed.has(component)) {\r\n                const newArchetype = this.createNewArchetype(\r\n                    firstArchetype.components.filter((x) => x !== component)\r\n                );\r\n                firstArchetype.graph.removed.set(component, newArchetype);\r\n            }\r\n        }\r\n\r\n        const newArchetype = firstArchetype.graph.removed.get(component)!;\r\n        newArchetype.addEntity(entity);\r\n        this.entityArchetypes[entity] = newArchetype.id;\r\n    }\r\n\r\n    resize(maxEnts: number) {\r\n        for (const [_, archetype] of this.archetypes) {\r\n            archetype.resize(maxEnts);\r\n        }\r\n    }\r\n\r\n    update() {\r\n        // Used for overrides in multiplayer version\r\n    }\r\n}\r\n", "export function walk<const T>(\r\n    fn: (arg: T, add: (arg: T) => void) => T[] | void,\r\n    ...initialData: T[]\r\n) {\r\n    while (initialData.length) {\r\n        const res = fn(initialData.pop()!, initialData.push);\r\n        if (res == null) continue;\r\n\r\n        initialData.push(...res);\r\n    }\r\n}\r\n", "export function findGetter(\r\n    obj: any,\r\n    prop: PropertyKey\r\n): (() => any) | undefined {\r\n    while (obj) {\r\n        const desc = Object.getOwnPropertyDescriptor(obj, prop);\r\n        if (desc) {\r\n            return desc.get;\r\n        }\r\n        obj = Object.getPrototypeOf(obj);\r\n    }\r\n}\r\n\r\nexport function findSetter(\r\n    obj: any,\r\n    prop: PropertyKey\r\n): ((arg: any) => void) | undefined {\r\n    while (obj) {\r\n        const desc = Object.getOwnPropertyDescriptor(obj, prop);\r\n        if (desc) {\r\n            return desc.set;\r\n        }\r\n        obj = Object.getPrototypeOf(obj);\r\n    }\r\n}\r\n", "import { Logger } from \"../utils/logger\";\r\nimport { Class } from \"../utils/types\";\r\nimport { findGetter, findSetter } from \"../utils/polyfills\";\r\nimport { Entity } from \"./entity\";\r\nimport { World } from \"./world\";\r\nimport { TypeId } from \"./types\";\r\nimport { UnwrapTypeId } from \"./component\";\r\n\r\nconst logger = new Logger(\"Component Storage\");\r\n\r\nexport class StorageManager {\r\n    public readonly storages: ComponentStorage[] = [];\r\n\r\n    private readonly updateQueue: ComponentStorage[] = [];\r\n    private readonly storagesByType = new Map<number, ComponentStorage[]>();\r\n\r\n    constructor(public world: World) {}\r\n\r\n    loadFromData(data: ComponentStorage[]) {\r\n        logger.log(\"Loading from data dump:\", data);\r\n        data.forEach((storage, id) => {\r\n            // Still need to actually create the class\r\n            this.storages[id] = Object.create(\r\n                COMPONENT_STORAGES.get(storage.id)!.prototype,\r\n                Object.getOwnPropertyDescriptors(storage)\r\n            );\r\n        });\r\n    }\r\n\r\n    private createStorage(id: number, storageId: number): ComponentStorage {\r\n        const StorageClass = COMPONENT_STORAGES.get(storageId)!;\r\n        const storage = new StorageClass(id, this.world.maxEntities);\r\n\r\n        if (storage.needsUpdate) this.updateQueue.push(storage);\r\n\r\n        if (!this.storagesByType.has(storage.kind)) {\r\n            this.storagesByType.set(storage.kind, [storage]);\r\n        } else {\r\n            this.storagesByType.get(storage.kind)!.push(storage);\r\n        }\r\n\r\n        logger.log(\"Created new data storage for\", id, \"(Type:\", storageId, \")\");\r\n\r\n        return storage;\r\n    }\r\n\r\n    getOrCreateStorage(id: number, storageId: number) {\r\n        if (this.storages[id]) return this.storages[id];\r\n\r\n        this.storages[id] = this.createStorage(id, storageId);\r\n\r\n        return this.storages[id];\r\n    }\r\n\r\n    resize(maxEnts: number) {\r\n        for (let i = this.storages.length - 1; i >= 0; i--) {\r\n            this.storages[i].resize(maxEnts);\r\n        }\r\n    }\r\n\r\n    update() {\r\n        for (let i = this.updateQueue.length - 1; i >= 0; i--) {\r\n            this.updateQueue[i].update!();\r\n        }\r\n    }\r\n\r\n    getAllByType<T extends TypeId<ComponentStorage>>(\r\n        type: T\r\n    ): ReadonlyArray<UnwrapTypeId<T>> {\r\n        return (this.storagesByType.get(type) ?? []) as any;\r\n    }\r\n}\r\n\r\nexport interface StorageKind {\r\n    readonly any: TypeId<AnyComponentStorage>;\r\n\r\n    readonly f64: TypeId<AbstractNumberComponentStorage<Float64Array>>;\r\n    readonly f32: TypeId<AbstractNumberComponentStorage<Float32Array>>;\r\n    readonly i8: TypeId<AbstractNumberComponentStorage<Int8Array>>;\r\n    readonly i16: TypeId<AbstractNumberComponentStorage<Int16Array>>;\r\n    readonly i32: TypeId<AbstractNumberComponentStorage<Int32Array>>;\r\n    readonly u8: TypeId<AbstractNumberComponentStorage<Uint8Array>>;\r\n    readonly u16: TypeId<AbstractNumberComponentStorage<Uint16Array>>;\r\n    readonly u32: TypeId<AbstractNumberComponentStorage<Uint32Array>>;\r\n\r\n    readonly bool: TypeId<BooleanComponentStorage>;\r\n}\r\n\r\nexport const StorageKind: StorageKind = {} as any;\r\n\r\nexport function addStorageKind<T extends keyof StorageKind>(name: T, id: number) {\r\n    //@ts-ignore\r\n    StorageKind[name] = id;\r\n}\r\n\r\naddStorageKind(\"any\", 0);\r\naddStorageKind(\"f64\", 1);\r\naddStorageKind(\"f32\", 2);\r\naddStorageKind(\"i8\", 3);\r\naddStorageKind(\"i16\", 4);\r\naddStorageKind(\"i32\", 5);\r\naddStorageKind(\"u8\", 6);\r\naddStorageKind(\"u16\", 7);\r\naddStorageKind(\"u32\", 8);\r\naddStorageKind(\"bool\", 9);\r\n\r\nexport interface ComponentStorage<T = any> {\r\n    getEnt(id: Entity): T;\r\n    addOrSetEnt(id: Entity, val: T): void;\r\n    deleteEnt(id: Entity): void;\r\n\r\n    resize(maxEnts: number): void;\r\n\r\n    // Id refers to the exact storage class, while kind refers to the kind of storage\r\n    // For example, 2 enum storages with different options have the same kind but different ids\r\n    readonly id: number;\r\n    readonly kind: number;\r\n\r\n    readonly needsUpdate: boolean;\r\n\r\n    update?(): void;\r\n}\r\n\r\nexport abstract class ComponentStorage<T = any> {\r\n    public internalArray!: ArrayLike<T | number>;\r\n    public readonly needsUpdate: boolean = false;\r\n\r\n    constructor(public readonly id: number, size: number) {}\r\n\r\n    link<T>(\r\n        object: T,\r\n        property: keyof T,\r\n        entity: Entity,\r\n        slowBackwardsLink: boolean = false\r\n    ): void {\r\n        if (slowBackwardsLink) {\r\n            const getter = findGetter(object, property);\r\n            const setter = findSetter(object, property);\r\n\r\n            Object.defineProperty(this.internalArray, entity, {\r\n                get: getter ? getter : () => object[property],\r\n                set: setter ? setter : (v) => (object[property] = v),\r\n                enumerable: true,\r\n                configurable: true,\r\n            });\r\n        }\r\n\r\n        Object.defineProperty(object, property, {\r\n            get: () => this.getEnt(entity),\r\n            set: (val) => this.addOrSetEnt(entity, val),\r\n        });\r\n    }\r\n}\r\n\r\nexport class AnyComponentStorage extends ComponentStorage<any> {\r\n    public internalArray: any[] = [];\r\n    public readonly id = StorageKind.any;\r\n    public readonly kind = StorageKind.any;\r\n\r\n    getEnt(id: number) {\r\n        return this.internalArray[id];\r\n    }\r\n\r\n    addOrSetEnt(id: number, val: any) {\r\n        this.internalArray[id] = val;\r\n    }\r\n\r\n    deleteEnt(id: number) {\r\n        delete this.internalArray[id];\r\n    }\r\n\r\n    resize(maxEnts: number): void {}\r\n}\r\n\r\nObject.defineProperty(Object.prototype, \"storageKind\", {\r\n    configurable: true,\r\n    enumerable: false,\r\n    writable: true,\r\n    value: StorageKind.any,\r\n});\r\n\r\nexport const NUMBER_TYPED_ARRAYS = [\r\n    Int8Array,\r\n    Int16Array,\r\n    Int32Array,\r\n    // BigInt64Array,\r\n    Uint8Array,\r\n    Uint16Array,\r\n    Uint32Array,\r\n    // BigUint64Array,\r\n    Float32Array,\r\n    Float64Array,\r\n] as const;\r\nexport type NumberTypedArrayConstructor = (typeof NUMBER_TYPED_ARRAYS)[number];\r\n\r\nexport interface AbstractNumberComponentStorage<\r\n    T extends InstanceType<NumberTypedArrayConstructor> = InstanceType<NumberTypedArrayConstructor>\r\n> extends ComponentStorage<number> {\r\n    internalArray: T;\r\n\r\n    inc(ent: Entity, amount: number): void;\r\n    mult(ent: Entity, amount: number): void;\r\n    mod(ent: Entity, modulo: number): void;\r\n}\r\n\r\nfunction createNumberComponentStorage<\r\n    T extends NumberTypedArrayConstructor,\r\n    I extends TypeId<ComponentStorage<number>>\r\n>(id: I, constructor: T) {\r\n    return class NumberComponentStorage extends ComponentStorage<number> {\r\n        public internalArray: InstanceType<T>;\r\n        public readonly id: I = id;\r\n        public readonly kind: I = id;\r\n\r\n        constructor(id: number, maxEnts: number) {\r\n            super(id, maxEnts);\r\n\r\n            this.internalArray = new constructor(\r\n                new SharedArrayBuffer(constructor.BYTES_PER_ELEMENT * maxEnts)\r\n            ) as any;\r\n\r\n            // By default we use the faster x= operators in the number methods.\r\n            // However, some wrapper storages might need to know about these changes\r\n            // via addOrSetEnt. So if we are in a wrapper class, make sure to change these methods\r\n\r\n            const newTarget = new.target as any;\r\n            if (newTarget !== NumberComponentStorage && !newTarget.patchedByNCS) {\r\n                new.target.prototype.inc = function (ent, amount = 1) {\r\n                    this.addOrSetEnt(ent, this.getEnt(ent) + amount);\r\n                };\r\n                new.target.prototype.mult = function (ent, amount) {\r\n                    this.addOrSetEnt(ent, this.getEnt(ent) * amount);\r\n                };\r\n                new.target.prototype.mod = function (ent, modulo) {\r\n                    this.addOrSetEnt(ent, this.getEnt(ent) % modulo);\r\n                };\r\n\r\n                newTarget.patchedByNCS = true;\r\n            }\r\n        }\r\n\r\n        resize(maxEnts: number): void {\r\n            const old = this.internalArray;\r\n            this.internalArray = new constructor(\r\n                new SharedArrayBuffer(constructor.BYTES_PER_ELEMENT * maxEnts)\r\n            ) as any;\r\n            this.internalArray.set(old);\r\n        }\r\n\r\n        getEnt(id: number) {\r\n            return this.internalArray[id];\r\n        }\r\n\r\n        deleteEnt(id: number): void {\r\n            // Could be unsafe, but getting it will just return the old one\r\n        }\r\n\r\n        addOrSetEnt(id: number, val: number): void {\r\n            this.internalArray[id] = val;\r\n        }\r\n\r\n        inc(ent: Entity, amount: number) {\r\n            this.internalArray[ent] += amount;\r\n        }\r\n\r\n        mult(ent: Entity, amount: number) {\r\n            this.internalArray[ent] *= amount;\r\n        }\r\n\r\n        mod(ent: Entity, modulo: number) {\r\n            this.internalArray[ent] %= modulo;\r\n        }\r\n    };\r\n}\r\n\r\nexport const F64ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.f64,\r\n    Float64Array\r\n);\r\nexport const F32ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.f32,\r\n    Float32Array\r\n);\r\nexport const I8ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.i8,\r\n    Int16Array\r\n);\r\nexport const I16ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.i16,\r\n    Int16Array\r\n);\r\nexport const I32ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.i32,\r\n    Int32Array\r\n);\r\nexport const U8ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.u8,\r\n    Uint16Array\r\n);\r\nexport const U16ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.u16,\r\n    Uint16Array\r\n);\r\nexport const U32ComponentStorage = createNumberComponentStorage(\r\n    StorageKind.u32,\r\n    Uint32Array\r\n);\r\n\r\nObject.defineProperty(Number.prototype, \"storageKind\", {\r\n    configurable: true,\r\n    enumerable: false,\r\n    writable: true,\r\n    value: StorageKind.f64,\r\n});\r\n\r\nexport class BooleanComponentStorage extends ComponentStorage<boolean> {\r\n    public internalArray: Uint8Array;\r\n\r\n    public readonly id: number = StorageKind.bool;\r\n    public readonly kind: number = StorageKind.bool;\r\n\r\n    constructor(id: number, maxEnts: number) {\r\n        super(id, maxEnts);\r\n        this.internalArray = new Uint8Array(\r\n            new SharedArrayBuffer(Uint8Array.BYTES_PER_ELEMENT * maxEnts)\r\n        );\r\n    }\r\n\r\n    getEnt(id: number): boolean {\r\n        return !!this.internalArray[id];\r\n    }\r\n\r\n    addOrSetEnt(id: number, val: boolean): void {\r\n        this.internalArray[id] = +val;\r\n    }\r\n\r\n    deleteEnt(id: number): void {\r\n        // this.internalArray[id] = 2;\r\n    }\r\n\r\n    resize(maxEnts: number): void {\r\n        const old = this.internalArray;\r\n        this.internalArray = new Uint8Array(\r\n            new SharedArrayBuffer(Uint8Array.BYTES_PER_ELEMENT * maxEnts)\r\n        );\r\n        this.internalArray.set(old);\r\n    }\r\n}\r\n\r\nObject.defineProperty(Boolean.prototype, \"storageKind\", {\r\n    configurable: true,\r\n    enumerable: false,\r\n    writable: true,\r\n    value: StorageKind.bool,\r\n});\r\n\r\nexport const COMPONENT_STORAGES: Map<number, Class<ComponentStorage>> = new Map();\r\n\r\nCOMPONENT_STORAGES.set(0, AnyComponentStorage);\r\nCOMPONENT_STORAGES.set(1, F64ComponentStorage);\r\nCOMPONENT_STORAGES.set(2, F32ComponentStorage);\r\nCOMPONENT_STORAGES.set(3, I8ComponentStorage);\r\nCOMPONENT_STORAGES.set(4, I16ComponentStorage);\r\nCOMPONENT_STORAGES.set(5, I32ComponentStorage);\r\nCOMPONENT_STORAGES.set(6, U8ComponentStorage);\r\nCOMPONENT_STORAGES.set(7, U16ComponentStorage);\r\nCOMPONENT_STORAGES.set(8, U32ComponentStorage);\r\nCOMPONENT_STORAGES.set(9, BooleanComponentStorage);\r\n", "import { Logger } from \"../utils/logger\";\r\nimport { Class } from \"../utils/types\";\r\nimport { Entity } from \"./entity\";\r\nimport {\r\n    COMPONENT_STORAGES,\r\n    ComponentStorage,\r\n    StorageKind,\r\n    addStorageKind,\r\n} from \"./storage\";\r\nimport { TypeId } from \"./types\";\r\n\r\nconst logger = new Logger(\"Custom Storages\");\r\n\r\nexport type CustomComponentStorageOptions =\r\n    | ({ type: typeof StorageKind.logged } & LoggedComponentStorageOptions)\r\n    | ({ type: typeof StorageKind.enum } & EnumComponentStorageOptions)\r\n    | ({ type: typeof StorageKind.nullable } & NullableComponentStorageOptions)\r\n    | ({ type: typeof StorageKind.ranged } & RangedComponentStorageOptions);\r\n\r\nexport const CUSTOM_COMPONENT_STORAGES: Map<\r\n    number,\r\n    CustomComponentStorageOptions\r\n> = new Map();\r\n\r\nexport function loadCustomComponentStorages(\r\n    customStorages: Map<number, CustomComponentStorageOptions>\r\n) {\r\n    logger.log(\r\n        \"Loading custom storage classes from data dump:\",\r\n        customStorages\r\n    );\r\n\r\n    for (const [id, data] of customStorages) {\r\n        COMPONENT_STORAGES.set(id, createCustomStorage(data.type, data));\r\n    }\r\n}\r\n\r\nexport const customComponentStorageCache: Record<\r\n    number,\r\n    Map<string, number>\r\n> = {\r\n    3: new Map(),\r\n    4: new Map(),\r\n    5: new Map(),\r\n    6: new Map(),\r\n};\r\n\r\ndeclare module \"./storage\" {\r\n    interface StorageKind {\r\n        readonly logged: TypeId<LoggedComponentStorage<any>> & 3;\r\n        readonly enum: TypeId<EnumComponentStorage<any>> & 4;\r\n        readonly nullable: TypeId<NullableComponentStorage<any>> & 5;\r\n        readonly ranged: TypeId<RangedComponentStorage<any>> & 6;\r\n    }\r\n}\r\n\r\naddStorageKind(\"logged\", 3);\r\naddStorageKind(\"enum\", 4);\r\naddStorageKind(\"nullable\", 5);\r\naddStorageKind(\"ranged\", 6);\r\n\r\nconst customStorageFactories = {\r\n    3: createLoggedStorage,\r\n    4: createEnumComponentStorage,\r\n    5: createNullableComponentStorage,\r\n    6: createRangedComponentStorage,\r\n} as any as Record<\r\n    number,\r\n    (\r\n        id: number,\r\n        options: CustomComponentStorageOptions\r\n    ) => Class<ComponentStorage<any>>\r\n>;\r\n\r\nexport function createCustomStorage(\r\n    id: number,\r\n    options: CustomComponentStorageOptions\r\n): Class<ComponentStorage<any>> {\r\n    return customStorageFactories[options.type](id, options);\r\n}\r\n\r\nexport function registerCustomStorage(\r\n    options: CustomComponentStorageOptions\r\n): number {\r\n    const optionsStr = JSON.stringify(options);\r\n\r\n    if (customComponentStorageCache[options.type].has(optionsStr)) {\r\n        return customComponentStorageCache[options.type].get(optionsStr)!;\r\n    }\r\n\r\n    const id = COMPONENT_STORAGES.size;\r\n\r\n    customComponentStorageCache[options.type].set(optionsStr, id);\r\n\r\n    const constructor = customStorageFactories[options.type](id, options);\r\n    COMPONENT_STORAGES.set(id, constructor);\r\n    CUSTOM_COMPONENT_STORAGES.set(id, options);\r\n    return id;\r\n}\r\n\r\n/* Each custom component implementation storage has 3 parts\r\n    - An interface:\r\n        interface xyzComponentStorage extends ComponentStorage {}\r\n        Holds typings for that kind of storage, as most of them are just extended classes\r\n    \r\n    - Options: \r\n        interface xyzComponentStorageOptions \r\n        The options that you pass into the constructor\r\n    \r\n    - A factory function:\r\n        function createXYZStorage(id: number, options: Options): ComponentStorage\r\n        It actually creates the storage class given the ID\r\n*/\r\n\r\nexport interface LoggedComponentStorage<T> extends ComponentStorage<T> {\r\n    rollback(numFrames: number, clearFuture?: boolean): void;\r\n}\r\n\r\ninterface LoggedComponentStorageOptions {\r\n    backingStorageId: number;\r\n    bufferSize: number;\r\n}\r\n\r\nfunction createLoggedStorage<T>(\r\n    id: number,\r\n    { backingStorageId, bufferSize }: LoggedComponentStorageOptions\r\n): Class<ComponentStorage<T>> {\r\n    const superStorage = COMPONENT_STORAGES.get(backingStorageId)! as Class<\r\n        ComponentStorage<T>\r\n    >;\r\n\r\n    return class LoggedStorage\r\n        extends superStorage\r\n        implements LoggedComponentStorage<T>\r\n    {\r\n        private readonly bufferSize = bufferSize;\r\n        public readonly needsUpdate: boolean = true;\r\n        public readonly id: number = id;\r\n        public readonly kind = StorageKind.logged;\r\n\r\n        // This is a list of updates to stuff,\r\n        public readonly log: ReadonlyArray<ReadonlyMap<Entity, T> | null> =\r\n            new Array(bufferSize);\r\n        private readonly writeableLog: (Map<Entity, T> | null)[] = this\r\n            .log as any;\r\n\r\n        addOrSetEnt(id: Entity, val: any): void {\r\n            if (!this.log[0]) {\r\n                this.writeableLog[0] = new Map();\r\n            }\r\n\r\n            const map = this.writeableLog[0]!;\r\n\r\n            // I want to keep track of what the value was at the start of this frame\r\n            // that way when we rollback we go to that value\r\n            // The next time something is set we will log the value that is now in there\r\n            // in the event that a value is changed more than once a frame, we want to keep the\r\n            // beginning value, which is why we make sure the map doesn't already have the entity\r\n            if (!map.has(id)) {\r\n                map.set(id, super.getEnt(id));\r\n            }\r\n\r\n            super.addOrSetEnt(id, val);\r\n        }\r\n\r\n        update() {\r\n            if (this.writeableLog.unshift(null) > this.bufferSize)\r\n                this.writeableLog.pop();\r\n        }\r\n\r\n        // This is the number of frames BEFORE the current frame to go back.\r\n        // For example, rollback(0) will set the state back to the start of this frame\r\n        rollback(numFrames: number) {\r\n            if (numFrames > this.bufferSize) {\r\n                logger.log(\r\n                    \"Can not rollback\",\r\n                    numFrames,\r\n                    \"frames, max buffer size is\",\r\n                    this.bufferSize,\r\n                    \"frames\"\r\n                );\r\n                numFrames = this.bufferSize;\r\n            }\r\n\r\n            for (let i = 0; i < numFrames + 1; i++) {\r\n                if (!this.log[i]) continue;\r\n\r\n                this.log[i]!.forEach((val, ent) => {\r\n                    super.addOrSetEnt(ent, val);\r\n                });\r\n            }\r\n            this.writeableLog.splice(0, numFrames + 1);\r\n        }\r\n    };\r\n}\r\n\r\nexport interface EnumComponentStorage<T extends string>\r\n    extends ComponentStorage<T> {\r\n    readonly options: ReadonlyArray<T>;\r\n}\r\n\r\ninterface EnumComponentStorageOptions<T extends string = string> {\r\n    options: T[];\r\n}\r\n\r\n// Ones that can be created\r\nfunction createEnumComponentStorage<T extends string>(\r\n    newId: number,\r\n    { options }: EnumComponentStorageOptions<T>\r\n) {\r\n    class EnumStorage\r\n        extends ComponentStorage<T>\r\n        implements EnumComponentStorage<T>\r\n    {\r\n        public internalArray: Uint8Array;\r\n        private internalMap?: Map<any, number>;\r\n        public readonly id: number = newId;\r\n        public readonly kind = StorageKind.enum;\r\n\r\n        public readonly options: ReadonlyArray<T> = options;\r\n\r\n        constructor(id: number, maxEnts: number) {\r\n            super(id, maxEnts);\r\n            this.internalArray = new Uint8Array(\r\n                new SharedArrayBuffer(Uint8Array.BYTES_PER_ELEMENT * maxEnts)\r\n            );\r\n\r\n            // See what happens when we used a map and not an array + indexof\r\n            if (options.length > 20) {\r\n            }\r\n        }\r\n\r\n        getEnt(id: number): T {\r\n            return options[this.internalArray[id]];\r\n        }\r\n\r\n        addOrSetEnt(id: number, value: T): void {\r\n            this.internalArray[id] = options.indexOf(value);\r\n        }\r\n\r\n        deleteEnt(id: number): void {\r\n            // this.internalData[id] = 0;\r\n        }\r\n\r\n        resize(maxEnts: number): void {\r\n            const old = this.internalArray;\r\n            this.internalArray = new Uint8Array(\r\n                new SharedArrayBuffer(Uint8Array.BYTES_PER_ELEMENT * maxEnts)\r\n            );\r\n            this.internalArray.set(old);\r\n        }\r\n    }\r\n}\r\n\r\nexport interface NullableComponentStorage<T> extends ComponentStorage<T> {}\r\ninterface NullableComponentStorageOptions {\r\n    backingStorageId: number;\r\n}\r\n\r\nfunction createNullableComponentStorage<T>(\r\n    id: number,\r\n    options: NullableComponentStorageOptions\r\n) {\r\n    const superStorage = COMPONENT_STORAGES.get(\r\n        options.backingStorageId\r\n    )! as Class<ComponentStorage<T>>;\r\n\r\n    return class NullableStorage\r\n        extends superStorage\r\n        implements NullableComponentStorage<T>\r\n    {\r\n        private readonly nullValues: Set<number> = new Set();\r\n        public readonly id: number = id;\r\n        public readonly kind = StorageKind.nullable;\r\n\r\n        addOrSetEnt(id: Entity, val: T): void {\r\n            if (val == null) {\r\n                this.nullValues.add(id);\r\n            } else {\r\n                super.addOrSetEnt(id, val);\r\n            }\r\n        }\r\n\r\n        getEnt(id: Entity): T {\r\n            if (this.nullValues.has(id)) return null as any;\r\n            return super.getEnt(id);\r\n        }\r\n\r\n        resize(maxEnts: number): void {\r\n            super.resize(maxEnts);\r\n        }\r\n\r\n        deleteEnt(id: Entity): void {\r\n            super.deleteEnt(id);\r\n        }\r\n    };\r\n}\r\n\r\n/* \r\n    Ranged component storages only hold on to data for a range of entities, not World.maxEntityCount\r\n\r\n    This is done by extending the backing storage and shifting the entity range to start at 0\r\n*/\r\nexport interface RangedComponentStorage<T> extends ComponentStorage<T> {}\r\ninterface RangedComponentStorageOptions {\r\n    backingStorageId: number;\r\n    capacity: number;\r\n}\r\n\r\nfunction createRangedComponentStorage<T>(\r\n    id: number,\r\n    { backingStorageId, capacity }: RangedComponentStorageOptions\r\n) {\r\n    const superStorage = COMPONENT_STORAGES.get(backingStorageId)! as Class<\r\n        ComponentStorage<T>\r\n    >;\r\n\r\n    return class RangedStorage\r\n        extends superStorage\r\n        implements RangedComponentStorage<T>\r\n    {\r\n        private first!: number;\r\n        public readonly kind = StorageKind.ranged;\r\n\r\n        constructor() {\r\n            super(id, capacity);\r\n        }\r\n\r\n        addOrSetEnt(id: Entity, val: T): void {\r\n            if (this.first === undefined) {\r\n                this.first = id;\r\n            }\r\n\r\n            return super.addOrSetEnt((id - this.first) as Entity, val);\r\n        }\r\n\r\n        getEnt(id: Entity): T {\r\n            return super.getEnt((id - this.first) as Entity);\r\n        }\r\n\r\n        deleteEnt(id: Entity): void {\r\n            return super.deleteEnt((id - this.first) as Entity);\r\n        }\r\n\r\n        resize(maxEnts: number): void {\r\n            return;\r\n        }\r\n    };\r\n}\r\n", "import { Logger } from \"../utils/logger\";\r\nimport {\r\n    Class,\r\n    FixedLengthArray,\r\n    MatchingTree,\r\n    NullableTree,\r\n    Tree,\r\n    TreeBranch,\r\n} from \"../utils/types\";\r\nimport { Entity } from \"./entity\";\r\nimport { ComponentStorage, StorageKind } from \"./storage\";\r\nimport { registerCustomStorage } from \"./custom_storages\";\r\nimport { Component } from \"./component\";\r\n\r\nexport type TypeId<T = any> = number & {\r\n    _type: T;\r\n};\r\n\r\nexport function asTypeId<T>(val: number | string): TypeId<T> {\r\n    return (typeof val === \"number\" ? val : val.getId()) as TypeId<T>;\r\n}\r\n\r\nexport type TypeTreeLeaf = TypeId | TypeIdBuilder<any> | TypeBuilder<any>;\r\nexport type TypeTree = Tree<TypeTreeLeaf>; //Tree<TypeId | TypeIdBuilder | TypeBuilder<any>>;\r\n\r\nexport type AsTypeIdTree_Patch<T extends TypeTree> = AsTypeIdTree<TypeBuilder<T>>;\r\nexport type AsTypeIdTree<T extends TypeTree> = T extends TypeId\r\n    ? T\r\n    : T extends TypeIdBuilder<infer U>\r\n    ? TypeId<U>\r\n    : T extends TypeBuilder<infer V>\r\n    ? AsTypeIdTree<V>\r\n    : {\r\n          [K in keyof T]: T[K] extends TypeTree ? AsTypeIdTree<T[K]> : never;\r\n      };\r\n\r\nexport type ExtractTypeTree<T extends TypeTree> = T extends TypeId<infer U>\r\n    ? U\r\n    : T extends TypeIdBuilder<infer V>\r\n    ? V\r\n    : T extends TypeBuilder<infer W>\r\n    ? AsTypeIdTree<W>\r\n    : {\r\n          [K in keyof T as T[K] extends TypeTree ? K : never]: T[K] extends TypeTree\r\n              ? AsTypeIdTree<T[K]>\r\n              : never;\r\n      };\r\n\r\nexport type TypeIdBuilderTreeFromTypeIdTree<T extends Tree<TypeId>> =\r\n    T extends TypeId<infer U>\r\n        ? TypeIdBuilder<U>\r\n        : {\r\n              [key in keyof T]: T[key] extends Tree<TypeId>\r\n                  ? TypeIdBuilderTreeFromTypeIdTree<T[key]>\r\n                  : never;\r\n          };\r\n\r\n/** TypeIdBuilder represents all the methods you do on individual `typeId`'s, not collections  */\r\nexport class TypeIdBuilder<T = any> {\r\n    constructor(public readonly id: TypeId<T>) {}\r\n    toTypeId(): TypeId<T> {\r\n        return this.id;\r\n    }\r\n\r\n    nullable(): TypeIdBuilder<T | null> {\r\n        return new TypeIdBuilder(\r\n            registerCustomStorage({\r\n                type: StorageKind.nullable,\r\n                backingStorageId: this.id,\r\n            }) as any\r\n        );\r\n    }\r\n\r\n    static defaultLoggedBufferSize = 15;\r\n\r\n    logged(bufferSize = TypeIdBuilder.defaultLoggedBufferSize): TypeIdBuilder<T> {\r\n        return new TypeIdBuilder(\r\n            registerCustomStorage({\r\n                type: StorageKind.logged,\r\n                backingStorageId: this.id,\r\n                bufferSize,\r\n            }) as any\r\n        );\r\n    }\r\n\r\n    ranged(capacity: number): TypeIdBuilder<T> {\r\n        return new TypeIdBuilder(\r\n            registerCustomStorage({\r\n                type: StorageKind.ranged,\r\n                capacity,\r\n                backingStorageId: this.id,\r\n            }) as any\r\n        );\r\n    }\r\n\r\n    vec<L extends number>(\r\n        length: L\r\n    ): TypeBuilder<FixedLengthArray<TypeIdBuilder<T>, L>> {\r\n        return new TypeBuilder(\r\n            new Array(length).fill(0).map((t) => new TypeIdBuilder(this.id)) as any\r\n        );\r\n    }\r\n}\r\n\r\n/** The type that this typeIdBuilder refers to\r\n * @example type UnwrapTypeIdBuilder<TypeIdBuilder<string>> = string\r\n */\r\nexport type UnwrapTypeIdBuilder<T extends TypeIdBuilder> = T extends TypeIdBuilder<\r\n    infer U\r\n>\r\n    ? U\r\n    : never;\r\n\r\ntype NullableTypeTree<T extends TypeTree> = T extends TypeId<infer U>\r\n    ? TypeId<U | null>\r\n    : T extends TypeIdBuilder<infer V>\r\n    ? TypeIdBuilder<V | null>\r\n    : T extends TypeBuilder<infer W>\r\n    ? TypeBuilder<NullableTypeTree<W>>\r\n    : {\r\n          [key in keyof T as T[key] extends Tree<TypeTree>\r\n              ? key\r\n              : never]: T[key] extends Tree<TypeTree>\r\n              ? NullableTypeTree<T[key]>\r\n              : never;\r\n      };\r\n\r\ntype TypeBuilderInstance<T extends TypeTree> = T extends TypeTreeLeaf\r\n    ? TypeBuilder<T>\r\n    : TypeBuilder<T> & T;\r\n\r\nexport class TypeBuilder<T extends TypeTree> {\r\n    readonly #type: T;\r\n\r\n    constructor(type: T) {\r\n        this.#type = type;\r\n        if (\r\n            !(\r\n                typeof this.#type === \"number\" ||\r\n                this.#type instanceof TypeBuilder ||\r\n                this.#type instanceof TypeIdBuilder\r\n            )\r\n        ) {\r\n            for (const [key, val] of Object.entries(type)) {\r\n                //@ts-expect-error\r\n                this[key] = val;\r\n            }\r\n        }\r\n    }\r\n\r\n    toTypeTree(): T {\r\n        return this.#type;\r\n    }\r\n\r\n    private static nullableRaw<T extends TypeTree>(type: T): NullableTypeTree<T> {\r\n        if (type instanceof TypeIdBuilder) {\r\n            return type.nullable() as any;\r\n        }\r\n\r\n        if (Array.isArray(type)) {\r\n            return type.map((t) => this.nullableRaw(t as any)) as any;\r\n        }\r\n\r\n        const obj = {} as T;\r\n        for (const [key, val] of Object.entries(type)) {\r\n            obj[key] = this.nullableRaw(val as any) as any;\r\n        }\r\n\r\n        return obj as any;\r\n    }\r\n\r\n    nullable(): TypeBuilderInstance<NullableTypeTree<T>> {\r\n        return new TypeBuilder(TypeBuilder.nullableRaw(this.#type)) as any;\r\n    }\r\n\r\n    private static loggedRaw<T extends TypeTree>(type: T): T {\r\n        if (type instanceof TypeIdBuilder) {\r\n            return type.logged() as any;\r\n        }\r\n\r\n        if (Array.isArray(type)) {\r\n            return type.map((t) => this.loggedRaw(t)) as any;\r\n        }\r\n\r\n        const obj = {} as T;\r\n        for (const [key, val] of Object.entries(type)) {\r\n            obj[key] = this.loggedRaw(val as any);\r\n        }\r\n\r\n        return obj as any;\r\n    }\r\n\r\n    logged(): TypeBuilderInstance<T> {\r\n        return new TypeBuilder(TypeBuilder.loggedRaw(this.#type)) as any;\r\n    }\r\n\r\n    private static rangedRaw<T extends TypeTree>(type: T, capacity: number): T {\r\n        if (type instanceof TypeIdBuilder) {\r\n            return type.ranged(capacity) as any;\r\n        }\r\n\r\n        if (Array.isArray(type)) {\r\n            return type.map((t) => this.rangedRaw(t, capacity)) as any;\r\n        }\r\n\r\n        const obj = {} as T;\r\n        for (const [key, val] of Object.entries(type)) {\r\n            obj[key] = this.rangedRaw(val as any, capacity);\r\n        }\r\n\r\n        return obj as any;\r\n    }\r\n\r\n    ranged(capacity: number): TypeBuilderInstance<T> {\r\n        return new TypeBuilder(TypeBuilder.rangedRaw(this.#type, capacity)) as any;\r\n    }\r\n}\r\n\r\n/**  Default behavior of the `Type` function */\r\nfunction TypeBuilderConstructor<T extends TypeTree>(\r\n    type: T\r\n): TypeBuilderInstance<T> {\r\n    return new TypeBuilder(type) as any;\r\n}\r\n\r\n/**  Most basic primitive types (no functions) */\r\nclass BaseTypes {\r\n    static readonly any = new TypeIdBuilder(asTypeId<any>(StorageKind.any));\r\n\r\n    static readonly bool = new TypeIdBuilder(asTypeId<boolean>(StorageKind.bool));\r\n    static readonly string = new TypeIdBuilder(asTypeId<string>(StorageKind.any));\r\n    static readonly entity = new TypeIdBuilder(asTypeId<Entity>(StorageKind.i32));\r\n\r\n    static readonly f64 = new TypeIdBuilder(asTypeId<number>(StorageKind.f64));\r\n    static readonly f32 = new TypeIdBuilder(asTypeId<number>(StorageKind.f32));\r\n    static readonly i8 = new TypeIdBuilder(asTypeId<number>(StorageKind.i8));\r\n    static readonly i16 = new TypeIdBuilder(asTypeId<number>(StorageKind.i16));\r\n    static readonly i32 = new TypeIdBuilder(asTypeId<number>(StorageKind.i32));\r\n    static readonly u8 = new TypeIdBuilder(asTypeId<number>(StorageKind.u8));\r\n    static readonly u16 = new TypeIdBuilder(asTypeId<number>(StorageKind.u16));\r\n    static readonly u32 = new TypeIdBuilder(asTypeId<number>(StorageKind.u32));\r\n    static readonly number = BaseTypes.f64;\r\n}\r\n\r\n/**  Function that can be used to create more complex base types */\r\nclass ComplexTypes {\r\n    static custom = function <T>(type?: T) {\r\n        return new TypeIdBuilder(asTypeId<T>(0));\r\n    };\r\n\r\n    static component = function <T extends TypeTree>(component: {\r\n        schema: T;\r\n    }): TypeBuilderInstance<T> {\r\n        return new TypeBuilder(component.schema) as any;\r\n    };\r\n\r\n    static enum = function <T extends string>(...options: T[]): TypeIdBuilder<T> {\r\n        return new TypeIdBuilder(\r\n            registerCustomStorage({\r\n                type: StorageKind.enum,\r\n                options,\r\n            }) as any\r\n        );\r\n    };\r\n}\r\n\r\n/** First class supported types that are very common */\r\nexport class FirstClassTypes {\r\n    static readonly vec2 = TypeBuilderConstructor({\r\n        x: BaseTypes.number,\r\n        y: BaseTypes.number,\r\n    });\r\n\r\n    static readonly vec3 = TypeBuilderConstructor({\r\n        x: BaseTypes.number,\r\n        y: BaseTypes.number,\r\n        z: BaseTypes.number,\r\n    });\r\n\r\n    static readonly rect = TypeBuilderConstructor({\r\n        ...this.vec2,\r\n        width: BaseTypes.number,\r\n        height: BaseTypes.number,\r\n    });\r\n\r\n    static readonly circle = TypeBuilderConstructor({\r\n        ...this.vec2,\r\n        radius: BaseTypes.number,\r\n    });\r\n\r\n    static readonly directionStr = ComplexTypes.enum(\"UP\", \"DOWN\", \"LEFT\", \"RIGHT\");\r\n    static readonly rotationDirection = ComplexTypes.enum(\r\n        \"CLOCKWISE\",\r\n        \"COUNTERCLOCKWISE\"\r\n    );\r\n}\r\n\r\nexport const Type = Object.assign(\r\n    TypeBuilderConstructor,\r\n    BaseTypes,\r\n    ComplexTypes,\r\n    FirstClassTypes\r\n);\r\n\r\nexport type Type = typeof Type;\r\n\r\n// const y = Type({ hello: Type.string });\r\n// type x = AsTypeIdTree<typeof y>;\r\n\r\n// export const Type: Type = {\r\n//     any: 0 as TypeIdBuilder<any>,\r\n//     number: 1 as TypeIdBuilder<number>,\r\n//     bool: 2 as TypeIdBuilder<boolean>,\r\n//     string: 0 as TypeIdBuilder<string>,\r\n//     entity: 1 as TypeIdBuilder<Entity>,\r\n\r\n//     nullable(type) {\r\n//         return registerCustomStorage({\r\n//             type: StorageKind.nullable,\r\n//             backingStorageId: type,\r\n//         }) as any;\r\n//     },\r\n\r\n//     custom<T>(type?: T) {\r\n//         return 0 as any;\r\n//     },\r\n\r\n//     component<T>(component: { schema: T }) {\r\n//         return component.schema as any;\r\n//     },\r\n\r\n//     enum<T extends string>(...options: T[]) {\r\n//         return registerCustomStorage({\r\n//             type: StorageKind.enum,\r\n//             options,\r\n//         }) as any;\r\n//     },\r\n\r\n//     tuple<const A extends TypeId[]>(...args: A) {\r\n//         return args as any;\r\n//     },\r\n\r\n//     vec<T, L extends number>(type: TypeId<T>, len: L) {\r\n//         return new Array(len).fill(type) as FixedLengthArray<T, L>;\r\n//     },\r\n\r\n//     logged(type, bufferSize = Type.logged.defaultBufferSize!) {\r\n//         if (typeof type === \"number\")\r\n//             return registerCustomStorage({\r\n//                 type: StorageKind.logged,\r\n//                 bufferSize,\r\n//                 backingStorageId: type,\r\n//             }) as any;\r\n\r\n//         // its an object\r\n//         let obj = {} as typeof type;\r\n//         for (const [key, value] of Object.entries(type)) {\r\n//             obj[key as keyof typeof type] = Type.logged(\r\n//                 value,\r\n//                 bufferSize\r\n//             ) as any;\r\n//         }\r\n\r\n//         return obj;\r\n//     },\r\n\r\n//     ranged(type, capacity) {\r\n//         if (typeof type === \"number\")\r\n//             return registerCustomStorage({\r\n//                 type: StorageKind.ranged,\r\n//                 capacity,\r\n//                 backingStorageId: type,\r\n//             }) as any;\r\n\r\n//         let obj = {} as typeof type;\r\n//         for (const [key, value] of Object.entries(type)) {\r\n//             obj[key as keyof typeof type] = Type.ranged(value, capacity) as any;\r\n//         }\r\n\r\n//         return obj;\r\n//     },\r\n// };\r\n", "import { walk } from \"../utils/walk\";\r\nimport { Logger } from \"../utils/logger\";\r\nimport { FlatTreeBranch, Tree, TreeBranch } from \"../utils/types\";\r\nimport type { Entity } from \"./entity\";\r\nimport \"./storage\";\r\nimport {\r\n    AsTypeIdTree,\r\n    AsTypeIdTree_Patch,\r\n    Type,\r\n    TypeBuilder,\r\n    TypeId,\r\n    TypeIdBuilder,\r\n    TypeTree,\r\n    UnwrapTypeIdBuilder,\r\n} from \"./types\";\r\nimport { World } from \"./world\";\r\n\r\nconst logger = new Logger(\"Components\");\r\n\r\nconst CACHED_HASH = Symbol(\"CACHED_HASH\");\r\n\r\ndeclare global {\r\n    interface Function {\r\n        getId(): number;\r\n\r\n        /** @internal */\r\n        [CACHED_HASH]?: number;\r\n    }\r\n\r\n    interface String {\r\n        getId(): number;\r\n    }\r\n}\r\n\r\n/* OBJECT ID SETUP */\r\n\r\n// Start at 1, because relationship components don't work if the relationship part is 0\r\nlet nextComponentId: number = 1;\r\nexport function getUniqueComponentId() {\r\n    return nextComponentId++;\r\n}\r\n\r\nexport const ID_MAP: Record<string, number> = {};\r\nexport const setIdMap = (map: Record<string, number>): void => {\r\n    for (const key of Object.keys(ID_MAP)) {\r\n        delete ID_MAP[key];\r\n    }\r\n\r\n    for (const [key, value] of Object.entries(map)) {\r\n        ID_MAP[key] = value;\r\n        nextComponentId = Math.max(nextComponentId, value);\r\n    }\r\n};\r\n\r\nexport type ObjectIDMethod =\r\n    | \"MANUALLY IMPLEMENTED\"\r\n    | \"CONSTRUCTOR NAME\"\r\n    | \"CONSTRUCTOR HASH\";\r\n\r\nexport function setObjectIdImplementation(method: ObjectIDMethod) {\r\n    switch (method) {\r\n        case \"MANUALLY IMPLEMENTED\":\r\n            Function.prototype.getId = function () {\r\n                logger.error(\r\n                    \"Cannot get the ID of object:\",\r\n                    this,\r\n                    `because the \"MANUALLY_IMPLEMENTED\" method of getId() was chosen `\r\n                );\r\n                throw new Error(\"Cannot get the ID of object\");\r\n            };\r\n            break;\r\n\r\n        case \"CONSTRUCTOR HASH\":\r\n            Function.prototype.getId = function () {\r\n                if (this[CACHED_HASH]) {\r\n                    return this[CACHED_HASH];\r\n                }\r\n\r\n                const string = this.toString();\r\n                let h!: number;\r\n                for (let i = 0; i < string.length; i++)\r\n                    h = (Math.imul(31, h) + string.charCodeAt(i)) | 0;\r\n\r\n                this[CACHED_HASH] = h;\r\n                return h;\r\n            };\r\n            break;\r\n\r\n        case \"CONSTRUCTOR NAME\":\r\n            Function.prototype.getId = function () {\r\n                return (ID_MAP[this.name] ??= getUniqueComponentId());\r\n            };\r\n    }\r\n}\r\n\r\nexport function markAsSuperclass(classHandle: { new (): any }) {\r\n    const prototype = Object.getPrototypeOf(classHandle);\r\n    classHandle.getId = function () {\r\n        return prototype.getId();\r\n    };\r\n}\r\n\r\nexport function loadComponentMethods() {\r\n    setObjectIdImplementation(\"CONSTRUCTOR NAME\");\r\n\r\n    String.prototype.getId = function (this: string) {\r\n        return (ID_MAP[this] ??= getUniqueComponentId());\r\n    };\r\n\r\n    logger.log(\r\n        \"Patched Object prototype, 3rd party external components are now available\"\r\n    );\r\n}\r\n\r\n/* COMPONENT CLASSES */\r\n\r\nexport interface EntityComponent<T> {\r\n    constructor: ComponentClass;\r\n}\r\nexport abstract class EntityComponent<T> {\r\n    abstract readonly schema: Tree<TypeId<any>>;\r\n\r\n    declare readonly flattenedSchema: TypeId[];\r\n    declare readonly propIds: number[];\r\n\r\n    constructor(public cache: T) {}\r\n\r\n    static readonly id: number;\r\n    static getId() {\r\n        return this.id;\r\n    }\r\n\r\n    static __init__(schema: Tree<TypeId<any>>) {\r\n        //@ts-expect-error\r\n        this.prototype.schema = schema;\r\n    }\r\n\r\n    abstract copyIntoStorage(world: World, ent: Entity): void;\r\n\r\n    public static currentEntity: Entity;\r\n}\r\n\r\n// Throw in TypeId<T> so ent.get() recognizes the internal data\r\ntype PODCConstructor<T> = TypeId<T> &\r\n    typeof PODComponent & {\r\n        new (data: T): PODComponent<T>;\r\n        prototype: PODComponent<T>;\r\n    };\r\nexport class PODComponent<T> extends EntityComponent<T> {\r\n    public declare readonly schema: TypeId<T>;\r\n\r\n    public declare data: T;\r\n\r\n    static __init__<T>(schema: TypeId<T>) {\r\n        super.__init__(schema);\r\n\r\n        //@ts-expect-error\r\n        this.prototype.propIds = [this.getId()];\r\n        //@ts-expect-error\r\n        this.prototype.flattenedSchema = [schema];\r\n\r\n        Object.defineProperty(this.prototype, \"data\", {\r\n            get: () => {\r\n                return this.currentEntity.get(this.getId()) as T;\r\n            },\r\n            set: (v) => {\r\n                return this.currentEntity.update(this.getId(), v);\r\n            },\r\n        });\r\n    }\r\n\r\n    copyIntoStorage(world: World, ent: Entity): void {\r\n        world.storageManager\r\n            .getOrCreateStorage(this.constructor.getId(), this.schema)\r\n            .addOrSetEnt(ent, this.cache);\r\n    }\r\n}\r\n\r\ntype RCConstructor<T extends Record<string, any>> = typeof RecordComponent & {\r\n    readonly [K in keyof T]: TypeId<T[K]>;\r\n} & {\r\n    new (data: T): RecordComponent<T> & ExtraRCInstanceTypes<T>;\r\n    prototype: RecordComponent<T>;\r\n};\r\n\r\ntype ExtraRCInstanceTypes<T extends Record<string, any>> = {\r\n    [K in keyof T]: T[K];\r\n};\r\nexport class RecordComponent<T extends Record<string, any>> extends EntityComponent<\r\n    T[keyof T][]\r\n> {\r\n    public declare readonly schema: { [K in keyof T]: TypeId<T[K]> };\r\n    public declare readonly propNames: string[];\r\n\r\n    constructor(data: T) {\r\n        super([]);\r\n\r\n        for (let i = this.propNames.length - 1; i > -1; i--) {\r\n            this.cache[i] = data[this.propNames[i]];\r\n        }\r\n    }\r\n\r\n    copyIntoStorage(world: World, ent: Entity): void {\r\n        for (let i = this.flattenedSchema.length - 1; i > -1; i--) {\r\n            world.storageManager\r\n                .getOrCreateStorage(this.propIds[i], this.flattenedSchema[i])\r\n                .addOrSetEnt(ent, this.cache[i]);\r\n        }\r\n    }\r\n\r\n    static __init__<T extends Record<string, any>>(schema: {\r\n        [K in keyof T]: TypeId<T[K]>;\r\n    }) {\r\n        //@ts-expect-error\r\n        this.prototype.flattenedSchema = [];\r\n        //@ts-expect-error\r\n        (this.prototype.propIds = []), (this.prototype.propNames = []);\r\n\r\n        for (const [key, type] of Object.entries(schema)) {\r\n            const id = getUniqueComponentId();\r\n\r\n            this.prototype.flattenedSchema.push(type);\r\n            this.prototype.propIds.push(id);\r\n            //@ts-expect-error\r\n            this.prototype.propNames.push(key);\r\n\r\n            //@ts-expect-error\r\n            this[key] = id;\r\n\r\n            Object.defineProperty(this.prototype, key, {\r\n                get: () => {\r\n                    return this.currentEntity.get(id);\r\n                },\r\n                set: (v) => {\r\n                    return this.currentEntity.update(id, v);\r\n                },\r\n            });\r\n        }\r\n\r\n        super.__init__(schema);\r\n    }\r\n}\r\n\r\ntype NCConstructor<\r\n    S extends Tree<TypeId>,\r\n    T extends UnwrapTypeIdTree<S>\r\n> = typeof NestedComponent &\r\n    S & {\r\n        new (data: T): NestedComponent<S, T> & ExtraNCInstanceTypes<T>;\r\n        prototype: NestedComponent<S, T>;\r\n    };\r\n\r\ntype ExtraNCInstanceTypes<T extends Record<string, any>> = {\r\n    [K in keyof T]: T[K];\r\n};\r\nexport class NestedComponent<\r\n    S extends Tree<TypeId<any>>,\r\n    T extends UnwrapTypeIdTree<S>\r\n> extends EntityComponent<T[keyof T][]> {\r\n    public declare readonly schema: S;\r\n\r\n    constructor(data: T) {\r\n        super([]);\r\n\r\n        const queue: [schema: Tree<TypeId>, data: any][] = [[this.schema, data]];\r\n\r\n        walk(([schema, data], add) => {\r\n            if (typeof schema === \"number\") {\r\n                this.cache.push(data);\r\n                return;\r\n            }\r\n\r\n            for (const key of Object.keys(schema)) {\r\n                add([schema[key], data[key]]);\r\n            }\r\n        }, queue);\r\n    }\r\n\r\n    copyIntoStorage(world: World, ent: Entity): void {\r\n        for (let i = this.flattenedSchema.length - 1; i > -1; i--) {\r\n            world.storageManager\r\n                .getOrCreateStorage(this.propIds[i], this.flattenedSchema[i])\r\n                .addOrSetEnt(ent, this.cache[i]);\r\n        }\r\n    }\r\n\r\n    static __init__<S extends Tree<TypeId<any>>, T extends UnwrapTypeIdTree<S>>(\r\n        schema: S\r\n    ) {\r\n        //@ts-expect-error\r\n        (this.prototype.propIds = []), (this.prototype.flattenedSchema = []);\r\n\r\n        const queue: [schema: any, targetObj: any, key: string][] = [\r\n            [schema, this, \"prototype\"],\r\n        ];\r\n\r\n        walk(([schema, target, key], add) => {\r\n            if (typeof schema === \"number\") {\r\n                const id = getUniqueComponentId();\r\n\r\n                Object.defineProperty(target, key, {\r\n                    get: () => {\r\n                        return this.currentEntity.get(id);\r\n                    },\r\n                    set: (v) => {\r\n                        return this.currentEntity.update(id, v);\r\n                    },\r\n                });\r\n\r\n                this.prototype.propIds.push(id);\r\n                this.prototype.flattenedSchema.push(schema as TypeId);\r\n                return;\r\n            }\r\n\r\n            for (const key of Object.keys(schema)) {\r\n                add([schema[key], (target[key] = {}), key as string]);\r\n            }\r\n        }, ...queue);\r\n\r\n        super.__init__(schema);\r\n    }\r\n}\r\n\r\nexport function Component<const T extends TypeTree>(\r\n    schema: T\r\n): AsTypeIdTree<T> extends infer R\r\n    ? R extends Tree<TypeId>\r\n        ? ComponentClass<R>\r\n        : never\r\n    : never {\r\n    const realSchema = convertTypeTreeToTypeIdTree(schema);\r\n\r\n    if (typeof realSchema === \"number\") {\r\n        class CustomComponent extends PODComponent<T> {\r\n            static readonly id = getUniqueComponentId();\r\n        }\r\n\r\n        CustomComponent.__init__(realSchema as any);\r\n        return CustomComponent as any;\r\n    }\r\n\r\n    if (isTypeIdRecord(realSchema)) {\r\n        class CustomComponent extends RecordComponent<any> {\r\n            static readonly id = getUniqueComponentId();\r\n        }\r\n\r\n        CustomComponent.__init__(realSchema);\r\n        return CustomComponent as any;\r\n    }\r\n\r\n    class CustomComponent extends NestedComponent<any, any> {\r\n        static readonly id = getUniqueComponentId();\r\n    }\r\n\r\n    CustomComponent.__init__(realSchema as any);\r\n    return CustomComponent as any;\r\n}\r\n\r\n/* \r\n    Resources and components are exactly the same (they are actually stored as components on \r\n    a reserved \"world\" entity). However, having a different name helps the user to understand\r\n    what goes where.\r\n*/\r\nexport const Resource = Component;\r\n\r\nexport type ComponentClass<TSchema extends Tree<TypeId> = Tree<TypeId>> =\r\n    TSchema extends TypeId\r\n        ? PODCConstructor<UnwrapTypeIdTree<TSchema>>\r\n        : TSchema extends FlatTreeBranch<TypeId>\r\n        ? RCConstructor<UnwrapTypeIdTree<TSchema>>\r\n        : NCConstructor<TSchema, UnwrapTypeIdTree<TSchema>>;\r\n\r\nexport type UnwrapTypeId<T extends TypeId> = T extends TypeId<infer U> ? U : never;\r\nexport type UnwrapTypeIdBuilderRecord<T extends Record<string, TypeIdBuilder>> = {\r\n    [K in keyof T]: UnwrapTypeIdBuilder<T[K]>;\r\n};\r\n\r\nexport type UnwrapTypeIdTree<T extends Tree<TypeId>> = T extends TypeId<infer U>\r\n    ? U\r\n    : T extends Record<string, Tree<TypeId>>\r\n    ? {\r\n          [K in keyof T as T[K] extends Tree<TypeId> ? K : never]: UnwrapTypeIdTree<\r\n              T[K]\r\n          >;\r\n      }\r\n    : never;\r\n\r\nexport type UnwrapTypeIdArray<T extends TypeId[]> = {\r\n    [K in keyof T]: UnwrapTypeId<T[K]>;\r\n} & { length: T[\"length\"] };\r\n\r\nfunction isTypeId<T>(schema: TypeTree): schema is TypeId<T> {\r\n    return typeof schema === \"number\";\r\n}\r\n\r\nfunction isTypeIdBuilder<T>(schema: TypeTree): schema is TypeIdBuilder<T> {\r\n    return schema instanceof TypeIdBuilder;\r\n}\r\n\r\nfunction isTypeIdRecord(schema: TypeTree): schema is Record<string, TypeId> {\r\n    return Object.values(schema).every((t) => typeof t === \"number\");\r\n}\r\n\r\nfunction isTypeBuilder<T extends TypeTree>(\r\n    schema: TypeTree\r\n): schema is TypeBuilder<T> {\r\n    return schema instanceof TypeBuilder;\r\n}\r\n\r\nfunction convertTypeTreeToTypeIdTree<T extends TypeTree>(\r\n    schema: T\r\n): AsTypeIdTree<T> extends infer R ? (R extends Tree<TypeId> ? R : never) : never {\r\n    if (isTypeId(schema)) return schema as any;\r\n    if (isTypeIdBuilder<T>(schema)) return schema.toTypeId() as any;\r\n    if (isTypeBuilder<T>(schema))\r\n        return convertTypeTreeToTypeIdTree(schema.toTypeTree());\r\n\r\n    const obj = {} as any;\r\n    for (const [key, val] of Object.entries(schema)) {\r\n        // This is annoying, but we get an \"excessively deep\" error\r\n        obj[key] = (convertTypeTreeToTypeIdTree as any)(val);\r\n    }\r\n    return obj as any;\r\n}\r\n", "declare global {\r\n    interface ReadonlySet<T> {\r\n        clone(): Set<T>;\r\n        concat(...other: (Set<T> | T)[]): Set<T>;\r\n        every(f: (arg: T) => boolean): boolean;\r\n        some(f: (arg: T) => boolean): boolean;\r\n        filter(f: (arg: T) => boolean): Set<T>;\r\n        map<U>(f: (arg: T) => U): Set<U>;\r\n    }\r\n\r\n    interface Set<T> extends ReadonlySet<T> {}\r\n}\r\nexport function loadSetMethods() {\r\n    Set.prototype.clone = function () {\r\n        return new Set(this);\r\n    };\r\n\r\n    Set.prototype.concat = function (...others) {\r\n        const newSet = this.clone();\r\n\r\n        for (const other of others) {\r\n            if (other instanceof Set) {\r\n                other.forEach((s) => newSet.add(s));\r\n            } else {\r\n                newSet.add(other);\r\n            }\r\n        }\r\n\r\n        return newSet;\r\n    };\r\n\r\n    Set.prototype.every = function (fn) {\r\n        for (const v of this) {\r\n            if (!fn(v)) return false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    Set.prototype.filter = function (fn) {\r\n        const newSet = new Set();\r\n\r\n        for (const v of this) {\r\n            if (fn(v)) newSet.add(v);\r\n        }\r\n        return newSet;\r\n    };\r\n\r\n    Set.prototype.some = function (fn) {\r\n        for (const v of this) {\r\n            if (fn(v)) return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    Set.prototype.map = function <T, U>(\r\n        this: Set<T>,\r\n        fn: (arg: T) => U\r\n    ): Set<U> {\r\n        const set = new Set<U>();\r\n        for (const value of this) {\r\n            set.add(fn(value));\r\n        }\r\n        return set;\r\n    };\r\n}\r\n", "import { Class } from \"./types\";\r\n\r\n/** @internal */\r\nexport const isClass = (val: any): val is Class<any> => {\r\n    return typeof val === \"function\" && val.toString().startsWith(\"class\");\r\n};\r\n", "import { isClass } from \"../utils/class\";\r\nimport { Archetype } from \"./archetype\";\r\nimport { Entity, intoID } from \"./entity\";\r\nimport type { World } from \"./world\";\r\n\r\nexport type EntityNarrower = (ent: Entity) => boolean;\r\nexport interface QueryModifier {\r\n    (components: ReadonlySet<number>): boolean;\r\n    narrower?: EntityNarrower;\r\n}\r\n\r\nexport type QueryModifierFactory<T extends any[] = any[]> = (\r\n    ...args: T\r\n) => QueryModifier;\r\nexport type IntoQueryModifier = intoID | intoID[] | QueryModifier;\r\n\r\nexport class Query {\r\n    protected targetedArchetypes: Archetype[] = [];\r\n\r\n    // Used for skipping entities when multithreading\r\n    protected offset: number = 0;\r\n    protected stepSize: number = 1;\r\n\r\n    private lastCheckedArchetypes = new Map<Archetype, number>();\r\n\r\n    setStepSizeAndOffset(stepSize: number, offset: number) {\r\n        this.stepSize = stepSize;\r\n        this.offset = offset;\r\n    }\r\n\r\n    private entityNarrower: EntityNarrower;\r\n\r\n    constructor(public componentTester: QueryModifier) {\r\n        if (typeof componentTester.narrower === \"function\") {\r\n            this[Symbol.iterator] = this.iterator_narrower;\r\n            this.forEach = this.forEach_narrower;\r\n        }\r\n\r\n        this.entityNarrower = componentTester.narrower!;\r\n    }\r\n\r\n    ignoreMultithreadingFragmentation() {\r\n        this.offset = 0;\r\n        this.stepSize = 1;\r\n    }\r\n\r\n    addTargetedArchetype(archetype: Archetype) {\r\n        this.targetedArchetypes.push(archetype);\r\n        this.lastCheckedArchetypes.set(archetype, -Infinity);\r\n    }\r\n\r\n    // Default (no narrower)\r\n    *[Symbol.iterator](): IterableIterator<Entity> {\r\n        for (let i = this.targetedArchetypes.length - 1; i >= 0; i--) {\r\n            for (\r\n                let j = this.targetedArchetypes[i].entities[0] - this.offset;\r\n                j > 0;\r\n                j -= this.stepSize\r\n            ) {\r\n                yield this.targetedArchetypes[i].entities[j] as Entity;\r\n            }\r\n        }\r\n    }\r\n\r\n    forEach(fn: (entity: Entity) => void) {\r\n        for (let i = this.targetedArchetypes.length - 1; i >= 0; i--) {\r\n            for (\r\n                let j = this.targetedArchetypes[i].entities[0] - this.offset;\r\n                j > 0;\r\n                j -= this.stepSize\r\n            ) {\r\n                fn(this.targetedArchetypes[i].entities[j] as Entity);\r\n            }\r\n        }\r\n    }\r\n\r\n    // With narrower\r\n    private forEach_narrower(fn: (entity: Entity) => void) {\r\n        for (let i = this.targetedArchetypes.length - 1; i >= 0; i--) {\r\n            for (\r\n                let j = this.targetedArchetypes[i].entities[0] - this.offset;\r\n                j > 0;\r\n                j -= this.stepSize\r\n            ) {\r\n                const ent = this.targetedArchetypes[i].entities[j] as Entity;\r\n                if (this.entityNarrower(ent)) fn(ent);\r\n            }\r\n        }\r\n    }\r\n\r\n    private *iterator_narrower() {\r\n        for (let i = this.targetedArchetypes.length - 1; i >= 0; i--) {\r\n            for (\r\n                let j = this.targetedArchetypes[i].entities[0] - this.offset;\r\n                j > 0;\r\n                j -= this.stepSize\r\n            ) {\r\n                const ent = this.targetedArchetypes[i].entities[j] as Entity;\r\n                if (this.entityNarrower(ent)) yield ent;\r\n            }\r\n        }\r\n    }\r\n\r\n    // With state (added + removed)\r\n    private addedState = new Set<Entity>();\r\n    private removedState = new Set<Entity>();\r\n\r\n    // Don't capture stack\r\n    private readonly NO_OP = new Function() as (...args: any[]) => void;\r\n\r\n    private forEach_state(\r\n        state: Set<Entity>,\r\n        addedFn: (entity: Entity) => void,\r\n        removedFn: (entity: Entity) => void\r\n    ) {\r\n        const lastFrame = new Set(state);\r\n\r\n        for (let i = this.targetedArchetypes.length - 1; i >= 0; i--) {\r\n            const archetype = this.targetedArchetypes[i];\r\n\r\n            // If nothing has changed in this archetype, just remove all the stuff\r\n            if (\r\n                archetype.lastModified === this.lastCheckedArchetypes.get(archetype)!\r\n            ) {\r\n                for (\r\n                    let j = this.targetedArchetypes[i].entities[0] - this.offset;\r\n                    j > 0;\r\n                    j -= this.stepSize\r\n                ) {\r\n                    lastFrame.delete(\r\n                        this.targetedArchetypes[i].entities[j] as Entity\r\n                    );\r\n                }\r\n            } else {\r\n                for (\r\n                    let j = this.targetedArchetypes[i].entities[0] - this.offset;\r\n                    j > 0;\r\n                    j -= this.stepSize\r\n                ) {\r\n                    const ent = this.targetedArchetypes[i].entities[j] as Entity;\r\n                    if (!state.has(ent)) {\r\n                        state.add(ent);\r\n                        addedFn(ent);\r\n                    }\r\n\r\n                    lastFrame.delete(ent);\r\n                }\r\n            }\r\n        }\r\n\r\n        lastFrame.forEach((ent) => {\r\n            removedFn(ent);\r\n            state.delete(ent);\r\n        });\r\n    }\r\n\r\n    forEachAdded(fn: (ent: Entity) => void) {\r\n        this.forEach_state(this.addedState, fn, this.NO_OP);\r\n    }\r\n\r\n    forEachRemoved(fn: (ent: Entity) => void) {\r\n        this.forEach_state(this.removedState, this.NO_OP, fn);\r\n    }\r\n}\r\n\r\nexport class QueryManager {\r\n    private queries: Query[] = [];\r\n\r\n    constructor(private world: World) {}\r\n\r\n    // Used for one time queries\r\n    query(...modifiers: QueryModifier[]): Query {\r\n        const query = new Query(All(...modifiers));\r\n\r\n        for (const [id, archetype] of this.world.archetypeManager.archetypes) {\r\n            if (query.componentTester(archetype.components)) {\r\n                query.addTargetedArchetype(archetype);\r\n            }\r\n        }\r\n\r\n        return query;\r\n    }\r\n\r\n    addQuery(query: Query) {\r\n        this.queries.push(query);\r\n\r\n        for (const [id, archetype] of this.world.archetypeManager.archetypes) {\r\n            if (query.componentTester(archetype.components)) {\r\n                query.addTargetedArchetype(archetype);\r\n            }\r\n        }\r\n    }\r\n\r\n    onNewArchetypeCreated(archetype: Archetype) {\r\n        for (let i = 0; i < this.queries.length; i++) {\r\n            if (this.queries[i].componentTester(archetype.components)) {\r\n                this.queries[i].addTargetedArchetype(archetype);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// Common Query Modifiers\r\nexport const With: QueryModifierFactory<\r\n    [...components: intoID[]] | [modifier: QueryModifier]\r\n> = (...components) => {\r\n    if (\r\n        components.length === 1 &&\r\n        typeof components[0] === \"function\" &&\r\n        !isClass(components[0])\r\n    )\r\n        return components[0] as QueryModifier;\r\n\r\n    components = components.map((c) => (typeof c == \"number\" ? c : c.getId()));\r\n\r\n    return (test: ReadonlySet<number>) =>\r\n        components.every((c) => test.has(c as number));\r\n};\r\n\r\nexport const Without: QueryModifierFactory<intoID[]> = (...components) => {\r\n    components = components.map((c) => (typeof c == \"number\" ? c : c.getId()));\r\n\r\n    return (test: ReadonlySet<number>) =>\r\n        components.every((c) => !test.has(c as number));\r\n};\r\n\r\nexport const Not: QueryModifierFactory<[arg: QueryModifier]> =\r\n    (modifier: QueryModifier) => (components) =>\r\n        !modifier(components);\r\n\r\nexport const All: QueryModifierFactory<QueryModifier[]> = (...modifiers) => {\r\n    const fn: QueryModifier = function AllModifier(components) {\r\n        for (let i = modifiers.length - 1; i > -1; i--) {\r\n            if (!modifiers[i](components)) return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    const narrowers = modifiers\r\n        .map((modifier) => modifier.narrower)\r\n        .filter((f): f is EntityNarrower => typeof f == \"function\");\r\n\r\n    if (narrowers.length > 0) {\r\n        fn.narrower = function (ent) {\r\n            for (let i = narrowers.length - 1; i > -1; i--) {\r\n                if (!narrowers[i](ent)) return false;\r\n            }\r\n\r\n            return true;\r\n        };\r\n    }\r\n\r\n    return fn;\r\n};\r\n", "import { isClass } from \"../utils/class\";\r\nimport { MatchingTree, Tree, TreeBranch } from \"../utils/types\";\r\nimport { intoID } from \"./entity\";\r\nimport { Query, QueryModifier, IntoQueryModifier, All, With } from \"./query\";\r\nimport type { World } from \"./world\";\r\n\r\nexport type SystemOrdering =\r\n    | \"STANDARD\"\r\n    | \"FIRST\"\r\n    | \"LAST\"\r\n    | {\r\n          position: number;\r\n      }\r\n    | {\r\n          before: intoID;\r\n      }\r\n    | {\r\n          after: intoID;\r\n      };\r\n\r\nexport class BagelSystem<T extends Tree<Query>> {\r\n    /** @internal */\r\n    public static nextSystemId: number = 0;\r\n    public declare static id: number;\r\n\r\n    public declare readonly entities: T;\r\n    public static readonly runOrder: SystemOrdering = \"STANDARD\";\r\n\r\n    constructor(public world: World) {}\r\n\r\n    init() {}\r\n\r\n    /** @internal */\r\n    setStepSizeAndOffset(\r\n        stepSize: number,\r\n        offset: number,\r\n        obj: Tree<Query> = this.entities\r\n    ) {\r\n        if (obj instanceof Query) {\r\n            obj.setStepSizeAndOffset(stepSize, offset);\r\n        } else {\r\n            for (const val of Object.values(obj)) {\r\n                this.setStepSizeAndOffset(stepSize, offset, val);\r\n            }\r\n        }\r\n    }\r\n\r\n    update() {}\r\n}\r\n\r\nexport function System<\r\n    Into extends Tree<IntoQueryModifier>,\r\n    T extends MatchingTree<Into, IntoQueryModifier, Query>\r\n>(queries: Into) {\r\n    // Convert it from query modifier things to normal queries;\r\n    const realQueries = queryModifierToQuery(queries) as T;\r\n\r\n    class CustomSystemClass extends BagelSystem<T> {\r\n        public readonly entities = realQueries;\r\n        public static id = BagelSystem.nextSystemId++;\r\n    }\r\n\r\n    return CustomSystemClass as typeof CustomSystemClass;\r\n}\r\n\r\nfunction isIntoQueryModifier(\r\n    tree: Tree<IntoQueryModifier>\r\n): tree is IntoQueryModifier {\r\n    return tree.constructor !== Object;\r\n}\r\n\r\nfunction intoQueryModifierToQueryModifier(query: IntoQueryModifier): QueryModifier {\r\n    if (typeof query == \"number\") {\r\n        return With(query);\r\n    }\r\n\r\n    if (typeof query === \"function\" && !isClass(query)) {\r\n        return query as QueryModifier;\r\n    }\r\n\r\n    if (Array.isArray(query)) {\r\n        return All(\r\n            ...(query.map(intoQueryModifierToQueryModifier) as QueryModifier[])\r\n        );\r\n    }\r\n\r\n    return With(query.getId());\r\n}\r\n\r\nfunction queryModifierToQuery(tree: Tree<IntoQueryModifier>): Tree<Query> {\r\n    if (isIntoQueryModifier(tree)) {\r\n        return new Query(intoQueryModifierToQueryModifier(tree));\r\n    }\r\n\r\n    if (Array.isArray(tree)) {\r\n        return tree.map(queryModifierToQuery);\r\n    }\r\n\r\n    let obj = {} as any;\r\n    for (const [key, val] of Object.entries(tree)) {\r\n        obj[key] = queryModifierToQuery(val);\r\n    }\r\n    return obj;\r\n}\r\n", "import { Tree } from \"../utils/types\";\r\nimport { Query } from \"./query\";\r\nimport { BagelSystem, SystemOrdering } from \"./system\";\r\nimport { World } from \"./world\";\r\n\r\nexport const SystemType = {\r\n    LOCAL: 0,\r\n    REMOTE: 1,\r\n} as const;\r\nexport type SystemType = (typeof SystemType)[keyof typeof SystemType];\r\n\r\nexport class SystemManager {\r\n    public localSystems: BagelSystem<any>[] = [];\r\n\r\n    // Change this to change the max number of systems\r\n    public readonly systemLocations = new Uint8Array(100);\r\n\r\n    public readonly schedules: Record<\r\n        string,\r\n        { first: number[]; standard: number[]; last: number[] }\r\n    > = {};\r\n    public readonly enabledSchedules: Record<string, number[]> = {};\r\n\r\n    constructor(private readonly world: World) {\r\n        this.createSchedule(\"DEFAULT\");\r\n    }\r\n\r\n    private reorderEnabled(schedule: string) {\r\n        const copy = this.enabledSchedules[schedule].slice();\r\n        const working = this.enabledSchedules[schedule];\r\n\r\n        working.length = 0;\r\n\r\n        const { first, standard, last } = this.schedules[schedule];\r\n        working.push(\r\n            ...[...first, ...standard, ...last].filter((x) => copy.includes(x))\r\n        );\r\n    }\r\n\r\n    private registerSystem(id: number, type: SystemType = SystemType.REMOTE) {\r\n        this.systemLocations[id] = type;\r\n        // this.enabled.add(id);\r\n    }\r\n\r\n    // createSchedule(name: string, ...systems: number[]): void;\r\n    // createSchedule(name: string, systems: {first?: number[], default?: number[], last?: number[]}): void;\r\n    createSchedule(name: string, ...systems: number[]) {\r\n        this.schedules[name] = { first: [], standard: systems, last: [] };\r\n        this.enabledSchedules[name] = [];\r\n    }\r\n\r\n    addToSchedule(\r\n        id: number,\r\n        schedule: string,\r\n        ordering: SystemOrdering,\r\n        enabled: boolean\r\n    ) {\r\n        const scheduleArr = (this.schedules[schedule] ??= {\r\n            first: [],\r\n            standard: [],\r\n            last: [],\r\n        });\r\n        const { first, standard, last } = scheduleArr;\r\n\r\n        // Use match here in the future\r\n        if (\r\n            ordering === \"STANDARD\" ||\r\n            ordering === \"LAST\" ||\r\n            ordering === \"FIRST\"\r\n        ) {\r\n            scheduleArr[ordering.toLowerCase()].push(id);\r\n        } else if (\"position\" in ordering) {\r\n            // Decide which one to go into and add it\r\n            if (ordering.position < first.length) {\r\n                first.splice(ordering.position, 0, id);\r\n            } else if (ordering.position < first.length + standard.length) {\r\n                standard.splice(ordering.position - first.length, 0, id);\r\n            } else {\r\n                last.splice(\r\n                    ordering.position - first.length - standard.length,\r\n                    id\r\n                );\r\n            }\r\n        } else {\r\n            // before or after\r\n            const kind = Object.keys(ordering)[0];\r\n            const relativeTo: number = (ordering as any)[kind];\r\n\r\n            const arr = [first, standard, last].find((arr) =>\r\n                arr.includes(relativeTo)\r\n            )!;\r\n            const idx = arr.indexOf(relativeTo);\r\n\r\n            arr.splice(idx + (kind === \"before\" ? 0 : 1), 0, id);\r\n        }\r\n\r\n        if (enabled) {\r\n            this.enable(id, schedule);\r\n        }\r\n    }\r\n\r\n    enable(id: number, schedule: string) {\r\n        if (this.enabledSchedules[schedule].includes(id)) return;\r\n\r\n        this.enabledSchedules[schedule].push(id);\r\n        this.reorderEnabled(schedule);\r\n    }\r\n\r\n    disable(id: number, schedule: string) {\r\n        this.enabledSchedules[schedule].splice(\r\n            this.enabledSchedules[schedule].indexOf(id),\r\n            1\r\n        );\r\n        // this.enabled.delete(id);\r\n    }\r\n\r\n    addSystem(system: BagelSystem<any>) {\r\n        //@ts-expect-error\r\n        const { id } = system.constructor;\r\n        this.localSystems[id] = system;\r\n        this.registerSystem(id, SystemType.LOCAL);\r\n\r\n        // Register system queries\r\n        const registerQueryTree = (queries: Tree<Query>) => {\r\n            if (queries instanceof Query) {\r\n                this.world.queryManager.addQuery(queries);\r\n                return;\r\n            }\r\n\r\n            for (const query of Object.values(queries)) {\r\n                registerQueryTree(query);\r\n            }\r\n        };\r\n\r\n        registerQueryTree(system.entities);\r\n    }\r\n\r\n    addRemoteSystem(id: number) {\r\n        this.registerSystem(id, SystemType.REMOTE);\r\n    }\r\n\r\n    update(schedule?: string): Promise<void>;\r\n    update(systems: number[]): Promise<void>;\r\n\r\n    update(arg: string | number[] = \"DEFAULT\") {\r\n        let systems: number[];\r\n\r\n        if (typeof arg === \"string\") systems = this.enabledSchedules[arg];\r\n        else systems = arg;\r\n\r\n        const promises = [];\r\n\r\n        for (const systemId of systems) {\r\n            if (this.systemLocations[systemId] == SystemType.REMOTE) {\r\n                promises.push(this.world.workerManager.update(systemId));\r\n            } else {\r\n                this.localSystems[systemId].update();\r\n            }\r\n        }\r\n\r\n        return Promise.all(promises) as any as Promise<void>;\r\n    }\r\n}\r\n\r\n/**  End API\r\n *\r\n * world.addSystem(A, {before: B})\r\n *\r\n * or\r\n *\r\n * System A {\r\n *  runOrdering: {\r\n *      before: B\r\n * }\r\n *\r\n * world.addSystem(A)\r\n *\r\n *\r\n */\r\n", "export function awaitMessage<T = any>(\r\n    worker: Worker,\r\n    messageType: any\r\n): Promise<T> {\r\n    return new Promise<T>((resolve, reject) => {\r\n        function listen({ data }: MessageEvent<any>) {\r\n            if (data.type === messageType) {\r\n                worker.removeEventListener(\"message\", listen);\r\n                resolve(data);\r\n            }\r\n        }\r\n\r\n        worker.addEventListener(\"message\", listen);\r\n    });\r\n}\r\n", "import { Logger } from \"../utils/logger\";\r\nimport { Archetype } from \"./archetype\";\r\nimport { ID_MAP } from \"./component\";\r\nimport { CUSTOM_COMPONENT_STORAGES } from \"./custom_storages\";\r\nimport { World } from \"./world\";\r\nimport { awaitMessage } from \"../utils/await_worker\";\r\n\r\nexport enum MessageType {\r\n    init,\r\n    update,\r\n    sync,\r\n    newArchetype,\r\n}\r\n\r\nconst logger = new Logger(\"Worker Manager\");\r\ninterface WorkerLike {\r\n    postMessage(data: any): void;\r\n}\r\n\r\n// A object that represents multiple workers\r\nexport class WorkerProxy {\r\n    public workers: Worker[] = [];\r\n\r\n    constructor(public url: string, public numThreads: number) {}\r\n\r\n    postMessage(data: any): void {\r\n        for (let i = this.workers.length - 1; i >= 0; i--) {\r\n            this.workers[i].postMessage(data);\r\n        }\r\n    }\r\n\r\n    async initAndEmitData<T>(\r\n        emitData: any,\r\n        waitFor: any,\r\n        indexProp?: string\r\n    ): Promise<T[]> {\r\n        const data = [];\r\n\r\n        for (let i = 0; i < this.numThreads; i++) {\r\n            this.workers.push(new Worker(this.url, { type: \"module\" }));\r\n\r\n            if (indexProp) {\r\n                this.workers[i].postMessage({ ...emitData, [indexProp]: i });\r\n            } else {\r\n                this.workers[i].postMessage(emitData);\r\n            }\r\n            data[i] = await awaitMessage(this.workers[i], waitFor);\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\r\n\r\nexport class WorkerManager {\r\n    public readonly workers: WorkerLike[] = [];\r\n    private readonly triggerArrays: Int32Array[] = [];\r\n\r\n    constructor(private readonly world: World) {}\r\n\r\n    async loadWorkerSystem(url: string): Promise<number>;\r\n    async loadWorkerSystem(\r\n        url: string,\r\n        numThreads?: number,\r\n        startInOrder?: boolean\r\n    ): Promise<number>;\r\n\r\n    async loadWorkerSystem(url: string, numThreads: number = 1) {\r\n        let worker: Worker | WorkerProxy;\r\n        let systemData: {\r\n            name: string;\r\n            id: number;\r\n        };\r\n\r\n        const triggerArray = new Int32Array(\r\n            new SharedArrayBuffer(numThreads * Int32Array.BYTES_PER_ELEMENT)\r\n        );\r\n\r\n        if (numThreads === 1) {\r\n            logger.log(`Loading remote system...`);\r\n\r\n            worker = new Worker(url, { type: \"module\" });\r\n\r\n            worker.postMessage({\r\n                type: MessageType.init,\r\n                storage: this.world.storageManager.storages,\r\n                components: ID_MAP,\r\n                archetypeManager: this.world.archetypeManager,\r\n                customStorages: CUSTOM_COMPONENT_STORAGES,\r\n                stepSize: 1,\r\n                offset: 0,\r\n                triggerArray,\r\n            });\r\n\r\n            systemData = await awaitMessage<{ name: string; id: number }>(\r\n                worker,\r\n                MessageType.init\r\n            );\r\n        } else {\r\n            logger.log(`Loading remote system with ${numThreads} threads`);\r\n\r\n            worker = new WorkerProxy(url, numThreads);\r\n\r\n            systemData = (\r\n                await worker.initAndEmitData<{\r\n                    name: string;\r\n                    id: number;\r\n                }>(\r\n                    {\r\n                        type: MessageType.init,\r\n                        storage: this.world.storageManager.storages,\r\n                        components: ID_MAP,\r\n                        archetypeManager: this.world.archetypeManager,\r\n                        customStorages: CUSTOM_COMPONENT_STORAGES,\r\n                        stepSize: numThreads,\r\n                        triggerArray,\r\n                    },\r\n                    MessageType.init,\r\n                    \"offset\"\r\n                )\r\n            )[0];\r\n        }\r\n\r\n        this.workers[systemData.id] = worker;\r\n        this.triggerArrays[systemData.id] = triggerArray;\r\n        logger.logOk(`Remote system ${systemData.name} (${systemData.id}) is ready`);\r\n\r\n        return systemData.id;\r\n    }\r\n\r\n    update(id: number): Promise<any> {\r\n        const triggerArray = this.triggerArrays[id];\r\n        if (triggerArray.length === 1) {\r\n            // Tell them to go\r\n            Atomics.store(triggerArray, 0, 1);\r\n            Atomics.notify(triggerArray, 0);\r\n\r\n            // Wait for it to respond\r\n            return Atomics.waitAsync(triggerArray, 0, 1).value as Promise<any>;\r\n        }\r\n\r\n        const promises = [];\r\n        for (let i = triggerArray.length - 1; i >= 0; i--) {\r\n            Atomics.store(triggerArray, i, 1);\r\n            Atomics.notify(triggerArray, i);\r\n            promises.push(Atomics.waitAsync(triggerArray, i, 1).value);\r\n        }\r\n\r\n        return Promise.all(promises);\r\n    }\r\n\r\n    updateAll() {\r\n        this.triggerArrays.forEach((arr, idx) => this.update(idx));\r\n    }\r\n\r\n    onNewArchetypeCreated(archetype: Archetype) {\r\n        for (const worker of this.workers) {\r\n            worker.postMessage({\r\n                type: MessageType.newArchetype,\r\n                archetype,\r\n            });\r\n        }\r\n    }\r\n}\r\n", "export function getBits(number: number, start: number, end: number): number {\r\n    return (number >> start) & ((1 << end) - 1);\r\n}\r\n", "import type { Entity, intoID } from \"./entity\";\r\nimport { getBits } from \"../utils/bits\";\r\nimport { QueryModifierFactory, With } from \"./query\";\r\nimport { TypeId } from \"./types\";\r\n\r\ndeclare module \"./entity\" {\r\n    interface EntityAPI {\r\n        relate(by: intoID, to: Entity, data?: any): void;\r\n        getAllRelatedBy(relationship: intoID): Set<Entity>;\r\n        getSingleRelatedBy(relationship: intoID): Entity | null;\r\n    }\r\n}\r\n\r\nexport const RELATIONSHIP_SHIFT = 15;\r\nexport function Relationship<T = any>(name: intoID, entity: Entity): TypeId<T> {\r\n    if (typeof name !== \"number\") {\r\n        name = name.getId();\r\n    }\r\n\r\n    return (((name as number) << RELATIONSHIP_SHIFT) | entity) as TypeId<T>;\r\n}\r\n\r\nexport const loadRelationshipMethods = (extraMethods: any[]) =>\r\n    extraMethods.push(() => {\r\n        //@ts-expect-error\r\n        Number.prototype.relate = function (\r\n            this: Entity,\r\n            by: intoID,\r\n            to: Entity,\r\n            data?: any\r\n        ) {\r\n            if (data == undefined) {\r\n                this.tag(Relationship(by, to));\r\n            } else {\r\n                this.add(Relationship(by, to), data);\r\n            }\r\n        };\r\n\r\n        //@ts-expect-error\r\n        Number.prototype.getAllRelatedBy = function (this: Entity, by: intoID) {\r\n            if (typeof by !== \"number\") {\r\n                by = by.getId();\r\n            }\r\n\r\n            return this.components()\r\n                .filter((component) => component >> RELATIONSHIP_SHIFT == by)\r\n                .map((component) => getBits(component, 0, RELATIONSHIP_SHIFT));\r\n        };\r\n\r\n        //@ts-expect-error\r\n        Number.prototype.getSingleRelatedBy = function (this: Entity, by: intoID) {\r\n            if (typeof by !== \"number\") {\r\n                by = by.getId();\r\n            }\r\n            for (const component of this.components()) {\r\n                if (component >> RELATIONSHIP_SHIFT == by)\r\n                    return getBits(component, 0, RELATIONSHIP_SHIFT);\r\n            }\r\n\r\n            return null;\r\n        };\r\n    });\r\n\r\nexport const WithRelationship: QueryModifierFactory<\r\n    [relationship: number] | [relationship: number, to: Entity]\r\n> = (relationship, to?) =>\r\n    typeof to === \"number\"\r\n        ? With(Relationship(relationship, to))\r\n        : (components) =>\r\n              components.some(\r\n                  (component) => component >> RELATIONSHIP_SHIFT == relationship\r\n              );\r\n", "// import { Component, Type } from \"./component\";\r\nimport { getUniqueComponentId } from \"./component\";\r\nimport type { Entity } from \"./entity\";\r\nimport type { QueryModifier, QueryModifierFactory } from \"./query\";\r\nimport { WithRelationship } from \"./relationships\";\r\n\r\ndeclare module \"./entity\" {\r\n    interface EntityAPI {\r\n        addChild(child: Entity): void;\r\n        removeChild(child: Entity): void;\r\n        children(): Entity[];\r\n        parent(): Entity | null;\r\n    }\r\n}\r\n\r\nexport let CHILD!: number;\r\nexport let PARENT!: number;\r\n\r\nexport const loadHierarchyMethods = (methodLoaders: any[]) =>\r\n    methodLoaders.push(() => {\r\n        CHILD = getUniqueComponentId();\r\n        PARENT = getUniqueComponentId();\r\n\r\n        //@ts-expect-error\r\n        Number.prototype.addChild = function (\r\n            this: Entity,\r\n            child: Entity\r\n        ): void {\r\n            this.relate(CHILD, child);\r\n            child.relate(PARENT, this);\r\n        };\r\n\r\n        //@ts-expect-error\r\n        Number.prototype.children = function (this: Entity) {\r\n            return this.getAllRelatedBy(CHILD);\r\n        };\r\n    });\r\n\r\n// Parent query modifier\r\nexport const Parent: QueryModifierFactory<\r\n    [] | [entity: Entity] | [requirements: QueryModifier]\r\n> = (arg?) => {\r\n    if (typeof arg == \"number\") {\r\n        return WithRelationship(PARENT, arg);\r\n    }\r\n\r\n    const fn: QueryModifier = WithRelationship(PARENT);\r\n\r\n    // If there is not requirement for the parent just return this\r\n    if (arg == undefined) {\r\n        return fn;\r\n    }\r\n\r\n    // Add the narrower\r\n\r\n    // We need to check if the modifier passed in is also narrowed, to support recursive things\r\n    if (typeof arg.narrower !== \"undefined\") {\r\n        fn.narrower = function (ent: Entity) {\r\n            const parent = ent.getSingleRelatedBy(PARENT)!;\r\n            if (!arg(parent.components())) return false;\r\n\r\n            return arg.narrower!(parent);\r\n        };\r\n    } else {\r\n        fn.narrower = function (ent: Entity) {\r\n            return arg(ent.getSingleRelatedBy(PARENT)!.components());\r\n        };\r\n    }\r\n\r\n    return fn;\r\n};\r\n\r\n// Child query modifier\r\nexport const Child: QueryModifierFactory<\r\n    [] | [entity: Entity] | [requirements: QueryModifier]\r\n> = (arg?) => {\r\n    if (typeof arg == \"number\") {\r\n        return WithRelationship(CHILD, arg);\r\n    }\r\n\r\n    const fn = WithRelationship(CHILD);\r\n\r\n    if (typeof arg == \"undefined\") return fn;\r\n\r\n    // Same as parent, we have to check if the modifier is narrowed to support recursive narrows\r\n    if (typeof arg.narrower == \"function\") {\r\n        fn.narrower = function (entity) {\r\n            const children = entity.children();\r\n            if (!children.some((child) => arg(child.components())))\r\n                return false;\r\n\r\n            return children.some((child) => arg.narrower!(child));\r\n        };\r\n    } else\r\n        fn.narrower = function (entity) {\r\n            return entity\r\n                .getAllRelatedBy(CHILD)\r\n                .some((ent) => arg(ent.components()));\r\n        };\r\n\r\n    return fn;\r\n};\r\n", "import { Class } from \"../utils/types\";\r\nimport { Entity, intoID, loadEntityMethods } from \"./entity\";\r\nimport \"../utils/setFns\";\r\nimport { QueryManager, QueryModifier } from \"./query\";\r\nimport { StorageManager } from \"./storage\";\r\nimport { BagelSystem, SystemOrdering } from \"./system\";\r\nimport { SystemManager } from \"./system_manager\";\r\nimport { WorkerManager } from \"./worker_manager\";\r\nimport { ArchetypeManager } from \"./archetype\";\r\nimport { ResourceManager } from \"./resource\";\r\nimport { Logger } from \"../utils/logger\";\r\nimport \"./relationships\";\r\nimport \"./hierarchy\";\r\nimport { TypeId } from \"./types\";\r\nimport { EntityComponent, Resource } from \"./component\";\r\n\r\nconst logger = new Logger(\"World\");\r\n\r\nexport class World {\r\n    public static readonly GLOBAL_WORLD: World;\r\n\r\n    public readonly entities: Int32Array;\r\n\r\n    public readonly storageManager: StorageManager;\r\n    public readonly queryManager: QueryManager;\r\n    public readonly workerManager: WorkerManager;\r\n    public readonly systemManager: SystemManager;\r\n    public readonly archetypeManager: ArchetypeManager;\r\n\r\n    private readonly reservedEntity = 0 as Entity;\r\n\r\n    constructor(private internalMaxEntities: number) {\r\n        logger.group(\"Creating world with\", internalMaxEntities, \"entities\");\r\n\r\n        this.storageManager = new StorageManager(this);\r\n        this.queryManager = new QueryManager(this);\r\n        this.workerManager = new WorkerManager(this);\r\n        this.systemManager = new SystemManager(this);\r\n        this.archetypeManager = new ArchetypeManager(this);\r\n\r\n        this.entities = new Int32Array(\r\n            new SharedArrayBuffer(\r\n                Int32Array.BYTES_PER_ELEMENT * (internalMaxEntities + 1)\r\n            )\r\n        );\r\n\r\n        //@ts-ignore\r\n        World.GLOBAL_WORLD = this;\r\n\r\n        logger.groupEnd();\r\n        logger.logOk(\r\n            \"Created world with max capacity of\",\r\n            internalMaxEntities,\r\n            \"entities\"\r\n        );\r\n    }\r\n\r\n    get maxEntities() {\r\n        return this.internalMaxEntities;\r\n    }\r\n\r\n    set maxEntities(v: number) {\r\n        this.internalMaxEntities = v;\r\n\r\n        logger.log(\"Resizing all storages for\", v, \"entities...\");\r\n        this.archetypeManager.resize(v);\r\n        this.storageManager.resize(v);\r\n    }\r\n\r\n    private openEntIds: number[] = [];\r\n    private nextEntId: number = 1;\r\n\r\n    spawn(...components: (any | [any, number])[]): Entity {\r\n        const ent = (this.openEntIds.pop() ?? this.nextEntId++) as Entity;\r\n        this.entities[this.entities[0]] = ent;\r\n        this.entities[0]++;\r\n\r\n        for (const component of components) {\r\n            if (Array.isArray(component)) {\r\n                ent.add(component[0], component[1]);\r\n            } else {\r\n                ent.add(component);\r\n            }\r\n        }\r\n\r\n        return ent;\r\n    }\r\n\r\n    destroy(ent: Entity) {\r\n        this.openEntIds.push(ent);\r\n        this.archetypeManager.archetypes\r\n            .get(this.archetypeManager.entityArchetypes[ent])!\r\n            .removeEntity(ent);\r\n    }\r\n\r\n    query(...modifiers: QueryModifier[]) {\r\n        return this.queryManager.query(...modifiers);\r\n    }\r\n\r\n    addSystem(\r\n        system: Class<BagelSystem<any>> | BagelSystem<any>,\r\n        schedule: string | false = \"DEFAULT\",\r\n        enable: boolean = true,\r\n        ordering?: SystemOrdering\r\n    ) {\r\n        if (!(system instanceof BagelSystem)) system = new system(this);\r\n        const sys = system.constructor as typeof BagelSystem;\r\n\r\n        ordering ??= sys.runOrder;\r\n\r\n        this.systemManager.addSystem(system);\r\n        system.init();\r\n\r\n        if (schedule === false) {\r\n            return this;\r\n        }\r\n\r\n        this.systemManager.addToSchedule(\r\n            sys.id,\r\n            schedule as string,\r\n            ordering,\r\n            enable\r\n        );\r\n        return this;\r\n    }\r\n\r\n    async addRemoteSystem(url: string, numThreads?: number) {\r\n        const id = await this.workerManager.loadWorkerSystem(url, numThreads);\r\n        this.systemManager.addRemoteSystem(id);\r\n        return this;\r\n    }\r\n\r\n    createSchedule(name: string, ...systems: Class<BagelSystem<any>>[]) {\r\n        this.systemManager.createSchedule(\r\n            name,\r\n            ...systems.map((sys) => (sys as typeof BagelSystem).id)\r\n        );\r\n\r\n        return this;\r\n    }\r\n\r\n    addToSchedule(\r\n        system: Class<BagelSystem<any>>,\r\n        schedule: string = \"DEFAULT\",\r\n        ordering?: SystemOrdering,\r\n        enabled = true\r\n    ) {\r\n        this.systemManager.addToSchedule(\r\n            (system as typeof BagelSystem).id,\r\n            schedule,\r\n            ordering ?? (system as typeof BagelSystem).runOrder,\r\n            enabled\r\n        );\r\n        return this;\r\n    }\r\n\r\n    enable(system: Class<BagelSystem<any>>, schedule = \"DEFAULT\") {\r\n        this.systemManager.enable((system as typeof BagelSystem).id, schedule);\r\n        return this;\r\n    }\r\n\r\n    disable(system: Class<BagelSystem<any>>, schedule = \"DEFAULT\") {\r\n        this.systemManager.disable((system as typeof BagelSystem).id, schedule);\r\n    }\r\n\r\n    tick(schedule: string = \"DEFAULT\"): Promise<void> {\r\n        this.storageManager.update();\r\n        this.archetypeManager.update();\r\n        return this.update(schedule);\r\n    }\r\n\r\n    update(systems: Class<BagelSystem<any>>[]): Promise<void>;\r\n    update(schedule?: string): Promise<void>;\r\n    update(arg: string | Class<BagelSystem<any>>[] = \"DEFAULT\"): Promise<void> {\r\n        if (typeof arg === \"string\") {\r\n            return this.systemManager.update(arg);\r\n        }\r\n\r\n        for (let i = arg.length - 1; i >= 0; i--) {\r\n            if (typeof arg[i] !== \"number\") {\r\n                //@ts-ignore\r\n                arg[i] = (arg[i] as typeof BagelSystem).id;\r\n            }\r\n        }\r\n\r\n        return this.systemManager.update(arg as any);\r\n    }\r\n\r\n    // Resources (Meant to mimic the entity / component API)\r\n    // Under the hood, it uses the same storage system, but without the archetype stuff\r\n    add(resource: any, id: intoID = resource.constructor.getId()) {\r\n        if (resource instanceof EntityComponent) {\r\n            resource.copyIntoStorage(this, this.reservedEntity);\r\n            return;\r\n        }\r\n\r\n        if (typeof id !== \"number\") {\r\n            id = id.getId();\r\n        }\r\n\r\n        World.GLOBAL_WORLD.storageManager\r\n            .getOrCreateStorage(id, resource.storageKind)\r\n            .addOrSetEnt(this.reservedEntity, resource);\r\n    }\r\n\r\n    get = this.reservedEntity.get.bind(this.reservedEntity);\r\n    set = this.reservedEntity.set.bind(this.reservedEntity);\r\n\r\n    remove(id: intoID) {\r\n        if (typeof id !== \"number\") id = id.getId();\r\n\r\n        this.storageManager.storages[id].deleteEnt(this.reservedEntity);\r\n    }\r\n}\r\n", "import { Class, KeysOfObjWhere, Tree } from \"../utils/types\";\r\nimport { Component, EntityComponent, PODComponent } from \"./component\";\r\nimport { World } from \"./world\";\r\nimport { Logger } from \"../utils/logger\";\r\nimport { loadRelationshipMethods } from \"./relationships\";\r\nimport { loadHierarchyMethods } from \"./hierarchy\";\r\nimport { AbstractNumberComponentStorage, F64ComponentStorage } from \"./storage\";\r\nimport { Type, TypeId } from \"./types\";\r\n\r\nconst logger = new Logger(\"Entities\");\r\n\r\nexport type intoID = number | { getId(): number };\r\n\r\nexport interface EntityAPI {\r\n    readonly world: World;\r\n\r\n    add(component: any, id?: intoID): void;\r\n    update<T>(id: intoID | TypeId<T>, component: T): void;\r\n    update(component: any): void;\r\n\r\n    set(component: any): void;\r\n    set<T>(id: intoID | TypeId<T>, component: T): void;\r\n\r\n    get<T>(typeId: TypeId<T>): T;\r\n    // For calling methods on components (ent.get(Vector).add)\r\n    // get<T extends Class<EntityComponent<any>>>(component: T): T;\r\n    get<T extends Class<any>>(component: T): InstanceType<T>;\r\n    get<T>(id: intoID): T;\r\n\r\n    remove(id: intoID): void;\r\n    has(id: intoID): boolean;\r\n\r\n    components(): ReadonlySet<number>;\r\n\r\n    tag(tag: intoID): void;\r\n    removeTag(tag: intoID): void;\r\n\r\n    getSlowRef(): {\r\n        -readonly [key in keyof Type as Type[key] extends TypeId<infer U>\r\n            ? Type[key]\r\n            : never]: Type[key] extends TypeId ? Type[key][\"_type\"] : never;\r\n    };\r\n\r\n    getLinkInfo<T = any>(\r\n        component: TypeId<T>\r\n    ): [key: number | string, obj: Record<number | string, T>];\r\n\r\n    // Useful number methods\r\n    inc(component: TypeId<number>, amount?: number): void;\r\n    mult(component: TypeId<number>, amount: number): void;\r\n    mod(component: TypeId<number>, modulo: number): void;\r\n}\r\n\r\nexport type Entity = number & EntityAPI;\r\n\r\nexport const extraEntityMethodLoaders: (() => void)[] = [];\r\nloadRelationshipMethods(extraEntityMethodLoaders);\r\nloadHierarchyMethods(extraEntityMethodLoaders);\r\n\r\n/** @internal */\r\nexport function loadEntityMethods() {\r\n    //@ts-ignore\r\n    Object.defineProperty(Number.prototype, \"world\", {\r\n        configurable: false,\r\n        enumerable: false,\r\n        get() {\r\n            return World.GLOBAL_WORLD;\r\n        },\r\n    });\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.add = function (\r\n        this: Entity,\r\n        component: any,\r\n        id = component.constructor.getId()\r\n    ) {\r\n        World.GLOBAL_WORLD.archetypeManager.entityAddComponent(this, id);\r\n\r\n        if (component instanceof EntityComponent) {\r\n            component.copyIntoStorage(World.GLOBAL_WORLD, this);\r\n            return;\r\n        }\r\n\r\n        if (typeof id !== \"number\") {\r\n            id = id.getId();\r\n        }\r\n\r\n        World.GLOBAL_WORLD.storageManager\r\n            .getOrCreateStorage(id, component.storageKind)\r\n            .addOrSetEnt(this, component);\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.update = function (this: Entity, valOrId, component) {\r\n        if (component == null) component = valOrId;\r\n\r\n        if (typeof valOrId == \"string\") valOrId = valOrId.getId();\r\n        else if (typeof valOrId !== \"number\") valOrId = valOrId.constructor.getId();\r\n\r\n        World.GLOBAL_WORLD.storageManager\r\n            // It doesn't matter what storage kind we pass in, we know it already exists.\r\n            .getOrCreateStorage(valOrId, 0)\r\n            .addOrSetEnt(this, component);\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.set = Number.prototype.update;\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.get = function (this: Entity, id) {\r\n        /* \r\n        By default, if a subclass of EntityComponent is passed in, we return \r\n        it after attaching ourselves. This is so we can access methods like so:\r\n\r\n            ent.get(Vector).add(ent2)\r\n\r\n        However, with PODComponents, a lot of the time we just want the data, not some\r\n        random class that is returned by Component():\r\n\r\n            const name = Component(Type.string);\r\n            ent.get(Name) -> should be a string, is actually \"class extends PODComponent<string>\"\r\n\r\n        We could just return the internal data of all PODComponents, but then we would be unable\r\n        to use methods (which are desired in some cases):\r\n\r\n            class Score extends Component(Type.number) {\r\n                reset() {\r\n                    this.data = 0;\r\n                }\r\n            }\r\n\r\n            ent.get(Score).reset();\r\n        \r\n        So, we only return the internal data if the component is a direct subclass of PODComponent.\r\n        In practice, this means components defined with `const x = Component()`. So components declared\r\n        with class X extends Component(...) will always have methods attached.\r\n\r\n            const Name = Component(Type.string)\r\n            class Score extends COmponent(Type.number) {\r\n                reset() {\r\n                    this.data = 0\r\n                }\r\n            }\r\n\r\n            ent.get(Name) -> string\r\n            ent.get(Score) -> Score (with ent internally attached)\r\n\r\n        We can tell if something is a direct subclass (1 level) by checking\r\n            Object.getPrototypeOf(class) === PODComponent\r\n        */\r\n\r\n        // // Actually, ive given up on that rn\r\n        // if (id.prototype instanceof PODComponent) {\r\n        //     id = id.;\r\n        // }\r\n\r\n        // if (\r\n        //     id.prototype instanceof EntityComponent &&\r\n        //     Object.getPrototypeOf(id) !== PODComponent\r\n        // ) {\r\n        //     id.currentEntity = this;\r\n        //     return id;\r\n        // }\r\n\r\n        if (typeof id !== \"number\") id = id.getId();\r\n\r\n        return World.GLOBAL_WORLD.storageManager.storages[id].getEnt(this);\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.remove = function (this: Entity, id) {\r\n        if (typeof id !== \"number\") id = id.getId();\r\n\r\n        World.GLOBAL_WORLD.storageManager.storages[id]?.deleteEnt(this);\r\n        World.GLOBAL_WORLD.archetypeManager.entityRemoveComponent(this, id);\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.has = function (this: Entity, id) {\r\n        const { archetypes, entityArchetypes } = World.GLOBAL_WORLD.archetypeManager;\r\n\r\n        return archetypes.get(entityArchetypes[this])!.components.has(id);\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.components = function (this: Entity) {\r\n        const { archetypes, entityArchetypes } = World.GLOBAL_WORLD.archetypeManager;\r\n\r\n        return archetypes.get(entityArchetypes[this])!.components;\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.tag = function (this: Entity, tag) {\r\n        if (typeof tag !== \"number\") tag = tag.getId();\r\n\r\n        World.GLOBAL_WORLD.archetypeManager.entityAddComponent(this, tag);\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.removeTag = function (this: Entity, tag) {\r\n        if (typeof tag !== \"number\") tag = tag.getId();\r\n\r\n        World.GLOBAL_WORLD.archetypeManager.entityRemoveComponent(this, tag);\r\n    };\r\n\r\n    //@ts-expect-error\r\n    Number.prototype.getSlowRef = function (this: Entity) {\r\n        return new Proxy(\r\n            {},\r\n            {\r\n                get: (target, p, receiver) => {\r\n                    return this.get(p as any);\r\n                },\r\n\r\n                set: (target, p, newValue, receiver) => {\r\n                    this.update(p as any, newValue);\r\n                    return true;\r\n                },\r\n            }\r\n        );\r\n    };\r\n\r\n    //@ts-ignore\r\n    Number.prototype.getLinkInfo = function (\r\n        this: Entity,\r\n        component: TypeId\r\n    ): [string | number, Record<string | number, any>] {\r\n        return [\r\n            this,\r\n            World.GLOBAL_WORLD.storageManager.storages[component].internalArray,\r\n        ];\r\n    };\r\n\r\n    //@ts-ignore\r\n    Number.prototype.inc = function (\r\n        this: Entity,\r\n        component: TypeId<number>,\r\n        amount: number = 1\r\n    ) {\r\n        //@ts-expect-error\r\n        if (typeof component !== \"number\") component = component.getId();\r\n\r\n        (\r\n            World.GLOBAL_WORLD.storageManager.storages[\r\n                component\r\n            ] as AbstractNumberComponentStorage\r\n        ).inc(this, amount);\r\n    };\r\n\r\n    //@ts-ignore\r\n    Number.prototype.mult = function (\r\n        this: Entity,\r\n        component: TypeId<number>,\r\n        amount: number\r\n    ) {\r\n        //@ts-expect-error\r\n        if (typeof component !== \"number\") component = component.getId();\r\n\r\n        (\r\n            World.GLOBAL_WORLD.storageManager.storages[\r\n                component\r\n            ] as AbstractNumberComponentStorage\r\n        ).mult(this, amount);\r\n    };\r\n\r\n    //@ts-ignore\r\n    Number.prototype.mod = function (\r\n        this: Entity,\r\n        component: TypeId<number>,\r\n        modulo: number\r\n    ) {\r\n        //@ts-expect-error\r\n        if (typeof component !== \"number\") component = component.getId();\r\n\r\n        (\r\n            World.GLOBAL_WORLD.storageManager.storages[\r\n                component\r\n            ] as AbstractNumberComponentStorage\r\n        ).mod(this, modulo);\r\n    };\r\n\r\n    extraEntityMethodLoaders.forEach((method) => method());\r\n    logger.logOk(\"Loaded all entity polyfills\");\r\n}\r\n", "import { TypeId } from \"../ecs/types\";\r\nimport { Archetype } from \"./archetype\";\r\nimport {\r\n    ComponentClass,\r\n    EntityComponent,\r\n    PODComponent,\r\n    UnwrapTypeIdArray,\r\n} from \"./component\";\r\nimport { Entity, intoID } from \"./entity\";\r\nimport { World } from \"./world\";\r\n\r\nexport class Blueprint {\r\n    private archetype?: Archetype;\r\n    private readonly defaultData = new Map<number, any>();\r\n    private readonly targetedComponents = new Set<number>();\r\n\r\n    private neededPropertyIds: number[] = [];\r\n    private neededPropertyStorageKinds: number[] = [];\r\n\r\n    constructor(...components: (intoID | {})[]) {\r\n        for (const arg of components) {\r\n            // Arg is internal component instance, copy all values into default data\r\n            if (arg instanceof EntityComponent) {\r\n                this.targetedComponents.add(arg.constructor.getId());\r\n\r\n                const cache: any[] =\r\n                    arg instanceof PODComponent ? [arg.cache] : arg.cache;\r\n\r\n                for (let i = 0; i < arg.propIds.length; i++) {\r\n                    this.defaultData.set(arg.propIds[i], cache[i]);\r\n                }\r\n\r\n                this.registerComponentProperties(arg.constructor);\r\n\r\n                // Component w/o default data\r\n            } else if (typeof arg === \"function\" || typeof arg === \"number\") {\r\n                const id = typeof arg == \"number\" ? arg : arg.getId();\r\n                this.targetedComponents.add(id);\r\n\r\n                // If its also an internal component, make sure it's schema is properly initialized\r\n                if (\r\n                    typeof arg === \"function\" &&\r\n                    arg.prototype instanceof EntityComponent\r\n                ) {\r\n                    this.registerComponentProperties(arg as ComponentClass);\r\n                }\r\n\r\n                // External component with default data\r\n            } else {\r\n                const id = arg.constructor.getId();\r\n                this.targetedComponents.add(id);\r\n                this.defaultData.set(id, arg);\r\n            }\r\n        }\r\n\r\n        if (World.GLOBAL_WORLD) this.setupWithWorld(World.GLOBAL_WORLD);\r\n    }\r\n\r\n    private registerComponentProperties(componentClass: ComponentClass): void {\r\n        this.neededPropertyIds.push(...componentClass.prototype.propIds);\r\n        this.neededPropertyStorageKinds.push(\r\n            ...componentClass.prototype.flattenedSchema\r\n        );\r\n    }\r\n\r\n    private setupWithWorld(world: World) {\r\n        this.archetype = world.archetypeManager.getOrCreateArchetype(\r\n            this.targetedComponents\r\n        );\r\n\r\n        // Make sure all components + properties have storages\r\n        for (let i = this.neededPropertyIds.length - 1; i > -1; i--) {\r\n            // getStorage creates a new storage if one doesn't exist\r\n            world.storageManager.getOrCreateStorage(\r\n                this.neededPropertyIds[i],\r\n                this.neededPropertyStorageKinds[i]\r\n            );\r\n        }\r\n    }\r\n\r\n    new() {\r\n        if (!this.archetype) {\r\n            this.setupWithWorld(World.GLOBAL_WORLD);\r\n        }\r\n\r\n        const ent = World.GLOBAL_WORLD.spawn();\r\n\r\n        for (const [key, value] of this.defaultData) {\r\n            const storage = World.GLOBAL_WORLD.storageManager.getOrCreateStorage(\r\n                key,\r\n                value.storageKind\r\n            );\r\n\r\n            storage.addOrSetEnt(ent, value);\r\n        }\r\n\r\n        const manager = World.GLOBAL_WORLD.archetypeManager;\r\n\r\n        manager.moveWithoutGraph(ent, manager.defaultArchetype, this.archetype!);\r\n        return ent;\r\n    }\r\n\r\n    factory<T extends TypeId[]>(\r\n        ...options: T\r\n    ): (...args: UnwrapTypeIdArray<T>) => Entity {\r\n        return BlueprintFactory(this, ...options);\r\n    }\r\n}\r\n\r\nexport interface BlueprintFactory {\r\n    <T extends TypeId[]>(blueprint: Blueprint, ...options: T): (\r\n        ...args: UnwrapTypeIdArray<T>\r\n    ) => Entity;\r\n    <T extends TypeId[]>(components: (intoID | {})[], ...options: T): (\r\n        ...args: UnwrapTypeIdArray<T>\r\n    ) => Entity;\r\n}\r\n\r\nexport function BlueprintFactory<T extends TypeId[]>(\r\n    blueprint: Blueprint,\r\n    ...options: T\r\n): (...args: UnwrapTypeIdArray<T>) => Entity;\r\nexport function BlueprintFactory<T extends TypeId[]>(\r\n    components: (intoID | {})[],\r\n    ...options: T\r\n): (...args: UnwrapTypeIdArray<T>) => Entity;\r\n\r\nexport function BlueprintFactory<T extends TypeId[]>(\r\n    bpOrComponents: Blueprint | (intoID | {})[],\r\n    ...options: T\r\n): (...args: UnwrapTypeIdArray<T>) => Entity {\r\n    const bp =\r\n        bpOrComponents instanceof Blueprint\r\n            ? bpOrComponents\r\n            : new Blueprint(...bpOrComponents);\r\n\r\n    return (...args: UnwrapTypeIdArray<T>): Entity => {\r\n        const ent = bp.new();\r\n\r\n        for (let i = options.length - 1; i > -1; i--) {\r\n            ent.update(options[i], args[i]);\r\n        }\r\n\r\n        return ent;\r\n    };\r\n}\r\n\r\nexport function AdvancedBlueprintFactory<\r\n    const TComponents extends TypeId[],\r\n    const TFunc extends (this: Entity, ...args: any[]) => void,\r\n    TArgs extends Parameters<TFunc> = Parameters<TFunc>\r\n>(\r\n    blueprint: Blueprint,\r\n    components: TComponents,\r\n    fn: TFunc\r\n): (\r\n    ...args: [...components: UnwrapTypeIdArray<TComponents>, ...args: TArgs]\r\n) => Entity {\r\n    return (...args: [...data: UnwrapTypeIdArray<TComponents>, ...args: TArgs]) => {\r\n        const ent = blueprint.new();\r\n        for (let i = components.length - 1; i > -1; i--) {\r\n            ent.update(components[i], args[i]);\r\n        }\r\n\r\n        fn.call(ent, ...args.slice(components.length));\r\n        return ent;\r\n    };\r\n}\r\n", "import { Logger } from \"../utils/logger\";\r\nimport { Class } from \"../utils/types\";\r\nimport { intoID } from \"./entity\";\r\nimport { TypeId } from \"./types\";\r\nimport { World } from \"./world\";\r\n\r\nconst logger = new Logger(\"World\", \"Resources\");\r\nexport class ResourceManager {\r\n    public readonly resources: Map<number, any> = new Map();\r\n\r\n    constructor(public readonly world: World) {}\r\n\r\n    addResource(resource: any, id: intoID = resource.constructor.getId()) {\r\n        if (typeof id !== \"number\") id = id.getId();\r\n\r\n        this.resources.set(id, resource);\r\n        logger.log(\"Added resource\", resource, \"(Id:\", id, \")\");\r\n    }\r\n\r\n    removeResource(id: intoID) {\r\n        if (typeof id !== \"number\") id = id.getId();\r\n        this.resources.delete(id as number);\r\n    }\r\n\r\n    getResource<T>(resource: Class<T>): T;\r\n    getResource<T>(id: intoID | TypeId<T>): T;\r\n\r\n    getResource<T>(id: intoID | TypeId<T>): T {\r\n        return this.resources.get(typeof id == \"number\" ? id : id.getId());\r\n    }\r\n\r\n    /** @internal */\r\n    public loadFromData(data: any) {\r\n        logger.log(\"Loading from data dump:\", data);\r\n\r\n        //@ts-ignore\r\n        this.resources = data;\r\n    }\r\n}\r\n", "export * from \"../ecs/archetype\";\r\nexport * from \"../ecs/blueprint\";\r\nexport * from \"../ecs/component\";\r\nexport * from \"../ecs/entity\";\r\nexport * from \"../ecs/hierarchy\";\r\nexport * from \"../ecs/query\";\r\nexport * from \"../ecs/relationships\";\r\nexport * from \"../ecs/resource\";\r\nexport * from \"../ecs/storage\";\r\nexport * from \"../ecs/custom_storages\";\r\nexport * from \"../ecs/system\";\r\nexport * from \"../ecs/system_manager\";\r\nexport * from \"../ecs/worker_manager\";\r\nexport * from \"../ecs/types\";\r\nexport * from \"../ecs/world\";\r\nexport * from \"../utils/class\";\r\nexport * from \"../utils/logger\";\r\nexport * from \"../utils/setFns\";\r\nexport * from \"../utils/walk\";\r\nexport * from \"../utils/types\";\r\n\r\nimport { loadEntityMethods } from \"../ecs/entity\";\r\nimport { loadComponentMethods } from \"../ecs/component\";\r\nimport { loadSetMethods } from \"../utils/setFns\";\r\n\r\n// Load polyfills here\r\nloadEntityMethods();\r\nloadComponentMethods();\r\nloadSetMethods();\r\n", "import { BufferBuilder } from \"./bufferbuilder\";\n\nexport type Packable =\n\t| null\n\t| undefined\n\t| string\n\t| number\n\t| boolean\n\t| Date\n\t| ArrayBuffer\n\t| Array<Packable>\n\t| { [key: string]: Packable }\n\t| ({ BYTES_PER_ELEMENT: number } & ArrayBufferView);\nexport type Unpackable =\n\t| null\n\t| undefined\n\t| string\n\t| number\n\t| boolean\n\t| ArrayBuffer\n\t| Array<Unpackable>\n\t| { [key: string]: Unpackable };\n\nexport function unpack<T extends Unpackable>(data: ArrayBuffer) {\n\tconst unpacker = new Unpacker(data);\n\treturn unpacker.unpack() as T;\n}\n\nexport function pack(data: Packable) {\n\tconst packer = new Packer();\n\tpacker.pack(data);\n\treturn packer.getBuffer();\n}\n\nclass Unpacker {\n\tprivate index: number;\n\tprivate readonly dataBuffer: ArrayBuffer;\n\tprivate readonly dataView: Uint8Array;\n\tprivate readonly length: number;\n\n\tconstructor(data: ArrayBuffer) {\n\t\tthis.index = 0;\n\t\tthis.dataBuffer = data;\n\t\tthis.dataView = new Uint8Array(this.dataBuffer);\n\t\tthis.length = this.dataBuffer.byteLength;\n\t}\n\n\tunpack(): Unpackable {\n\t\tconst type = this.unpack_uint8();\n\t\tif (type < 0x80) {\n\t\t\treturn type;\n\t\t} else if ((type ^ 0xe0) < 0x20) {\n\t\t\treturn (type ^ 0xe0) - 0x20;\n\t\t}\n\n\t\tlet size;\n\t\tif ((size = type ^ 0xa0) <= 0x0f) {\n\t\t\treturn this.unpack_raw(size);\n\t\t} else if ((size = type ^ 0xb0) <= 0x0f) {\n\t\t\treturn this.unpack_string(size);\n\t\t} else if ((size = type ^ 0x90) <= 0x0f) {\n\t\t\treturn this.unpack_array(size);\n\t\t} else if ((size = type ^ 0x80) <= 0x0f) {\n\t\t\treturn this.unpack_map(size);\n\t\t}\n\n\t\tswitch (type) {\n\t\t\tcase 0xc0:\n\t\t\t\treturn null;\n\t\t\tcase 0xc1:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xc2:\n\t\t\t\treturn false;\n\t\t\tcase 0xc3:\n\t\t\t\treturn true;\n\t\t\tcase 0xca:\n\t\t\t\treturn this.unpack_float();\n\t\t\tcase 0xcb:\n\t\t\t\treturn this.unpack_double();\n\t\t\tcase 0xcc:\n\t\t\t\treturn this.unpack_uint8();\n\t\t\tcase 0xcd:\n\t\t\t\treturn this.unpack_uint16();\n\t\t\tcase 0xce:\n\t\t\t\treturn this.unpack_uint32();\n\t\t\tcase 0xcf:\n\t\t\t\treturn this.unpack_uint64();\n\t\t\tcase 0xd0:\n\t\t\t\treturn this.unpack_int8();\n\t\t\tcase 0xd1:\n\t\t\t\treturn this.unpack_int16();\n\t\t\tcase 0xd2:\n\t\t\t\treturn this.unpack_int32();\n\t\t\tcase 0xd3:\n\t\t\t\treturn this.unpack_int64();\n\t\t\tcase 0xd4:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd5:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd6:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd7:\n\t\t\t\treturn undefined;\n\t\t\tcase 0xd8:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_string(size);\n\t\t\tcase 0xd9:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_string(size);\n\t\t\tcase 0xda:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_raw(size);\n\t\t\tcase 0xdb:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_raw(size);\n\t\t\tcase 0xdc:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_array(size);\n\t\t\tcase 0xdd:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_array(size);\n\t\t\tcase 0xde:\n\t\t\t\tsize = this.unpack_uint16();\n\t\t\t\treturn this.unpack_map(size);\n\t\t\tcase 0xdf:\n\t\t\t\tsize = this.unpack_uint32();\n\t\t\t\treturn this.unpack_map(size);\n\t\t}\n\t}\n\n\tunpack_uint8() {\n\t\tconst byte = this.dataView[this.index] & 0xff;\n\t\tthis.index++;\n\t\treturn byte;\n\t}\n\n\tunpack_uint16() {\n\t\tconst bytes = this.read(2);\n\t\tconst uint16 = (bytes[0] & 0xff) * 256 + (bytes[1] & 0xff);\n\t\tthis.index += 2;\n\t\treturn uint16;\n\t}\n\n\tunpack_uint32() {\n\t\tconst bytes = this.read(4);\n\t\tconst uint32 =\n\t\t\t((bytes[0] * 256 + bytes[1]) * 256 + bytes[2]) * 256 + bytes[3];\n\t\tthis.index += 4;\n\t\treturn uint32;\n\t}\n\n\tunpack_uint64() {\n\t\tconst bytes = this.read(8);\n\t\tconst uint64 =\n\t\t\t((((((bytes[0] * 256 + bytes[1]) * 256 + bytes[2]) * 256 + bytes[3]) *\n\t\t\t\t256 +\n\t\t\t\tbytes[4]) *\n\t\t\t\t256 +\n\t\t\t\tbytes[5]) *\n\t\t\t\t256 +\n\t\t\t\tbytes[6]) *\n\t\t\t\t256 +\n\t\t\tbytes[7];\n\t\tthis.index += 8;\n\t\treturn uint64;\n\t}\n\n\tunpack_int8() {\n\t\tconst uint8 = this.unpack_uint8();\n\t\treturn uint8 < 0x80 ? uint8 : uint8 - (1 << 8);\n\t}\n\n\tunpack_int16() {\n\t\tconst uint16 = this.unpack_uint16();\n\t\treturn uint16 < 0x8000 ? uint16 : uint16 - (1 << 16);\n\t}\n\n\tunpack_int32() {\n\t\tconst uint32 = this.unpack_uint32();\n\t\treturn uint32 < 2 ** 31 ? uint32 : uint32 - 2 ** 32;\n\t}\n\n\tunpack_int64() {\n\t\tconst uint64 = this.unpack_uint64();\n\t\treturn uint64 < 2 ** 63 ? uint64 : uint64 - 2 ** 64;\n\t}\n\n\tunpack_raw(size: number) {\n\t\tif (this.length < this.index + size) {\n\t\t\tthrow new Error(\n\t\t\t\t`BinaryPackFailure: index is out of range ${this.index} ${size} ${this.length}`,\n\t\t\t);\n\t\t}\n\t\tconst buf = this.dataBuffer.slice(this.index, this.index + size);\n\t\tthis.index += size;\n\n\t\treturn buf;\n\t}\n\n\tunpack_string(size: number) {\n\t\tconst bytes = this.read(size);\n\t\tlet i = 0;\n\t\tlet str = \"\";\n\t\tlet c;\n\t\tlet code;\n\n\t\twhile (i < size) {\n\t\t\tc = bytes[i];\n\t\t\t// The length of a UTF-8 sequence is specified in the first byte:\n\t\t\t// 0xxxxxxx means length 1,\n\t\t\t// 110xxxxx means length 2,\n\t\t\t// 1110xxxx means length 3,\n\t\t\t// 11110xxx means length 4.\n\t\t\t// 10xxxxxx is for non-initial bytes.\n\t\t\tif (c < 0xa0) {\n\t\t\t\t// One-byte sequence: bits 0xxxxxxx\n\t\t\t\tcode = c;\n\t\t\t\ti++;\n\t\t\t} else if ((c ^ 0xc0) < 0x20) {\n\t\t\t\t// Two-byte sequence: bits 110xxxxx 10xxxxxx\n\t\t\t\tcode = ((c & 0x1f) << 6) | (bytes[i + 1] & 0x3f);\n\t\t\t\ti += 2;\n\t\t\t} else if ((c ^ 0xe0) < 0x10) {\n\t\t\t\t// Three-byte sequence: bits 1110xxxx 10xxxxxx 10xxxxxx\n\t\t\t\tcode =\n\t\t\t\t\t((c & 0x0f) << 12) |\n\t\t\t\t\t((bytes[i + 1] & 0x3f) << 6) |\n\t\t\t\t\t(bytes[i + 2] & 0x3f);\n\t\t\t\ti += 3;\n\t\t\t} else {\n\t\t\t\t// Four-byte sequence: bits 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n\t\t\t\tcode =\n\t\t\t\t\t((c & 0x07) << 18) |\n\t\t\t\t\t((bytes[i + 1] & 0x3f) << 12) |\n\t\t\t\t\t((bytes[i + 2] & 0x3f) << 6) |\n\t\t\t\t\t(bytes[i + 3] & 0x3f);\n\t\t\t\ti += 4;\n\t\t\t}\n\t\t\tstr += String.fromCodePoint(code);\n\t\t}\n\n\t\tthis.index += size;\n\t\treturn str;\n\t}\n\n\tunpack_array(size: number) {\n\t\tconst objects = new Array<Unpackable>(size);\n\t\tfor (let i = 0; i < size; i++) {\n\t\t\tobjects[i] = this.unpack();\n\t\t}\n\t\treturn objects;\n\t}\n\n\tunpack_map(size: number) {\n\t\tconst map: { [key: string]: Unpackable } = {};\n\t\tfor (let i = 0; i < size; i++) {\n\t\t\tconst key = this.unpack() as string;\n\t\t\tmap[key] = this.unpack();\n\t\t}\n\t\treturn map;\n\t}\n\n\tunpack_float() {\n\t\tconst uint32 = this.unpack_uint32();\n\t\tconst sign = uint32 >> 31;\n\t\tconst exp = ((uint32 >> 23) & 0xff) - 127;\n\t\tconst fraction = (uint32 & 0x7fffff) | 0x800000;\n\t\treturn (sign === 0 ? 1 : -1) * fraction * 2 ** (exp - 23);\n\t}\n\n\tunpack_double() {\n\t\tconst h32 = this.unpack_uint32();\n\t\tconst l32 = this.unpack_uint32();\n\t\tconst sign = h32 >> 31;\n\t\tconst exp = ((h32 >> 20) & 0x7ff) - 1023;\n\t\tconst hfrac = (h32 & 0xfffff) | 0x100000;\n\t\tconst frac = hfrac * 2 ** (exp - 20) + l32 * 2 ** (exp - 52);\n\t\treturn (sign === 0 ? 1 : -1) * frac;\n\t}\n\n\tread(length: number) {\n\t\tconst j = this.index;\n\t\tif (j + length <= this.length) {\n\t\t\treturn this.dataView.subarray(j, j + length);\n\t\t} else {\n\t\t\tthrow new Error(\"BinaryPackFailure: read index out of range\");\n\t\t}\n\t}\n}\n\nexport class Packer {\n\tprivate _bufferBuilder = new BufferBuilder();\n\tprivate _textEncoder = new TextEncoder();\n\n\tgetBuffer() {\n\t\treturn this._bufferBuilder.toArrayBuffer();\n\t}\n\n\tpack(value: Packable) {\n\t\tif (typeof value === \"string\") {\n\t\t\tthis.pack_string(value);\n\t\t} else if (typeof value === \"number\") {\n\t\t\tif (Math.floor(value) === value) {\n\t\t\t\tthis.pack_integer(value);\n\t\t\t} else {\n\t\t\t\tthis.pack_double(value);\n\t\t\t}\n\t\t} else if (typeof value === \"boolean\") {\n\t\t\tif (value === true) {\n\t\t\t\tthis._bufferBuilder.append(0xc3);\n\t\t\t} else if (value === false) {\n\t\t\t\tthis._bufferBuilder.append(0xc2);\n\t\t\t}\n\t\t} else if (value === undefined) {\n\t\t\tthis._bufferBuilder.append(0xc0);\n\t\t} else if (typeof value === \"object\") {\n\t\t\tif (value === null) {\n\t\t\t\tthis._bufferBuilder.append(0xc0);\n\t\t\t} else {\n\t\t\t\tconst constructor = value.constructor;\n\t\t\t\tif (value instanceof Array) {\n\t\t\t\t\tthis.pack_array(value);\n\t\t\t\t} else if (value instanceof ArrayBuffer) {\n\t\t\t\t\tthis.pack_bin(new Uint8Array(value));\n\t\t\t\t} else if (\"BYTES_PER_ELEMENT\" in value) {\n\t\t\t\t\tconst v = value as unknown as DataView;\n\t\t\t\t\tthis.pack_bin(new Uint8Array(v.buffer, v.byteOffset, v.byteLength));\n\t\t\t\t} else if (value instanceof Date) {\n\t\t\t\t\tthis.pack_string(value.toString());\n\t\t\t\t} else if (\n\t\t\t\t\tconstructor == Object ||\n\t\t\t\t\tconstructor.toString().startsWith(\"class\")\n\t\t\t\t) {\n\t\t\t\t\tthis.pack_object(value);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`Type \"${constructor.toString()}\" not yet supported`);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new Error(`Type \"${typeof value}\" not yet supported`);\n\t\t}\n\t\tthis._bufferBuilder.flush();\n\t}\n\n\tpack_bin(blob: Uint8Array) {\n\t\tconst length = blob.length;\n\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0xa0 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xda);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xdb);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tthis._bufferBuilder.append_buffer(blob);\n\t}\n\n\tpack_string(str: string) {\n\t\tconst encoded = this._textEncoder.encode(str);\n\t\tconst length = encoded.length;\n\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0xb0 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xd8);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xd9);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tthis._bufferBuilder.append_buffer(encoded);\n\t}\n\n\tpack_array(ary: Packable[]) {\n\t\tconst length = ary.length;\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0x90 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xdc);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xdd);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tthis.pack(ary[i]);\n\t\t}\n\t}\n\n\tpack_integer(num: number) {\n\t\tif (num >= -0x20 && num <= 0x7f) {\n\t\t\tthis._bufferBuilder.append(num & 0xff);\n\t\t} else if (num >= 0x00 && num <= 0xff) {\n\t\t\tthis._bufferBuilder.append(0xcc);\n\t\t\tthis.pack_uint8(num);\n\t\t} else if (num >= -0x80 && num <= 0x7f) {\n\t\t\tthis._bufferBuilder.append(0xd0);\n\t\t\tthis.pack_int8(num);\n\t\t} else if (num >= 0x0000 && num <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xcd);\n\t\t\tthis.pack_uint16(num);\n\t\t} else if (num >= -0x8000 && num <= 0x7fff) {\n\t\t\tthis._bufferBuilder.append(0xd1);\n\t\t\tthis.pack_int16(num);\n\t\t} else if (num >= 0x00000000 && num <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xce);\n\t\t\tthis.pack_uint32(num);\n\t\t} else if (num >= -0x80000000 && num <= 0x7fffffff) {\n\t\t\tthis._bufferBuilder.append(0xd2);\n\t\t\tthis.pack_int32(num);\n\t\t} else if (num >= -0x8000000000000000 && num <= 0x7fffffffffffffff) {\n\t\t\tthis._bufferBuilder.append(0xd3);\n\t\t\tthis.pack_int64(num);\n\t\t} else if (num >= 0x0000000000000000 && num <= 0xffffffffffffffff) {\n\t\t\tthis._bufferBuilder.append(0xcf);\n\t\t\tthis.pack_uint64(num);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid integer\");\n\t\t}\n\t}\n\n\tpack_double(num: number) {\n\t\tlet sign = 0;\n\t\tif (num < 0) {\n\t\t\tsign = 1;\n\t\t\tnum = -num;\n\t\t}\n\t\tconst exp = Math.floor(Math.log(num) / Math.LN2);\n\t\tconst frac0 = num / 2 ** exp - 1;\n\t\tconst frac1 = Math.floor(frac0 * 2 ** 52);\n\t\tconst b32 = 2 ** 32;\n\t\tconst h32 =\n\t\t\t(sign << 31) | ((exp + 1023) << 20) | ((frac1 / b32) & 0x0fffff);\n\t\tconst l32 = frac1 % b32;\n\t\tthis._bufferBuilder.append(0xcb);\n\t\tthis.pack_int32(h32);\n\t\tthis.pack_int32(l32);\n\t}\n\n\tpack_object(obj: { [key: string]: Packable }) {\n\t\tconst keys = Object.keys(obj);\n\t\tconst length = keys.length;\n\t\tif (length <= 0x0f) {\n\t\t\tthis.pack_uint8(0x80 + length);\n\t\t} else if (length <= 0xffff) {\n\t\t\tthis._bufferBuilder.append(0xde);\n\t\t\tthis.pack_uint16(length);\n\t\t} else if (length <= 0xffffffff) {\n\t\t\tthis._bufferBuilder.append(0xdf);\n\t\t\tthis.pack_uint32(length);\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid length\");\n\t\t}\n\t\tfor (const prop in obj) {\n\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\tif (obj.hasOwnProperty(prop)) {\n\t\t\t\tthis.pack(prop);\n\t\t\t\tthis.pack(obj[prop]);\n\t\t\t}\n\t\t}\n\t}\n\n\tpack_uint8(num: number) {\n\t\tthis._bufferBuilder.append(num);\n\t}\n\n\tpack_uint16(num: number) {\n\t\tthis._bufferBuilder.append(num >> 8);\n\t\tthis._bufferBuilder.append(num & 0xff);\n\t}\n\n\tpack_uint32(num: number) {\n\t\tconst n = num & 0xffffffff;\n\t\tthis._bufferBuilder.append((n & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((n & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((n & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(n & 0x000000ff);\n\t}\n\n\tpack_uint64(num: number) {\n\t\tconst high = num / 2 ** 32;\n\t\tconst low = num % 2 ** 32;\n\t\tthis._bufferBuilder.append((high & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((high & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((high & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(high & 0x000000ff);\n\t\tthis._bufferBuilder.append((low & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((low & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((low & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(low & 0x000000ff);\n\t}\n\n\tpack_int8(num: number) {\n\t\tthis._bufferBuilder.append(num & 0xff);\n\t}\n\n\tpack_int16(num: number) {\n\t\tthis._bufferBuilder.append((num & 0xff00) >> 8);\n\t\tthis._bufferBuilder.append(num & 0xff);\n\t}\n\n\tpack_int32(num: number) {\n\t\tthis._bufferBuilder.append((num >>> 24) & 0xff);\n\t\tthis._bufferBuilder.append((num & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((num & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(num & 0x000000ff);\n\t}\n\n\tpack_int64(num: number) {\n\t\tconst high = Math.floor(num / 2 ** 32);\n\t\tconst low = num % 2 ** 32;\n\t\tthis._bufferBuilder.append((high & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((high & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((high & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(high & 0x000000ff);\n\t\tthis._bufferBuilder.append((low & 0xff000000) >>> 24);\n\t\tthis._bufferBuilder.append((low & 0x00ff0000) >>> 16);\n\t\tthis._bufferBuilder.append((low & 0x0000ff00) >>> 8);\n\t\tthis._bufferBuilder.append(low & 0x000000ff);\n\t}\n}\n", "class BufferBuilder {\n\tprivate _pieces: number[];\n\tprivate readonly _parts: ArrayBufferView[];\n\n\tconstructor() {\n\t\tthis._pieces = [];\n\t\tthis._parts = [];\n\t}\n\n\tappend_buffer(data: ArrayBufferView) {\n\t\tthis.flush();\n\t\tthis._parts.push(data);\n\t}\n\n\tappend(data: number) {\n\t\tthis._pieces.push(data);\n\t}\n\n\tflush() {\n\t\tif (this._pieces.length > 0) {\n\t\t\tconst buf = new Uint8Array(this._pieces);\n\t\t\tthis._parts.push(buf);\n\t\t\tthis._pieces = [];\n\t\t}\n\t}\n\n\tprivate encoder = new TextEncoder();\n\n\tpublic toArrayBuffer() {\n\t\tconst buffer = [];\n\t\tfor (const part of this._parts) {\n\t\t\tbuffer.push(part);\n\t\t}\n\t\treturn concatArrayBuffers(buffer).buffer;\n\t}\n}\n\nexport { BufferBuilder };\n\nfunction concatArrayBuffers(bufs: ArrayBufferView[]) {\n\tlet size = 0;\n\tfor (const buf of bufs) {\n\t\tsize += buf.byteLength;\n\t}\n\tconst result = new Uint8Array(size);\n\tlet offset = 0;\n\tfor (const buf of bufs) {\n\t\tconst view = new Uint8Array(buf.buffer, buf.byteOffset, buf.byteLength);\n\t\tresult.set(view, offset);\n\t\toffset += buf.byteLength;\n\t}\n\treturn result;\n}\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n    'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator ||\n      !window.navigator.userAgent) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  const {navigator} = window;\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n      /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n      /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n      /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n    .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n        this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n        externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n        internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n        .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n    window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n    'localDescription', {\n      get() {\n        const description = origLocalDescription.get.apply(this);\n        if (description.type === '') {\n          return description;\n        }\n        return replaceInternalStreamId(this, description);\n      }\n    });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n          'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window, browserDetails) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n            .then(devices => {\n              devices = devices.filter(d => d.kind === 'videoinput');\n              let dev = devices.find(d => matches.some(match =>\n                d.label.toLowerCase().includes(match)));\n              if (!dev && devices.length && matches.includes('back')) {\n                dev = devices[devices.length - 1]; // more likely the back cam\n              }\n              if (dev) {\n                constraints.video.deviceId = face.exact\n                  ? {exact: dev.deviceId}\n                  : {ideal: dev.deviceId};\n              }\n              constraints.video = constraintsToChrome_(constraints.video);\n              logging('chrome: ' + JSON.stringify(constraints));\n              return func(constraints);\n            });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n", "/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n      Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        // WebIDL input coercion and validation\n        let sendEncodings = arguments[1] && arguments[1].sendEncodings;\n        if (sendEncodings === undefined) {\n          sendEncodings = [];\n        }\n        sendEncodings = [...sendEncodings];\n        const shouldPerformCheck = sendEncodings.length > 0;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params) ||\n              // Avoid being fooled by patched getParameters() below.\n              (params.encodings.length === 1 &&\n               Object.keys(params.encodings[0]).length === 0)) {\n            params.encodings = sendEncodings;\n            sender.sendEncodings = sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        const params = origGetParameters.apply(this, arguments);\n        if (!('encodings' in params)) {\n          params.encodings = [].concat(this.sendEncodings || [{}]);\n        }\n        return params;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateOffer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateAnswer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n      'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n", "/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n        .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (server.urls === undefined && server.url) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio', {direction: 'recvonly'});\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video', {direction: 'recvonly'});\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n\n", "/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substring(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      for (const key in parsedCandidate) {\n        if (!(key in nativeCandidate)) {\n          Object.defineProperty(nativeCandidate, key,\n            {value: parsedCandidate[key]});\n        }\n      }\n\n      // Override serializer to not serialize the extra attributes.\n      nativeCandidate.toJSON = function toJSON() {\n        return {\n          candidate: nativeCandidate.candidate,\n          sdpMid: nativeCandidate.sdpMid,\n          sdpMLineIndex: nativeCandidate.sdpMLineIndex,\n          usernameFragment: nativeCandidate.usernameFragment,\n        };\n      };\n      return nativeCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimRTCIceCandidateRelayProtocol(window) {\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'relayProtocol' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      const parsedCandidate = SDPUtils.parseCandidate(e.candidate.candidate);\n      if (parsedCandidate.type === 'relay') {\n        // This is a libwebrtc-specific mapping of local type preference\n        // to relayProtocol.\n        e.candidate.relayProtocol = {\n          0: 'tls',\n          1: 'tcp',\n          2: 'udp',\n        }[parsedCandidate.priority >> 24];\n      }\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substring(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n          this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n          this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeExtmapAllowMixed(window, browserDetails) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' && browserDetails.version >= 605) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      const sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n      // Safari enforces read-only-ness of RTCSessionDescription fields.\n      if (window.RTCSessionDescription &&\n          desc instanceof window.RTCSessionDescription) {\n        arguments[0] = new window.RTCSessionDescription({\n          type: desc.type,\n          sdp,\n        });\n      } else {\n        desc.sdp = sdp;\n      }\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n\nexport function shimAddIceCandidateNullOrEmpty(window, browserDetails) {\n  // Support for addIceCandidate(null or undefined)\n  // as well as addIceCandidate({candidate: \"\", ...})\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=978582\n  // Note: must be called before other polyfills which change the signature.\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  if (!nativeAddIceCandidate || nativeAddIceCandidate.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      // Native support for ignoring exists for Chrome M77+.\n      // Safari ignores as well, exact version unknown but works in the same\n      // version that also ignores addIceCandidate(null).\n      if (((browserDetails.browser === 'chrome' && browserDetails.version < 78)\n           || (browserDetails.browser === 'firefox'\n               && browserDetails.version < 68)\n           || (browserDetails.browser === 'safari'))\n          && arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Note: Make sure to call this ahead of APIs that modify\n// setLocalDescription.length\nexport function shimParameterlessSetLocalDescription(window, browserDetails) {\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  if (!nativeSetLocalDescription || nativeSetLocalDescription.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      let desc = arguments[0] || {};\n      if (typeof desc !== 'object' || (desc.type && desc.sdp)) {\n        return nativeSetLocalDescription.apply(this, arguments);\n      }\n      // The remaining steps should technically happen when SLD comes off the\n      // RTCPeerConnection's operations chain (not ahead of going on it), but\n      // this is too difficult to shim. Instead, this shim only covers the\n      // common case where the operations chain is empty. This is imperfect, but\n      // should cover many cases. Rationale: Even if we can't reduce the glare\n      // window to zero on imperfect implementations, there's value in tapping\n      // into the perfect negotiation pattern that several browsers support.\n      desc = {type: desc.type, sdp: desc.sdp};\n      if (!desc.type) {\n        switch (this.signalingState) {\n          case 'stable':\n          case 'have-local-offer':\n          case 'have-remote-pranswer':\n            desc.type = 'offer';\n            break;\n          default:\n            desc.type = 'answer';\n            break;\n        }\n      }\n      if (desc.sdp || (desc.type !== 'offer' && desc.type !== 'answer')) {\n        return nativeSetLocalDescription.apply(this, [desc]);\n      }\n      const func = desc.type === 'offer' ? this.createOffer : this.createAnswer;\n      return func.apply(this)\n        .then(d => nativeSetLocalDescription.apply(this, [d]));\n    };\n}\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n// Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\nimport * as sdp from 'sdp';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings,\n    // Expose sdp as a convenience. For production apps include directly.\n    sdp,\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      chromeShim.shimGetUserMedia(window, browserDetails);\n      chromeShim.shimMediaStream(window, browserDetails);\n      chromeShim.shimPeerConnection(window, browserDetails);\n      chromeShim.shimOnTrack(window, browserDetails);\n      chromeShim.shimAddTrackRemoveTrack(window, browserDetails);\n      chromeShim.shimGetSendersWithDtmf(window, browserDetails);\n      chromeShim.shimGetStats(window, browserDetails);\n      chromeShim.shimSenderReceiverGetStats(window, browserDetails);\n      chromeShim.fixNegotiationNeeded(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      firefoxShim.shimGetUserMedia(window, browserDetails);\n      firefoxShim.shimPeerConnection(window, browserDetails);\n      firefoxShim.shimOnTrack(window, browserDetails);\n      firefoxShim.shimRemoveStream(window, browserDetails);\n      firefoxShim.shimSenderGetStats(window, browserDetails);\n      firefoxShim.shimReceiverGetStats(window, browserDetails);\n      firefoxShim.shimRTCDataChannel(window, browserDetails);\n      firefoxShim.shimAddTransceiver(window, browserDetails);\n      firefoxShim.shimGetParameters(window, browserDetails);\n      firefoxShim.shimCreateOffer(window, browserDetails);\n      firefoxShim.shimCreateAnswer(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      // Must be called before shimCallbackAPI.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      safariShim.shimRTCIceServerUrls(window, browserDetails);\n      safariShim.shimCreateOfferLegacy(window, browserDetails);\n      safariShim.shimCallbacksAPI(window, browserDetails);\n      safariShim.shimLocalStreamsAPI(window, browserDetails);\n      safariShim.shimRemoteStreamsAPI(window, browserDetails);\n      safariShim.shimTrackEventTransceiver(window, browserDetails);\n      safariShim.shimGetUserMedia(window, browserDetails);\n      safariShim.shimAudioContext(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n", "/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter =\n  adapterFactory({window: typeof window === 'undefined' ? undefined : window});\nexport default adapter;\n", "let decoder\ntry {\n\tdecoder = new TextDecoder()\n} catch(error) {}\nlet src\nlet srcEnd\nlet position = 0\nlet alreadySet\nconst EMPTY_ARRAY = []\nconst LEGACY_RECORD_INLINE_ID = 105\nconst RECORD_DEFINITIONS_ID = 0xdffe\nconst RECORD_INLINE_ID = 0xdfff // temporary first-come first-serve tag // proposed tag: 0x7265 // 're'\nconst BUNDLED_STRINGS_ID = 0xdff9\nconst PACKED_TABLE_TAG_ID = 51\nconst PACKED_REFERENCE_TAG_ID = 6\nconst STOP_CODE = {}\nlet strings = EMPTY_ARRAY\nlet stringPosition = 0\nlet currentDecoder = {}\nlet currentStructures\nlet srcString\nlet srcStringStart = 0\nlet srcStringEnd = 0\nlet bundledStrings\nlet referenceMap\nlet currentExtensions = []\nlet currentExtensionRanges = []\nlet packedValues\nlet dataView\nlet restoreMapsAsObject\nlet defaultOptions = {\n\tuseRecords: false,\n\tmapsAsObjects: true\n}\nlet sequentialMode = false\nlet inlineObjectReadThreshold = 2;\nvar BlockedFunction // we use search and replace to change the next call to BlockedFunction to avoid CSP issues for\n// no-eval build\ntry {\n\tnew Function('')\n} catch(error) {\n\t// if eval variants are not supported, do not create inline object readers ever\n\tinlineObjectReadThreshold = Infinity\n}\n\n\n\nexport class Decoder {\n\tconstructor(options) {\n\t\tif (options) {\n\t\t\tif ((options.keyMap || options._keyMap) && !options.useRecords) {\n\t\t\t\toptions.useRecords = false\n\t\t\t\toptions.mapsAsObjects = true\n\t\t\t}\n\t\t\tif (options.useRecords === false && options.mapsAsObjects === undefined)\n\t\t\t\toptions.mapsAsObjects = true\n\t\t\tif (options.getStructures)\n\t\t\t\toptions.getShared = options.getStructures\n\t\t\tif (options.getShared && !options.structures)\n\t\t\t\t(options.structures = []).uninitialized = true // this is what we use to denote an uninitialized structures\n\t\t\tif (options.keyMap) {\n\t\t\t\tthis.mapKey = new Map()\n\t\t\t\tfor (let [k,v] of Object.entries(options.keyMap)) this.mapKey.set(v,k)\n\t\t\t}\n\t\t}\n\t\tObject.assign(this, options)\n\t}\n\t/*\n\tdecodeKey(key) {\n\t\treturn this.keyMap\n\t\t\t? Object.keys(this.keyMap)[Object.values(this.keyMap).indexOf(key)] || key\n\t\t\t: key\n\t}\n\t*/\n\tdecodeKey(key) {\n\t\treturn this.keyMap ? this.mapKey.get(key) || key : key\n\t}\n\t\n\tencodeKey(key) {\n\t\treturn this.keyMap && this.keyMap.hasOwnProperty(key) ? this.keyMap[key] : key\n\t}\n\n\tencodeKeys(rec) {\n\t\tif (!this._keyMap) return rec\n\t\tlet map = new Map()\n\t\tfor (let [k,v] of Object.entries(rec)) map.set((this._keyMap.hasOwnProperty(k) ? this._keyMap[k] : k), v)\n\t\treturn map\n\t}\n\n\tdecodeKeys(map) {\n\t\tif (!this._keyMap || map.constructor.name != 'Map') return map\n\t\tif (!this._mapKey) {\n\t\t\tthis._mapKey = new Map()\n\t\t\tfor (let [k,v] of Object.entries(this._keyMap)) this._mapKey.set(v,k)\n\t\t}\n\t\tlet res = {}\n\t\t//map.forEach((v,k) => res[Object.keys(this._keyMap)[Object.values(this._keyMap).indexOf(k)] || k] = v)\n\t\tmap.forEach((v,k) => res[safeKey(this._mapKey.has(k) ? this._mapKey.get(k) : k)] =  v)\n\t\treturn res\n\t}\n\t\n\tmapDecode(source, end) {\n\t\n\t\tlet res = this.decode(source)\n\t\tif (this._keyMap) { \n\t\t\t//Experiemntal support for Optimised KeyMap  decoding \n\t\t\tswitch (res.constructor.name) {\n\t\t\t\tcase 'Array': return res.map(r => this.decodeKeys(r))\n\t\t\t\t//case 'Map': return this.decodeKeys(res)\n\t\t\t}\n\t\t}\n\t\treturn res\n\t}\n\n\tdecode(source, end) {\n\t\tif (src) {\n\t\t\t// re-entrant execution, save the state and restore it after we do this decode\n\t\t\treturn saveState(() => {\n\t\t\t\tclearSource()\n\t\t\t\treturn this ? this.decode(source, end) : Decoder.prototype.decode.call(defaultOptions, source, end)\n\t\t\t})\n\t\t}\n\t\tsrcEnd = end > -1 ? end : source.length\n\t\tposition = 0\n\t\tstringPosition = 0\n\t\tsrcStringEnd = 0\n\t\tsrcString = null\n\t\tstrings = EMPTY_ARRAY\n\t\tbundledStrings = null\n\t\tsrc = source\n\t\t// this provides cached access to the data view for a buffer if it is getting reused, which is a recommend\n\t\t// technique for getting data from a database where it can be copied into an existing buffer instead of creating\n\t\t// new ones\n\t\ttry {\n\t\t\tdataView = source.dataView || (source.dataView = new DataView(source.buffer, source.byteOffset, source.byteLength))\n\t\t} catch(error) {\n\t\t\t// if it doesn't have a buffer, maybe it is the wrong type of object\n\t\t\tsrc = null\n\t\t\tif (source instanceof Uint8Array)\n\t\t\t\tthrow error\n\t\t\tthrow new Error('Source must be a Uint8Array or Buffer but was a ' + ((source && typeof source == 'object') ? source.constructor.name : typeof source))\n\t\t}\n\t\tif (this instanceof Decoder) {\n\t\t\tcurrentDecoder = this\n\t\t\tpackedValues = this.sharedValues &&\n\t\t\t\t(this.pack ? new Array(this.maxPrivatePackedValues || 16).concat(this.sharedValues) :\n\t\t\t\tthis.sharedValues)\n\t\t\tif (this.structures) {\n\t\t\t\tcurrentStructures = this.structures\n\t\t\t\treturn checkedRead()\n\t\t\t} else if (!currentStructures || currentStructures.length > 0) {\n\t\t\t\tcurrentStructures = []\n\t\t\t}\n\t\t} else {\n\t\t\tcurrentDecoder = defaultOptions\n\t\t\tif (!currentStructures || currentStructures.length > 0)\n\t\t\t\tcurrentStructures = []\n\t\t\tpackedValues = null\n\t\t}\n\t\treturn checkedRead()\n\t}\n\tdecodeMultiple(source, forEach) {\n\t\tlet values, lastPosition = 0\n\t\ttry {\n\t\t\tlet size = source.length\n\t\t\tsequentialMode = true\n\t\t\tlet value = this ? this.decode(source, size) : defaultDecoder.decode(source, size)\n\t\t\tif (forEach) {\n\t\t\t\tif (forEach(value) === false) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\twhile(position < size) {\n\t\t\t\t\tlastPosition = position\n\t\t\t\t\tif (forEach(checkedRead()) === false) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvalues = [ value ]\n\t\t\t\twhile(position < size) {\n\t\t\t\t\tlastPosition = position\n\t\t\t\t\tvalues.push(checkedRead())\n\t\t\t\t}\n\t\t\t\treturn values\n\t\t\t}\n\t\t} catch(error) {\n\t\t\terror.lastPosition = lastPosition\n\t\t\terror.values = values\n\t\t\tthrow error\n\t\t} finally {\n\t\t\tsequentialMode = false\n\t\t\tclearSource()\n\t\t}\n\t}\n}\nexport function getPosition() {\n\treturn position\n}\nexport function checkedRead() {\n\ttry {\n\t\tlet result = read()\n\t\tif (bundledStrings) {\n\t\t\tif (position >= bundledStrings.postBundlePosition) {\n\t\t\t\tlet error = new Error('Unexpected bundle position');\n\t\t\t\terror.incomplete = true;\n\t\t\t\tthrow error\n\t\t\t}\n\t\t\t// bundled strings to skip past\n\t\t\tposition = bundledStrings.postBundlePosition;\n\t\t\tbundledStrings = null;\n\t\t}\n\n\t\tif (position == srcEnd) {\n\t\t\t// finished reading this source, cleanup references\n\t\t\tcurrentStructures = null\n\t\t\tsrc = null\n\t\t\tif (referenceMap)\n\t\t\t\treferenceMap = null\n\t\t} else if (position > srcEnd) {\n\t\t\t// over read\n\t\t\tlet error = new Error('Unexpected end of CBOR data')\n\t\t\terror.incomplete = true\n\t\t\tthrow error\n\t\t} else if (!sequentialMode) {\n\t\t\tthrow new Error('Data read, but end of buffer not reached')\n\t\t}\n\t\t// else more to read, but we are reading sequentially, so don't clear source yet\n\t\treturn result\n\t} catch(error) {\n\t\tclearSource()\n\t\tif (error instanceof RangeError || error.message.startsWith('Unexpected end of buffer')) {\n\t\t\terror.incomplete = true\n\t\t}\n\t\tthrow error\n\t}\n}\n\nexport function read() {\n\tlet token = src[position++]\n\tlet majorType = token >> 5\n\ttoken = token & 0x1f\n\tif (token > 0x17) {\n\t\tswitch (token) {\n\t\t\tcase 0x18:\n\t\t\t\ttoken = src[position++]\n\t\t\t\tbreak\n\t\t\tcase 0x19:\n\t\t\t\tif (majorType == 7) {\n\t\t\t\t\treturn getFloat16()\n\t\t\t\t}\n\t\t\t\ttoken = dataView.getUint16(position)\n\t\t\t\tposition += 2\n\t\t\t\tbreak\n\t\t\tcase 0x1a:\n\t\t\t\tif (majorType == 7) {\n\t\t\t\t\tlet value = dataView.getFloat32(position)\n\t\t\t\t\tif (currentDecoder.useFloat32 > 2) {\n\t\t\t\t\t\t// this does rounding of numbers that were encoded in 32-bit float to nearest significant decimal digit that could be preserved\n\t\t\t\t\t\tlet multiplier = mult10[((src[position] & 0x7f) << 1) | (src[position + 1] >> 7)]\n\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\treturn ((multiplier * value + (value > 0 ? 0.5 : -0.5)) >> 0) / multiplier\n\t\t\t\t\t}\n\t\t\t\t\tposition += 4\n\t\t\t\t\treturn value\n\t\t\t\t}\n\t\t\t\ttoken = dataView.getUint32(position)\n\t\t\t\tposition += 4\n\t\t\t\tbreak\n\t\t\tcase 0x1b:\n\t\t\t\tif (majorType == 7) {\n\t\t\t\t\tlet value = dataView.getFloat64(position)\n\t\t\t\t\tposition += 8\n\t\t\t\t\treturn value\n\t\t\t\t}\n\t\t\t\tif (majorType > 1) {\n\t\t\t\t\tif (dataView.getUint32(position) > 0)\n\t\t\t\t\t\tthrow new Error('JavaScript does not support arrays, maps, or strings with length over 4294967295')\n\t\t\t\t\ttoken = dataView.getUint32(position + 4)\n\t\t\t\t} else if (currentDecoder.int64AsNumber) {\n\t\t\t\t\ttoken = dataView.getUint32(position) * 0x100000000\n\t\t\t\t\ttoken += dataView.getUint32(position + 4)\n\t\t\t\t} else\n\t\t\t\t\ttoken = dataView.getBigUint64(position)\n\t\t\t\tposition += 8\n\t\t\t\tbreak\n\t\t\tcase 0x1f: \n\t\t\t\t// indefinite length\n\t\t\t\tswitch(majorType) {\n\t\t\t\t\tcase 2: // byte string\n\t\t\t\t\tcase 3: // text string\n\t\t\t\t\t\tthrow new Error('Indefinite length not supported for byte or text strings')\n\t\t\t\t\tcase 4: // array\n\t\t\t\t\t\tlet array = []\n\t\t\t\t\t\tlet value, i = 0\n\t\t\t\t\t\twhile ((value = read()) != STOP_CODE) {\n\t\t\t\t\t\t\tarray[i++] = value\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn majorType == 4 ? array : majorType == 3 ? array.join('') : Buffer.concat(array)\n\t\t\t\t\tcase 5: // map\n\t\t\t\t\t\tlet key\n\t\t\t\t\t\tif (currentDecoder.mapsAsObjects) {\n\t\t\t\t\t\t\tlet object = {}\n\t\t\t\t\t\t\tif (currentDecoder.keyMap) while((key = read()) != STOP_CODE) object[safeKey(currentDecoder.decodeKey(key))] = read()\n\t\t\t\t\t\t\telse while ((key = read()) != STOP_CODE) object[safeKey(key)] = read()\n\t\t\t\t\t\t\treturn object\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (restoreMapsAsObject) {\n\t\t\t\t\t\t\t\tcurrentDecoder.mapsAsObjects = true\n\t\t\t\t\t\t\t\trestoreMapsAsObject = false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet map = new Map()\n\t\t\t\t\t\t\tif (currentDecoder.keyMap) while((key = read()) != STOP_CODE) map.set(currentDecoder.decodeKey(key), read())\n\t\t\t\t\t\t\telse while ((key = read()) != STOP_CODE) map.set(key, read())\n\t\t\t\t\t\t\treturn map\n\t\t\t\t\t\t}\n\t\t\t\t\tcase 7:\n\t\t\t\t\t\treturn STOP_CODE\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('Invalid major type for indefinite length ' + majorType)\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Unknown token ' + token)\n\t\t}\n\t}\n\tswitch (majorType) {\n\t\tcase 0: // positive int\n\t\t\treturn token\n\t\tcase 1: // negative int\n\t\t\treturn ~token\n\t\tcase 2: // buffer\n\t\t\treturn readBin(token)\n\t\tcase 3: // string\n\t\t\tif (srcStringEnd >= position) {\n\t\t\t\treturn srcString.slice(position - srcStringStart, (position += token) - srcStringStart)\n\t\t\t}\n\t\t\tif (srcStringEnd == 0 && srcEnd < 140 && token < 32) {\n\t\t\t\t// for small blocks, avoiding the overhead of the extract call is helpful\n\t\t\t\tlet string = token < 16 ? shortStringInJS(token) : longStringInJS(token)\n\t\t\t\tif (string != null)\n\t\t\t\t\treturn string\n\t\t\t}\n\t\t\treturn readFixedString(token)\n\t\tcase 4: // array\n\t\t\tlet array = new Array(token)\n\t\t  //if (currentDecoder.keyMap) for (let i = 0; i < token; i++) array[i] = currentDecoder.decodeKey(read())\t\n\t\t\t//else \n\t\t\tfor (let i = 0; i < token; i++) array[i] = read()\n\t\t\treturn array\n\t\tcase 5: // map\n\t\t\tif (currentDecoder.mapsAsObjects) {\n\t\t\t\tlet object = {}\n\t\t\t\tif (currentDecoder.keyMap) for (let i = 0; i < token; i++) object[safeKey(currentDecoder.decodeKey(read()))] = read()\n\t\t\t\telse for (let i = 0; i < token; i++) object[safeKey(read())] = read()\n\t\t\t\treturn object\n\t\t\t} else {\n\t\t\t\tif (restoreMapsAsObject) {\n\t\t\t\t\tcurrentDecoder.mapsAsObjects = true\n\t\t\t\t\trestoreMapsAsObject = false\n\t\t\t\t}\n\t\t\t\tlet map = new Map()\n\t\t\t\tif (currentDecoder.keyMap) for (let i = 0; i < token; i++) map.set(currentDecoder.decodeKey(read()),read())\n\t\t\t\telse for (let i = 0; i < token; i++) map.set(read(), read())\n\t\t\t\treturn map\n\t\t\t}\n\t\tcase 6: // extension\n\t\t\tif (token >= BUNDLED_STRINGS_ID) {\n\t\t\t\tlet structure = currentStructures[token & 0x1fff] // check record structures first\n\t\t\t\t// At some point we may provide an option for dynamic tag assignment with a range like token >= 8 && (token < 16 || (token > 0x80 && token < 0xc0) || (token > 0x130 && token < 0x4000))\n\t\t\t\tif (structure) {\n\t\t\t\t\tif (!structure.read) structure.read = createStructureReader(structure)\n\t\t\t\t\treturn structure.read()\n\t\t\t\t}\n\t\t\t\tif (token < 0x10000) {\n\t\t\t\t\tif (token == RECORD_INLINE_ID) { // we do a special check for this so that we can keep the\n\t\t\t\t\t\t// currentExtensions as densely stored array (v8 stores arrays densely under about 3000 elements)\n\t\t\t\t\t\tlet length = readJustLength()\n\t\t\t\t\t\tlet id = read()\n\t\t\t\t\t\tlet structure = read()\n\t\t\t\t\t\trecordDefinition(id, structure)\n\t\t\t\t\t\tlet object = {}\n\t\t\t\t\t\tif (currentDecoder.keyMap) for (let i = 2; i < length; i++) {\n\t\t\t\t\t\t\tlet key = currentDecoder.decodeKey(structure[i - 2])\n\t\t\t\t\t\t\tobject[safeKey(key)] = read()\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse for (let i = 2; i < length; i++) {\n\t\t\t\t\t\t\tlet key = structure[i - 2]\n\t\t\t\t\t\t\tobject[safeKey(key)] = read()\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn object\n\t\t\t\t\t}\n\t\t\t\t\telse if (token == RECORD_DEFINITIONS_ID) {\n\t\t\t\t\t\tlet length = readJustLength()\n\t\t\t\t\t\tlet id = read()\n\t\t\t\t\t\tfor (let i = 2; i < length; i++) {\n\t\t\t\t\t\t\trecordDefinition(id++, read())\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn read()\n\t\t\t\t\t} else if (token == BUNDLED_STRINGS_ID) {\n\t\t\t\t\t\treturn readBundleExt()\n\t\t\t\t\t}\n\t\t\t\t\tif (currentDecoder.getShared) {\n\t\t\t\t\t\tloadShared()\n\t\t\t\t\t\tstructure = currentStructures[token & 0x1fff]\n\t\t\t\t\t\tif (structure) {\n\t\t\t\t\t\t\tif (!structure.read)\n\t\t\t\t\t\t\t\tstructure.read = createStructureReader(structure)\n\t\t\t\t\t\t\treturn structure.read()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet extension = currentExtensions[token]\n\t\t\tif (extension) {\n\t\t\t\tif (extension.handlesRead)\n\t\t\t\t\treturn extension(read)\n\t\t\t\telse\n\t\t\t\t\treturn extension(read())\n\t\t\t} else {\n\t\t\t\tlet input = read()\n\t\t\t\tfor (let i = 0; i < currentExtensionRanges.length; i++) {\n\t\t\t\t\tlet value = currentExtensionRanges[i](token, input)\n\t\t\t\t\tif (value !== undefined)\n\t\t\t\t\t\treturn value\n\t\t\t\t}\n\t\t\t\treturn new Tag(input, token)\n\t\t\t}\n\t\tcase 7: // fixed value\n\t\t\tswitch (token) {\n\t\t\t\tcase 0x14: return false\n\t\t\t\tcase 0x15: return true\n\t\t\t\tcase 0x16: return null\n\t\t\t\tcase 0x17: return; // undefined\n\t\t\t\tcase 0x1f:\n\t\t\t\tdefault:\n\t\t\t\t\tlet packedValue = (packedValues || getPackedValues())[token]\n\t\t\t\t\tif (packedValue !== undefined)\n\t\t\t\t\t\treturn packedValue\n\t\t\t\t\tthrow new Error('Unknown token ' + token)\n\t\t\t}\n\t\tdefault: // negative int\n\t\t\tif (isNaN(token)) {\n\t\t\t\tlet error = new Error('Unexpected end of CBOR data')\n\t\t\t\terror.incomplete = true\n\t\t\t\tthrow error\n\t\t\t}\n\t\t\tthrow new Error('Unknown CBOR token ' + token)\n\t}\n}\nconst validName = /^[a-zA-Z_$][a-zA-Z\\d_$]*$/\nfunction createStructureReader(structure) {\n\tfunction readObject() {\n\t\t// get the array size from the header\n\t\tlet length = src[position++]\n\t\t//let majorType = token >> 5\n\t\tlength = length & 0x1f\n\t\tif (length > 0x17) {\n\t\t\tswitch (length) {\n\t\t\t\tcase 0x18:\n\t\t\t\t\tlength = src[position++]\n\t\t\t\t\tbreak\n\t\t\t\tcase 0x19:\n\t\t\t\t\tlength = dataView.getUint16(position)\n\t\t\t\t\tposition += 2\n\t\t\t\t\tbreak\n\t\t\t\tcase 0x1a:\n\t\t\t\t\tlength = dataView.getUint32(position)\n\t\t\t\t\tposition += 4\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error('Expected array header, but got ' + src[position - 1])\n\t\t\t}\n\t\t}\n\t\t// This initial function is quick to instantiate, but runs slower. After several iterations pay the cost to build the faster function\n\t\tlet compiledReader = this.compiledReader // first look to see if we have the fast compiled function\n\t\twhile(compiledReader) {\n\t\t\t// we have a fast compiled object literal reader\n\t\t\tif (compiledReader.propertyCount === length)\n\t\t\t\treturn compiledReader(read) // with the right length, so we use it\n\t\t\tcompiledReader = compiledReader.next // see if there is another reader with the right length\n\t\t}\n\t\tif (this.slowReads++ >= inlineObjectReadThreshold) { // create a fast compiled reader\n\t\t\tlet array = this.length == length ? this : this.slice(0, length)\n\t\t\tcompiledReader = currentDecoder.keyMap \n\t\t\t? new Function('r', 'return {' + array.map(k => currentDecoder.decodeKey(k)).map(k => validName.test(k) ? safeKey(k) + ':r()' : ('[' + JSON.stringify(k) + ']:r()')).join(',') + '}')\n\t\t\t: new Function('r', 'return {' + array.map(key => validName.test(key) ? safeKey(key) + ':r()' : ('[' + JSON.stringify(key) + ']:r()')).join(',') + '}')\n\t\t\tif (this.compiledReader)\n\t\t\t\tcompiledReader.next = this.compiledReader // if there is an existing one, we store multiple readers as a linked list because it is usually pretty rare to have multiple readers (of different length) for the same structure\n\t\t\tcompiledReader.propertyCount = length\n\t\t\tthis.compiledReader = compiledReader\n\t\t\treturn compiledReader(read)\n\t\t}\n\t\tlet object = {}\n\t\tif (currentDecoder.keyMap) for (let i = 0; i < length; i++) object[safeKey(currentDecoder.decodeKey(this[i]))] = read()\n\t\telse for (let i = 0; i < length; i++) {\n\t\t\tobject[safeKey(this[i])] = read();\n\t\t}\n\t\treturn object\n\t}\n\tstructure.slowReads = 0\n\treturn readObject\n}\n\nfunction safeKey(key) {\n\treturn key === '__proto__' ? '__proto_' : key\n}\n\nlet readFixedString = readStringJS\nlet readString8 = readStringJS\nlet readString16 = readStringJS\nlet readString32 = readStringJS\n\nexport let isNativeAccelerationEnabled = false\nexport function setExtractor(extractStrings) {\n\tisNativeAccelerationEnabled = true\n\treadFixedString = readString(1)\n\treadString8 = readString(2)\n\treadString16 = readString(3)\n\treadString32 = readString(5)\n\tfunction readString(headerLength) {\n\t\treturn function readString(length) {\n\t\t\tlet string = strings[stringPosition++]\n\t\t\tif (string == null) {\n\t\t\t\tif (bundledStrings)\n\t\t\t\t\treturn readStringJS(length)\n\t\t\t\tlet extraction = extractStrings(position, srcEnd, length, src)\n\t\t\t\tif (typeof extraction == 'string') {\n\t\t\t\t\tstring = extraction\n\t\t\t\t\tstrings = EMPTY_ARRAY\n\t\t\t\t} else {\n\t\t\t\t\tstrings = extraction\n\t\t\t\t\tstringPosition = 1\n\t\t\t\t\tsrcStringEnd = 1 // even if a utf-8 string was decoded, must indicate we are in the midst of extracted strings and can't skip strings\n\t\t\t\t\tstring = strings[0]\n\t\t\t\t\tif (string === undefined)\n\t\t\t\t\t\tthrow new Error('Unexpected end of buffer')\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet srcStringLength = string.length\n\t\t\tif (srcStringLength <= length) {\n\t\t\t\tposition += length\n\t\t\t\treturn string\n\t\t\t}\n\t\t\tsrcString = string\n\t\t\tsrcStringStart = position\n\t\t\tsrcStringEnd = position + srcStringLength\n\t\t\tposition += length\n\t\t\treturn string.slice(0, length) // we know we just want the beginning\n\t\t}\n\t}\n}\nfunction readStringJS(length) {\n\tlet result\n\tif (length < 16) {\n\t\tif (result = shortStringInJS(length))\n\t\t\treturn result\n\t}\n\tif (length > 64 && decoder)\n\t\treturn decoder.decode(src.subarray(position, position += length))\n\tconst end = position + length\n\tconst units = []\n\tresult = ''\n\twhile (position < end) {\n\t\tconst byte1 = src[position++]\n\t\tif ((byte1 & 0x80) === 0) {\n\t\t\t// 1 byte\n\t\t\tunits.push(byte1)\n\t\t} else if ((byte1 & 0xe0) === 0xc0) {\n\t\t\t// 2 bytes\n\t\t\tconst byte2 = src[position++] & 0x3f\n\t\t\tunits.push(((byte1 & 0x1f) << 6) | byte2)\n\t\t} else if ((byte1 & 0xf0) === 0xe0) {\n\t\t\t// 3 bytes\n\t\t\tconst byte2 = src[position++] & 0x3f\n\t\t\tconst byte3 = src[position++] & 0x3f\n\t\t\tunits.push(((byte1 & 0x1f) << 12) | (byte2 << 6) | byte3)\n\t\t} else if ((byte1 & 0xf8) === 0xf0) {\n\t\t\t// 4 bytes\n\t\t\tconst byte2 = src[position++] & 0x3f\n\t\t\tconst byte3 = src[position++] & 0x3f\n\t\t\tconst byte4 = src[position++] & 0x3f\n\t\t\tlet unit = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0c) | (byte3 << 0x06) | byte4\n\t\t\tif (unit > 0xffff) {\n\t\t\t\tunit -= 0x10000\n\t\t\t\tunits.push(((unit >>> 10) & 0x3ff) | 0xd800)\n\t\t\t\tunit = 0xdc00 | (unit & 0x3ff)\n\t\t\t}\n\t\t\tunits.push(unit)\n\t\t} else {\n\t\t\tunits.push(byte1)\n\t\t}\n\n\t\tif (units.length >= 0x1000) {\n\t\t\tresult += fromCharCode.apply(String, units)\n\t\t\tunits.length = 0\n\t\t}\n\t}\n\n\tif (units.length > 0) {\n\t\tresult += fromCharCode.apply(String, units)\n\t}\n\n\treturn result\n}\nlet fromCharCode = String.fromCharCode\nfunction longStringInJS(length) {\n\tlet start = position\n\tlet bytes = new Array(length)\n\tfor (let i = 0; i < length; i++) {\n\t\tconst byte = src[position++];\n\t\tif ((byte & 0x80) > 0) {\n\t\t\tposition = start\n    \t\t\treturn\n    \t\t}\n    \t\tbytes[i] = byte\n    \t}\n    \treturn fromCharCode.apply(String, bytes)\n}\nfunction shortStringInJS(length) {\n\tif (length < 4) {\n\t\tif (length < 2) {\n\t\t\tif (length === 0)\n\t\t\t\treturn ''\n\t\t\telse {\n\t\t\t\tlet a = src[position++]\n\t\t\t\tif ((a & 0x80) > 1) {\n\t\t\t\t\tposition -= 1\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\treturn fromCharCode(a)\n\t\t\t}\n\t\t} else {\n\t\t\tlet a = src[position++]\n\t\t\tlet b = src[position++]\n\t\t\tif ((a & 0x80) > 0 || (b & 0x80) > 0) {\n\t\t\t\tposition -= 2\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (length < 3)\n\t\t\t\treturn fromCharCode(a, b)\n\t\t\tlet c = src[position++]\n\t\t\tif ((c & 0x80) > 0) {\n\t\t\t\tposition -= 3\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn fromCharCode(a, b, c)\n\t\t}\n\t} else {\n\t\tlet a = src[position++]\n\t\tlet b = src[position++]\n\t\tlet c = src[position++]\n\t\tlet d = src[position++]\n\t\tif ((a & 0x80) > 0 || (b & 0x80) > 0 || (c & 0x80) > 0 || (d & 0x80) > 0) {\n\t\t\tposition -= 4\n\t\t\treturn\n\t\t}\n\t\tif (length < 6) {\n\t\t\tif (length === 4)\n\t\t\t\treturn fromCharCode(a, b, c, d)\n\t\t\telse {\n\t\t\t\tlet e = src[position++]\n\t\t\t\tif ((e & 0x80) > 0) {\n\t\t\t\t\tposition -= 5\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\treturn fromCharCode(a, b, c, d, e)\n\t\t\t}\n\t\t} else if (length < 8) {\n\t\t\tlet e = src[position++]\n\t\t\tlet f = src[position++]\n\t\t\tif ((e & 0x80) > 0 || (f & 0x80) > 0) {\n\t\t\t\tposition -= 6\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (length < 7)\n\t\t\t\treturn fromCharCode(a, b, c, d, e, f)\n\t\t\tlet g = src[position++]\n\t\t\tif ((g & 0x80) > 0) {\n\t\t\t\tposition -= 7\n\t\t\t\treturn\n\t\t\t}\n\t\t\treturn fromCharCode(a, b, c, d, e, f, g)\n\t\t} else {\n\t\t\tlet e = src[position++]\n\t\t\tlet f = src[position++]\n\t\t\tlet g = src[position++]\n\t\t\tlet h = src[position++]\n\t\t\tif ((e & 0x80) > 0 || (f & 0x80) > 0 || (g & 0x80) > 0 || (h & 0x80) > 0) {\n\t\t\t\tposition -= 8\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (length < 10) {\n\t\t\t\tif (length === 8)\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h)\n\t\t\t\telse {\n\t\t\t\t\tlet i = src[position++]\n\t\t\t\t\tif ((i & 0x80) > 0) {\n\t\t\t\t\t\tposition -= 9\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i)\n\t\t\t\t}\n\t\t\t} else if (length < 12) {\n\t\t\t\tlet i = src[position++]\n\t\t\t\tlet j = src[position++]\n\t\t\t\tif ((i & 0x80) > 0 || (j & 0x80) > 0) {\n\t\t\t\t\tposition -= 10\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (length < 11)\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j)\n\t\t\t\tlet k = src[position++]\n\t\t\t\tif ((k & 0x80) > 0) {\n\t\t\t\t\tposition -= 11\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k)\n\t\t\t} else {\n\t\t\t\tlet i = src[position++]\n\t\t\t\tlet j = src[position++]\n\t\t\t\tlet k = src[position++]\n\t\t\t\tlet l = src[position++]\n\t\t\t\tif ((i & 0x80) > 0 || (j & 0x80) > 0 || (k & 0x80) > 0 || (l & 0x80) > 0) {\n\t\t\t\t\tposition -= 12\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (length < 14) {\n\t\t\t\t\tif (length === 12)\n\t\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l)\n\t\t\t\t\telse {\n\t\t\t\t\t\tlet m = src[position++]\n\t\t\t\t\t\tif ((m & 0x80) > 0) {\n\t\t\t\t\t\t\tposition -= 13\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l, m)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet m = src[position++]\n\t\t\t\t\tlet n = src[position++]\n\t\t\t\t\tif ((m & 0x80) > 0 || (n & 0x80) > 0) {\n\t\t\t\t\t\tposition -= 14\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tif (length < 15)\n\t\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l, m, n)\n\t\t\t\t\tlet o = src[position++]\n\t\t\t\t\tif ((o & 0x80) > 0) {\n\t\t\t\t\t\tposition -= 15\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\treturn fromCharCode(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction readBin(length) {\n\treturn currentDecoder.copyBuffers ?\n\t\t// specifically use the copying slice (not the node one)\n\t\tUint8Array.prototype.slice.call(src, position, position += length) :\n\t\tsrc.subarray(position, position += length)\n}\nfunction readExt(length) {\n\tlet type = src[position++]\n\tif (currentExtensions[type]) {\n\t\treturn currentExtensions[type](src.subarray(position, position += length))\n\t}\n\telse\n\t\tthrow new Error('Unknown extension type ' + type)\n}\nlet f32Array = new Float32Array(1)\nlet u8Array = new Uint8Array(f32Array.buffer, 0, 4)\nfunction getFloat16() {\n\tlet byte0 = src[position++]\n\tlet byte1 = src[position++]\n\tlet exponent = (byte0 & 0x7f) >> 2;\n\tif (exponent === 0x1f) { // specials\n\t\tif (byte1 || (byte0 & 3))\n\t\t\treturn NaN;\n\t\treturn (byte0 & 0x80) ? -Infinity : Infinity;\n\t}\n\tif (exponent === 0) { // sub-normals\n\t\t// significand with 10 fractional bits and divided by 2^14\n\t\tlet abs = (((byte0 & 3) << 8) | byte1) / (1 << 24)\n\t\treturn (byte0 & 0x80) ? -abs : abs\n\t}\n\n\tu8Array[3] = (byte0 & 0x80) | // sign bit\n\t\t((exponent >> 1) + 56) // 4 of 5 of the exponent bits, re-offset-ed\n\tu8Array[2] = ((byte0 & 7) << 5) | // last exponent bit and first two mantissa bits\n\t\t(byte1 >> 3) // next 5 bits of mantissa\n\tu8Array[1] = byte1 << 5; // last three bits of mantissa\n\tu8Array[0] = 0;\n\treturn f32Array[0];\n}\n\nlet keyCache = new Array(4096)\nfunction readKey() {\n\tlet length = src[position++]\n\tif (length >= 0x60 && length < 0x78) {\n\t\t// fixstr, potentially use key cache\n\t\tlength = length - 0x60\n\t\tif (srcStringEnd >= position) // if it has been extracted, must use it (and faster anyway)\n\t\t\treturn srcString.slice(position - srcStringStart, (position += length) - srcStringStart)\n\t\telse if (!(srcStringEnd == 0 && srcEnd < 180))\n\t\t\treturn readFixedString(length)\n\t} else { // not cacheable, go back and do a standard read\n\t\tposition--\n\t\treturn read()\n\t}\n\tlet key = ((length << 5) ^ (length > 1 ? dataView.getUint16(position) : length > 0 ? src[position] : 0)) & 0xfff\n\tlet entry = keyCache[key]\n\tlet checkPosition = position\n\tlet end = position + length - 3\n\tlet chunk\n\tlet i = 0\n\tif (entry && entry.bytes == length) {\n\t\twhile (checkPosition < end) {\n\t\t\tchunk = dataView.getUint32(checkPosition)\n\t\t\tif (chunk != entry[i++]) {\n\t\t\t\tcheckPosition = 0x70000000\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tcheckPosition += 4\n\t\t}\n\t\tend += 3\n\t\twhile (checkPosition < end) {\n\t\t\tchunk = src[checkPosition++]\n\t\t\tif (chunk != entry[i++]) {\n\t\t\t\tcheckPosition = 0x70000000\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif (checkPosition === end) {\n\t\t\tposition = checkPosition\n\t\t\treturn entry.string\n\t\t}\n\t\tend -= 3\n\t\tcheckPosition = position\n\t}\n\tentry = []\n\tkeyCache[key] = entry\n\tentry.bytes = length\n\twhile (checkPosition < end) {\n\t\tchunk = dataView.getUint32(checkPosition)\n\t\tentry.push(chunk)\n\t\tcheckPosition += 4\n\t}\n\tend += 3\n\twhile (checkPosition < end) {\n\t\tchunk = src[checkPosition++]\n\t\tentry.push(chunk)\n\t}\n\t// for small blocks, avoiding the overhead of the extract call is helpful\n\tlet string = length < 16 ? shortStringInJS(length) : longStringInJS(length)\n\tif (string != null)\n\t\treturn entry.string = string\n\treturn entry.string = readFixedString(length)\n}\n\nexport class Tag {\n\tconstructor(value, tag) {\n\t\tthis.value = value\n\t\tthis.tag = tag\n\t}\n}\n\ncurrentExtensions[0] = (dateString) => {\n\t// string date extension\n\treturn new Date(dateString)\n}\n\ncurrentExtensions[1] = (epochSec) => {\n\t// numeric date extension\n\treturn new Date(Math.round(epochSec * 1000))\n}\n\ncurrentExtensions[2] = (buffer) => {\n\t// bigint extension\n\tlet value = BigInt(0)\n\tfor (let i = 0, l = buffer.byteLength; i < l; i++) {\n\t\tvalue = BigInt(buffer[i]) + value << BigInt(8)\n\t}\n\treturn value\n}\n\ncurrentExtensions[3] = (buffer) => {\n\t// negative bigint extension\n\treturn BigInt(-1) - currentExtensions[2](buffer)\n}\ncurrentExtensions[4] = (fraction) => {\n\t// best to reparse to maintain accuracy\n\treturn +(fraction[1] + 'e' + fraction[0])\n}\n\ncurrentExtensions[5] = (fraction) => {\n\t// probably not sufficiently accurate\n\treturn fraction[1] * Math.exp(fraction[0] * Math.log(2))\n}\n\n// the registration of the record definition extension\nconst recordDefinition = (id, structure) => {\n\tid = id - 0xe000\n\tlet existingStructure = currentStructures[id]\n\tif (existingStructure && existingStructure.isShared) {\n\t\t(currentStructures.restoreStructures || (currentStructures.restoreStructures = []))[id] = existingStructure\n\t}\n\tcurrentStructures[id] = structure\n\n\tstructure.read = createStructureReader(structure)\n}\ncurrentExtensions[LEGACY_RECORD_INLINE_ID] = (data) => {\n\tlet length = data.length\n\tlet structure = data[1]\n\trecordDefinition(data[0], structure)\n\tlet object = {}\n\tfor (let i = 2; i < length; i++) {\n\t\tlet key = structure[i - 2]\n\t\tobject[safeKey(key)] = data[i]\n\t}\n\treturn object\n}\ncurrentExtensions[14] = (value) => {\n\tif (bundledStrings)\n\t\treturn bundledStrings[0].slice(bundledStrings.position0, bundledStrings.position0 += value)\n\treturn new Tag(value, 14)\n}\ncurrentExtensions[15] = (value) => {\n\tif (bundledStrings)\n\t\treturn bundledStrings[1].slice(bundledStrings.position1, bundledStrings.position1 += value)\n\treturn new Tag(value, 15)\n}\nlet glbl = { Error, RegExp }\ncurrentExtensions[27] = (data) => { // http://cbor.schmorp.de/generic-object\n\treturn (glbl[data[0]] || Error)(data[1], data[2])\n}\nconst packedTable = (read) => {\n\tif (src[position++] != 0x84)\n\t\tthrow new Error('Packed values structure must be followed by a 4 element array')\n\tlet newPackedValues = read() // packed values\n\tpackedValues = packedValues ? newPackedValues.concat(packedValues.slice(newPackedValues.length)) : newPackedValues\n\tpackedValues.prefixes = read()\n\tpackedValues.suffixes = read()\n\treturn read() // read the rump\n}\npackedTable.handlesRead = true\ncurrentExtensions[51] = packedTable\n\ncurrentExtensions[PACKED_REFERENCE_TAG_ID] = (data) => { // packed reference\n\tif (!packedValues) {\n\t\tif (currentDecoder.getShared)\n\t\t\tloadShared()\n\t\telse\n\t\t\treturn new Tag(data, PACKED_REFERENCE_TAG_ID)\n\t}\n\tif (typeof data == 'number')\n\t\treturn packedValues[16 + (data >= 0 ? 2 * data : (-2 * data - 1))]\n\tthrow new Error('No support for non-integer packed references yet')\n}\n\n// The following code is an incomplete implementation of http://cbor.schmorp.de/stringref\n// the real thing would need to implemennt more logic to populate the stringRefs table and\n// maintain a stack of stringRef \"namespaces\".\n//\n// currentExtensions[25] = (id) => {\n// \treturn stringRefs[id]\n// }\n// currentExtensions[256] = (read) => {\n// \tstringRefs = []\n// \ttry {\n// \t\treturn read()\n// \t} finally {\n// \t\tstringRefs = null\n// \t}\n// }\n// currentExtensions[256].handlesRead = true\n\ncurrentExtensions[28] = (read) => { \n\t// shareable http://cbor.schmorp.de/value-sharing (for structured clones)\n\tif (!referenceMap) {\n\t\treferenceMap = new Map()\n\t\treferenceMap.id = 0\n\t}\n\tlet id = referenceMap.id++\n\tlet token = src[position]\n\tlet target\n\t// TODO: handle Maps, Sets, and other types that can cycle; this is complicated, because you potentially need to read\n\t// ahead past references to record structure definitions\n\tif ((token >> 5) == 4)\n\t\ttarget = []\n\telse\n\t\ttarget = {}\n\n\tlet refEntry = { target } // a placeholder object\n\treferenceMap.set(id, refEntry)\n\tlet targetProperties = read() // read the next value as the target object to id\n\tif (refEntry.used) // there is a cycle, so we have to assign properties to original target\n\t\treturn Object.assign(target, targetProperties)\n\trefEntry.target = targetProperties // the placeholder wasn't used, replace with the deserialized one\n\treturn targetProperties // no cycle, can just use the returned read object\n}\ncurrentExtensions[28].handlesRead = true\n\ncurrentExtensions[29] = (id) => {\n\t// sharedref http://cbor.schmorp.de/value-sharing (for structured clones)\n\tlet refEntry = referenceMap.get(id)\n\trefEntry.used = true\n\treturn refEntry.target\n}\n\ncurrentExtensions[258] = (array) => new Set(array); // https://github.com/input-output-hk/cbor-sets-spec/blob/master/CBOR_SETS.md\n(currentExtensions[259] = (read) => {\n\t// https://github.com/shanewholloway/js-cbor-codec/blob/master/docs/CBOR-259-spec\n\t// for decoding as a standard Map\n\tif (currentDecoder.mapsAsObjects) {\n\t\tcurrentDecoder.mapsAsObjects = false\n\t\trestoreMapsAsObject = true\n\t}\n\treturn read()\n}).handlesRead = true\nfunction combine(a, b) {\n\tif (typeof a === 'string')\n\t\treturn a + b\n\tif (a instanceof Array)\n\t\treturn a.concat(b)\n\treturn Object.assign({}, a, b)\n}\nfunction getPackedValues() {\n\tif (!packedValues) {\n\t\tif (currentDecoder.getShared)\n\t\t\tloadShared()\n\t\telse\n\t\t\tthrow new Error('No packed values available')\n\t}\n\treturn packedValues\n}\nconst SHARED_DATA_TAG_ID = 0x53687264 // ascii 'Shrd'\ncurrentExtensionRanges.push((tag, input) => {\n\tif (tag >= 225 && tag <= 255)\n\t\treturn combine(getPackedValues().prefixes[tag - 224], input)\n\tif (tag >= 28704 && tag <= 32767)\n\t\treturn combine(getPackedValues().prefixes[tag - 28672], input)\n\tif (tag >= 1879052288 && tag <= 2147483647)\n\t\treturn combine(getPackedValues().prefixes[tag - 1879048192], input)\n\tif (tag >= 216 && tag <= 223)\n\t\treturn combine(input, getPackedValues().suffixes[tag - 216])\n\tif (tag >= 27647 && tag <= 28671)\n\t\treturn combine(input, getPackedValues().suffixes[tag - 27639])\n\tif (tag >= 1811940352 && tag <= 1879048191)\n\t\treturn combine(input, getPackedValues().suffixes[tag - 1811939328])\n\tif (tag == SHARED_DATA_TAG_ID) {// we do a special check for this so that we can keep the currentExtensions as densely stored array (v8 stores arrays densely under about 3000 elements)\n\t\treturn {\n\t\t\tpackedValues: packedValues,\n\t\t\tstructures: currentStructures.slice(0),\n\t\t\tversion: input,\n\t\t}\n\t}\n\tif (tag == 55799) // self-descriptive CBOR tag, just return input value\n\t\treturn input\n})\n\nconst isLittleEndianMachine = new Uint8Array(new Uint16Array([1]).buffer)[0] == 1\nexport const typedArrays = [Uint8Array, Uint8ClampedArray, Uint16Array, Uint32Array,\n\ttypeof BigUint64Array == 'undefined' ? { name:'BigUint64Array' } : BigUint64Array, Int8Array, Int16Array, Int32Array,\n\ttypeof BigInt64Array == 'undefined' ? { name:'BigInt64Array' } : BigInt64Array, Float32Array, Float64Array]\nconst typedArrayTags = [64, 68, 69, 70, 71, 72, 77, 78, 79, 85, 86]\nfor (let i = 0; i < typedArrays.length; i++) {\n\tregisterTypedArray(typedArrays[i], typedArrayTags[i])\n}\nfunction registerTypedArray(TypedArray, tag) {\n\tlet dvMethod = 'get' + TypedArray.name.slice(0, -5)\n\tlet bytesPerElement;\n\tif (typeof TypedArray === 'function')\n\t\tbytesPerElement = TypedArray.BYTES_PER_ELEMENT;\n\telse\n\t\tTypedArray = null;\n\tfor (let littleEndian = 0; littleEndian < 2; littleEndian++) {\n\t\tif (!littleEndian && bytesPerElement == 1)\n\t\t\tcontinue\n\t\tlet sizeShift = bytesPerElement == 2 ? 1 : bytesPerElement == 4 ? 2 : 3\n\t\tcurrentExtensions[littleEndian ? tag : (tag - 4)] = (bytesPerElement == 1 || littleEndian == isLittleEndianMachine) ? (buffer) => {\n\t\t\tif (!TypedArray)\n\t\t\t\tthrow new Error('Could not find typed array for code ' + tag)\n\t\t\t// we have to always slice/copy here to get a new ArrayBuffer that is word/byte aligned\n\t\t\treturn new TypedArray(Uint8Array.prototype.slice.call(buffer, 0).buffer)\n\t\t} : buffer => {\n\t\t\tif (!TypedArray)\n\t\t\t\tthrow new Error('Could not find typed array for code ' + tag)\n\t\t\tlet dv = new DataView(buffer.buffer, buffer.byteOffset, buffer.byteLength)\n\t\t\tlet elements = buffer.length >> sizeShift\n\t\t\tlet ta = new TypedArray(elements)\n\t\t\tlet method = dv[dvMethod]\n\t\t\tfor (let i = 0; i < elements; i++) {\n\t\t\t\tta[i] = method.call(dv, i << sizeShift, littleEndian)\n\t\t\t}\n\t\t\treturn ta\n\t\t}\n\t}\n}\n\nfunction readBundleExt() {\n\tlet length = readJustLength()\n\tlet bundlePosition = position + read()\n\tfor (let i = 2; i < length; i++) {\n\t\t// skip past bundles that were already read\n\t\tlet bundleLength = readJustLength() // this will increment position, so must add to position afterwards\n\t\tposition += bundleLength\n\t}\n\tlet dataPosition = position\n\tposition = bundlePosition\n\tbundledStrings = [readStringJS(readJustLength()), readStringJS(readJustLength())]\n\tbundledStrings.position0 = 0\n\tbundledStrings.position1 = 0\n\tbundledStrings.postBundlePosition = position\n\tposition = dataPosition\n\treturn read()\n}\n\nfunction readJustLength() {\n\tlet token = src[position++] & 0x1f\n\tif (token > 0x17) {\n\t\tswitch (token) {\n\t\t\tcase 0x18:\n\t\t\t\ttoken = src[position++]\n\t\t\t\tbreak\n\t\t\tcase 0x19:\n\t\t\t\ttoken = dataView.getUint16(position)\n\t\t\t\tposition += 2\n\t\t\t\tbreak\n\t\t\tcase 0x1a:\n\t\t\t\ttoken = dataView.getUint32(position)\n\t\t\t\tposition += 4\n\t\t\t\tbreak\n\t\t}\n\t}\n\treturn token\n}\n\nfunction loadShared() {\n\tif (currentDecoder.getShared) {\n\t\tlet sharedData = saveState(() => {\n\t\t\t// save the state in case getShared modifies our buffer\n\t\t\tsrc = null\n\t\t\treturn currentDecoder.getShared()\n\t\t}) || {}\n\t\tlet updatedStructures = sharedData.structures || []\n\t\tcurrentDecoder.sharedVersion = sharedData.version\n\t\tpackedValues = currentDecoder.sharedValues = sharedData.packedValues\n\t\tif (currentStructures === true)\n\t\t\tcurrentDecoder.structures = currentStructures = updatedStructures\n\t\telse\n\t\t\tcurrentStructures.splice.apply(currentStructures, [0, updatedStructures.length].concat(updatedStructures))\n\t}\n}\n\nfunction saveState(callback) {\n\tlet savedSrcEnd = srcEnd\n\tlet savedPosition = position\n\tlet savedStringPosition = stringPosition\n\tlet savedSrcStringStart = srcStringStart\n\tlet savedSrcStringEnd = srcStringEnd\n\tlet savedSrcString = srcString\n\tlet savedStrings = strings\n\tlet savedReferenceMap = referenceMap\n\tlet savedBundledStrings = bundledStrings\n\n\t// TODO: We may need to revisit this if we do more external calls to user code (since it could be slow)\n\tlet savedSrc = new Uint8Array(src.slice(0, srcEnd)) // we copy the data in case it changes while external data is processed\n\tlet savedStructures = currentStructures\n\tlet savedDecoder = currentDecoder\n\tlet savedSequentialMode = sequentialMode\n\tlet value = callback()\n\tsrcEnd = savedSrcEnd\n\tposition = savedPosition\n\tstringPosition = savedStringPosition\n\tsrcStringStart = savedSrcStringStart\n\tsrcStringEnd = savedSrcStringEnd\n\tsrcString = savedSrcString\n\tstrings = savedStrings\n\treferenceMap = savedReferenceMap\n\tbundledStrings = savedBundledStrings\n\tsrc = savedSrc\n\tsequentialMode = savedSequentialMode\n\tcurrentStructures = savedStructures\n\tcurrentDecoder = savedDecoder\n\tdataView = new DataView(src.buffer, src.byteOffset, src.byteLength)\n\treturn value\n}\nexport function clearSource() {\n\tsrc = null\n\treferenceMap = null\n\tcurrentStructures = null\n}\n\nexport function addExtension(extension) {\n\tcurrentExtensions[extension.tag] = extension.decode\n}\n\nexport const mult10 = new Array(147) // this is a table matching binary exponents to the multiplier to determine significant digit rounding\nfor (let i = 0; i < 256; i++) {\n\tmult10[i] = +('1e' + Math.floor(45.15 - i * 0.30103))\n}\nlet defaultDecoder = new Decoder({ useRecords: false })\nexport const decode = defaultDecoder.decode\nexport const decodeMultiple = defaultDecoder.decodeMultiple\nexport const FLOAT32_OPTIONS = {\n\tNEVER: 0,\n\tALWAYS: 1,\n\tDECIMAL_ROUND: 3,\n\tDECIMAL_FIT: 4\n}\nexport function roundFloat32(float32Number) {\n\tf32Array[0] = float32Number\n\tlet multiplier = mult10[((u8Array[3] & 0x7f) << 1) | (u8Array[2] >> 7)]\n\treturn ((multiplier * float32Number + (float32Number > 0 ? 0.5 : -0.5)) >> 0) / multiplier\n}\n", "import { Decoder, mult10, Tag, typedArrays, addExtension as decodeAddExtension } from './decode.js'\nlet textEncoder\ntry {\n\ttextEncoder = new TextEncoder()\n} catch (error) {}\nlet extensions, extensionClasses\nconst Buffer = typeof globalThis === 'object' && globalThis.Buffer;\nconst hasNodeBuffer = typeof Buffer !== 'undefined'\nconst ByteArrayAllocate = hasNodeBuffer ? Buffer.allocUnsafeSlow : Uint8Array\nconst ByteArray = hasNodeBuffer ? Buffer : Uint8Array\nconst MAX_STRUCTURES = 0x100\nconst MAX_BUFFER_SIZE = hasNodeBuffer ? 0x100000000 : 0x7fd00000\nlet serializationId = 1\nlet throwOnIterable\nlet target\nlet targetView\nlet position = 0\nlet safeEnd\nlet bundledStrings = null\nconst MAX_BUNDLE_SIZE = 0xf000\nconst hasNonLatin = /[\\u0080-\\uFFFF]/\nconst RECORD_SYMBOL = Symbol('record-id')\nexport class Encoder extends Decoder {\n\tconstructor(options) {\n\t\tsuper(options)\n\t\tthis.offset = 0\n\t\tlet typeBuffer\n\t\tlet start\n\t\tlet sharedStructures\n\t\tlet hasSharedUpdate\n\t\tlet structures\n\t\tlet referenceMap\n\t\toptions = options || {}\n\t\tlet encodeUtf8 = ByteArray.prototype.utf8Write ? function(string, position, maxBytes) {\n\t\t\treturn target.utf8Write(string, position, maxBytes)\n\t\t} : (textEncoder && textEncoder.encodeInto) ?\n\t\t\tfunction(string, position) {\n\t\t\t\treturn textEncoder.encodeInto(string, target.subarray(position)).written\n\t\t\t} : false\n\n\t\tlet encoder = this\n\t\tlet hasSharedStructures = options.structures || options.saveStructures\n\t\tlet maxSharedStructures = options.maxSharedStructures\n\t\tif (maxSharedStructures == null)\n\t\t\tmaxSharedStructures = hasSharedStructures ? 128 : 0\n\t\tif (maxSharedStructures > 8190)\n\t\t\tthrow new Error('Maximum maxSharedStructure is 8190')\n\t\tlet isSequential = options.sequential\n\t\tif (isSequential) {\n\t\t\tmaxSharedStructures = 0\n\t\t}\n\t\tif (!this.structures)\n\t\t\tthis.structures = []\n\t\tif (this.saveStructures)\n\t\t\tthis.saveShared = this.saveStructures\n\t\tlet samplingPackedValues, packedObjectMap, sharedValues = options.sharedValues\n\t\tlet sharedPackedObjectMap\n\t\tif (sharedValues) {\n\t\t\tsharedPackedObjectMap = Object.create(null)\n\t\t\tfor (let i = 0, l = sharedValues.length; i < l; i++) {\n\t\t\t\tsharedPackedObjectMap[sharedValues[i]] = i\n\t\t\t}\n\t\t}\n\t\tlet recordIdsToRemove = []\n\t\tlet transitionsCount = 0\n\t\tlet serializationsSinceTransitionRebuild = 0\n\t\t\n\t\tthis.mapEncode = function(value, encodeOptions) {\n\t\t\t// Experimental support for premapping keys using _keyMap instad of keyMap - not optiimised yet)\n\t\t\tif (this._keyMap && !this._mapped) {\n\t\t\t\t//console.log('encoding ', value)\n\t\t\t\tswitch (value.constructor.name) {\n\t\t\t\t\tcase 'Array': \n\t\t\t\t\t\tvalue = value.map(r => this.encodeKeys(r))\n\t\t\t\t\t\tbreak\n\t\t\t\t\t//case 'Map': \n\t\t\t\t\t//\tvalue = this.encodeKeys(value)\n\t\t\t\t\t//\tbreak\n\t\t\t\t}\n\t\t\t\t//this._mapped = true\n\t\t\t}\n\t\t\treturn this.encode(value, encodeOptions)\n\t\t}\n\t\t\n\t\tthis.encode = function(value, encodeOptions)\t{\n\t\t\tif (!target) {\n\t\t\t\ttarget = new ByteArrayAllocate(8192)\n\t\t\t\ttargetView = new DataView(target.buffer, 0, 8192)\n\t\t\t\tposition = 0\n\t\t\t}\n\t\t\tsafeEnd = target.length - 10\n\t\t\tif (safeEnd - position < 0x800) {\n\t\t\t\t// don't start too close to the end, \n\t\t\t\ttarget = new ByteArrayAllocate(target.length)\n\t\t\t\ttargetView = new DataView(target.buffer, 0, target.length)\n\t\t\t\tsafeEnd = target.length - 10\n\t\t\t\tposition = 0\n\t\t\t} else if (encodeOptions === REUSE_BUFFER_MODE)\n\t\t\t\tposition = (position + 7) & 0x7ffffff8 // Word align to make any future copying of this buffer faster\n\t\t\tstart = position\n\t\t\tif (encoder.useSelfDescribedHeader) {\n\t\t\t\ttargetView.setUint32(position, 0xd9d9f700) // tag two byte, then self-descriptive tag\n\t\t\t\tposition += 3\n\t\t\t}\n\t\t\treferenceMap = encoder.structuredClone ? new Map() : null\n\t\t\tif (encoder.bundleStrings && typeof value !== 'string') {\n\t\t\t\tbundledStrings = []\n\t\t\t\tbundledStrings.size = Infinity // force a new bundle start on first string\n\t\t\t} else\n\t\t\t\tbundledStrings = null\n\n\t\t\tsharedStructures = encoder.structures\n\t\t\tif (sharedStructures) {\n\t\t\t\tif (sharedStructures.uninitialized) {\n\t\t\t\t\tlet sharedData = encoder.getShared() || {}\n\t\t\t\t\tencoder.structures = sharedStructures = sharedData.structures || []\n\t\t\t\t\tencoder.sharedVersion = sharedData.version\n\t\t\t\t\tlet sharedValues = encoder.sharedValues = sharedData.packedValues\n\t\t\t\t\tif (sharedValues) {\n\t\t\t\t\t\tsharedPackedObjectMap = {}\n\t\t\t\t\t\tfor (let i = 0, l = sharedValues.length; i < l; i++)\n\t\t\t\t\t\t\tsharedPackedObjectMap[sharedValues[i]] = i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet sharedStructuresLength = sharedStructures.length\n\t\t\t\tif (sharedStructuresLength > maxSharedStructures && !isSequential)\n\t\t\t\t\tsharedStructuresLength = maxSharedStructures\n\t\t\t\tif (!sharedStructures.transitions) {\n\t\t\t\t\t// rebuild our structure transitions\n\t\t\t\t\tsharedStructures.transitions = Object.create(null)\n\t\t\t\t\tfor (let i = 0; i < sharedStructuresLength; i++) {\n\t\t\t\t\t\tlet keys = sharedStructures[i]\n\t\t\t\t\t\t//console.log('shared struct keys:', keys)\n\t\t\t\t\t\tif (!keys)\n\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\tlet nextTransition, transition = sharedStructures.transitions\n\t\t\t\t\t\tfor (let j = 0, l = keys.length; j < l; j++) {\n\t\t\t\t\t\t\tif (transition[RECORD_SYMBOL] === undefined)\n\t\t\t\t\t\t\t\ttransition[RECORD_SYMBOL] = i\n\t\t\t\t\t\t\tlet key = keys[j]\n\t\t\t\t\t\t\tnextTransition = transition[key]\n\t\t\t\t\t\t\tif (!nextTransition) {\n\t\t\t\t\t\t\t\tnextTransition = transition[key] = Object.create(null)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttransition = nextTransition\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttransition[RECORD_SYMBOL] = i | 0x100000\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!isSequential)\n\t\t\t\t\tsharedStructures.nextId = sharedStructuresLength\n\t\t\t}\n\t\t\tif (hasSharedUpdate)\n\t\t\t\thasSharedUpdate = false\n\t\t\tstructures = sharedStructures || []\n\t\t\tpackedObjectMap = sharedPackedObjectMap\n\t\t\tif (options.pack) {\n\t\t\t\tlet packedValues = new Map()\n\t\t\t\tpackedValues.values = []\n\t\t\t\tpackedValues.encoder = encoder\n\t\t\t\tpackedValues.maxValues = options.maxPrivatePackedValues || (sharedPackedObjectMap ? 16 : Infinity)\n\t\t\t\tpackedValues.objectMap = sharedPackedObjectMap || false\n\t\t\t\tpackedValues.samplingPackedValues = samplingPackedValues\n\t\t\t\tfindRepetitiveStrings(value, packedValues)\n\t\t\t\tif (packedValues.values.length > 0) {\n\t\t\t\t\ttarget[position++] = 0xd8 // one-byte tag\n\t\t\t\t\ttarget[position++] = 51 // tag 51 for packed shared structures https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\t\t\twriteArrayHeader(4)\n\t\t\t\t\tlet valuesArray = packedValues.values\n\t\t\t\t\tencode(valuesArray)\n\t\t\t\t\twriteArrayHeader(0) // prefixes\n\t\t\t\t\twriteArrayHeader(0) // suffixes\n\t\t\t\t\tpackedObjectMap = Object.create(sharedPackedObjectMap || null)\n\t\t\t\t\tfor (let i = 0, l = valuesArray.length; i < l; i++) {\n\t\t\t\t\t\tpackedObjectMap[valuesArray[i]] = i\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrowOnIterable = encodeOptions & THROW_ON_ITERABLE;\n\t\t\ttry {\n\t\t\t\tif (throwOnIterable)\n\t\t\t\t\treturn;\n\t\t\t\tencode(value)\n\t\t\t\tif (bundledStrings) {\n\t\t\t\t\twriteBundles(start, encode)\n\t\t\t\t}\n\t\t\t\tencoder.offset = position // update the offset so next serialization doesn't write over our buffer, but can continue writing to same buffer sequentially\n\t\t\t\tif (referenceMap && referenceMap.idsToInsert) {\n\t\t\t\t\tposition += referenceMap.idsToInsert.length * 2\n\t\t\t\t\tif (position > safeEnd)\n\t\t\t\t\t\tmakeRoom(position)\n\t\t\t\t\tencoder.offset = position\n\t\t\t\t\tlet serialized = insertIds(target.subarray(start, position), referenceMap.idsToInsert)\n\t\t\t\t\treferenceMap = null\n\t\t\t\t\treturn serialized\n\t\t\t\t}\n\t\t\t\tif (encodeOptions & REUSE_BUFFER_MODE) {\n\t\t\t\t\ttarget.start = start\n\t\t\t\t\ttarget.end = position\n\t\t\t\t\treturn target\n\t\t\t\t}\n\t\t\t\treturn target.subarray(start, position) // position can change if we call encode again in saveShared, so we get the buffer now\n\t\t\t} finally {\n\t\t\t\tif (sharedStructures) {\n\t\t\t\t\tif (serializationsSinceTransitionRebuild < 10)\n\t\t\t\t\t\tserializationsSinceTransitionRebuild++\n\t\t\t\t\tif (sharedStructures.length > maxSharedStructures)\n\t\t\t\t\t\tsharedStructures.length = maxSharedStructures\n\t\t\t\t\tif (transitionsCount > 10000) {\n\t\t\t\t\t\t// force a rebuild occasionally after a lot of transitions so it can get cleaned up\n\t\t\t\t\t\tsharedStructures.transitions = null\n\t\t\t\t\t\tserializationsSinceTransitionRebuild = 0\n\t\t\t\t\t\ttransitionsCount = 0\n\t\t\t\t\t\tif (recordIdsToRemove.length > 0)\n\t\t\t\t\t\t\trecordIdsToRemove = []\n\t\t\t\t\t} else if (recordIdsToRemove.length > 0 && !isSequential) {\n\t\t\t\t\t\tfor (let i = 0, l = recordIdsToRemove.length; i < l; i++) {\n\t\t\t\t\t\t\trecordIdsToRemove[i][RECORD_SYMBOL] = undefined\n\t\t\t\t\t\t}\n\t\t\t\t\t\trecordIdsToRemove = []\n\t\t\t\t\t\t//sharedStructures.nextId = maxSharedStructures\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (hasSharedUpdate && encoder.saveShared) {\n\t\t\t\t\tif (encoder.structures.length > maxSharedStructures) {\n\t\t\t\t\t\tencoder.structures = encoder.structures.slice(0, maxSharedStructures)\n\t\t\t\t\t}\n\t\t\t\t\t// we can't rely on start/end with REUSE_BUFFER_MODE since they will (probably) change when we save\n\t\t\t\t\tlet returnBuffer = target.subarray(start, position)\n\t\t\t\t\tif (encoder.updateSharedData() === false)\n\t\t\t\t\t\treturn encoder.encode(value) // re-encode if it fails\n\t\t\t\t\treturn returnBuffer\n\t\t\t\t}\n\t\t\t\tif (encodeOptions & RESET_BUFFER_MODE)\n\t\t\t\t\tposition = start\n\t\t\t}\n\t\t}\n\t\tthis.findCommonStringsToPack = () => {\n\t\t\tsamplingPackedValues = new Map()\n\t\t\tif (!sharedPackedObjectMap)\n\t\t\t\tsharedPackedObjectMap = Object.create(null)\n\t\t\treturn (options) => {\n\t\t\t\tlet threshold = options && options.threshold || 4\n\t\t\t\tlet position = this.pack ? options.maxPrivatePackedValues || 16 : 0\n\t\t\t\tif (!sharedValues)\n\t\t\t\t\tsharedValues = this.sharedValues = []\n\t\t\t\tfor (let [ key, status ] of samplingPackedValues) {\n\t\t\t\t\tif (status.count > threshold) {\n\t\t\t\t\t\tsharedPackedObjectMap[key] = position++\n\t\t\t\t\t\tsharedValues.push(key)\n\t\t\t\t\t\thasSharedUpdate = true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (this.saveShared && this.updateSharedData() === false) {}\n\t\t\t\tsamplingPackedValues = null\n\t\t\t}\n\t\t}\n\t\tconst encode = (value) => {\n\t\t\tif (position > safeEnd)\n\t\t\t\ttarget = makeRoom(position)\n\n\t\t\tvar type = typeof value\n\t\t\tvar length\n\t\t\tif (type === 'string') {\n\t\t\t\tif (packedObjectMap) {\n\t\t\t\t\tlet packedPosition = packedObjectMap[value]\n\t\t\t\t\tif (packedPosition >= 0) {\n\t\t\t\t\t\tif (packedPosition < 16)\n\t\t\t\t\t\t\ttarget[position++] = packedPosition + 0xe0 // simple values, defined in https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttarget[position++] = 0xc6 // tag 6 defined in https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\t\t\t\t\tif (packedPosition & 1)\n\t\t\t\t\t\t\t\tencode((15 - packedPosition) >> 1)\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tencode((packedPosition - 16) >> 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn\n/*\t\t\t\t\t\t} else if (packedStatus.serializationId != serializationId) {\n\t\t\t\t\t\t\tpackedStatus.serializationId = serializationId\n\t\t\t\t\t\t\tpackedStatus.count = 1\n\t\t\t\t\t\t\tif (options.sharedPack) {\n\t\t\t\t\t\t\t\tlet sharedCount = packedStatus.sharedCount = (packedStatus.sharedCount || 0) + 1\n\t\t\t\t\t\t\t\tif (shareCount > (options.sharedPack.threshold || 5)) {\n\t\t\t\t\t\t\t\t\tlet sharedPosition = packedStatus.position = packedStatus.nextSharedPosition\n\t\t\t\t\t\t\t\t\thasSharedUpdate = true\n\t\t\t\t\t\t\t\t\tif (sharedPosition < 16)\n\t\t\t\t\t\t\t\t\t\ttarget[position++] = sharedPosition + 0xc0\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} // else any in-doc incrementation?*/\n\t\t\t\t\t} else if (samplingPackedValues && !options.pack) {\n\t\t\t\t\t\tlet status = samplingPackedValues.get(value)\n\t\t\t\t\t\tif (status)\n\t\t\t\t\t\t\tstatus.count++\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tsamplingPackedValues.set(value, {\n\t\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet strLength = value.length\n\t\t\t\tif (bundledStrings && strLength >= 4 && strLength < 0x400) {\n\t\t\t\t\tif ((bundledStrings.size += strLength) > MAX_BUNDLE_SIZE) {\n\t\t\t\t\t\tlet extStart\n\t\t\t\t\t\tlet maxBytes = (bundledStrings[0] ? bundledStrings[0].length * 3 + bundledStrings[1].length : 0) + 10\n\t\t\t\t\t\tif (position + maxBytes > safeEnd)\n\t\t\t\t\t\t\ttarget = makeRoom(position + maxBytes)\n\t\t\t\t\t\ttarget[position++] = 0xd9 // tag 16-bit\n\t\t\t\t\t\ttarget[position++] = 0xdf // tag 0xdff9\n\t\t\t\t\t\ttarget[position++] = 0xf9\n\t\t\t\t\t\t// TODO: If we only have one bundle with any string data, only write one string bundle\n\t\t\t\t\t\ttarget[position++] = bundledStrings.position ? 0x84 : 0x82 // array of 4 or 2 elements depending on if we write bundles\n\t\t\t\t\t\ttarget[position++] = 0x1a // 32-bit unsigned int\n\t\t\t\t\t\textStart = position - start\n\t\t\t\t\t\tposition += 4 // reserve for writing bundle reference\n\t\t\t\t\t\tif (bundledStrings.position) {\n\t\t\t\t\t\t\twriteBundles(start, encode) // write the last bundles\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbundledStrings = ['', ''] // create new ones\n\t\t\t\t\t\tbundledStrings.size = 0\n\t\t\t\t\t\tbundledStrings.position = extStart\n\t\t\t\t\t}\n\t\t\t\t\tlet twoByte = hasNonLatin.test(value)\n\t\t\t\t\tbundledStrings[twoByte ? 0 : 1] += value\n\t\t\t\t\ttarget[position++] = twoByte ? 0xce : 0xcf\n\t\t\t\t\tencode(strLength);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlet headerSize\n\t\t\t\t// first we estimate the header size, so we can write to the correct location\n\t\t\t\tif (strLength < 0x20) {\n\t\t\t\t\theaderSize = 1\n\t\t\t\t} else if (strLength < 0x100) {\n\t\t\t\t\theaderSize = 2\n\t\t\t\t} else if (strLength < 0x10000) {\n\t\t\t\t\theaderSize = 3\n\t\t\t\t} else {\n\t\t\t\t\theaderSize = 5\n\t\t\t\t}\n\t\t\t\tlet maxBytes = strLength * 3\n\t\t\t\tif (position + maxBytes > safeEnd)\n\t\t\t\t\ttarget = makeRoom(position + maxBytes)\n\n\t\t\t\tif (strLength < 0x40 || !encodeUtf8) {\n\t\t\t\t\tlet i, c1, c2, strPosition = position + headerSize\n\t\t\t\t\tfor (i = 0; i < strLength; i++) {\n\t\t\t\t\t\tc1 = value.charCodeAt(i)\n\t\t\t\t\t\tif (c1 < 0x80) {\n\t\t\t\t\t\t\ttarget[strPosition++] = c1\n\t\t\t\t\t\t} else if (c1 < 0x800) {\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 6 | 0xc0\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 & 0x3f | 0x80\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t(c1 & 0xfc00) === 0xd800 &&\n\t\t\t\t\t\t\t((c2 = value.charCodeAt(i + 1)) & 0xfc00) === 0xdc00\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tc1 = 0x10000 + ((c1 & 0x03ff) << 10) + (c2 & 0x03ff)\n\t\t\t\t\t\t\ti++\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 18 | 0xf0\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 12 & 0x3f | 0x80\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 6 & 0x3f | 0x80\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 & 0x3f | 0x80\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 12 | 0xe0\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 >> 6 & 0x3f | 0x80\n\t\t\t\t\t\t\ttarget[strPosition++] = c1 & 0x3f | 0x80\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlength = strPosition - position - headerSize\n\t\t\t\t} else {\n\t\t\t\t\tlength = encodeUtf8(value, position + headerSize, maxBytes)\n\t\t\t\t}\n\n\t\t\t\tif (length < 0x18) {\n\t\t\t\t\ttarget[position++] = 0x60 | length\n\t\t\t\t} else if (length < 0x100) {\n\t\t\t\t\tif (headerSize < 2) {\n\t\t\t\t\t\ttarget.copyWithin(position + 2, position + 1, position + 1 + length)\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0x78\n\t\t\t\t\ttarget[position++] = length\n\t\t\t\t} else if (length < 0x10000) {\n\t\t\t\t\tif (headerSize < 3) {\n\t\t\t\t\t\ttarget.copyWithin(position + 3, position + 2, position + 2 + length)\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0x79\n\t\t\t\t\ttarget[position++] = length >> 8\n\t\t\t\t\ttarget[position++] = length & 0xff\n\t\t\t\t} else {\n\t\t\t\t\tif (headerSize < 5) {\n\t\t\t\t\t\ttarget.copyWithin(position + 5, position + 3, position + 3 + length)\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0x7a\n\t\t\t\t\ttargetView.setUint32(position, length)\n\t\t\t\t\tposition += 4\n\t\t\t\t}\n\t\t\t\tposition += length\n\t\t\t} else if (type === 'number') {\n\t\t\t\tif (!this.alwaysUseFloat && value >>> 0 === value) {// positive integer, 32-bit or less\n\t\t\t\t\t// positive uint\n\t\t\t\t\tif (value < 0x18) {\n\t\t\t\t\t\ttarget[position++] = value\n\t\t\t\t\t} else if (value < 0x100) {\n\t\t\t\t\t\ttarget[position++] = 0x18\n\t\t\t\t\t\ttarget[position++] = value\n\t\t\t\t\t} else if (value < 0x10000) {\n\t\t\t\t\t\ttarget[position++] = 0x19\n\t\t\t\t\t\ttarget[position++] = value >> 8\n\t\t\t\t\t\ttarget[position++] = value & 0xff\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttarget[position++] = 0x1a\n\t\t\t\t\t\ttargetView.setUint32(position, value)\n\t\t\t\t\t\tposition += 4\n\t\t\t\t\t}\n\t\t\t\t} else if (!this.alwaysUseFloat && value >> 0 === value) { // negative integer\n\t\t\t\t\tif (value >= -0x18) {\n\t\t\t\t\t\ttarget[position++] = 0x1f - value\n\t\t\t\t\t} else if (value >= -0x100) {\n\t\t\t\t\t\ttarget[position++] = 0x38\n\t\t\t\t\t\ttarget[position++] = ~value\n\t\t\t\t\t} else if (value >= -0x10000) {\n\t\t\t\t\t\ttarget[position++] = 0x39\n\t\t\t\t\t\ttargetView.setUint16(position, ~value)\n\t\t\t\t\t\tposition += 2\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttarget[position++] = 0x3a\n\t\t\t\t\t\ttargetView.setUint32(position, ~value)\n\t\t\t\t\t\tposition += 4\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet useFloat32\n\t\t\t\t\tif ((useFloat32 = this.useFloat32) > 0 && value < 0x100000000 && value >= -0x80000000) {\n\t\t\t\t\t\ttarget[position++] = 0xfa\n\t\t\t\t\t\ttargetView.setFloat32(position, value)\n\t\t\t\t\t\tlet xShifted\n\t\t\t\t\t\tif (useFloat32 < 4 ||\n\t\t\t\t\t\t\t\t// this checks for rounding of numbers that were encoded in 32-bit float to nearest significant decimal digit that could be preserved\n\t\t\t\t\t\t\t\t((xShifted = value * mult10[((target[position] & 0x7f) << 1) | (target[position + 1] >> 7)]) >> 0) === xShifted) {\n\t\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\tposition-- // move back into position for writing a double\n\t\t\t\t\t}\n\t\t\t\t\ttarget[position++] = 0xfb\n\t\t\t\t\ttargetView.setFloat64(position, value)\n\t\t\t\t\tposition += 8\n\t\t\t\t}\n\t\t\t} else if (type === 'object') {\n\t\t\t\tif (!value)\n\t\t\t\t\ttarget[position++] = 0xf6\n\t\t\t\telse {\n\t\t\t\t\tif (referenceMap) {\n\t\t\t\t\t\tlet referee = referenceMap.get(value)\n\t\t\t\t\t\tif (referee) {\n\t\t\t\t\t\t\ttarget[position++] = 0xd8\n\t\t\t\t\t\t\ttarget[position++] = 29 // http://cbor.schmorp.de/value-sharing\n\t\t\t\t\t\t\ttarget[position++] = 0x19 // 16-bit uint\n\t\t\t\t\t\t\tif (!referee.references) {\n\t\t\t\t\t\t\t\tlet idsToInsert = referenceMap.idsToInsert || (referenceMap.idsToInsert = [])\n\t\t\t\t\t\t\t\treferee.references = []\n\t\t\t\t\t\t\t\tidsToInsert.push(referee)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treferee.references.push(position - start)\n\t\t\t\t\t\t\tposition += 2 // TODO: also support 32-bit\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t} else \n\t\t\t\t\t\t\treferenceMap.set(value, { offset: position - start })\n\t\t\t\t\t}\n\t\t\t\t\tlet constructor = value.constructor\n\t\t\t\t\tif (constructor === Object) {\n\t\t\t\t\t\twriteObject(value, true)\n\t\t\t\t\t} else if (constructor === Array) {\n\t\t\t\t\t\tlength = value.length\n\t\t\t\t\t\tif (length < 0x18) {\n\t\t\t\t\t\t\ttarget[position++] = 0x80 | length\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twriteArrayHeader(length)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\t\t\tencode(value[i])\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (constructor === Map) {\n\t\t\t\t\t\tif (this.mapsAsObjects ? this.useTag259ForMaps !== false : this.useTag259ForMaps) {\n\t\t\t\t\t\t\t// use Tag 259 (https://github.com/shanewholloway/js-cbor-codec/blob/master/docs/CBOR-259-spec--explicit-maps.md) for maps if the user wants it that way\n\t\t\t\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\t\t\t\ttarget[position++] = 1\n\t\t\t\t\t\t\ttarget[position++] = 3\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlength = value.size\n\t\t\t\t\t\tif (length < 0x18) {\n\t\t\t\t\t\t\ttarget[position++] = 0xa0 | length\n\t\t\t\t\t\t} else if (length < 0x100) {\n\t\t\t\t\t\t\ttarget[position++] = 0xb8\n\t\t\t\t\t\t\ttarget[position++] = length\n\t\t\t\t\t\t} else if (length < 0x10000) {\n\t\t\t\t\t\t\ttarget[position++] = 0xb9\n\t\t\t\t\t\t\ttarget[position++] = length >> 8\n\t\t\t\t\t\t\ttarget[position++] = length & 0xff\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget[position++] = 0xba\n\t\t\t\t\t\t\ttargetView.setUint32(position, length)\n\t\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (encoder.keyMap) { \n\t\t\t\t\t\t\tfor (let [ key, entryValue ] of value) {\n\t\t\t\t\t\t\t\tencode(encoder.encodeKey(key))\n\t\t\t\t\t\t\t\tencode(entryValue)\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t} else { \n\t\t\t\t\t\t\tfor (let [ key, entryValue ] of value) {\n\t\t\t\t\t\t\t\tencode(key) \n\t\t\t\t\t\t\t\tencode(entryValue)\n\t\t\t\t\t\t\t} \t\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let i = 0, l = extensions.length; i < l; i++) {\n\t\t\t\t\t\t\tlet extensionClass = extensionClasses[i]\n\t\t\t\t\t\t\tif (value instanceof extensionClass) {\n\t\t\t\t\t\t\t\tlet extension = extensions[i]\n\t\t\t\t\t\t\t\tlet tag = extension.tag\n\t\t\t\t\t\t\t\tif (tag == undefined)\n\t\t\t\t\t\t\t\t\ttag = extension.getTag && extension.getTag.call(this, value)\n\t\t\t\t\t\t\t\tif (tag < 0x18) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xc0 | tag\n\t\t\t\t\t\t\t\t} else if (tag < 0x100) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xd8\n\t\t\t\t\t\t\t\t\ttarget[position++] = tag\n\t\t\t\t\t\t\t\t} else if (tag < 0x10000) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\t\t\t\t\t\ttarget[position++] = tag >> 8\n\t\t\t\t\t\t\t\t\ttarget[position++] = tag & 0xff\n\t\t\t\t\t\t\t\t} else if (tag > -1) {\n\t\t\t\t\t\t\t\t\ttarget[position++] = 0xda\n\t\t\t\t\t\t\t\t\ttargetView.setUint32(position, tag)\n\t\t\t\t\t\t\t\t\tposition += 4\n\t\t\t\t\t\t\t\t} // else undefined, don't write tag\n\t\t\t\t\t\t\t\textension.encode.call(this, value, encode, makeRoom)\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (value[Symbol.iterator]) {\n\t\t\t\t\t\t\tif (throwOnIterable) {\n\t\t\t\t\t\t\t\tlet error = new Error('Iterable should be serialized as iterator')\n\t\t\t\t\t\t\t\terror.iteratorNotHandled = true;\n\t\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget[position++] = 0x9f // indefinite length array\n\t\t\t\t\t\t\tfor (let entry of value) {\n\t\t\t\t\t\t\t\tencode(entry)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget[position++] = 0xff // stop-code\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (value[Symbol.asyncIterator] || isBlob(value)) {\n\t\t\t\t\t\t\tlet error = new Error('Iterable/blob should be serialized as iterator')\n\t\t\t\t\t\t\terror.iteratorNotHandled = true;\n\t\t\t\t\t\t\tthrow error;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.useToJSON && value.toJSON) {\n\t\t\t\t\t\t\tconst json = value.toJSON()\n\t\t\t\t\t\t\t// if for some reason value.toJSON returns itself it'll loop forever\n\t\t\t\t\t\t\tif (json !== value)\n\t\t\t\t\t\t\t\treturn encode(json)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// no extension found, write as object\n\t\t\t\t\t\twriteObject(value, !value.hasOwnProperty) // if it doesn't have hasOwnProperty, don't do hasOwnProperty checks\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (type === 'boolean') {\n\t\t\t\ttarget[position++] = value ? 0xf5 : 0xf4\n\t\t\t} else if (type === 'bigint') {\n\t\t\t\tif (value < (BigInt(1)<<BigInt(64)) && value >= 0) {\n\t\t\t\t\t// use an unsigned int as long as it fits\n\t\t\t\t\ttarget[position++] = 0x1b\n\t\t\t\t\ttargetView.setBigUint64(position, value)\n\t\t\t\t} else if (value > -(BigInt(1)<<BigInt(64)) && value < 0) {\n\t\t\t\t\t// if we can fit an unsigned int, use that\n\t\t\t\t\ttarget[position++] = 0x3b\n\t\t\t\t\ttargetView.setBigUint64(position, -value - BigInt(1))\n\t\t\t\t} else {\n\t\t\t\t\t// overflow\n\t\t\t\t\tif (this.largeBigIntToFloat) {\n\t\t\t\t\t\ttarget[position++] = 0xfb\n\t\t\t\t\t\ttargetView.setFloat64(position, Number(value))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new RangeError(value + ' was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tposition += 8\n\t\t\t} else if (type === 'undefined') {\n\t\t\t\ttarget[position++] = 0xf7\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unknown type: ' + type)\n\t\t\t}\n\t\t}\n\n\t\tconst writeObject = this.useRecords === false ? this.variableMapSize ? (object) => {\n\t\t\t// this method is slightly slower, but generates \"preferred serialization\" (optimally small for smaller objects)\n\t\t\tlet keys = Object.keys(object)\n\t\t\tlet vals = Object.values(object)\n\t\t\tlet length = keys.length\n\t\t\tif (length < 0x18) {\n\t\t\t\ttarget[position++] = 0xa0 | length\n\t\t\t} else if (length < 0x100) {\n\t\t\t\ttarget[position++] = 0xb8\n\t\t\t\ttarget[position++] = length\n\t\t\t} else if (length < 0x10000) {\n\t\t\t\ttarget[position++] = 0xb9\n\t\t\t\ttarget[position++] = length >> 8\n\t\t\t\ttarget[position++] = length & 0xff\n\t\t\t} else {\n\t\t\t\ttarget[position++] = 0xba\n\t\t\t\ttargetView.setUint32(position, length)\n\t\t\t\tposition += 4\n\t\t\t}\n\t\t\tlet key\n\t\t\tif (encoder.keyMap) { \n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tencode(encoder.encodeKey(keys[i]))\n\t\t\t\t\tencode(vals[i])\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tencode(keys[i])\n\t\t\t\t\tencode(vals[i])\n\t\t\t\t}\n\t\t\t}\n\t\t} :\n\t\t(object, safePrototype) => {\n\t\t\ttarget[position++] = 0xb9 // always use map 16, so we can preallocate and set the length afterwards\n\t\t\tlet objectOffset = position - start\n\t\t\tposition += 2\n\t\t\tlet size = 0\n\t\t\tif (encoder.keyMap) { \n\t\t\t\tfor (let key in object) if (safePrototype || object.hasOwnProperty(key)) {\n\t\t\t\t\tencode(encoder.encodeKey(key))\n\t\t\t\t\tencode(object[key])\n\t\t\t\t\tsize++\n\t\t\t\t}\n\t\t\t} else { \n\t\t\t\tfor (let key in object) if (safePrototype || object.hasOwnProperty(key)) {\n\t\t\t\t\t\tencode(key)\n\t\t\t\t\t\tencode(object[key])\n\t\t\t\t\tsize++\n\t\t\t\t}\n\t\t\t}\n\t\t\ttarget[objectOffset++ + start] = size >> 8\n\t\t\ttarget[objectOffset + start] = size & 0xff\n\t\t} :\n\t\t(object, safePrototype) => {\n\t\t\tlet nextTransition, transition = structures.transitions || (structures.transitions = Object.create(null))\n\t\t\tlet newTransitions = 0\n\t\t\tlet length = 0\n\t\t\tlet parentRecordId\n\t\t\tlet keys\n\t\t\tif (this.keyMap) {\n\t\t\t\tkeys = Object.keys(object).map(k => this.encodeKey(k))\n\t\t\t\tlength = keys.length\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tlet key = keys[i]\n\t\t\t\t\tnextTransition = transition[key]\n\t\t\t\t\tif (!nextTransition) {\n\t\t\t\t\t\tnextTransition = transition[key] = Object.create(null)\n\t\t\t\t\t\tnewTransitions++\n\t\t\t\t\t}\n\t\t\t\t\ttransition = nextTransition\n\t\t\t\t}\t\t\t\t\n\t\t\t} else {\n\t\t\t\tfor (let key in object) if (safePrototype || object.hasOwnProperty(key)) {\n\t\t\t\t\tnextTransition = transition[key]\n\t\t\t\t\tif (!nextTransition) {\n\t\t\t\t\t\tif (transition[RECORD_SYMBOL] & 0x100000) {// this indicates it is a brancheable/extendable terminal node, so we will use this record id and extend it\n\t\t\t\t\t\t\tparentRecordId = transition[RECORD_SYMBOL] & 0xffff\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextTransition = transition[key] = Object.create(null)\n\t\t\t\t\t\tnewTransitions++\n\t\t\t\t\t}\n\t\t\t\t\ttransition = nextTransition\n\t\t\t\t\tlength++\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet recordId = transition[RECORD_SYMBOL]\n\t\t\tif (recordId !== undefined) {\n\t\t\t\trecordId &= 0xffff\n\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\ttarget[position++] = (recordId >> 8) | 0xe0\n\t\t\t\ttarget[position++] = recordId & 0xff\n\t\t\t} else {\n\t\t\t\tif (!keys)\n\t\t\t\t\tkeys = transition.__keys__ || (transition.__keys__ = Object.keys(object))\n\t\t\t\tif (parentRecordId === undefined) {\n\t\t\t\t\trecordId = structures.nextId++\n\t\t\t\t\tif (!recordId) {\n\t\t\t\t\t\trecordId = 0\n\t\t\t\t\t\tstructures.nextId = 1\n\t\t\t\t\t}\n\t\t\t\t\tif (recordId >= MAX_STRUCTURES) {// cycle back around\n\t\t\t\t\t\tstructures.nextId = (recordId = maxSharedStructures) + 1\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trecordId = parentRecordId\n\t\t\t\t}\n\t\t\t\tstructures[recordId] = keys\n\t\t\t\tif (recordId < maxSharedStructures) {\n\t\t\t\t\ttarget[position++] = 0xd9\n\t\t\t\t\ttarget[position++] = (recordId >> 8) | 0xe0\n\t\t\t\t\ttarget[position++] = recordId & 0xff\n\t\t\t\t\ttransition = structures.transitions\n\t\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\t\tif (transition[RECORD_SYMBOL] === undefined || (transition[RECORD_SYMBOL] & 0x100000))\n\t\t\t\t\t\t\ttransition[RECORD_SYMBOL] = recordId\n\t\t\t\t\t\ttransition = transition[keys[i]]\n\t\t\t\t\t}\n\t\t\t\t\ttransition[RECORD_SYMBOL] = recordId | 0x100000 // indicates it is a extendable terminal\n\t\t\t\t\thasSharedUpdate = true\n\t\t\t\t} else {\n\t\t\t\t\ttransition[RECORD_SYMBOL] = recordId\n\t\t\t\t\ttargetView.setUint32(position, 0xd9dfff00) // tag two byte, then record definition id\n\t\t\t\t\tposition += 3\n\t\t\t\t\tif (newTransitions)\n\t\t\t\t\t\ttransitionsCount += serializationsSinceTransitionRebuild * newTransitions\n\t\t\t\t\t// record the removal of the id, we can maintain our shared structure\n\t\t\t\t\tif (recordIdsToRemove.length >= MAX_STRUCTURES - maxSharedStructures)\n\t\t\t\t\t\trecordIdsToRemove.shift()[RECORD_SYMBOL] = undefined // we are cycling back through, and have to remove old ones\n\t\t\t\t\trecordIdsToRemove.push(transition)\n\t\t\t\t\twriteArrayHeader(length + 2)\n\t\t\t\t\tencode(0xe000 + recordId)\n\t\t\t\t\tencode(keys)\n\t\t\t\t\tif (safePrototype === null) return; // special exit for iterator\n\t\t\t\t\tfor (let key in object)\n\t\t\t\t\t\tif (safePrototype || object.hasOwnProperty(key))\n\t\t\t\t\t\t\tencode(object[key])\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (length < 0x18) { // write the array header\n\t\t\t\ttarget[position++] = 0x80 | length\n\t\t\t} else {\n\t\t\t\twriteArrayHeader(length)\n\t\t\t}\n\t\t\tif (safePrototype === null) return; // special exit for iterator\n\t\t\tfor (let key in object)\n\t\t\t\tif (safePrototype || object.hasOwnProperty(key))\n\t\t\t\t\tencode(object[key])\n\t\t}\n\t\tconst makeRoom = (end) => {\n\t\t\tlet newSize\n\t\t\tif (end > 0x1000000) {\n\t\t\t\t// special handling for really large buffers\n\t\t\t\tif ((end - start) > MAX_BUFFER_SIZE)\n\t\t\t\t\tthrow new Error('Encoded buffer would be larger than maximum buffer size')\n\t\t\t\tnewSize = Math.min(MAX_BUFFER_SIZE,\n\t\t\t\t\tMath.round(Math.max((end - start) * (end > 0x4000000 ? 1.25 : 2), 0x400000) / 0x1000) * 0x1000)\n\t\t\t} else // faster handling for smaller buffers\n\t\t\t\tnewSize = ((Math.max((end - start) << 2, target.length - 1) >> 12) + 1) << 12\n\t\t\tlet newBuffer = new ByteArrayAllocate(newSize)\n\t\t\ttargetView = new DataView(newBuffer.buffer, 0, newSize)\n\t\t\tif (target.copy)\n\t\t\t\ttarget.copy(newBuffer, 0, start, end)\n\t\t\telse\n\t\t\t\tnewBuffer.set(target.slice(start, end))\n\t\t\tposition -= start\n\t\t\tstart = 0\n\t\t\tsafeEnd = newBuffer.length - 10\n\t\t\treturn target = newBuffer\n\t\t}\n\t\tlet chunkThreshold = 100;\n\t\tlet continuedChunkThreshold = 1000;\n\t\tthis.encodeAsIterable = function(value, options) {\n\t\t\treturn startEncoding(value, options, encodeObjectAsIterable);\n\t\t}\n\t\tthis.encodeAsAsyncIterable = function(value, options) {\n\t\t\treturn startEncoding(value, options, encodeObjectAsAsyncIterable);\n\t\t}\n\n\t\tfunction* encodeObjectAsIterable(object, iterateProperties, finalIterable) {\n\t\t\tlet constructor = object.constructor;\n\t\t\tif (constructor === Object) {\n\t\t\t\tlet useRecords = encoder.useRecords !== false;\n\t\t\t\tif (useRecords)\n\t\t\t\t\twriteObject(object, null); // write the record identifier\n\t\t\t\telse\n\t\t\t\t\twriteEntityLength(Object.keys(object).length, 0xa0);\n\t\t\t\tfor (let key in object) {\n\t\t\t\t\tlet value = object[key];\n\t\t\t\t\tif (!useRecords) encode(key);\n\t\t\t\t\tif (value && typeof value === 'object') {\n\t\t\t\t\t\tif (iterateProperties[key])\n\t\t\t\t\t\t\tyield* encodeObjectAsIterable(value, iterateProperties[key]);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tyield* tryEncode(value, iterateProperties, key);\n\t\t\t\t\t} else encode(value);\n\t\t\t\t}\n\t\t\t} else if (constructor === Array) {\n\t\t\t\tlet length = object.length;\n\t\t\t\twriteArrayHeader(length);\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tlet value = object[i];\n\t\t\t\t\tif (value && (typeof value === 'object' || position - start > chunkThreshold)) {\n\t\t\t\t\t\tif (iterateProperties.element)\n\t\t\t\t\t\t\tyield* encodeObjectAsIterable(value, iterateProperties.element);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tyield* tryEncode(value, iterateProperties, 'element');\n\t\t\t\t\t} else encode(value);\n\t\t\t\t}\n\t\t\t} else if (object[Symbol.iterator]) {\n\t\t\t\ttarget[position++] = 0x9f; // start indefinite array\n\t\t\t\tfor (let value of object) {\n\t\t\t\t\tif (value && (typeof value === 'object' || position - start > chunkThreshold)) {\n\t\t\t\t\t\tif (iterateProperties.element)\n\t\t\t\t\t\t\tyield* encodeObjectAsIterable(value, iterateProperties.element);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tyield* tryEncode(value, iterateProperties, 'element');\n\t\t\t\t\t} else encode(value);\n\t\t\t\t}\n\t\t\t\ttarget[position++] = 0xff; // stop byte\n\t\t\t} else if (isBlob(object)){\n\t\t\t\twriteEntityLength(object.size, 0x40); // encode as binary data\n\t\t\t\tyield target.subarray(start, position);\n\t\t\t\tyield object; // directly return blobs, they have to be encoded asynchronously\n\t\t\t\trestartEncoding();\n\t\t\t} else if (object[Symbol.asyncIterator]) {\n\t\t\t\ttarget[position++] = 0x9f; // start indefinite array\n\t\t\t\tyield target.subarray(start, position);\n\t\t\t\tyield object; // directly return async iterators, they have to be encoded asynchronously\n\t\t\t\trestartEncoding();\n\t\t\t\ttarget[position++] = 0xff; // stop byte\n\t\t\t} else {\n\t\t\t\tencode(object);\n\t\t\t}\n\t\t\tif (finalIterable && position > start) yield target.subarray(start, position);\n\t\t\telse if (position - start > chunkThreshold) {\n\t\t\t\tyield target.subarray(start, position);\n\t\t\t\trestartEncoding();\n\t\t\t}\n\t\t}\n\t\tfunction* tryEncode(value, iterateProperties, key) {\n\t\t\tlet restart = position - start;\n\t\t\ttry {\n\t\t\t\tencode(value);\n\t\t\t\tif (position - start > chunkThreshold) {\n\t\t\t\t\tyield target.subarray(start, position);\n\t\t\t\t\trestartEncoding();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tif (error.iteratorNotHandled) {\n\t\t\t\t\titerateProperties[key] = {};\n\t\t\t\t\tposition = start + restart; // restart our position so we don't have partial data from last encode\n\t\t\t\t\tyield* encodeObjectAsIterable.call(this, value, iterateProperties[key]);\n\t\t\t\t} else throw error;\n\t\t\t}\n\t\t}\n\t\tfunction restartEncoding() {\n\t\t\tchunkThreshold = continuedChunkThreshold;\n\t\t\tencoder.encode(null, THROW_ON_ITERABLE); // restart encoding\n\t\t}\n\t\tfunction startEncoding(value, options, encodeIterable) {\n\t\t\tif (options && options.chunkThreshold) // explicitly specified chunk sizes\n\t\t\t\tchunkThreshold = continuedChunkThreshold = options.chunkThreshold;\n\t\t\telse // we start with a smaller threshold to get initial bytes sent quickly\n\t\t\t\tchunkThreshold = 100;\n\t\t\tif (value && typeof value === 'object') {\n\t\t\t\tencoder.encode(null, THROW_ON_ITERABLE); // start encoding\n\t\t\t\treturn encodeIterable(value, encoder.iterateProperties || (encoder.iterateProperties = {}), true);\n\t\t\t}\n\t\t\treturn [encoder.encode(value)];\n\t\t}\n\n\t\tasync function* encodeObjectAsAsyncIterable(value, iterateProperties) {\n\t\t\tfor (let encodedValue of encodeObjectAsIterable(value, iterateProperties, true)) {\n\t\t\t\tlet constructor = encodedValue.constructor;\n\t\t\t\tif (constructor === ByteArray || constructor === Uint8Array)\n\t\t\t\t\tyield encodedValue;\n\t\t\t\telse if (isBlob(encodedValue)) {\n\t\t\t\t\tlet reader = encodedValue.stream().getReader();\n\t\t\t\t\tlet next;\n\t\t\t\t\twhile (!(next = await reader.read()).done) {\n\t\t\t\t\t\tyield next.value;\n\t\t\t\t\t}\n\t\t\t\t} else if (encodedValue[Symbol.asyncIterator]) {\n\t\t\t\t\tfor await (let asyncValue of encodedValue) {\n\t\t\t\t\t\trestartEncoding();\n\t\t\t\t\t\tif (asyncValue)\n\t\t\t\t\t\t\tyield* encodeObjectAsAsyncIterable(asyncValue, iterateProperties.async || (iterateProperties.async = {}));\n\t\t\t\t\t\telse yield encoder.encode(asyncValue);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tyield encodedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tuseBuffer(buffer) {\n\t\t// this means we are finished using our own buffer and we can write over it safely\n\t\ttarget = buffer\n\t\ttargetView = new DataView(target.buffer, target.byteOffset, target.byteLength)\n\t\tposition = 0\n\t}\n\tclearSharedData() {\n\t\tif (this.structures)\n\t\t\tthis.structures = []\n\t\tif (this.sharedValues)\n\t\t\tthis.sharedValues = undefined\n\t}\n\tupdateSharedData() {\n\t\tlet lastVersion = this.sharedVersion || 0\n\t\tthis.sharedVersion = lastVersion + 1\n\t\tlet structuresCopy = this.structures.slice(0)\n\t\tlet sharedData = new SharedData(structuresCopy, this.sharedValues, this.sharedVersion)\n\t\tlet saveResults = this.saveShared(sharedData,\n\t\t\t\texistingShared => (existingShared && existingShared.version || 0) == lastVersion)\n\t\tif (saveResults === false) {\n\t\t\t// get updated structures and try again if the update failed\n\t\t\tsharedData = this.getShared() || {}\n\t\t\tthis.structures = sharedData.structures || []\n\t\t\tthis.sharedValues = sharedData.packedValues\n\t\t\tthis.sharedVersion = sharedData.version\n\t\t\tthis.structures.nextId = this.structures.length\n\t\t} else {\n\t\t\t// restore structures\n\t\t\tstructuresCopy.forEach((structure, i) => this.structures[i] = structure)\n\t\t}\n\t\t// saveShared may fail to write and reload, or may have reloaded to check compatibility and overwrite saved data, either way load the correct shared data\n\t\treturn saveResults\n\t}\n}\nfunction writeEntityLength(length, majorValue) {\n\tif (length < 0x18)\n\t\ttarget[position++] = majorValue | length\n\telse if (length < 0x100) {\n\t\ttarget[position++] = majorValue | 0x18\n\t\ttarget[position++] = length\n\t} else if (length < 0x10000) {\n\t\ttarget[position++] = majorValue | 0x19\n\t\ttarget[position++] = length >> 8\n\t\ttarget[position++] = length & 0xff\n\t} else {\n\t\ttarget[position++] = majorValue | 0x1a\n\t\ttargetView.setUint32(position, length)\n\t\tposition += 4\n\t}\n\n}\nclass SharedData {\n\tconstructor(structures, values, version) {\n\t\tthis.structures = structures\n\t\tthis.packedValues = values\n\t\tthis.version = version\n\t}\n}\n\nfunction writeArrayHeader(length) {\n\tif (length < 0x18)\n\t\ttarget[position++] = 0x80 | length\n\telse if (length < 0x100) {\n\t\ttarget[position++] = 0x98\n\t\ttarget[position++] = length\n\t} else if (length < 0x10000) {\n\t\ttarget[position++] = 0x99\n\t\ttarget[position++] = length >> 8\n\t\ttarget[position++] = length & 0xff\n\t} else {\n\t\ttarget[position++] = 0x9a\n\t\ttargetView.setUint32(position, length)\n\t\tposition += 4\n\t}\n}\n\nconst BlobConstructor = typeof Blob === 'undefined' ? function(){} : Blob;\nfunction isBlob(object) {\n\tif (object instanceof BlobConstructor)\n\t\treturn true;\n\tlet tag = object[Symbol.toStringTag];\n\treturn tag === 'Blob' || tag === 'File';\n}\nfunction findRepetitiveStrings(value, packedValues) {\n\tswitch(typeof value) {\n\t\tcase 'string':\n\t\t\tif (value.length > 3) {\n\t\t\t\tif (packedValues.objectMap[value] > -1 || packedValues.values.length >= packedValues.maxValues)\n\t\t\t\t\treturn\n\t\t\t\tlet packedStatus = packedValues.get(value)\n\t\t\t\tif (packedStatus) {\n\t\t\t\t\tif (++packedStatus.count == 2) {\n\t\t\t\t\t\tpackedValues.values.push(value)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tpackedValues.set(value, {\n\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t})\n\t\t\t\t\tif (packedValues.samplingPackedValues) {\n\t\t\t\t\t\tlet status = packedValues.samplingPackedValues.get(value)\n\t\t\t\t\t\tif (status)\n\t\t\t\t\t\t\tstatus.count++\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tpackedValues.samplingPackedValues.set(value, {\n\t\t\t\t\t\t\t\tcount: 1,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'object':\n\t\t\tif (value) {\n\t\t\t\tif (value instanceof Array) {\n\t\t\t\t\tfor (let i = 0, l = value.length; i < l; i++) {\n\t\t\t\t\t\tfindRepetitiveStrings(value[i], packedValues)\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tlet includeKeys = !packedValues.encoder.useRecords\n\t\t\t\t\tfor (var key in value) {\n\t\t\t\t\t\tif (value.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tif (includeKeys)\n\t\t\t\t\t\t\t\tfindRepetitiveStrings(key, packedValues)\n\t\t\t\t\t\t\tfindRepetitiveStrings(value[key], packedValues)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'function': console.log(value)\n\t}\n}\nconst isLittleEndianMachine = new Uint8Array(new Uint16Array([1]).buffer)[0] == 1\nextensionClasses = [ Date, Set, Error, RegExp, Tag, ArrayBuffer,\n\tUint8Array, Uint8ClampedArray, Uint16Array, Uint32Array,\n\ttypeof BigUint64Array == 'undefined' ? function() {} : BigUint64Array, Int8Array, Int16Array, Int32Array,\n\ttypeof BigInt64Array == 'undefined' ? function() {} : BigInt64Array,\n\tFloat32Array, Float64Array, SharedData ]\n\n//Object.getPrototypeOf(Uint8Array.prototype).constructor /*TypedArray*/\nextensions = [{ // Date\n\ttag: 1,\n\tencode(date, encode) {\n\t\tlet seconds = date.getTime() / 1000\n\t\tif ((this.useTimestamp32 || date.getMilliseconds() === 0) && seconds >= 0 && seconds < 0x100000000) {\n\t\t\t// Timestamp 32\n\t\t\ttarget[position++] = 0x1a\n\t\t\ttargetView.setUint32(position, seconds)\n\t\t\tposition += 4\n\t\t} else {\n\t\t\t// Timestamp float64\n\t\t\ttarget[position++] = 0xfb\n\t\t\ttargetView.setFloat64(position, seconds)\n\t\t\tposition += 8\n\t\t}\n\t}\n}, { // Set\n\ttag: 258, // https://github.com/input-output-hk/cbor-sets-spec/blob/master/CBOR_SETS.md\n\tencode(set, encode) {\n\t\tlet array = Array.from(set)\n\t\tencode(array)\n\t}\n}, { // Error\n\ttag: 27, // http://cbor.schmorp.de/generic-object\n\tencode(error, encode) {\n\t\tencode([ error.name, error.message ])\n\t}\n}, { // RegExp\n\ttag: 27, // http://cbor.schmorp.de/generic-object\n\tencode(regex, encode) {\n\t\tencode([ 'RegExp', regex.source, regex.flags ])\n\t}\n}, { // Tag\n\tgetTag(tag) {\n\t\treturn tag.tag\n\t},\n\tencode(tag, encode) {\n\t\tencode(tag.value)\n\t}\n}, { // ArrayBuffer\n\tencode(arrayBuffer, encode, makeRoom) {\n\t\twriteBuffer(arrayBuffer, makeRoom)\n\t}\n}, { // Uint8Array\n\tgetTag(typedArray) {\n\t\tif (typedArray.constructor === Uint8Array) {\n\t\t\tif (this.tagUint8Array || hasNodeBuffer && this.tagUint8Array !== false)\n\t\t\t\treturn 64;\n\t\t} // else no tag\n\t},\n\tencode(typedArray, encode, makeRoom) {\n\t\twriteBuffer(typedArray, makeRoom)\n\t}\n},\n\ttypedArrayEncoder(68, 1),\n\ttypedArrayEncoder(69, 2),\n\ttypedArrayEncoder(70, 4),\n\ttypedArrayEncoder(71, 8),\n\ttypedArrayEncoder(72, 1),\n\ttypedArrayEncoder(77, 2),\n\ttypedArrayEncoder(78, 4),\n\ttypedArrayEncoder(79, 8),\n\ttypedArrayEncoder(85, 4),\n\ttypedArrayEncoder(86, 8),\n{\n\tencode(sharedData, encode) { // write SharedData\n\t\tlet packedValues = sharedData.packedValues || []\n\t\tlet sharedStructures = sharedData.structures || []\n\t\tif (packedValues.values.length > 0) {\n\t\t\ttarget[position++] = 0xd8 // one-byte tag\n\t\t\ttarget[position++] = 51 // tag 51 for packed shared structures https://www.potaroo.net/ietf/ids/draft-ietf-cbor-packed-03.txt\n\t\t\twriteArrayHeader(4)\n\t\t\tlet valuesArray = packedValues.values\n\t\t\tencode(valuesArray)\n\t\t\twriteArrayHeader(0) // prefixes\n\t\t\twriteArrayHeader(0) // suffixes\n\t\t\tpackedObjectMap = Object.create(sharedPackedObjectMap || null)\n\t\t\tfor (let i = 0, l = valuesArray.length; i < l; i++) {\n\t\t\t\tpackedObjectMap[valuesArray[i]] = i\n\t\t\t}\n\t\t}\n\t\tif (sharedStructures) {\n\t\t\ttargetView.setUint32(position, 0xd9dffe00)\n\t\t\tposition += 3\n\t\t\tlet definitions = sharedStructures.slice(0)\n\t\t\tdefinitions.unshift(0xe000)\n\t\t\tdefinitions.push(new Tag(sharedData.version, 0x53687264))\n\t\t\tencode(definitions)\n\t\t} else\n\t\t\tencode(new Tag(sharedData.version, 0x53687264))\n\t\t}\n\t}]\nfunction typedArrayEncoder(tag, size) {\n\tif (!isLittleEndianMachine && size > 1)\n\t\ttag -= 4 // the big endian equivalents are 4 less\n\treturn {\n\t\ttag: tag,\n\t\tencode: function writeExtBuffer(typedArray, encode) {\n\t\t\tlet length = typedArray.byteLength\n\t\t\tlet offset = typedArray.byteOffset || 0\n\t\t\tlet buffer = typedArray.buffer || typedArray\n\t\t\tencode(hasNodeBuffer ? Buffer.from(buffer, offset, length) :\n\t\t\t\tnew Uint8Array(buffer, offset, length))\n\t\t}\n\t}\n}\nfunction writeBuffer(buffer, makeRoom) {\n\tlet length = buffer.byteLength\n\tif (length < 0x18) {\n\t\ttarget[position++] = 0x40 + length\n\t} else if (length < 0x100) {\n\t\ttarget[position++] = 0x58\n\t\ttarget[position++] = length\n\t} else if (length < 0x10000) {\n\t\ttarget[position++] = 0x59\n\t\ttarget[position++] = length >> 8\n\t\ttarget[position++] = length & 0xff\n\t} else {\n\t\ttarget[position++] = 0x5a\n\t\ttargetView.setUint32(position, length)\n\t\tposition += 4\n\t}\n\tif (position + length >= target.length) {\n\t\tmakeRoom(position + length)\n\t}\n\t// if it is already a typed array (has an ArrayBuffer), use that, but if it is an ArrayBuffer itself,\n\t// must wrap it to set it.\n\ttarget.set(buffer.buffer ? buffer : new Uint8Array(buffer), position)\n\tposition += length\n}\n\nfunction insertIds(serialized, idsToInsert) {\n\t// insert the ids that need to be referenced for structured clones\n\tlet nextId\n\tlet distanceToMove = idsToInsert.length * 2\n\tlet lastEnd = serialized.length - distanceToMove\n\tidsToInsert.sort((a, b) => a.offset > b.offset ? 1 : -1)\n\tfor (let id = 0; id < idsToInsert.length; id++) {\n\t\tlet referee = idsToInsert[id]\n\t\treferee.id = id\n\t\tfor (let position of referee.references) {\n\t\t\tserialized[position++] = id >> 8\n\t\t\tserialized[position] = id & 0xff\n\t\t}\n\t}\n\twhile (nextId = idsToInsert.pop()) {\n\t\tlet offset = nextId.offset\n\t\tserialized.copyWithin(offset + distanceToMove, offset, lastEnd)\n\t\tdistanceToMove -= 2\n\t\tlet position = offset + distanceToMove\n\t\tserialized[position++] = 0xd8\n\t\tserialized[position++] = 28 // http://cbor.schmorp.de/value-sharing\n\t\tlastEnd = offset\n\t}\n\treturn serialized\n}\nfunction writeBundles(start, encode) {\n\ttargetView.setUint32(bundledStrings.position + start, position - bundledStrings.position - start + 1) // the offset to bundle\n\tlet writeStrings = bundledStrings\n\tbundledStrings = null\n\tencode(writeStrings[0])\n\tencode(writeStrings[1])\n}\n\nexport function addExtension(extension) {\n\tif (extension.Class) {\n\t\tif (!extension.encode)\n\t\t\tthrow new Error('Extension has no encode function')\n\t\textensionClasses.unshift(extension.Class)\n\t\textensions.unshift(extension)\n\t}\n\tdecodeAddExtension(extension)\n}\nlet defaultEncoder = new Encoder({ useRecords: false })\nexport const encode = defaultEncoder.encode\nexport const encodeAsIterable = defaultEncoder.encodeAsIterable\nexport const encodeAsAsyncIterable = defaultEncoder.encodeAsAsyncIterable\nexport { FLOAT32_OPTIONS } from './decode.js'\nimport { FLOAT32_OPTIONS } from './decode.js'\nexport const { NEVER, ALWAYS, DECIMAL_ROUND, DECIMAL_FIT } = FLOAT32_OPTIONS\nexport const REUSE_BUFFER_MODE = 512\nexport const RESET_BUFFER_MODE = 1024\nexport const THROW_ON_ITERABLE = 2048\n\n\n", "export { util, type Util } from \"./util\";\nimport { Peer } from \"./peer\";\nimport { CborPeer } from \"./cborPeer\";\nimport { MsgPackPeer } from \"./msgPackPeer\";\n\nexport type { PeerEvents, PeerOptions } from \"./peer\";\n\nexport type {\n\tPeerJSOption,\n\tPeerConnectOption,\n\tAnswerOption,\n\tCallOption,\n} from \"./optionInterfaces\";\nexport type { UtilSupportsObj } from \"./util\";\nexport type { DataConnection } from \"./dataconnection/DataConnection\";\nexport type { MediaConnection } from \"./mediaconnection\";\nexport type { LogLevel } from \"./logger\";\nexport * from \"./enums\";\n\nexport { BufferedConnection } from \"./dataconnection/BufferedConnection/BufferedConnection\";\nexport { StreamConnection } from \"./dataconnection/StreamConnection/StreamConnection\";\nexport { Cbor } from \"./dataconnection/StreamConnection/Cbor\";\nexport { MsgPack } from \"./dataconnection/StreamConnection/MsgPack\";\nexport type { SerializerMapping } from \"./peer\";\n\nexport { Peer, MsgPackPeer, CborPeer };\n\nexport { PeerError } from \"./peerError\";\nexport default Peer;\n", "import { BinaryPackChunker } from \"./dataconnection/BufferedConnection/binaryPackChunker\";\nimport * as BinaryPack from \"peerjs-js-binarypack\";\nimport { Supports } from \"./supports\";\nimport { validateId } from \"./utils/validateId\";\nimport { randomToken } from \"./utils/randomToken\";\n\nexport interface UtilSupportsObj {\n\t/**\n\t * The current browser.\n\t * This property can be useful in determining whether two peers can connect.\n\t *\n\t * ```ts\n\t * if (util.browser === 'firefox') {\n\t *  // OK to peer with Firefox peers.\n\t * }\n\t * ```\n\t *\n\t * `util.browser` can currently have the values\n\t * `'firefox', 'chrome', 'safari', 'edge', 'Not a supported browser.', 'Not a browser.' (unknown WebRTC-compatible agent).\n\t */\n\tbrowser: boolean;\n\twebRTC: boolean;\n\t/**\n\t * True if the current browser supports media streams and PeerConnection.\n\t */\n\taudioVideo: boolean;\n\t/**\n\t * True if the current browser supports DataChannel and PeerConnection.\n\t */\n\tdata: boolean;\n\tbinaryBlob: boolean;\n\t/**\n\t * True if the current browser supports reliable DataChannels.\n\t */\n\treliable: boolean;\n}\n\nconst DEFAULT_CONFIG = {\n\ticeServers: [\n\t\t{ urls: \"stun:stun.l.google.com:19302\" },\n\t\t{\n\t\t\turls: [\n\t\t\t\t\"turn:eu-0.turn.peerjs.com:3478\",\n\t\t\t\t\"turn:us-0.turn.peerjs.com:3478\",\n\t\t\t],\n\t\t\tusername: \"peerjs\",\n\t\t\tcredential: \"peerjsp\",\n\t\t},\n\t],\n\tsdpSemantics: \"unified-plan\",\n};\n\nexport class Util extends BinaryPackChunker {\n\tnoop(): void {}\n\n\treadonly CLOUD_HOST = \"0.peerjs.com\";\n\treadonly CLOUD_PORT = 443;\n\n\t// Browsers that need chunking:\n\treadonly chunkedBrowsers = { Chrome: 1, chrome: 1 };\n\n\t// Returns browser-agnostic default config\n\treadonly defaultConfig = DEFAULT_CONFIG;\n\n\treadonly browser = Supports.getBrowser();\n\treadonly browserVersion = Supports.getVersion();\n\n\tpack = BinaryPack.pack;\n\tunpack = BinaryPack.unpack;\n\n\t/**\n\t * A hash of WebRTC features mapped to booleans that correspond to whether the feature is supported by the current browser.\n\t *\n\t * :::caution\n\t * Only the properties documented here are guaranteed to be present on `util.supports`\n\t * :::\n\t */\n\treadonly supports = (function () {\n\t\tconst supported: UtilSupportsObj = {\n\t\t\tbrowser: Supports.isBrowserSupported(),\n\t\t\twebRTC: Supports.isWebRTCSupported(),\n\t\t\taudioVideo: false,\n\t\t\tdata: false,\n\t\t\tbinaryBlob: false,\n\t\t\treliable: false,\n\t\t};\n\n\t\tif (!supported.webRTC) return supported;\n\n\t\tlet pc: RTCPeerConnection;\n\n\t\ttry {\n\t\t\tpc = new RTCPeerConnection(DEFAULT_CONFIG);\n\n\t\t\tsupported.audioVideo = true;\n\n\t\t\tlet dc: RTCDataChannel;\n\n\t\t\ttry {\n\t\t\t\tdc = pc.createDataChannel(\"_PEERJSTEST\", { ordered: true });\n\t\t\t\tsupported.data = true;\n\t\t\t\tsupported.reliable = !!dc.ordered;\n\n\t\t\t\t// Binary test\n\t\t\t\ttry {\n\t\t\t\t\tdc.binaryType = \"blob\";\n\t\t\t\t\tsupported.binaryBlob = !Supports.isIOS;\n\t\t\t\t} catch (e) {}\n\t\t\t} catch (e) {\n\t\t\t} finally {\n\t\t\t\tif (dc) {\n\t\t\t\t\tdc.close();\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t} finally {\n\t\t\tif (pc) {\n\t\t\t\tpc.close();\n\t\t\t}\n\t\t}\n\n\t\treturn supported;\n\t})();\n\n\t// Ensure alphanumeric ids\n\tvalidateId = validateId;\n\trandomToken = randomToken;\n\n\tblobToArrayBuffer(\n\t\tblob: Blob,\n\t\tcb: (arg: ArrayBuffer | null) => void,\n\t): FileReader {\n\t\tconst fr = new FileReader();\n\n\t\tfr.onload = function (evt) {\n\t\t\tif (evt.target) {\n\t\t\t\tcb(evt.target.result as ArrayBuffer);\n\t\t\t}\n\t\t};\n\n\t\tfr.readAsArrayBuffer(blob);\n\n\t\treturn fr;\n\t}\n\n\tbinaryStringToArrayBuffer(binary: string): ArrayBuffer | SharedArrayBuffer {\n\t\tconst byteArray = new Uint8Array(binary.length);\n\n\t\tfor (let i = 0; i < binary.length; i++) {\n\t\t\tbyteArray[i] = binary.charCodeAt(i) & 0xff;\n\t\t}\n\n\t\treturn byteArray.buffer;\n\t}\n\tisSecure(): boolean {\n\t\treturn location.protocol === \"https:\";\n\t}\n}\n\n/**\n * Provides a variety of helpful utilities.\n *\n * :::caution\n * Only the utilities documented here are guaranteed to be present on `util`.\n * Undocumented utilities can be removed without warning.\n * We don't consider these to be breaking changes.\n * :::\n */\nexport const util = new Util();\n", "export class BinaryPackChunker {\n\treadonly chunkedMTU = 16300; // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n\t// Binary stuff\n\n\tprivate _dataCount: number = 1;\n\n\tchunk = (\n\t\tblob: ArrayBuffer,\n\t): { __peerData: number; n: number; total: number; data: Uint8Array }[] => {\n\t\tconst chunks = [];\n\t\tconst size = blob.byteLength;\n\t\tconst total = Math.ceil(size / this.chunkedMTU);\n\n\t\tlet index = 0;\n\t\tlet start = 0;\n\n\t\twhile (start < size) {\n\t\t\tconst end = Math.min(size, start + this.chunkedMTU);\n\t\t\tconst b = blob.slice(start, end);\n\n\t\t\tconst chunk = {\n\t\t\t\t__peerData: this._dataCount,\n\t\t\t\tn: index,\n\t\t\t\tdata: b,\n\t\t\t\ttotal,\n\t\t\t};\n\n\t\t\tchunks.push(chunk);\n\n\t\t\tstart = end;\n\t\t\tindex++;\n\t\t}\n\n\t\tthis._dataCount++;\n\n\t\treturn chunks;\n\t};\n}\n\nexport function concatArrayBuffers(bufs: Uint8Array[]) {\n\tlet size = 0;\n\tfor (const buf of bufs) {\n\t\tsize += buf.byteLength;\n\t}\n\tconst result = new Uint8Array(size);\n\tlet offset = 0;\n\tfor (const buf of bufs) {\n\t\tresult.set(buf, offset);\n\t\toffset += buf.byteLength;\n\t}\n\treturn result;\n}\n", "import webRTCAdapter_import from \"webrtc-adapter\";\n\nconst webRTCAdapter: typeof webRTCAdapter_import =\n\t//@ts-ignore\n\twebRTCAdapter_import.default || webRTCAdapter_import;\n\nexport const Supports = new (class {\n\treadonly isIOS = [\"iPad\", \"iPhone\", \"iPod\"].includes(navigator.platform);\n\treadonly supportedBrowsers = [\"firefox\", \"chrome\", \"safari\"];\n\n\treadonly minFirefoxVersion = 59;\n\treadonly minChromeVersion = 72;\n\treadonly minSafariVersion = 605;\n\n\tisWebRTCSupported(): boolean {\n\t\treturn typeof RTCPeerConnection !== \"undefined\";\n\t}\n\n\tisBrowserSupported(): boolean {\n\t\tconst browser = this.getBrowser();\n\t\tconst version = this.getVersion();\n\n\t\tconst validBrowser = this.supportedBrowsers.includes(browser);\n\n\t\tif (!validBrowser) return false;\n\n\t\tif (browser === \"chrome\") return version >= this.minChromeVersion;\n\t\tif (browser === \"firefox\") return version >= this.minFirefoxVersion;\n\t\tif (browser === \"safari\")\n\t\t\treturn !this.isIOS && version >= this.minSafariVersion;\n\n\t\treturn false;\n\t}\n\n\tgetBrowser(): string {\n\t\treturn webRTCAdapter.browserDetails.browser;\n\t}\n\n\tgetVersion(): number {\n\t\treturn webRTCAdapter.browserDetails.version || 0;\n\t}\n\n\tisUnifiedPlanSupported(): boolean {\n\t\tconst browser = this.getBrowser();\n\t\tconst version = webRTCAdapter.browserDetails.version || 0;\n\n\t\tif (browser === \"chrome\" && version < this.minChromeVersion) return false;\n\t\tif (browser === \"firefox\" && version >= this.minFirefoxVersion) return true;\n\t\tif (\n\t\t\t!window.RTCRtpTransceiver ||\n\t\t\t!(\"currentDirection\" in RTCRtpTransceiver.prototype)\n\t\t)\n\t\t\treturn false;\n\n\t\tlet tempPc: RTCPeerConnection;\n\t\tlet supported = false;\n\n\t\ttry {\n\t\t\ttempPc = new RTCPeerConnection();\n\t\t\ttempPc.addTransceiver(\"audio\");\n\t\t\tsupported = true;\n\t\t} catch (e) {\n\t\t} finally {\n\t\t\tif (tempPc) {\n\t\t\t\ttempPc.close();\n\t\t\t}\n\t\t}\n\n\t\treturn supported;\n\t}\n\n\ttoString(): string {\n\t\treturn `Supports:\n    browser:${this.getBrowser()}\n    version:${this.getVersion()}\n    isIOS:${this.isIOS}\n    isWebRTCSupported:${this.isWebRTCSupported()}\n    isBrowserSupported:${this.isBrowserSupported()}\n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`;\n\t}\n})();\n", "export const validateId = (id: string): boolean => {\n\t// Allow empty ids\n\treturn !id || /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id);\n};\n", "export const randomToken = () => Math.random().toString(36).slice(2);\n", "import { util } from \"./util\";\nimport logger, { LogLevel } from \"./logger\";\nimport { Socket } from \"./socket\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport type { DataConnection } from \"./dataconnection/DataConnection\";\nimport {\n\tConnectionType,\n\tPeerErrorType,\n\tServerMessageType,\n\tSocketEventType,\n} from \"./enums\";\nimport type { ServerMessage } from \"./servermessage\";\nimport { API } from \"./api\";\nimport type {\n\tCallOption,\n\tPeerConnectOption,\n\tPeerJSOption,\n} from \"./optionInterfaces\";\nimport { BinaryPack } from \"./dataconnection/BufferedConnection/BinaryPack\";\nimport { Raw } from \"./dataconnection/BufferedConnection/Raw\";\nimport { Json } from \"./dataconnection/BufferedConnection/Json\";\n\nimport { EventEmitterWithError, PeerError } from \"./peerError\";\n\nclass PeerOptions implements PeerJSOption {\n\t/**\n\t * Prints log messages depending on the debug level passed in.\n\t */\n\tdebug?: LogLevel;\n\t/**\n\t * Server host. Defaults to `0.peerjs.com`.\n\t * Also accepts `'/'` to signify relative hostname.\n\t */\n\thost?: string;\n\t/**\n\t * Server port. Defaults to `443`.\n\t */\n\tport?: number;\n\t/**\n\t * The path where your self-hosted PeerServer is running. Defaults to `'/'`\n\t */\n\tpath?: string;\n\t/**\n\t * API key for the PeerServer.\n\t * This is not used anymore.\n\t * @deprecated\n\t */\n\tkey?: string;\n\ttoken?: string;\n\t/**\n\t * Configuration hash passed to RTCPeerConnection.\n\t * This hash contains any custom ICE/TURN server configuration.\n\t *\n\t * Defaults to {@apilink util.defaultConfig}\n\t */\n\tconfig?: any;\n\t/**\n\t * Set to true `true` if you're using TLS.\n\t * :::danger\n\t * If possible *always use TLS*\n\t * :::\n\t */\n\tsecure?: boolean;\n\tpingInterval?: number;\n\treferrerPolicy?: ReferrerPolicy;\n\tlogFunction?: (logLevel: LogLevel, ...rest: any[]) => void;\n\tserializers?: SerializerMapping;\n}\n\nexport { type PeerOptions };\n\nexport interface SerializerMapping {\n\t[key: string]: new (\n\t\tpeerId: string,\n\t\tprovider: Peer,\n\t\toptions: any,\n\t) => DataConnection;\n}\n\nexport interface PeerEvents {\n\t/**\n\t * Emitted when a connection to the PeerServer is established.\n\t *\n\t * You may use the peer before this is emitted, but messages to the server will be queued. <code>id</code> is the brokering ID of the peer (which was either provided in the constructor or assigned by the server).<span class='tip'>You should not wait for this event before connecting to other peers if connection speed is important.</span>\n\t */\n\topen: (id: string) => void;\n\t/**\n\t * Emitted when a new data connection is established from a remote peer.\n\t */\n\tconnection: (dataConnection: DataConnection) => void;\n\t/**\n\t * Emitted when a remote peer attempts to call you.\n\t */\n\tcall: (mediaConnection: MediaConnection) => void;\n\t/**\n\t * Emitted when the peer is destroyed and can no longer accept or create any new connections.\n\t */\n\tclose: () => void;\n\t/**\n\t * Emitted when the peer is disconnected from the signalling server\n\t */\n\tdisconnected: (currentId: string) => void;\n\t/**\n\t * Errors on the peer are almost always fatal and will destroy the peer.\n\t *\n\t * Errors from the underlying socket and PeerConnections are forwarded here.\n\t */\n\terror: (error: PeerError<`${PeerErrorType}`>) => void;\n}\n/**\n * A peer who can initiate connections with other peers.\n */\nexport class Peer extends EventEmitterWithError<PeerErrorType, PeerEvents> {\n\tprivate static readonly DEFAULT_KEY = \"peerjs\";\n\n\tprotected readonly _serializers: SerializerMapping = {\n\t\traw: Raw,\n\t\tjson: Json,\n\t\tbinary: BinaryPack,\n\t\t\"binary-utf8\": BinaryPack,\n\n\t\tdefault: BinaryPack,\n\t};\n\tprivate readonly _options: PeerOptions;\n\tprivate readonly _api: API;\n\tprivate readonly _socket: Socket;\n\n\tprivate _id: string | null = null;\n\tprivate _lastServerId: string | null = null;\n\n\t// States.\n\tprivate _destroyed = false; // Connections have been killed\n\tprivate _disconnected = false; // Connection to PeerServer killed but P2P connections still active\n\tprivate _open = false; // Sockets and such are not yet open.\n\tprivate readonly _connections: Map<\n\t\tstring,\n\t\t(DataConnection | MediaConnection)[]\n\t> = new Map(); // All connections for this peer.\n\tprivate readonly _lostMessages: Map<string, ServerMessage[]> = new Map(); // src => [list of messages]\n\t/**\n\t * The brokering ID of this peer\n\t *\n\t * If no ID was specified in {@apilink Peer | the constructor},\n\t * this will be `undefined` until the {@apilink PeerEvents | `open`} event is emitted.\n\t */\n\tget id() {\n\t\treturn this._id;\n\t}\n\n\tget options() {\n\t\treturn this._options;\n\t}\n\n\tget open() {\n\t\treturn this._open;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tget socket() {\n\t\treturn this._socket;\n\t}\n\n\t/**\n\t * A hash of all connections associated with this peer, keyed by the remote peer's ID.\n\t * @deprecated\n\t * Return type will change from Object to Map<string,[]>\n\t */\n\tget connections(): Object {\n\t\tconst plainConnections = Object.create(null);\n\n\t\tfor (const [k, v] of this._connections) {\n\t\t\tplainConnections[k] = v;\n\t\t}\n\n\t\treturn plainConnections;\n\t}\n\n\t/**\n\t * true if this peer and all of its connections can no longer be used.\n\t */\n\tget destroyed() {\n\t\treturn this._destroyed;\n\t}\n\t/**\n\t * false if there is an active connection to the PeerServer.\n\t */\n\tget disconnected() {\n\t\treturn this._disconnected;\n\t}\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t */\n\tconstructor();\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t * @param options for specifying details about PeerServer\n\t */\n\tconstructor(options: PeerOptions);\n\n\t/**\n\t * A peer can connect to other peers and listen for connections.\n\t * @param id Other peers can connect to this peer using the provided ID.\n\t *     If no ID is given, one will be generated by the brokering server.\n\t * The ID must start and end with an alphanumeric character (lower or upper case character or a digit). In the middle of the ID spaces, dashes (-) and underscores (_) are allowed. Use {@apilink PeerOptions.metadata } to send identifying information.\n\t * @param options for specifying details about PeerServer\n\t */\n\tconstructor(id: string, options?: PeerOptions);\n\n\tconstructor(id?: string | PeerOptions, options?: PeerOptions) {\n\t\tsuper();\n\n\t\tlet userId: string | undefined;\n\n\t\t// Deal with overloading\n\t\tif (id && id.constructor == Object) {\n\t\t\toptions = id as PeerOptions;\n\t\t} else if (id) {\n\t\t\tuserId = id.toString();\n\t\t}\n\n\t\t// Configurize options\n\t\toptions = {\n\t\t\tdebug: 0, // 1: Errors, 2: Warnings, 3: All logs\n\t\t\thost: util.CLOUD_HOST,\n\t\t\tport: util.CLOUD_PORT,\n\t\t\tpath: \"/\",\n\t\t\tkey: Peer.DEFAULT_KEY,\n\t\t\ttoken: util.randomToken(),\n\t\t\tconfig: util.defaultConfig,\n\t\t\treferrerPolicy: \"strict-origin-when-cross-origin\",\n\t\t\tserializers: {},\n\t\t\t...options,\n\t\t};\n\t\tthis._options = options;\n\t\tthis._serializers = { ...this._serializers, ...this.options.serializers };\n\n\t\t// Detect relative URL host.\n\t\tif (this._options.host === \"/\") {\n\t\t\tthis._options.host = window.location.hostname;\n\t\t}\n\n\t\t// Set path correctly.\n\t\tif (this._options.path) {\n\t\t\tif (this._options.path[0] !== \"/\") {\n\t\t\t\tthis._options.path = \"/\" + this._options.path;\n\t\t\t}\n\t\t\tif (this._options.path[this._options.path.length - 1] !== \"/\") {\n\t\t\t\tthis._options.path += \"/\";\n\t\t\t}\n\t\t}\n\n\t\t// Set whether we use SSL to same as current host\n\t\tif (\n\t\t\tthis._options.secure === undefined &&\n\t\t\tthis._options.host !== util.CLOUD_HOST\n\t\t) {\n\t\t\tthis._options.secure = util.isSecure();\n\t\t} else if (this._options.host == util.CLOUD_HOST) {\n\t\t\tthis._options.secure = true;\n\t\t}\n\t\t// Set a custom log function if present\n\t\tif (this._options.logFunction) {\n\t\t\tlogger.setLogFunction(this._options.logFunction);\n\t\t}\n\n\t\tlogger.logLevel = this._options.debug || 0;\n\n\t\tthis._api = new API(options);\n\t\tthis._socket = this._createServerConnection();\n\n\t\t// Sanity checks\n\t\t// Ensure WebRTC supported\n\t\tif (!util.supports.audioVideo && !util.supports.data) {\n\t\t\tthis._delayedAbort(\n\t\t\t\tPeerErrorType.BrowserIncompatible,\n\t\t\t\t\"The current browser does not support WebRTC\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// Ensure alphanumeric id\n\t\tif (!!userId && !util.validateId(userId)) {\n\t\t\tthis._delayedAbort(PeerErrorType.InvalidID, `ID \"${userId}\" is invalid`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId) {\n\t\t\tthis._initialize(userId);\n\t\t} else {\n\t\t\tthis._api\n\t\t\t\t.retrieveId()\n\t\t\t\t.then((id) => this._initialize(id))\n\t\t\t\t.catch((error) => this._abort(PeerErrorType.ServerError, error));\n\t\t}\n\t}\n\n\tprivate _createServerConnection(): Socket {\n\t\tconst socket = new Socket(\n\t\t\tthis._options.secure,\n\t\t\tthis._options.host!,\n\t\t\tthis._options.port!,\n\t\t\tthis._options.path!,\n\t\t\tthis._options.key!,\n\t\t\tthis._options.pingInterval,\n\t\t);\n\n\t\tsocket.on(SocketEventType.Message, (data: ServerMessage) => {\n\t\t\tthis._handleMessage(data);\n\t\t});\n\n\t\tsocket.on(SocketEventType.Error, (error: string) => {\n\t\t\tthis._abort(PeerErrorType.SocketError, error);\n\t\t});\n\n\t\tsocket.on(SocketEventType.Disconnected, () => {\n\t\t\tif (this.disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emitError(PeerErrorType.Network, \"Lost connection to server.\");\n\t\t\tthis.disconnect();\n\t\t});\n\n\t\tsocket.on(SocketEventType.Close, () => {\n\t\t\tif (this.disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._abort(\n\t\t\t\tPeerErrorType.SocketClosed,\n\t\t\t\t\"Underlying socket is already closed.\",\n\t\t\t);\n\t\t});\n\n\t\treturn socket;\n\t}\n\n\t/** Initialize a connection with the server. */\n\tprivate _initialize(id: string): void {\n\t\tthis._id = id;\n\t\tthis.socket.start(id, this._options.token!);\n\t}\n\n\t/** Handles messages from the server. */\n\tprivate _handleMessage(message: ServerMessage): void {\n\t\tconst type = message.type;\n\t\tconst payload = message.payload;\n\t\tconst peerId = message.src;\n\n\t\tswitch (type) {\n\t\t\tcase ServerMessageType.Open: // The connection to the server is open.\n\t\t\t\tthis._lastServerId = this.id;\n\t\t\t\tthis._open = true;\n\t\t\t\tthis.emit(\"open\", this.id);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Error: // Server error.\n\t\t\t\tthis._abort(PeerErrorType.ServerError, payload.msg);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.IdTaken: // The selected ID is taken.\n\t\t\t\tthis._abort(PeerErrorType.UnavailableID, `ID \"${this.id}\" is taken`);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.InvalidKey: // The given API key cannot be found.\n\t\t\t\tthis._abort(\n\t\t\t\t\tPeerErrorType.InvalidKey,\n\t\t\t\t\t`API KEY \"${this._options.key}\" is invalid`,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Leave: // Another peer has closed its connection to this peer.\n\t\t\t\tlogger.log(`Received leave message from ${peerId}`);\n\t\t\t\tthis._cleanupPeer(peerId);\n\t\t\t\tthis._connections.delete(peerId);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Expire: // The offer sent to a peer has expired without response.\n\t\t\t\tthis.emitError(\n\t\t\t\t\tPeerErrorType.PeerUnavailable,\n\t\t\t\t\t`Could not connect to peer ${peerId}`,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Offer: {\n\t\t\t\t// we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n\t\t\t\tconst connectionId = payload.connectionId;\n\t\t\t\tlet connection = this.getConnection(peerId, connectionId);\n\n\t\t\t\tif (connection) {\n\t\t\t\t\tconnection.close();\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t`Offer received for existing Connection ID:${connectionId}`,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Create a new connection.\n\t\t\t\tif (payload.type === ConnectionType.Media) {\n\t\t\t\t\tconst mediaConnection = new MediaConnection(peerId, this, {\n\t\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t\t\t_payload: payload,\n\t\t\t\t\t\tmetadata: payload.metadata,\n\t\t\t\t\t});\n\t\t\t\t\tconnection = mediaConnection;\n\t\t\t\t\tthis._addConnection(peerId, connection);\n\t\t\t\t\tthis.emit(\"call\", mediaConnection);\n\t\t\t\t} else if (payload.type === ConnectionType.Data) {\n\t\t\t\t\tconst dataConnection = new this._serializers[payload.serialization](\n\t\t\t\t\t\tpeerId,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t\t\t\t_payload: payload,\n\t\t\t\t\t\t\tmetadata: payload.metadata,\n\t\t\t\t\t\t\tlabel: payload.label,\n\t\t\t\t\t\t\tserialization: payload.serialization,\n\t\t\t\t\t\t\treliable: payload.reliable,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tconnection = dataConnection;\n\n\t\t\t\t\tthis._addConnection(peerId, connection);\n\t\t\t\t\tthis.emit(\"connection\", dataConnection);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn(`Received malformed connection type:${payload.type}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Find messages.\n\t\t\t\tconst messages = this._getMessages(connectionId);\n\t\t\t\tfor (const message of messages) {\n\t\t\t\t\tconnection.handleMessage(message);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tif (!payload) {\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t`You received a malformed message from ${peerId} of type ${type}`,\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst connectionId = payload.connectionId;\n\t\t\t\tconst connection = this.getConnection(peerId, connectionId);\n\n\t\t\t\tif (connection && connection.peerConnection) {\n\t\t\t\t\t// Pass it on.\n\t\t\t\t\tconnection.handleMessage(message);\n\t\t\t\t} else if (connectionId) {\n\t\t\t\t\t// Store for possible later use\n\t\t\t\t\tthis._storeMessage(connectionId, message);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn(\"You received an unrecognized message:\", message);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/** Stores messages without a set up connection, to be claimed later. */\n\tprivate _storeMessage(connectionId: string, message: ServerMessage): void {\n\t\tif (!this._lostMessages.has(connectionId)) {\n\t\t\tthis._lostMessages.set(connectionId, []);\n\t\t}\n\n\t\tthis._lostMessages.get(connectionId).push(message);\n\t}\n\n\t/**\n\t * Retrieve messages from lost message store\n\t * @internal\n\t */\n\t//TODO Change it to private\n\tpublic _getMessages(connectionId: string): ServerMessage[] {\n\t\tconst messages = this._lostMessages.get(connectionId);\n\n\t\tif (messages) {\n\t\t\tthis._lostMessages.delete(connectionId);\n\t\t\treturn messages;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t/**\n\t * Connects to the remote peer specified by id and returns a data connection.\n\t * @param peer The brokering ID of the remote peer (their {@apilink Peer.id}).\n\t * @param options for specifying details about Peer Connection\n\t */\n\tconnect(peer: string, options: PeerConnectOption = {}): DataConnection {\n\t\toptions = {\n\t\t\tserialization: \"default\",\n\t\t\t...options,\n\t\t};\n\t\tif (this.disconnected) {\n\t\t\tlogger.warn(\n\t\t\t\t\"You cannot connect to a new Peer because you called \" +\n\t\t\t\t\t\".disconnect() on this Peer and ended your connection with the \" +\n\t\t\t\t\t\"server. You can create a new Peer to reconnect, or call reconnect \" +\n\t\t\t\t\t\"on this peer if you believe its ID to still be available.\",\n\t\t\t);\n\t\t\tthis.emitError(\n\t\t\t\tPeerErrorType.Disconnected,\n\t\t\t\t\"Cannot connect to new Peer after disconnecting from server.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataConnection = new this._serializers[options.serialization](\n\t\t\tpeer,\n\t\t\tthis,\n\t\t\toptions,\n\t\t);\n\t\tthis._addConnection(peer, dataConnection);\n\t\treturn dataConnection;\n\t}\n\n\t/**\n\t * Calls the remote peer specified by id and returns a media connection.\n\t * @param peer The brokering ID of the remote peer (their peer.id).\n\t * @param stream The caller's media stream\n\t * @param options Metadata associated with the connection, passed in by whoever initiated the connection.\n\t */\n\tcall(\n\t\tpeer: string,\n\t\tstream: MediaStream,\n\t\toptions: CallOption = {},\n\t): MediaConnection {\n\t\tif (this.disconnected) {\n\t\t\tlogger.warn(\n\t\t\t\t\"You cannot connect to a new Peer because you called \" +\n\t\t\t\t\t\".disconnect() on this Peer and ended your connection with the \" +\n\t\t\t\t\t\"server. You can create a new Peer to reconnect.\",\n\t\t\t);\n\t\t\tthis.emitError(\n\t\t\t\tPeerErrorType.Disconnected,\n\t\t\t\t\"Cannot connect to new Peer after disconnecting from server.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!stream) {\n\t\t\tlogger.error(\n\t\t\t\t\"To call a peer, you must provide a stream from your browser's `getUserMedia`.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst mediaConnection = new MediaConnection(peer, this, {\n\t\t\t...options,\n\t\t\t_stream: stream,\n\t\t});\n\t\tthis._addConnection(peer, mediaConnection);\n\t\treturn mediaConnection;\n\t}\n\n\t/** Add a data/media connection to this peer. */\n\tprivate _addConnection(\n\t\tpeerId: string,\n\t\tconnection: MediaConnection | DataConnection,\n\t): void {\n\t\tlogger.log(\n\t\t\t`add connection ${connection.type}:${connection.connectionId} to peerId:${peerId}`,\n\t\t);\n\n\t\tif (!this._connections.has(peerId)) {\n\t\t\tthis._connections.set(peerId, []);\n\t\t}\n\t\tthis._connections.get(peerId).push(connection);\n\t}\n\n\t//TODO should be private\n\t_removeConnection(connection: DataConnection | MediaConnection): void {\n\t\tconst connections = this._connections.get(connection.peer);\n\n\t\tif (connections) {\n\t\t\tconst index = connections.indexOf(connection);\n\n\t\t\tif (index !== -1) {\n\t\t\t\tconnections.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\t//remove from lost messages\n\t\tthis._lostMessages.delete(connection.connectionId);\n\t}\n\n\t/** Retrieve a data/media connection for this peer. */\n\tgetConnection(\n\t\tpeerId: string,\n\t\tconnectionId: string,\n\t): null | DataConnection | MediaConnection {\n\t\tconst connections = this._connections.get(peerId);\n\t\tif (!connections) {\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (const connection of connections) {\n\t\t\tif (connection.connectionId === connectionId) {\n\t\t\t\treturn connection;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate _delayedAbort(type: PeerErrorType, message: string | Error): void {\n\t\tsetTimeout(() => {\n\t\t\tthis._abort(type, message);\n\t\t}, 0);\n\t}\n\n\t/**\n\t * Emits an error message and destroys the Peer.\n\t * The Peer is not destroyed if it's in a disconnected state, in which case\n\t * it retains its disconnected state and its existing connections.\n\t */\n\tprivate _abort(type: PeerErrorType, message: string | Error): void {\n\t\tlogger.error(\"Aborting!\");\n\n\t\tthis.emitError(type, message);\n\n\t\tif (!this._lastServerId) {\n\t\t\tthis.destroy();\n\t\t} else {\n\t\t\tthis.disconnect();\n\t\t}\n\t}\n\n\t/**\n\t * Destroys the Peer: closes all active connections as well as the connection\n\t * to the server.\n\t *\n\t * :::caution\n\t * This cannot be undone; the respective peer object will no longer be able\n\t * to create or receive any connections, its ID will be forfeited on the server,\n\t * and all of its data and media connections will be closed.\n\t * :::\n\t */\n\tdestroy(): void {\n\t\tif (this.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\tlogger.log(`Destroy peer with ID:${this.id}`);\n\n\t\tthis.disconnect();\n\t\tthis._cleanup();\n\n\t\tthis._destroyed = true;\n\n\t\tthis.emit(\"close\");\n\t}\n\n\t/** Disconnects every connection on this peer. */\n\tprivate _cleanup(): void {\n\t\tfor (const peerId of this._connections.keys()) {\n\t\t\tthis._cleanupPeer(peerId);\n\t\t\tthis._connections.delete(peerId);\n\t\t}\n\n\t\tthis.socket.removeAllListeners();\n\t}\n\n\t/** Closes all connections to this peer. */\n\tprivate _cleanupPeer(peerId: string): void {\n\t\tconst connections = this._connections.get(peerId);\n\n\t\tif (!connections) return;\n\n\t\tfor (const connection of connections) {\n\t\t\tconnection.close();\n\t\t}\n\t}\n\n\t/**\n\t * Disconnects the Peer's connection to the PeerServer. Does not close any\n\t *  active connections.\n\t * Warning: The peer can no longer create or accept connections after being\n\t *  disconnected. It also cannot reconnect to the server.\n\t */\n\tdisconnect(): void {\n\t\tif (this.disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentId = this.id;\n\n\t\tlogger.log(`Disconnect peer with ID:${currentId}`);\n\n\t\tthis._disconnected = true;\n\t\tthis._open = false;\n\n\t\tthis.socket.close();\n\n\t\tthis._lastServerId = currentId;\n\t\tthis._id = null;\n\n\t\tthis.emit(\"disconnected\", currentId);\n\t}\n\n\t/** Attempts to reconnect with the same ID.\n\t *\n\t * Only {@apilink Peer.disconnect | disconnected peers} can be reconnected.\n\t * Destroyed peers cannot be reconnected.\n\t * If the connection fails (as an example, if the peer's old ID is now taken),\n\t * the peer's existing connections will not close, but any associated errors events will fire.\n\t */\n\treconnect(): void {\n\t\tif (this.disconnected && !this.destroyed) {\n\t\t\tlogger.log(\n\t\t\t\t`Attempting reconnection to server with ID ${this._lastServerId}`,\n\t\t\t);\n\t\t\tthis._disconnected = false;\n\t\t\tthis._initialize(this._lastServerId!);\n\t\t} else if (this.destroyed) {\n\t\t\tthrow new Error(\n\t\t\t\t\"This peer cannot reconnect to the server. It has already been destroyed.\",\n\t\t\t);\n\t\t} else if (!this.disconnected && !this.open) {\n\t\t\t// Do nothing. We're still connecting the first time.\n\t\t\tlogger.error(\n\t\t\t\t\"In a hurry? We're still trying to make the initial connection!\",\n\t\t\t);\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Get a list of available peer IDs. If you're running your own server, you'll\n\t * want to set allow_discovery: true in the PeerServer options. If you're using\n\t * the cloud server, email team@peerjs.com to get the functionality enabled for\n\t * your key.\n\t */\n\tlistAllPeers(cb = (_: any[]) => {}): void {\n\t\tthis._api\n\t\t\t.listAllPeers()\n\t\t\t.then((peers) => cb(peers))\n\t\t\t.catch((error) => this._abort(PeerErrorType.ServerError, error));\n\t}\n}\n", "const LOG_PREFIX = \"PeerJS: \";\n\n/*\nPrints log messages depending on the debug level passed in. Defaults to 0.\n0  Prints no logs.\n1  Prints only errors.\n2  Prints errors and warnings.\n3  Prints all logs.\n*/\nexport enum LogLevel {\n\t/**\n\t * Prints no logs.\n\t */\n\tDisabled,\n\t/**\n\t * Prints only errors.\n\t */\n\tErrors,\n\t/**\n\t * Prints errors and warnings.\n\t */\n\tWarnings,\n\t/**\n\t * Prints all logs.\n\t */\n\tAll,\n}\n\nclass Logger {\n\tprivate _logLevel = LogLevel.Disabled;\n\n\tget logLevel(): LogLevel {\n\t\treturn this._logLevel;\n\t}\n\n\tset logLevel(logLevel: LogLevel) {\n\t\tthis._logLevel = logLevel;\n\t}\n\n\tlog(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.All) {\n\t\t\tthis._print(LogLevel.All, ...args);\n\t\t}\n\t}\n\n\twarn(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.Warnings) {\n\t\t\tthis._print(LogLevel.Warnings, ...args);\n\t\t}\n\t}\n\n\terror(...args: any[]) {\n\t\tif (this._logLevel >= LogLevel.Errors) {\n\t\t\tthis._print(LogLevel.Errors, ...args);\n\t\t}\n\t}\n\n\tsetLogFunction(fn: (logLevel: LogLevel, ..._: any[]) => void): void {\n\t\tthis._print = fn;\n\t}\n\n\tprivate _print(logLevel: LogLevel, ...rest: any[]): void {\n\t\tconst copy = [LOG_PREFIX, ...rest];\n\n\t\tfor (const i in copy) {\n\t\t\tif (copy[i] instanceof Error) {\n\t\t\t\tcopy[i] = \"(\" + copy[i].name + \") \" + copy[i].message;\n\t\t\t}\n\t\t}\n\n\t\tif (logLevel >= LogLevel.All) {\n\t\t\tconsole.log(...copy);\n\t\t} else if (logLevel >= LogLevel.Warnings) {\n\t\t\tconsole.warn(\"WARNING\", ...copy);\n\t\t} else if (logLevel >= LogLevel.Errors) {\n\t\t\tconsole.error(\"ERROR\", ...copy);\n\t\t}\n\t}\n}\n\nexport default new Logger();\n", "import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\nimport { ServerMessageType, SocketEventType } from \"./enums\";\nimport { version } from \"../package.json\";\n\n/**\n * An abstraction on top of WebSockets to provide fastest\n * possible connection for peers.\n */\nexport class Socket extends EventEmitter {\n\tprivate _disconnected: boolean = true;\n\tprivate _id?: string;\n\tprivate _messagesQueue: Array<object> = [];\n\tprivate _socket?: WebSocket;\n\tprivate _wsPingTimer?: any;\n\tprivate readonly _baseUrl: string;\n\n\tconstructor(\n\t\tsecure: any,\n\t\thost: string,\n\t\tport: number,\n\t\tpath: string,\n\t\tkey: string,\n\t\tprivate readonly pingInterval: number = 5000,\n\t) {\n\t\tsuper();\n\n\t\tconst wsProtocol = secure ? \"wss://\" : \"ws://\";\n\n\t\tthis._baseUrl = wsProtocol + host + \":\" + port + path + \"peerjs?key=\" + key;\n\t}\n\n\tstart(id: string, token: string): void {\n\t\tthis._id = id;\n\n\t\tconst wsUrl = `${this._baseUrl}&id=${id}&token=${token}`;\n\n\t\tif (!!this._socket || !this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._socket = new WebSocket(wsUrl + \"&version=\" + version);\n\t\tthis._disconnected = false;\n\n\t\tthis._socket.onmessage = (event) => {\n\t\t\tlet data;\n\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(event.data);\n\t\t\t\tlogger.log(\"Server message received:\", data);\n\t\t\t} catch (e) {\n\t\t\t\tlogger.log(\"Invalid server message\", event.data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.emit(SocketEventType.Message, data);\n\t\t};\n\n\t\tthis._socket.onclose = (event) => {\n\t\t\tif (this._disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlogger.log(\"Socket closed.\", event);\n\n\t\t\tthis._cleanup();\n\t\t\tthis._disconnected = true;\n\n\t\t\tthis.emit(SocketEventType.Disconnected);\n\t\t};\n\n\t\t// Take care of the queue of connections if necessary and make sure Peer knows\n\t\t// socket is open.\n\t\tthis._socket.onopen = () => {\n\t\t\tif (this._disconnected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._sendQueuedMessages();\n\n\t\t\tlogger.log(\"Socket open\");\n\n\t\t\tthis._scheduleHeartbeat();\n\t\t};\n\t}\n\n\tprivate _scheduleHeartbeat(): void {\n\t\tthis._wsPingTimer = setTimeout(() => {\n\t\t\tthis._sendHeartbeat();\n\t\t}, this.pingInterval);\n\t}\n\n\tprivate _sendHeartbeat(): void {\n\t\tif (!this._wsOpen()) {\n\t\t\tlogger.log(`Cannot send heartbeat, because socket closed`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = JSON.stringify({ type: ServerMessageType.Heartbeat });\n\n\t\tthis._socket!.send(message);\n\n\t\tthis._scheduleHeartbeat();\n\t}\n\n\t/** Is the websocket currently open? */\n\tprivate _wsOpen(): boolean {\n\t\treturn !!this._socket && this._socket.readyState === 1;\n\t}\n\n\t/** Send queued messages. */\n\tprivate _sendQueuedMessages(): void {\n\t\t//Create copy of queue and clear it,\n\t\t//because send method push the message back to queue if smth will go wrong\n\t\tconst copiedQueue = [...this._messagesQueue];\n\t\tthis._messagesQueue = [];\n\n\t\tfor (const message of copiedQueue) {\n\t\t\tthis.send(message);\n\t\t}\n\t}\n\n\t/** Exposed send for DC & Peer. */\n\tsend(data: any): void {\n\t\tif (this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If we didn't get an ID yet, we can't yet send anything so we should queue\n\t\t// up these messages.\n\t\tif (!this._id) {\n\t\t\tthis._messagesQueue.push(data);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!data.type) {\n\t\t\tthis.emit(SocketEventType.Error, \"Invalid message\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._wsOpen()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = JSON.stringify(data);\n\n\t\tthis._socket!.send(message);\n\t}\n\n\tclose(): void {\n\t\tif (this._disconnected) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cleanup();\n\n\t\tthis._disconnected = true;\n\t}\n\n\tprivate _cleanup(): void {\n\t\tif (this._socket) {\n\t\t\tthis._socket.onopen =\n\t\t\t\tthis._socket.onmessage =\n\t\t\t\tthis._socket.onclose =\n\t\t\t\t\tnull;\n\t\t\tthis._socket.close();\n\t\t\tthis._socket = undefined;\n\t\t}\n\n\t\tclearTimeout(this._wsPingTimer!);\n\t}\n}\n", "'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n", "export enum ConnectionType {\n\tData = \"data\",\n\tMedia = \"media\",\n}\n\nexport enum PeerErrorType {\n\t/**\n\t * The client's browser does not support some or all WebRTC features that you are trying to use.\n\t */\n\tBrowserIncompatible = \"browser-incompatible\",\n\t/**\n\t * You've already disconnected this peer from the server and can no longer make any new connections on it.\n\t */\n\tDisconnected = \"disconnected\",\n\t/**\n\t * The ID passed into the Peer constructor contains illegal characters.\n\t */\n\tInvalidID = \"invalid-id\",\n\t/**\n\t * The API key passed into the Peer constructor contains illegal characters or is not in the system (cloud server only).\n\t */\n\tInvalidKey = \"invalid-key\",\n\t/**\n\t * Lost or cannot establish a connection to the signalling server.\n\t */\n\tNetwork = \"network\",\n\t/**\n\t * The peer you're trying to connect to does not exist.\n\t */\n\tPeerUnavailable = \"peer-unavailable\",\n\t/**\n\t * PeerJS is being used securely, but the cloud server does not support SSL. Use a custom PeerServer.\n\t */\n\tSslUnavailable = \"ssl-unavailable\",\n\t/**\n\t * Unable to reach the server.\n\t */\n\tServerError = \"server-error\",\n\t/**\n\t * An error from the underlying socket.\n\t */\n\tSocketError = \"socket-error\",\n\t/**\n\t * The underlying socket closed unexpectedly.\n\t */\n\tSocketClosed = \"socket-closed\",\n\t/**\n\t * The ID passed into the Peer constructor is already taken.\n\t *\n\t * :::caution\n\t * This error is not fatal if your peer has open peer-to-peer connections.\n\t * This can happen if you attempt to {@apilink Peer.reconnect} a peer that has been disconnected from the server,\n\t * but its old ID has now been taken.\n\t * :::\n\t */\n\tUnavailableID = \"unavailable-id\",\n\t/**\n\t * Native WebRTC errors.\n\t */\n\tWebRTC = \"webrtc\",\n}\n\nexport enum BaseConnectionErrorType {\n\tNegotiationFailed = \"negotiation-failed\",\n\tConnectionClosed = \"connection-closed\",\n}\n\nexport enum DataConnectionErrorType {\n\tNotOpenYet = \"not-open-yet\",\n\tMessageToBig = \"message-too-big\",\n}\n\nexport enum SerializationType {\n\tBinary = \"binary\",\n\tBinaryUTF8 = \"binary-utf8\",\n\tJSON = \"json\",\n\tNone = \"raw\",\n}\n\nexport enum SocketEventType {\n\tMessage = \"message\",\n\tDisconnected = \"disconnected\",\n\tError = \"error\",\n\tClose = \"close\",\n}\n\nexport enum ServerMessageType {\n\tHeartbeat = \"HEARTBEAT\",\n\tCandidate = \"CANDIDATE\",\n\tOffer = \"OFFER\",\n\tAnswer = \"ANSWER\",\n\tOpen = \"OPEN\", // The connection to the server is open.\n\tError = \"ERROR\", // Server error.\n\tIdTaken = \"ID-TAKEN\", // The selected ID is taken.\n\tInvalidKey = \"INVALID-KEY\", // The given API key cannot be found.\n\tLeave = \"LEAVE\", // Another peer has closed its connection to this peer.\n\tExpire = \"EXPIRE\", // The offer sent to a peer has expired without response.\n}\n", "{\n\t\"name\": \"peerjs\",\n\t\"version\": \"1.5.1\",\n\t\"keywords\": [\n\t\t\"peerjs\",\n\t\t\"webrtc\",\n\t\t\"p2p\",\n\t\t\"rtc\"\n\t],\n\t\"description\": \"PeerJS client\",\n\t\"homepage\": \"https://peerjs.com\",\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/peers/peerjs/issues\"\n\t},\n\t\"repository\": {\n\t\t\"type\": \"git\",\n\t\t\"url\": \"https://github.com/peers/peerjs\"\n\t},\n\t\"license\": \"MIT\",\n\t\"contributors\": [\n\t\t\"Michelle Bu <michelle@michellebu.com>\",\n\t\t\"afrokick <devbyru@gmail.com>\",\n\t\t\"ericz <really.ez@gmail.com>\",\n\t\t\"Jairo <kidandcat@gmail.com>\",\n\t\t\"Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>\",\n\t\t\"Jairo Caro-Accino Viciana <jairo@galax.be>\",\n\t\t\"Carlos Caballero <carlos.caballero.gonzalez@gmail.com>\",\n\t\t\"hc <hheennrryy@gmail.com>\",\n\t\t\"Muhammad Asif <capripio@gmail.com>\",\n\t\t\"PrashoonB <prashoonbhattacharjee@gmail.com>\",\n\t\t\"Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>\",\n\t\t\"akotynski <aleksanderkotbury@gmail.com>\",\n\t\t\"lmb <i@lmb.io>\",\n\t\t\"Jairooo <jairocaro@msn.com>\",\n\t\t\"Moritz Stückler <moritz.stueckler@gmail.com>\",\n\t\t\"Simon <crydotsnakegithub@gmail.com>\",\n\t\t\"Denis Lukov <denismassters@gmail.com>\",\n\t\t\"Philipp Hancke <fippo@andyet.net>\",\n\t\t\"Hans Oksendahl <hansoksendahl@gmail.com>\",\n\t\t\"Jess <jessachandler@gmail.com>\",\n\t\t\"khankuan <khankuan@gmail.com>\",\n\t\t\"DUODVK <kurmanov.work@gmail.com>\",\n\t\t\"XiZhao <kwang1imsa@gmail.com>\",\n\t\t\"Matthias Lohr <matthias@lohr.me>\",\n\t\t\"=frank tree <=frnktrb@googlemail.com>\",\n\t\t\"Andre Eckardt <aeckardt@outlook.com>\",\n\t\t\"Chris Cowan <agentme49@gmail.com>\",\n\t\t\"Alex Chuev <alex@chuev.com>\",\n\t\t\"alxnull <alxnull@e.mail.de>\",\n\t\t\"Yemel Jardi <angel.jardi@gmail.com>\",\n\t\t\"Ben Parnell <benjaminparnell.94@gmail.com>\",\n\t\t\"Benny Lichtner <bennlich@gmail.com>\",\n\t\t\"fresheneesz <bitetrudpublic@gmail.com>\",\n\t\t\"bob.barstead@exaptive.com <bob.barstead@exaptive.com>\",\n\t\t\"chandika <chandika@gmail.com>\",\n\t\t\"emersion <contact@emersion.fr>\",\n\t\t\"Christopher Van <cvan@users.noreply.github.com>\",\n\t\t\"eddieherm <edhermoso@gmail.com>\",\n\t\t\"Eduardo Pinho <enet4mikeenet@gmail.com>\",\n\t\t\"Evandro Zanatta <ezanatta@tray.net.br>\",\n\t\t\"Gardner Bickford <gardner@users.noreply.github.com>\",\n\t\t\"Gian Luca <gianluca.cecchi@cynny.com>\",\n\t\t\"PatrickJS <github@gdi2290.com>\",\n\t\t\"jonnyf <github@jonathanfoss.co.uk>\",\n\t\t\"Hizkia Felix <hizkifw@gmail.com>\",\n\t\t\"Hristo Oskov <hristo.oskov@gmail.com>\",\n\t\t\"Isaac Madwed <i.madwed@gmail.com>\",\n\t\t\"Ilya Konanykhin <ilya.konanykhin@gmail.com>\",\n\t\t\"jasonbarry <jasbarry@me.com>\",\n\t\t\"Jonathan Burke <jonathan.burke.1311@googlemail.com>\",\n\t\t\"Josh Hamit <josh.hamit@gmail.com>\",\n\t\t\"Jordan Austin <jrax86@gmail.com>\",\n\t\t\"Joel Wetzell <jwetzell@yahoo.com>\",\n\t\t\"xizhao <kevin.wang@cloudera.com>\",\n\t\t\"Alberto Torres <kungfoobar@gmail.com>\",\n\t\t\"Jonathan Mayol <mayoljonathan@gmail.com>\",\n\t\t\"Jefferson Felix <me@jsfelix.dev>\",\n\t\t\"Rolf Erik Lekang <me@rolflekang.com>\",\n\t\t\"Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>\",\n\t\t\"Pepijn de Vos <pepijndevos@gmail.com>\",\n\t\t\"JooYoung <qkdlql@naver.com>\",\n\t\t\"Tobias Speicher <rootcommander@gmail.com>\",\n\t\t\"Steve Blaurock <sblaurock@gmail.com>\",\n\t\t\"Kyrylo Shegeda <shegeda@ualberta.ca>\",\n\t\t\"Diwank Singh Tomer <singh@diwank.name>\",\n\t\t\"Sören Balko <Soeren.Balko@gmail.com>\",\n\t\t\"Arpit Solanki <solankiarpit1997@gmail.com>\",\n\t\t\"Yuki Ito <yuki@gnnk.net>\",\n\t\t\"Artur Zayats <zag2art@gmail.com>\"\n\t],\n\t\"funding\": {\n\t\t\"type\": \"opencollective\",\n\t\t\"url\": \"https://opencollective.com/peer\"\n\t},\n\t\"collective\": {\n\t\t\"type\": \"opencollective\",\n\t\t\"url\": \"https://opencollective.com/peer\"\n\t},\n\t\"files\": [\n\t\t\"dist/*\"\n\t],\n\t\"sideEffects\": [\n\t\t\"lib/global.ts\",\n\t\t\"lib/supports.ts\"\n\t],\n\t\"main\": \"dist/bundler.cjs\",\n\t\"module\": \"dist/bundler.mjs\",\n\t\"browser-minified\": \"dist/peerjs.min.js\",\n\t\"browser-unminified\": \"dist/peerjs.js\",\n\t\"browser-minified-cbor\": \"dist/serializer.cbor.mjs\",\n\t\"browser-minified-msgpack\": \"dist/serializer.msgpack.mjs\",\n\t\"types\": \"dist/types.d.ts\",\n\t\"engines\": {\n\t\t\"node\": \">= 14\"\n\t},\n\t\"targets\": {\n\t\t\"types\": {\n\t\t\t\"source\": \"lib/exports.ts\"\n\t\t},\n\t\t\"main\": {\n\t\t\t\"source\": \"lib/exports.ts\",\n\t\t\t\"sourceMap\": {\n\t\t\t\t\"inlineSources\": true\n\t\t\t}\n\t\t},\n\t\t\"module\": {\n\t\t\t\"source\": \"lib/exports.ts\",\n\t\t\t\"includeNodeModules\": [\n\t\t\t\t\"eventemitter3\"\n\t\t\t],\n\t\t\t\"sourceMap\": {\n\t\t\t\t\"inlineSources\": true\n\t\t\t}\n\t\t},\n\t\t\"browser-minified\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"global\",\n\t\t\t\"optimize\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/global.ts\"\n\t\t},\n\t\t\"browser-unminified\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"global\",\n\t\t\t\"optimize\": false,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/global.ts\"\n\t\t},\n\t\t\"browser-minified-cbor\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"esmodule\",\n\t\t\t\"isLibrary\": true,\n\t\t\t\"optimize\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/dataconnection/StreamConnection/Cbor.ts\"\n\t\t},\n\t\t\"browser-minified-msgpack\": {\n\t\t\t\"context\": \"browser\",\n\t\t\t\"outputFormat\": \"esmodule\",\n\t\t\t\"isLibrary\": true,\n\t\t\t\"optimize\": true,\n\t\t\t\"engines\": {\n\t\t\t\t\"browsers\": \"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15\"\n\t\t\t},\n\t\t\t\"source\": \"lib/dataconnection/StreamConnection/MsgPack.ts\"\n\t\t}\n\t},\n\t\"scripts\": {\n\t\t\"contributors\": \"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\\"chore(contributors): update and sort contributors list\\\"\",\n\t\t\"check\": \"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit\",\n\t\t\"watch\": \"parcel watch\",\n\t\t\"build\": \"rm -rf dist && parcel build\",\n\t\t\"prepublishOnly\": \"npm run build\",\n\t\t\"test\": \"jest\",\n\t\t\"test:watch\": \"jest --watch\",\n\t\t\"coverage\": \"jest --coverage --collectCoverageFrom=\\\"./lib/**\\\"\",\n\t\t\"format\": \"prettier --write .\",\n\t\t\"format:check\": \"prettier --check .\",\n\t\t\"semantic-release\": \"semantic-release\",\n\t\t\"e2e\": \"wdio run e2e/wdio.local.conf.ts\",\n\t\t\"e2e:bstack\": \"wdio run e2e/wdio.bstack.conf.ts\"\n\t},\n\t\"devDependencies\": {\n\t\t\"@parcel/config-default\": \"^2.9.3\",\n\t\t\"@parcel/packager-ts\": \"^2.9.3\",\n\t\t\"@parcel/transformer-typescript-tsc\": \"^2.9.3\",\n\t\t\"@parcel/transformer-typescript-types\": \"^2.9.3\",\n\t\t\"@semantic-release/changelog\": \"^6.0.1\",\n\t\t\"@semantic-release/git\": \"^10.0.1\",\n\t\t\"@swc/core\": \"^1.3.27\",\n\t\t\"@swc/jest\": \"^0.2.24\",\n\t\t\"@types/jasmine\": \"^4.3.4\",\n\t\t\"@wdio/browserstack-service\": \"^8.11.2\",\n\t\t\"@wdio/cli\": \"^8.11.2\",\n\t\t\"@wdio/globals\": \"^8.11.2\",\n\t\t\"@wdio/jasmine-framework\": \"^8.11.2\",\n\t\t\"@wdio/local-runner\": \"^8.11.2\",\n\t\t\"@wdio/spec-reporter\": \"^8.11.2\",\n\t\t\"@wdio/types\": \"^8.10.4\",\n\t\t\"http-server\": \"^14.1.1\",\n\t\t\"jest\": \"^29.3.1\",\n\t\t\"jest-environment-jsdom\": \"^29.3.1\",\n\t\t\"mock-socket\": \"^9.0.0\",\n\t\t\"parcel\": \"^2.9.3\",\n\t\t\"prettier\": \"^3.0.0\",\n\t\t\"semantic-release\": \"^21.0.0\",\n\t\t\"ts-node\": \"^10.9.1\",\n\t\t\"typescript\": \"^5.0.0\",\n\t\t\"wdio-geckodriver-service\": \"^5.0.1\"\n\t},\n\t\"dependencies\": {\n\t\t\"@msgpack/msgpack\": \"^2.8.0\",\n\t\t\"cbor-x\": \"^1.5.3\",\n\t\t\"eventemitter3\": \"^4.0.7\",\n\t\t\"peerjs-js-binarypack\": \"^2.0.0\",\n\t\t\"webrtc-adapter\": \"^8.0.0\"\n\t},\n\t\"alias\": {\n\t\t\"process\": false,\n\t\t\"buffer\": false\n\t}\n}\n", "import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport { ConnectionType, ServerMessageType } from \"./enums\";\nimport type { Peer } from \"./peer\";\nimport { BaseConnection, type BaseConnectionEvents } from \"./baseconnection\";\nimport type { ServerMessage } from \"./servermessage\";\nimport type { AnswerOption } from \"./optionInterfaces\";\n\nexport interface MediaConnectionEvents extends BaseConnectionEvents<never> {\n\t/**\n\t * Emitted when a connection to the PeerServer is established.\n\t *\n\t * ```ts\n\t * mediaConnection.on('stream', (stream) => { ... });\n\t * ```\n\t */\n\tstream: (stream: MediaStream) => void;\n\t/**\n\t * Emitted when the auxiliary data channel is established.\n\t * After this event, hanging up will close the connection cleanly on the remote peer.\n\t * @beta\n\t */\n\twillCloseOnRemote: () => void;\n}\n\n/**\n * Wraps WebRTC's media streams.\n * To get one, use {@apilink Peer.call} or listen for the {@apilink PeerEvents | `call`} event.\n */\nexport class MediaConnection extends BaseConnection<MediaConnectionEvents> {\n\tprivate static readonly ID_PREFIX = \"mc_\";\n\treadonly label: string;\n\n\tprivate _negotiator: Negotiator<MediaConnectionEvents, this>;\n\tprivate _localStream: MediaStream;\n\tprivate _remoteStream: MediaStream;\n\n\t/**\n\t * For media connections, this is always 'media'.\n\t */\n\tget type() {\n\t\treturn ConnectionType.Media;\n\t}\n\n\tget localStream(): MediaStream {\n\t\treturn this._localStream;\n\t}\n\n\tget remoteStream(): MediaStream {\n\t\treturn this._remoteStream;\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\n\t\tthis._localStream = this.options._stream;\n\t\tthis.connectionId =\n\t\t\tthis.options.connectionId ||\n\t\t\tMediaConnection.ID_PREFIX + util.randomToken();\n\n\t\tthis._negotiator = new Negotiator(this);\n\n\t\tif (this._localStream) {\n\t\t\tthis._negotiator.startConnection({\n\t\t\t\t_stream: this._localStream,\n\t\t\t\toriginator: true,\n\t\t\t});\n\t\t}\n\t}\n\n\t/** Called by the Negotiator when the DataChannel is ready. */\n\toverride _initializeDataChannel(dc: RTCDataChannel): void {\n\t\tthis.dataChannel = dc;\n\n\t\tthis.dataChannel.onopen = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc connection success`);\n\t\t\tthis.emit(\"willCloseOnRemote\");\n\t\t};\n\n\t\tthis.dataChannel.onclose = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc closed for:`, this.peer);\n\t\t\tthis.close();\n\t\t};\n\t}\n\taddStream(remoteStream) {\n\t\tlogger.log(\"Receiving stream\", remoteStream);\n\n\t\tthis._remoteStream = remoteStream;\n\t\tsuper.emit(\"stream\", remoteStream); // Should we call this `open`?\n\t}\n\n\t/**\n\t * @internal\n\t */\n\thandleMessage(message: ServerMessage): void {\n\t\tconst type = message.type;\n\t\tconst payload = message.payload;\n\n\t\tswitch (message.type) {\n\t\t\tcase ServerMessageType.Answer:\n\t\t\t\t// Forward to negotiator\n\t\t\t\tvoid this._negotiator.handleSDP(type, payload.sdp);\n\t\t\t\tthis._open = true;\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Candidate:\n\t\t\t\tvoid this._negotiator.handleCandidate(payload.candidate);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.warn(`Unrecognized message type:${type} from peer:${this.peer}`);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n     * When receiving a {@apilink PeerEvents | `call`} event on a peer, you can call\n     * `answer` on the media connection provided by the callback to accept the call\n     * and optionally send your own media stream.\n\n     *\n     * @param stream A WebRTC media stream.\n     * @param options\n     * @returns\n     */\n\tanswer(stream?: MediaStream, options: AnswerOption = {}): void {\n\t\tif (this._localStream) {\n\t\t\tlogger.warn(\n\t\t\t\t\"Local stream already exists on this MediaConnection. Are you answering a call twice?\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._localStream = stream;\n\n\t\tif (options && options.sdpTransform) {\n\t\t\tthis.options.sdpTransform = options.sdpTransform;\n\t\t}\n\n\t\tthis._negotiator.startConnection({\n\t\t\t...this.options._payload,\n\t\t\t_stream: stream,\n\t\t});\n\t\t// Retrieve lost messages stored because PeerConnection not set up.\n\t\tconst messages = this.provider._getMessages(this.connectionId);\n\n\t\tfor (const message of messages) {\n\t\t\tthis.handleMessage(message);\n\t\t}\n\n\t\tthis._open = true;\n\t}\n\n\t/**\n\t * Exposed functionality for users.\n\t */\n\n\t/**\n\t * Closes the media connection.\n\t */\n\tclose(): void {\n\t\tif (this._negotiator) {\n\t\t\tthis._negotiator.cleanup();\n\t\t\tthis._negotiator = null;\n\t\t}\n\n\t\tthis._localStream = null;\n\t\tthis._remoteStream = null;\n\n\t\tif (this.provider) {\n\t\t\tthis.provider._removeConnection(this);\n\n\t\t\tthis.provider = null;\n\t\t}\n\n\t\tif (this.options && this.options._stream) {\n\t\t\tthis.options._stream = null;\n\t\t}\n\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._open = false;\n\n\t\tsuper.emit(\"close\");\n\t}\n}\n", "import logger from \"./logger\";\nimport type { MediaConnection } from \"./mediaconnection\";\nimport type { DataConnection } from \"./dataconnection/DataConnection\";\nimport {\n\tBaseConnectionErrorType,\n\tConnectionType,\n\tPeerErrorType,\n\tServerMessageType,\n} from \"./enums\";\nimport type { BaseConnection, BaseConnectionEvents } from \"./baseconnection\";\nimport type { ValidEventTypes } from \"eventemitter3\";\n\n/**\n * Manages all negotiations between Peers.\n */\nexport class Negotiator<\n\tEvents extends ValidEventTypes,\n\tConnectionType extends BaseConnection<Events | BaseConnectionEvents>,\n> {\n\tconstructor(readonly connection: ConnectionType) {}\n\n\t/** Returns a PeerConnection object set up correctly (for data, media). */\n\tstartConnection(options: any) {\n\t\tconst peerConnection = this._startPeerConnection();\n\n\t\t// Set the connection's PC.\n\t\tthis.connection.peerConnection = peerConnection;\n\n\t\tif (this.connection.type === ConnectionType.Media && options._stream) {\n\t\t\tthis._addTracksToConnection(options._stream, peerConnection);\n\t\t}\n\n\t\t// What do we need to do now?\n\t\tif (options.originator) {\n\t\t\tconst dataConnection = this.connection;\n\n\t\t\tconst config: RTCDataChannelInit = { ordered: !!options.reliable };\n\n\t\t\tconst dataChannel = peerConnection.createDataChannel(\n\t\t\t\tdataConnection.label,\n\t\t\t\tconfig,\n\t\t\t);\n\t\t\tdataConnection._initializeDataChannel(dataChannel);\n\n\t\t\tvoid this._makeOffer();\n\t\t} else {\n\t\t\tvoid this.handleSDP(\"OFFER\", options.sdp);\n\t\t}\n\t}\n\n\t/** Start a PC. */\n\tprivate _startPeerConnection(): RTCPeerConnection {\n\t\tlogger.log(\"Creating RTCPeerConnection.\");\n\n\t\tconst peerConnection = new RTCPeerConnection(\n\t\t\tthis.connection.provider.options.config,\n\t\t);\n\n\t\tthis._setupListeners(peerConnection);\n\n\t\treturn peerConnection;\n\t}\n\n\t/** Set up various WebRTC listeners. */\n\tprivate _setupListeners(peerConnection: RTCPeerConnection) {\n\t\tconst peerId = this.connection.peer;\n\t\tconst connectionId = this.connection.connectionId;\n\t\tconst connectionType = this.connection.type;\n\t\tconst provider = this.connection.provider;\n\n\t\t// ICE CANDIDATES.\n\t\tlogger.log(\"Listening for ICE candidates.\");\n\n\t\tpeerConnection.onicecandidate = (evt) => {\n\t\t\tif (!evt.candidate || !evt.candidate.candidate) return;\n\n\t\t\tlogger.log(`Received ICE candidates for ${peerId}:`, evt.candidate);\n\n\t\t\tprovider.socket.send({\n\t\t\t\ttype: ServerMessageType.Candidate,\n\t\t\t\tpayload: {\n\t\t\t\t\tcandidate: evt.candidate,\n\t\t\t\t\ttype: connectionType,\n\t\t\t\t\tconnectionId: connectionId,\n\t\t\t\t},\n\t\t\t\tdst: peerId,\n\t\t\t});\n\t\t};\n\n\t\tpeerConnection.oniceconnectionstatechange = () => {\n\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\tcase \"failed\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState is failed, closing connections to \" + peerId,\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.emitError(\n\t\t\t\t\t\tBaseConnectionErrorType.NegotiationFailed,\n\t\t\t\t\t\t\"Negotiation of connection to \" + peerId + \" failed.\",\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.close();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"closed\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState is closed, closing connections to \" + peerId,\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.emitError(\n\t\t\t\t\t\tBaseConnectionErrorType.ConnectionClosed,\n\t\t\t\t\t\t\"Connection to \" + peerId + \" closed.\",\n\t\t\t\t\t);\n\t\t\t\t\tthis.connection.close();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"disconnected\":\n\t\t\t\t\tlogger.log(\n\t\t\t\t\t\t\"iceConnectionState changed to disconnected on the connection with \" +\n\t\t\t\t\t\t\tpeerId,\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"completed\":\n\t\t\t\t\tpeerConnection.onicecandidate = () => {};\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.connection.emit(\n\t\t\t\t\"iceStateChanged\",\n\t\t\t\tpeerConnection.iceConnectionState,\n\t\t\t);\n\t\t};\n\n\t\t// DATACONNECTION.\n\t\tlogger.log(\"Listening for data channel\");\n\t\t// Fired between offer and answer, so options should already be saved\n\t\t// in the options hash.\n\t\tpeerConnection.ondatachannel = (evt) => {\n\t\t\tlogger.log(\"Received data channel\");\n\n\t\t\tconst dataChannel = evt.channel;\n\t\t\tconst connection = <DataConnection>(\n\t\t\t\tprovider.getConnection(peerId, connectionId)\n\t\t\t);\n\n\t\t\tconnection._initializeDataChannel(dataChannel);\n\t\t};\n\n\t\t// MEDIACONNECTION.\n\t\tlogger.log(\"Listening for remote stream\");\n\n\t\tpeerConnection.ontrack = (evt) => {\n\t\t\tlogger.log(\"Received remote stream\");\n\n\t\t\tconst stream = evt.streams[0];\n\t\t\tconst connection = provider.getConnection(peerId, connectionId);\n\n\t\t\tif (connection.type === ConnectionType.Media) {\n\t\t\t\tconst mediaConnection = <MediaConnection>connection;\n\n\t\t\t\tthis._addStreamToMediaConnection(stream, mediaConnection);\n\t\t\t}\n\t\t};\n\t}\n\n\tcleanup(): void {\n\t\tlogger.log(\"Cleaning up PeerConnection to \" + this.connection.peer);\n\n\t\tconst peerConnection = this.connection.peerConnection;\n\n\t\tif (!peerConnection) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.connection.peerConnection = null;\n\n\t\t//unsubscribe from all PeerConnection's events\n\t\tpeerConnection.onicecandidate =\n\t\t\tpeerConnection.oniceconnectionstatechange =\n\t\t\tpeerConnection.ondatachannel =\n\t\t\tpeerConnection.ontrack =\n\t\t\t\t() => {};\n\n\t\tconst peerConnectionNotClosed = peerConnection.signalingState !== \"closed\";\n\t\tlet dataChannelNotClosed = false;\n\n\t\tconst dataChannel = this.connection.dataChannel;\n\n\t\tif (dataChannel) {\n\t\t\tdataChannelNotClosed =\n\t\t\t\t!!dataChannel.readyState && dataChannel.readyState !== \"closed\";\n\t\t}\n\n\t\tif (peerConnectionNotClosed || dataChannelNotClosed) {\n\t\t\tpeerConnection.close();\n\t\t}\n\t}\n\n\tprivate async _makeOffer(): Promise<void> {\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\ttry {\n\t\t\tconst offer = await peerConnection.createOffer(\n\t\t\t\tthis.connection.options.constraints,\n\t\t\t);\n\n\t\t\tlogger.log(\"Created offer.\");\n\n\t\t\tif (\n\t\t\t\tthis.connection.options.sdpTransform &&\n\t\t\t\ttypeof this.connection.options.sdpTransform === \"function\"\n\t\t\t) {\n\t\t\t\toffer.sdp =\n\t\t\t\t\tthis.connection.options.sdpTransform(offer.sdp) || offer.sdp;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait peerConnection.setLocalDescription(offer);\n\n\t\t\t\tlogger.log(\n\t\t\t\t\t\"Set localDescription:\",\n\t\t\t\t\toffer,\n\t\t\t\t\t`for:${this.connection.peer}`,\n\t\t\t\t);\n\n\t\t\t\tlet payload: any = {\n\t\t\t\t\tsdp: offer,\n\t\t\t\t\ttype: this.connection.type,\n\t\t\t\t\tconnectionId: this.connection.connectionId,\n\t\t\t\t\tmetadata: this.connection.metadata,\n\t\t\t\t};\n\n\t\t\t\tif (this.connection.type === ConnectionType.Data) {\n\t\t\t\t\tconst dataConnection = <DataConnection>(<unknown>this.connection);\n\n\t\t\t\t\tpayload = {\n\t\t\t\t\t\t...payload,\n\t\t\t\t\t\tlabel: dataConnection.label,\n\t\t\t\t\t\treliable: dataConnection.reliable,\n\t\t\t\t\t\tserialization: dataConnection.serialization,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tprovider.socket.send({\n\t\t\t\t\ttype: ServerMessageType.Offer,\n\t\t\t\t\tpayload,\n\t\t\t\t\tdst: this.connection.peer,\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\t// TODO: investigate why _makeOffer is being called from the answer\n\t\t\t\tif (\n\t\t\t\t\terr !=\n\t\t\t\t\t\"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer\"\n\t\t\t\t) {\n\t\t\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\t\t\tlogger.log(\"Failed to setLocalDescription, \", err);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (err_1) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err_1);\n\t\t\tlogger.log(\"Failed to createOffer, \", err_1);\n\t\t}\n\t}\n\n\tprivate async _makeAnswer(): Promise<void> {\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\ttry {\n\t\t\tconst answer = await peerConnection.createAnswer();\n\t\t\tlogger.log(\"Created answer.\");\n\n\t\t\tif (\n\t\t\t\tthis.connection.options.sdpTransform &&\n\t\t\t\ttypeof this.connection.options.sdpTransform === \"function\"\n\t\t\t) {\n\t\t\t\tanswer.sdp =\n\t\t\t\t\tthis.connection.options.sdpTransform(answer.sdp) || answer.sdp;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait peerConnection.setLocalDescription(answer);\n\n\t\t\t\tlogger.log(\n\t\t\t\t\t`Set localDescription:`,\n\t\t\t\t\tanswer,\n\t\t\t\t\t`for:${this.connection.peer}`,\n\t\t\t\t);\n\n\t\t\t\tprovider.socket.send({\n\t\t\t\t\ttype: ServerMessageType.Answer,\n\t\t\t\t\tpayload: {\n\t\t\t\t\t\tsdp: answer,\n\t\t\t\t\t\ttype: this.connection.type,\n\t\t\t\t\t\tconnectionId: this.connection.connectionId,\n\t\t\t\t\t},\n\t\t\t\t\tdst: this.connection.peer,\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\t\tlogger.log(\"Failed to setLocalDescription, \", err);\n\t\t\t}\n\t\t} catch (err_1) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err_1);\n\t\t\tlogger.log(\"Failed to create answer, \", err_1);\n\t\t}\n\t}\n\n\t/** Handle an SDP. */\n\tasync handleSDP(type: string, sdp: any): Promise<void> {\n\t\tsdp = new RTCSessionDescription(sdp);\n\t\tconst peerConnection = this.connection.peerConnection;\n\t\tconst provider = this.connection.provider;\n\n\t\tlogger.log(\"Setting remote description\", sdp);\n\n\t\tconst self = this;\n\n\t\ttry {\n\t\t\tawait peerConnection.setRemoteDescription(sdp);\n\t\t\tlogger.log(`Set remoteDescription:${type} for:${this.connection.peer}`);\n\t\t\tif (type === \"OFFER\") {\n\t\t\t\tawait self._makeAnswer();\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tprovider.emitError(PeerErrorType.WebRTC, err);\n\t\t\tlogger.log(\"Failed to setRemoteDescription, \", err);\n\t\t}\n\t}\n\n\t/** Handle a candidate. */\n\tasync handleCandidate(ice: RTCIceCandidate) {\n\t\tlogger.log(`handleCandidate:`, ice);\n\n\t\ttry {\n\t\t\tawait this.connection.peerConnection.addIceCandidate(ice);\n\t\t\tlogger.log(`Added ICE candidate for:${this.connection.peer}`);\n\t\t} catch (err) {\n\t\t\tthis.connection.provider.emitError(PeerErrorType.WebRTC, err);\n\t\t\tlogger.log(\"Failed to handleCandidate, \", err);\n\t\t}\n\t}\n\n\tprivate _addTracksToConnection(\n\t\tstream: MediaStream,\n\t\tpeerConnection: RTCPeerConnection,\n\t): void {\n\t\tlogger.log(`add tracks from stream ${stream.id} to peer connection`);\n\n\t\tif (!peerConnection.addTrack) {\n\t\t\treturn logger.error(\n\t\t\t\t`Your browser does't support RTCPeerConnection#addTrack. Ignored.`,\n\t\t\t);\n\t\t}\n\n\t\tstream.getTracks().forEach((track) => {\n\t\t\tpeerConnection.addTrack(track, stream);\n\t\t});\n\t}\n\n\tprivate _addStreamToMediaConnection(\n\t\tstream: MediaStream,\n\t\tmediaConnection: MediaConnection,\n\t): void {\n\t\tlogger.log(\n\t\t\t`add stream ${stream.id} to media connection ${mediaConnection.connectionId}`,\n\t\t);\n\n\t\tmediaConnection.addStream(stream);\n\t}\n}\n", "import type { Peer } from \"./peer\";\nimport type { ServerMessage } from \"./servermessage\";\nimport type { ConnectionType } from \"./enums\";\nimport { BaseConnectionErrorType } from \"./enums\";\nimport {\n\tEventEmitterWithError,\n\ttype EventsWithError,\n\tPeerError,\n} from \"./peerError\";\nimport type { ValidEventTypes } from \"eventemitter3\";\n\nexport interface BaseConnectionEvents<\n\tErrorType extends string = BaseConnectionErrorType,\n> extends EventsWithError<ErrorType> {\n\t/**\n\t * Emitted when either you or the remote peer closes the connection.\n\t *\n\t * ```ts\n\t * connection.on('close', () => { ... });\n\t * ```\n\t */\n\tclose: () => void;\n\t/**\n\t * ```ts\n\t * connection.on('error', (error) => { ... });\n\t * ```\n\t */\n\terror: (error: PeerError<`${ErrorType}`>) => void;\n\ticeStateChanged: (state: RTCIceConnectionState) => void;\n}\n\nexport abstract class BaseConnection<\n\tSubClassEvents extends ValidEventTypes,\n\tErrorType extends string = never,\n> extends EventEmitterWithError<\n\tErrorType | BaseConnectionErrorType,\n\tSubClassEvents & BaseConnectionEvents<BaseConnectionErrorType | ErrorType>\n> {\n\tprotected _open = false;\n\n\t/**\n\t * Any type of metadata associated with the connection,\n\t * passed in by whoever initiated the connection.\n\t */\n\treadonly metadata: any;\n\tconnectionId: string;\n\n\tpeerConnection: RTCPeerConnection;\n\tdataChannel: RTCDataChannel;\n\n\tabstract get type(): ConnectionType;\n\n\t/**\n\t * The optional label passed in or assigned by PeerJS when the connection was initiated.\n\t */\n\tlabel: string;\n\n\t/**\n\t * Whether the media connection is active (e.g. your call has been answered).\n\t * You can check this if you want to set a maximum wait time for a one-sided call.\n\t */\n\tget open() {\n\t\treturn this._open;\n\t}\n\n\tprotected constructor(\n\t\t/**\n\t\t * The ID of the peer on the other end of this connection.\n\t\t */\n\t\treadonly peer: string,\n\t\tpublic provider: Peer,\n\t\treadonly options: any,\n\t) {\n\t\tsuper();\n\n\t\tthis.metadata = options.metadata;\n\t}\n\n\tabstract close(): void;\n\n\t/**\n\t * @internal\n\t */\n\tabstract handleMessage(message: ServerMessage): void;\n\n\t/**\n\t * Called by the Negotiator when the DataChannel is ready.\n\t * @internal\n\t * */\n\tabstract _initializeDataChannel(dc: RTCDataChannel): void;\n}\n", "import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\n\nexport interface EventsWithError<ErrorType extends string> {\n\terror: (error: PeerError<`${ErrorType}`>) => void;\n}\n\nexport class EventEmitterWithError<\n\tErrorType extends string,\n\tEvents extends EventsWithError<ErrorType>,\n> extends EventEmitter<Events, never> {\n\t/**\n\t * Emits a typed error message.\n\t *\n\t * @internal\n\t */\n\temitError(type: ErrorType, err: string | Error): void {\n\t\tlogger.error(\"Error:\", err);\n\n\t\t// @ts-ignore\n\t\tthis.emit(\"error\", new PeerError<`${ErrorType}`>(`${type}`, err));\n\t}\n}\n/**\n * A PeerError is emitted whenever an error occurs.\n * It always has a `.type`, which can be used to identify the error.\n */\nexport class PeerError<T extends string> extends Error {\n\t/**\n\t * @internal\n\t */\n\tconstructor(type: T, err: Error | string) {\n\t\tif (typeof err === \"string\") {\n\t\t\tsuper(err);\n\t\t} else {\n\t\t\tsuper();\n\t\t\tObject.assign(this, err);\n\t\t}\n\n\t\tthis.type = type;\n\t}\n\n\tpublic type: T;\n}\n", "import { util } from \"./util\";\nimport logger from \"./logger\";\nimport type { PeerJSOption } from \"./optionInterfaces\";\nimport { version } from \"../package.json\";\n\nexport class API {\n\tconstructor(private readonly _options: PeerJSOption) {}\n\n\tprivate _buildRequest(method: string): Promise<Response> {\n\t\tconst protocol = this._options.secure ? \"https\" : \"http\";\n\t\tconst { host, port, path, key } = this._options;\n\t\tconst url = new URL(`${protocol}://${host}:${port}${path}${key}/${method}`);\n\t\t// TODO: Why timestamp, why random?\n\t\turl.searchParams.set(\"ts\", `${Date.now()}${Math.random()}`);\n\t\turl.searchParams.set(\"version\", version);\n\t\treturn fetch(url.href, {\n\t\t\treferrerPolicy: this._options.referrerPolicy,\n\t\t});\n\t}\n\n\t/** Get a unique ID from the server via XHR and initialize with it. */\n\tasync retrieveId(): Promise<string> {\n\t\ttry {\n\t\t\tconst response = await this._buildRequest(\"id\");\n\n\t\t\tif (response.status !== 200) {\n\t\t\t\tthrow new Error(`Error. Status:${response.status}`);\n\t\t\t}\n\n\t\t\treturn response.text();\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Error retrieving ID\", error);\n\n\t\t\tlet pathError = \"\";\n\n\t\t\tif (\n\t\t\t\tthis._options.path === \"/\" &&\n\t\t\t\tthis._options.host !== util.CLOUD_HOST\n\t\t\t) {\n\t\t\t\tpathError =\n\t\t\t\t\t\" If you passed in a `path` to your self-hosted PeerServer, \" +\n\t\t\t\t\t\"you'll also need to pass in that same path when creating a new \" +\n\t\t\t\t\t\"Peer.\";\n\t\t\t}\n\n\t\t\tthrow new Error(\"Could not get an ID from the server.\" + pathError);\n\t\t}\n\t}\n\n\t/** @deprecated */\n\tasync listAllPeers(): Promise<any[]> {\n\t\ttry {\n\t\t\tconst response = await this._buildRequest(\"peers\");\n\n\t\t\tif (response.status !== 200) {\n\t\t\t\tif (response.status === 401) {\n\t\t\t\t\tlet helpfulError = \"\";\n\n\t\t\t\t\tif (this._options.host === util.CLOUD_HOST) {\n\t\t\t\t\t\thelpfulError =\n\t\t\t\t\t\t\t\"It looks like you're using the cloud server. You can email \" +\n\t\t\t\t\t\t\t\"team@peerjs.com to enable peer listing for your API key.\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\thelpfulError =\n\t\t\t\t\t\t\t\"You need to enable `allow_discovery` on your self-hosted \" +\n\t\t\t\t\t\t\t\"PeerServer to use this feature.\";\n\t\t\t\t\t}\n\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"It doesn't look like you have permission to list peers IDs. \" +\n\t\t\t\t\t\t\thelpfulError,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthrow new Error(`Error. Status:${response.status}`);\n\t\t\t}\n\n\t\t\treturn response.json();\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Error retrieving list peers\", error);\n\n\t\t\tthrow new Error(\"Could not get list peers from the server.\" + error);\n\t\t}\n\t}\n}\n", "import { BinaryPackChunker, concatArrayBuffers } from \"./binaryPackChunker\";\nimport logger from \"../../logger\";\nimport type { Peer } from \"../../peer\";\nimport { BufferedConnection } from \"./BufferedConnection\";\nimport { SerializationType } from \"../../enums\";\nimport { pack, type Packable, unpack } from \"peerjs-js-binarypack\";\n\nexport class BinaryPack extends BufferedConnection {\n\tprivate readonly chunker = new BinaryPackChunker();\n\treadonly serialization = SerializationType.Binary;\n\n\tprivate _chunkedData: {\n\t\t[id: number]: {\n\t\t\tdata: Uint8Array[];\n\t\t\tcount: number;\n\t\t\ttotal: number;\n\t\t};\n\t} = {};\n\n\tpublic override close(options?: { flush?: boolean }) {\n\t\tsuper.close(options);\n\t\tthis._chunkedData = {};\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\t}\n\n\t// Handles a DataChannel message.\n\tprotected override _handleDataMessage({ data }: { data: Uint8Array }): void {\n\t\tconst deserializedData = unpack(data);\n\n\t\t// PeerJS specific message\n\t\tconst peerData = deserializedData[\"__peerData\"];\n\t\tif (peerData) {\n\t\t\tif (peerData.type === \"close\") {\n\t\t\t\tthis.close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Chunked data -- piece things back together.\n\t\t\t// @ts-ignore\n\t\t\tthis._handleChunk(deserializedData);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit(\"data\", deserializedData);\n\t}\n\n\tprivate _handleChunk(data: {\n\t\t__peerData: number;\n\t\tn: number;\n\t\ttotal: number;\n\t\tdata: ArrayBuffer;\n\t}): void {\n\t\tconst id = data.__peerData;\n\t\tconst chunkInfo = this._chunkedData[id] || {\n\t\t\tdata: [],\n\t\t\tcount: 0,\n\t\t\ttotal: data.total,\n\t\t};\n\n\t\tchunkInfo.data[data.n] = new Uint8Array(data.data);\n\t\tchunkInfo.count++;\n\t\tthis._chunkedData[id] = chunkInfo;\n\n\t\tif (chunkInfo.total === chunkInfo.count) {\n\t\t\t// Clean up before making the recursive call to `_handleDataMessage`.\n\t\t\tdelete this._chunkedData[id];\n\n\t\t\t// We've received all the chunks--time to construct the complete data.\n\t\t\t// const data = new Blob(chunkInfo.data);\n\t\t\tconst data = concatArrayBuffers(chunkInfo.data);\n\t\t\tthis._handleDataMessage({ data });\n\t\t}\n\t}\n\n\tprotected override _send(\n\t\tdata: Packable,\n\t\tchunked: boolean,\n\t): void | Promise<void> {\n\t\tif (data instanceof Blob) {\n\t\t\treturn data.arrayBuffer().then((buffer) => {\n\t\t\t\tthis._send(buffer, chunked);\n\t\t\t});\n\t\t}\n\t\tconst blob = pack(data);\n\n\t\tif (!chunked && blob.byteLength > this.chunker.chunkedMTU) {\n\t\t\tthis._sendChunks(blob);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._bufferedSend(blob);\n\t}\n\n\tprivate _sendChunks(blob: ArrayBuffer) {\n\t\tconst blobs = this.chunker.chunk(blob);\n\t\tlogger.log(`DC#${this.connectionId} Try to send ${blobs.length} chunks...`);\n\n\t\tfor (const blob of blobs) {\n\t\t\tthis.send(blob, true);\n\t\t}\n\t}\n}\n", "import logger from \"../../logger\";\nimport { DataConnection } from \"../DataConnection\";\n\nexport abstract class BufferedConnection extends DataConnection {\n\tprivate _buffer: any[] = [];\n\tprivate _bufferSize = 0;\n\tprivate _buffering = false;\n\n\tpublic get bufferSize(): number {\n\t\treturn this._bufferSize;\n\t}\n\n\tpublic override _initializeDataChannel(dc: RTCDataChannel) {\n\t\tsuper._initializeDataChannel(dc);\n\t\tthis.dataChannel.binaryType = \"arraybuffer\";\n\t\tthis.dataChannel.addEventListener(\"message\", (e) =>\n\t\t\tthis._handleDataMessage(e),\n\t\t);\n\t}\n\n\tprotected abstract _handleDataMessage(e: MessageEvent): void;\n\n\tprotected _bufferedSend(msg: ArrayBuffer): void {\n\t\tif (this._buffering || !this._trySend(msg)) {\n\t\t\tthis._buffer.push(msg);\n\t\t\tthis._bufferSize = this._buffer.length;\n\t\t}\n\t}\n\n\t// Returns true if the send succeeds.\n\tprivate _trySend(msg: ArrayBuffer): boolean {\n\t\tif (!this.open) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.dataChannel.bufferedAmount > DataConnection.MAX_BUFFERED_AMOUNT) {\n\t\t\tthis._buffering = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis._buffering = false;\n\t\t\t\tthis._tryBuffer();\n\t\t\t}, 50);\n\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.dataChannel.send(msg);\n\t\t} catch (e) {\n\t\t\tlogger.error(`DC#:${this.connectionId} Error when sending:`, e);\n\t\t\tthis._buffering = true;\n\n\t\t\tthis.close();\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// Try to send the first message in the buffer.\n\tprivate _tryBuffer(): void {\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._buffer.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst msg = this._buffer[0];\n\n\t\tif (this._trySend(msg)) {\n\t\t\tthis._buffer.shift();\n\t\t\tthis._bufferSize = this._buffer.length;\n\t\t\tthis._tryBuffer();\n\t\t}\n\t}\n\n\tpublic override close(options?: { flush?: boolean }) {\n\t\tif (options?.flush) {\n\t\t\tthis.send({\n\t\t\t\t__peerData: {\n\t\t\t\t\ttype: \"close\",\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tthis._buffer = [];\n\t\tthis._bufferSize = 0;\n\t\tsuper.close();\n\t}\n}\n", "import logger from \"../logger\";\nimport { Negotiator } from \"../negotiator\";\nimport {\n\tBaseConnectionErrorType,\n\tConnectionType,\n\tDataConnectionErrorType,\n\tServerMessageType,\n} from \"../enums\";\nimport type { Peer } from \"../peer\";\nimport { BaseConnection, type BaseConnectionEvents } from \"../baseconnection\";\nimport type { ServerMessage } from \"../servermessage\";\nimport type { EventsWithError } from \"../peerError\";\nimport { randomToken } from \"../utils/randomToken\";\n\nexport interface DataConnectionEvents\n\textends EventsWithError<DataConnectionErrorType | BaseConnectionErrorType>,\n\t\tBaseConnectionEvents<DataConnectionErrorType | BaseConnectionErrorType> {\n\t/**\n\t * Emitted when data is received from the remote peer.\n\t */\n\tdata: (data: unknown) => void;\n\t/**\n\t * Emitted when the connection is established and ready-to-use.\n\t */\n\topen: () => void;\n}\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nexport abstract class DataConnection extends BaseConnection<\n\tDataConnectionEvents,\n\tDataConnectionErrorType\n> {\n\tprotected static readonly ID_PREFIX = \"dc_\";\n\tprotected static readonly MAX_BUFFERED_AMOUNT = 8 * 1024 * 1024;\n\n\tprivate _negotiator: Negotiator<DataConnectionEvents, this>;\n\tabstract readonly serialization: string;\n\treadonly reliable: boolean;\n\n\tpublic get type() {\n\t\treturn ConnectionType.Data;\n\t}\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\n\t\tthis.connectionId =\n\t\t\tthis.options.connectionId || DataConnection.ID_PREFIX + randomToken();\n\n\t\tthis.label = this.options.label || this.connectionId;\n\t\tthis.reliable = !!this.options.reliable;\n\n\t\tthis._negotiator = new Negotiator(this);\n\n\t\tthis._negotiator.startConnection(\n\t\t\tthis.options._payload || {\n\t\t\t\toriginator: true,\n\t\t\t\treliable: this.reliable,\n\t\t\t},\n\t\t);\n\t}\n\n\t/** Called by the Negotiator when the DataChannel is ready. */\n\toverride _initializeDataChannel(dc: RTCDataChannel): void {\n\t\tthis.dataChannel = dc;\n\n\t\tthis.dataChannel.onopen = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc connection success`);\n\t\t\tthis._open = true;\n\t\t\tthis.emit(\"open\");\n\t\t};\n\n\t\tthis.dataChannel.onmessage = (e) => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc onmessage:`, e.data);\n\t\t\t// this._handleDataMessage(e);\n\t\t};\n\n\t\tthis.dataChannel.onclose = () => {\n\t\t\tlogger.log(`DC#${this.connectionId} dc closed for:`, this.peer);\n\t\t\tthis.close();\n\t\t};\n\t}\n\n\t/**\n\t * Exposed functionality for users.\n\t */\n\n\t/** Allows user to close connection. */\n\tclose(options?: { flush?: boolean }): void {\n\t\tif (options?.flush) {\n\t\t\tthis.send({\n\t\t\t\t__peerData: {\n\t\t\t\t\ttype: \"close\",\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif (this._negotiator) {\n\t\t\tthis._negotiator.cleanup();\n\t\t\tthis._negotiator = null;\n\t\t}\n\n\t\tif (this.provider) {\n\t\t\tthis.provider._removeConnection(this);\n\n\t\t\tthis.provider = null;\n\t\t}\n\n\t\tif (this.dataChannel) {\n\t\t\tthis.dataChannel.onopen = null;\n\t\t\tthis.dataChannel.onmessage = null;\n\t\t\tthis.dataChannel.onclose = null;\n\t\t\tthis.dataChannel = null;\n\t\t}\n\n\t\tif (!this.open) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._open = false;\n\n\t\tsuper.emit(\"close\");\n\t}\n\n\tprotected abstract _send(data: any, chunked: boolean): void | Promise<void>;\n\n\t/** Allows user to send data. */\n\tpublic send(data: any, chunked = false) {\n\t\tif (!this.open) {\n\t\t\tthis.emitError(\n\t\t\t\tDataConnectionErrorType.NotOpenYet,\n\t\t\t\t\"Connection is not open. You should listen for the `open` event before sending messages.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\treturn this._send(data, chunked);\n\t}\n\n\tasync handleMessage(message: ServerMessage) {\n\t\tconst payload = message.payload;\n\n\t\tswitch (message.type) {\n\t\t\tcase ServerMessageType.Answer:\n\t\t\t\tawait this._negotiator.handleSDP(message.type, payload.sdp);\n\t\t\t\tbreak;\n\t\t\tcase ServerMessageType.Candidate:\n\t\t\t\tawait this._negotiator.handleCandidate(payload.candidate);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.warn(\n\t\t\t\t\t\"Unrecognized message type:\",\n\t\t\t\t\tmessage.type,\n\t\t\t\t\t\"from peer:\",\n\t\t\t\t\tthis.peer,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n", "import { BufferedConnection } from \"./BufferedConnection\";\nimport { SerializationType } from \"../../enums\";\n\nexport class Raw extends BufferedConnection {\n\treadonly serialization = SerializationType.None;\n\n\tprotected _handleDataMessage({ data }) {\n\t\tsuper.emit(\"data\", data);\n\t}\n\n\toverride _send(data, _chunked) {\n\t\tthis._bufferedSend(data);\n\t}\n}\n", "import { BufferedConnection } from \"./BufferedConnection\";\nimport { DataConnectionErrorType, SerializationType } from \"../../enums\";\nimport { util } from \"../../util\";\n\nexport class Json extends BufferedConnection {\n\treadonly serialization = SerializationType.JSON;\n\tprivate readonly encoder = new TextEncoder();\n\tprivate readonly decoder = new TextDecoder();\n\n\tstringify: (data: any) => string = JSON.stringify;\n\tparse: (data: string) => any = JSON.parse;\n\n\t// Handles a DataChannel message.\n\tprotected override _handleDataMessage({ data }: { data: Uint8Array }): void {\n\t\tconst deserializedData = this.parse(this.decoder.decode(data));\n\n\t\t// PeerJS specific message\n\t\tconst peerData = deserializedData[\"__peerData\"];\n\t\tif (peerData && peerData.type === \"close\") {\n\t\t\tthis.close();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit(\"data\", deserializedData);\n\t}\n\n\toverride _send(data, _chunked) {\n\t\tconst encodedData = this.encoder.encode(this.stringify(data));\n\t\tif (encodedData.byteLength >= util.chunkedMTU) {\n\t\t\tthis.emitError(\n\t\t\t\tDataConnectionErrorType.MessageToBig,\n\t\t\t\t\"Message too big for JSON channel\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tthis._bufferedSend(encodedData);\n\t}\n}\n", "import { Peer, type SerializerMapping } from \"./peer\";\nimport { Cbor } from \"./dataconnection/StreamConnection/Cbor\";\n\nexport class CborPeer extends Peer {\n\toverride _serializers: SerializerMapping = {\n\t\tCbor,\n\t\tdefault: Cbor,\n\t};\n}\n", "import type { Peer } from \"../../peer.js\";\nimport { Decoder, Encoder } from \"cbor-x\";\nimport { StreamConnection } from \"./StreamConnection.js\";\n\nconst NullValue = Symbol.for(null);\n\nfunction concatUint8Array(buffer1: Uint8Array, buffer2: Uint8Array) {\n\tconst tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n\ttmp.set(buffer1, 0);\n\ttmp.set(buffer2, buffer1.byteLength);\n\treturn new Uint8Array(tmp.buffer);\n}\n\nconst iterateOver = async function* (stream: ReadableStream) {\n\tconst reader = stream.getReader();\n\ttry {\n\t\twhile (true) {\n\t\t\tconst { done, value } = await reader.read();\n\t\t\tif (done) return;\n\t\t\tyield value;\n\t\t}\n\t} finally {\n\t\treader.releaseLock();\n\t}\n};\n\nexport class Cbor extends StreamConnection {\n\treadonly serialization = \"Cbor\";\n\tprivate _encoder = new Encoder();\n\tprivate _decoder = new Decoder();\n\tprivate _inc;\n\tprivate _decoderStream = new TransformStream<ArrayBuffer, unknown>({\n\t\ttransform: (abchunk, controller) => {\n\t\t\tlet chunk = new Uint8Array(abchunk);\n\t\t\tif (this._inc) {\n\t\t\t\tchunk = concatUint8Array(this._inc, chunk);\n\t\t\t\tthis._inc = null;\n\t\t\t}\n\t\t\tlet values;\n\t\t\ttry {\n\t\t\t\tvalues = this._decoder.decodeMultiple(chunk);\n\t\t\t} catch (error) {\n\t\t\t\tif (error.incomplete) {\n\t\t\t\t\tthis._inc = chunk.subarray(error.lastPosition);\n\t\t\t\t\tvalues = error.values;\n\t\t\t\t} else throw error;\n\t\t\t} finally {\n\t\t\t\tfor (let value of values || []) {\n\t\t\t\t\tif (value === null) value = NullValue;\n\t\t\t\t\tcontroller.enqueue(value);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t});\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, { ...options, reliable: true });\n\n\t\tvoid this._rawReadStream.pipeTo(this._decoderStream.writable);\n\n\t\t(async () => {\n\t\t\tfor await (const msg of iterateOver(this._decoderStream.readable)) {\n\t\t\t\tif (msg.__peerData?.type === \"close\") {\n\t\t\t\t\tthis.close();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.emit(\"data\", msg);\n\t\t\t}\n\t\t})();\n\t}\n\n\tprotected override _send(data) {\n\t\treturn this.writer.write(this._encoder.encode(data));\n\t}\n}\n", "import logger from \"../../logger.js\";\nimport type { Peer } from \"../../peer.js\";\nimport { DataConnection } from \"../DataConnection.js\";\n\nexport abstract class StreamConnection extends DataConnection {\n\tprivate _CHUNK_SIZE = 1024 * 8 * 4;\n\tprivate _splitStream = new TransformStream<Uint8Array>({\n\t\ttransform: (chunk, controller) => {\n\t\t\tfor (let split = 0; split < chunk.length; split += this._CHUNK_SIZE) {\n\t\t\t\tcontroller.enqueue(chunk.subarray(split, split + this._CHUNK_SIZE));\n\t\t\t}\n\t\t},\n\t});\n\tprivate _rawSendStream = new WritableStream<ArrayBuffer>({\n\t\twrite: async (chunk, controller) => {\n\t\t\tconst openEvent = new Promise((resolve) =>\n\t\t\t\tthis.dataChannel.addEventListener(\"bufferedamountlow\", resolve, {\n\t\t\t\t\tonce: true,\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\t// if we can send the chunk now, send it\n\t\t\t// if not, we wait until at least half of the sending buffer is free again\n\t\t\tawait (this.dataChannel.bufferedAmount <=\n\t\t\t\tDataConnection.MAX_BUFFERED_AMOUNT - chunk.byteLength || openEvent);\n\n\t\t\t// TODO: what can go wrong here?\n\t\t\ttry {\n\t\t\t\tthis.dataChannel.send(chunk);\n\t\t\t} catch (e) {\n\t\t\t\tlogger.error(`DC#:${this.connectionId} Error when sending:`, e);\n\t\t\t\tcontroller.error(e);\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t},\n\t});\n\tprotected writer = this._splitStream.writable.getWriter();\n\n\tprotected _rawReadStream = new ReadableStream<ArrayBuffer>({\n\t\tstart: (controller) => {\n\t\t\tthis.once(\"open\", () => {\n\t\t\t\tthis.dataChannel.addEventListener(\"message\", (e) => {\n\t\t\t\t\tcontroller.enqueue(e.data);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t});\n\n\tprotected constructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, { ...options, reliable: true });\n\n\t\tvoid this._splitStream.readable.pipeTo(this._rawSendStream);\n\t}\n\n\tpublic override _initializeDataChannel(dc) {\n\t\tsuper._initializeDataChannel(dc);\n\t\tthis.dataChannel.binaryType = \"arraybuffer\";\n\t\tthis.dataChannel.bufferedAmountLowThreshold =\n\t\t\tDataConnection.MAX_BUFFERED_AMOUNT / 2;\n\t}\n}\n", "import { Peer, type SerializerMapping } from \"./peer\";\nimport { MsgPack } from \"./exports\";\n\nexport class MsgPackPeer extends Peer {\n\toverride _serializers: SerializerMapping = {\n\t\tMsgPack,\n\t\tdefault: MsgPack,\n\t};\n}\n", "import { decodeMultiStream, Encoder } from \"@msgpack/msgpack\";\nimport { StreamConnection } from \"./StreamConnection.js\";\nimport type { Peer } from \"../../peer.js\";\n\nexport class MsgPack extends StreamConnection {\n\treadonly serialization = \"MsgPack\";\n\tprivate _encoder = new Encoder();\n\n\tconstructor(peerId: string, provider: Peer, options: any) {\n\t\tsuper(peerId, provider, options);\n\n\t\t(async () => {\n\t\t\tfor await (const msg of decodeMultiStream(this._rawReadStream)) {\n\t\t\t\t// @ts-ignore\n\t\t\t\tif (msg.__peerData?.type === \"close\") {\n\t\t\t\t\tthis.close();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.emit(\"data\", msg);\n\t\t\t}\n\t\t})();\n\t}\n\n\tprotected override _send(data) {\n\t\treturn this.writer.write(this._encoder.encode(data));\n\t}\n}\n", "/*! Tweakpane 4.0.1 (c) 2016 cocopon, licensed under the MIT license. */\nfunction forceCast(v) {\n    return v;\n}\nfunction isEmpty(value) {\n    return value === null || value === undefined;\n}\nfunction isObject$1(value) {\n    return value !== null && typeof value === 'object';\n}\nfunction isRecord(value) {\n    return value !== null && typeof value === 'object';\n}\nfunction deepEqualsArray(a1, a2) {\n    if (a1.length !== a2.length) {\n        return false;\n    }\n    for (let i = 0; i < a1.length; i++) {\n        if (a1[i] !== a2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction deepMerge(r1, r2) {\n    const keys = Array.from(new Set([...Object.keys(r1), ...Object.keys(r2)]));\n    return keys.reduce((result, key) => {\n        const v1 = r1[key];\n        const v2 = r2[key];\n        return isRecord(v1) && isRecord(v2)\n            ? Object.assign(Object.assign({}, result), { [key]: deepMerge(v1, v2) }) : Object.assign(Object.assign({}, result), { [key]: key in r2 ? v2 : v1 });\n    }, {});\n}\n\nfunction isBinding(value) {\n    if (!isObject$1(value)) {\n        return false;\n    }\n    return 'target' in value;\n}\n\nconst CREATE_MESSAGE_MAP = {\n    alreadydisposed: () => 'View has been already disposed',\n    invalidparams: (context) => `Invalid parameters for '${context.name}'`,\n    nomatchingcontroller: (context) => `No matching controller for '${context.key}'`,\n    nomatchingview: (context) => `No matching view for '${JSON.stringify(context.params)}'`,\n    notbindable: () => `Value is not bindable`,\n    notcompatible: (context) => `Not compatible with  plugin '${context.id}'`,\n    propertynotfound: (context) => `Property '${context.name}' not found`,\n    shouldneverhappen: () => 'This error should never happen',\n};\nclass TpError {\n    static alreadyDisposed() {\n        return new TpError({ type: 'alreadydisposed' });\n    }\n    static notBindable() {\n        return new TpError({\n            type: 'notbindable',\n        });\n    }\n    static notCompatible(bundleId, id) {\n        return new TpError({\n            type: 'notcompatible',\n            context: {\n                id: `${bundleId}.${id}`,\n            },\n        });\n    }\n    static propertyNotFound(name) {\n        return new TpError({\n            type: 'propertynotfound',\n            context: {\n                name: name,\n            },\n        });\n    }\n    static shouldNeverHappen() {\n        return new TpError({ type: 'shouldneverhappen' });\n    }\n    constructor(config) {\n        var _a;\n        this.message =\n            (_a = CREATE_MESSAGE_MAP[config.type](forceCast(config.context))) !== null && _a !== void 0 ? _a : 'Unexpected error';\n        this.name = this.constructor.name;\n        this.stack = new Error(this.message).stack;\n        this.type = config.type;\n    }\n    toString() {\n        return this.message;\n    }\n}\n\nclass BindingTarget {\n    constructor(obj, key) {\n        this.obj_ = obj;\n        this.key = key;\n    }\n    static isBindable(obj) {\n        if (obj === null) {\n            return false;\n        }\n        if (typeof obj !== 'object' && typeof obj !== 'function') {\n            return false;\n        }\n        return true;\n    }\n    read() {\n        return this.obj_[this.key];\n    }\n    write(value) {\n        this.obj_[this.key] = value;\n    }\n    writeProperty(name, value) {\n        const valueObj = this.read();\n        if (!BindingTarget.isBindable(valueObj)) {\n            throw TpError.notBindable();\n        }\n        if (!(name in valueObj)) {\n            throw TpError.propertyNotFound(name);\n        }\n        valueObj[name] = value;\n    }\n}\n\nclass Emitter {\n    constructor() {\n        this.observers_ = {};\n    }\n    on(eventName, handler) {\n        let observers = this.observers_[eventName];\n        if (!observers) {\n            observers = this.observers_[eventName] = [];\n        }\n        observers.push({\n            handler: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        const observers = this.observers_[eventName];\n        if (observers) {\n            this.observers_[eventName] = observers.filter((observer) => {\n                return observer.handler !== handler;\n            });\n        }\n        return this;\n    }\n    emit(eventName, event) {\n        const observers = this.observers_[eventName];\n        if (!observers) {\n            return;\n        }\n        observers.forEach((observer) => {\n            observer.handler(event);\n        });\n    }\n}\n\nclass ComplexValue {\n    constructor(initialValue, config) {\n        var _a;\n        this.constraint_ = config === null || config === void 0 ? void 0 : config.constraint;\n        this.equals_ = (_a = config === null || config === void 0 ? void 0 : config.equals) !== null && _a !== void 0 ? _a : ((v1, v2) => v1 === v2);\n        this.emitter = new Emitter();\n        this.rawValue_ = initialValue;\n    }\n    get constraint() {\n        return this.constraint_;\n    }\n    get rawValue() {\n        return this.rawValue_;\n    }\n    set rawValue(rawValue) {\n        this.setRawValue(rawValue, {\n            forceEmit: false,\n            last: true,\n        });\n    }\n    setRawValue(rawValue, options) {\n        const opts = options !== null && options !== void 0 ? options : {\n            forceEmit: false,\n            last: true,\n        };\n        const constrainedValue = this.constraint_\n            ? this.constraint_.constrain(rawValue)\n            : rawValue;\n        const prevValue = this.rawValue_;\n        const changed = !this.equals_(prevValue, constrainedValue);\n        if (!changed && !opts.forceEmit) {\n            return;\n        }\n        this.emitter.emit('beforechange', {\n            sender: this,\n        });\n        this.rawValue_ = constrainedValue;\n        this.emitter.emit('change', {\n            options: opts,\n            previousRawValue: prevValue,\n            rawValue: constrainedValue,\n            sender: this,\n        });\n    }\n}\n\nclass PrimitiveValue {\n    constructor(initialValue) {\n        this.emitter = new Emitter();\n        this.value_ = initialValue;\n    }\n    get rawValue() {\n        return this.value_;\n    }\n    set rawValue(value) {\n        this.setRawValue(value, {\n            forceEmit: false,\n            last: true,\n        });\n    }\n    setRawValue(value, options) {\n        const opts = options !== null && options !== void 0 ? options : {\n            forceEmit: false,\n            last: true,\n        };\n        const prevValue = this.value_;\n        if (prevValue === value && !opts.forceEmit) {\n            return;\n        }\n        this.emitter.emit('beforechange', {\n            sender: this,\n        });\n        this.value_ = value;\n        this.emitter.emit('change', {\n            options: opts,\n            previousRawValue: prevValue,\n            rawValue: this.value_,\n            sender: this,\n        });\n    }\n}\n\nclass ReadonlyPrimitiveValue {\n    constructor(value) {\n        this.emitter = new Emitter();\n        this.onValueBeforeChange_ = this.onValueBeforeChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value_ = value;\n        this.value_.emitter.on('beforechange', this.onValueBeforeChange_);\n        this.value_.emitter.on('change', this.onValueChange_);\n    }\n    get rawValue() {\n        return this.value_.rawValue;\n    }\n    onValueBeforeChange_(ev) {\n        this.emitter.emit('beforechange', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n    onValueChange_(ev) {\n        this.emitter.emit('change', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n}\n\nfunction createValue(initialValue, config) {\n    const constraint = config === null || config === void 0 ? void 0 : config.constraint;\n    const equals = config === null || config === void 0 ? void 0 : config.equals;\n    if (!constraint && !equals) {\n        return new PrimitiveValue(initialValue);\n    }\n    return new ComplexValue(initialValue, config);\n}\nfunction createReadonlyValue(value) {\n    return [\n        new ReadonlyPrimitiveValue(value),\n        (rawValue, options) => {\n            value.setRawValue(rawValue, options);\n        },\n    ];\n}\n\nclass ValueMap {\n    constructor(valueMap) {\n        this.emitter = new Emitter();\n        this.valMap_ = valueMap;\n        for (const key in this.valMap_) {\n            const v = this.valMap_[key];\n            v.emitter.on('change', () => {\n                this.emitter.emit('change', {\n                    key: key,\n                    sender: this,\n                });\n            });\n        }\n    }\n    static createCore(initialValue) {\n        const keys = Object.keys(initialValue);\n        return keys.reduce((o, key) => {\n            return Object.assign(o, {\n                [key]: createValue(initialValue[key]),\n            });\n        }, {});\n    }\n    static fromObject(initialValue) {\n        const core = this.createCore(initialValue);\n        return new ValueMap(core);\n    }\n    get(key) {\n        return this.valMap_[key].rawValue;\n    }\n    set(key, value) {\n        this.valMap_[key].rawValue = value;\n    }\n    value(key) {\n        return this.valMap_[key];\n    }\n}\n\nclass DefiniteRangeConstraint {\n    constructor(config) {\n        this.values = ValueMap.fromObject({\n            max: config.max,\n            min: config.min,\n        });\n    }\n    constrain(value) {\n        const max = this.values.get('max');\n        const min = this.values.get('min');\n        return Math.min(Math.max(value, min), max);\n    }\n}\n\nclass RangeConstraint {\n    constructor(config) {\n        this.values = ValueMap.fromObject({\n            max: config.max,\n            min: config.min,\n        });\n    }\n    constrain(value) {\n        const max = this.values.get('max');\n        const min = this.values.get('min');\n        let result = value;\n        if (!isEmpty(min)) {\n            result = Math.max(result, min);\n        }\n        if (!isEmpty(max)) {\n            result = Math.min(result, max);\n        }\n        return result;\n    }\n}\n\nclass StepConstraint {\n    constructor(step, origin = 0) {\n        this.step = step;\n        this.origin = origin;\n    }\n    constrain(value) {\n        const o = this.origin % this.step;\n        const r = Math.round((value - o) / this.step);\n        return o + r * this.step;\n    }\n}\n\nclass NumberLiteralNode {\n    constructor(text) {\n        this.text = text;\n    }\n    evaluate() {\n        return Number(this.text);\n    }\n    toString() {\n        return this.text;\n    }\n}\nconst BINARY_OPERATION_MAP = {\n    '**': (v1, v2) => Math.pow(v1, v2),\n    '*': (v1, v2) => v1 * v2,\n    '/': (v1, v2) => v1 / v2,\n    '%': (v1, v2) => v1 % v2,\n    '+': (v1, v2) => v1 + v2,\n    '-': (v1, v2) => v1 - v2,\n    '<<': (v1, v2) => v1 << v2,\n    '>>': (v1, v2) => v1 >> v2,\n    '>>>': (v1, v2) => v1 >>> v2,\n    '&': (v1, v2) => v1 & v2,\n    '^': (v1, v2) => v1 ^ v2,\n    '|': (v1, v2) => v1 | v2,\n};\nclass BinaryOperationNode {\n    constructor(operator, left, right) {\n        this.left = left;\n        this.operator = operator;\n        this.right = right;\n    }\n    evaluate() {\n        const op = BINARY_OPERATION_MAP[this.operator];\n        if (!op) {\n            throw new Error(`unexpected binary operator: '${this.operator}`);\n        }\n        return op(this.left.evaluate(), this.right.evaluate());\n    }\n    toString() {\n        return [\n            'b(',\n            this.left.toString(),\n            this.operator,\n            this.right.toString(),\n            ')',\n        ].join(' ');\n    }\n}\nconst UNARY_OPERATION_MAP = {\n    '+': (v) => v,\n    '-': (v) => -v,\n    '~': (v) => ~v,\n};\nclass UnaryOperationNode {\n    constructor(operator, expr) {\n        this.operator = operator;\n        this.expression = expr;\n    }\n    evaluate() {\n        const op = UNARY_OPERATION_MAP[this.operator];\n        if (!op) {\n            throw new Error(`unexpected unary operator: '${this.operator}`);\n        }\n        return op(this.expression.evaluate());\n    }\n    toString() {\n        return ['u(', this.operator, this.expression.toString(), ')'].join(' ');\n    }\n}\n\nfunction combineReader(parsers) {\n    return (text, cursor) => {\n        for (let i = 0; i < parsers.length; i++) {\n            const result = parsers[i](text, cursor);\n            if (result !== '') {\n                return result;\n            }\n        }\n        return '';\n    };\n}\nfunction readWhitespace(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^\\s+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readNonZeroDigit(text, cursor) {\n    const ch = text.substr(cursor, 1);\n    return ch.match(/^[1-9]$/) ? ch : '';\n}\nfunction readDecimalDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[0-9]+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readSignedInteger(text, cursor) {\n    const ds = readDecimalDigits(text, cursor);\n    if (ds !== '') {\n        return ds;\n    }\n    const sign = text.substr(cursor, 1);\n    cursor += 1;\n    if (sign !== '-' && sign !== '+') {\n        return '';\n    }\n    const sds = readDecimalDigits(text, cursor);\n    if (sds === '') {\n        return '';\n    }\n    return sign + sds;\n}\nfunction readExponentPart(text, cursor) {\n    const e = text.substr(cursor, 1);\n    cursor += 1;\n    if (e.toLowerCase() !== 'e') {\n        return '';\n    }\n    const si = readSignedInteger(text, cursor);\n    if (si === '') {\n        return '';\n    }\n    return e + si;\n}\nfunction readDecimalIntegerLiteral(text, cursor) {\n    const ch = text.substr(cursor, 1);\n    if (ch === '0') {\n        return ch;\n    }\n    const nzd = readNonZeroDigit(text, cursor);\n    cursor += nzd.length;\n    if (nzd === '') {\n        return '';\n    }\n    return nzd + readDecimalDigits(text, cursor);\n}\nfunction readDecimalLiteral1(text, cursor) {\n    const dil = readDecimalIntegerLiteral(text, cursor);\n    cursor += dil.length;\n    if (dil === '') {\n        return '';\n    }\n    const dot = text.substr(cursor, 1);\n    cursor += dot.length;\n    if (dot !== '.') {\n        return '';\n    }\n    const dds = readDecimalDigits(text, cursor);\n    cursor += dds.length;\n    return dil + dot + dds + readExponentPart(text, cursor);\n}\nfunction readDecimalLiteral2(text, cursor) {\n    const dot = text.substr(cursor, 1);\n    cursor += dot.length;\n    if (dot !== '.') {\n        return '';\n    }\n    const dds = readDecimalDigits(text, cursor);\n    cursor += dds.length;\n    if (dds === '') {\n        return '';\n    }\n    return dot + dds + readExponentPart(text, cursor);\n}\nfunction readDecimalLiteral3(text, cursor) {\n    const dil = readDecimalIntegerLiteral(text, cursor);\n    cursor += dil.length;\n    if (dil === '') {\n        return '';\n    }\n    return dil + readExponentPart(text, cursor);\n}\nconst readDecimalLiteral = combineReader([\n    readDecimalLiteral1,\n    readDecimalLiteral2,\n    readDecimalLiteral3,\n]);\nfunction parseBinaryDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[01]+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readBinaryIntegerLiteral(text, cursor) {\n    const prefix = text.substr(cursor, 2);\n    cursor += prefix.length;\n    if (prefix.toLowerCase() !== '0b') {\n        return '';\n    }\n    const bds = parseBinaryDigits(text, cursor);\n    if (bds === '') {\n        return '';\n    }\n    return prefix + bds;\n}\nfunction readOctalDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[0-7]+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readOctalIntegerLiteral(text, cursor) {\n    const prefix = text.substr(cursor, 2);\n    cursor += prefix.length;\n    if (prefix.toLowerCase() !== '0o') {\n        return '';\n    }\n    const ods = readOctalDigits(text, cursor);\n    if (ods === '') {\n        return '';\n    }\n    return prefix + ods;\n}\nfunction readHexDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[0-9a-f]+/i);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readHexIntegerLiteral(text, cursor) {\n    const prefix = text.substr(cursor, 2);\n    cursor += prefix.length;\n    if (prefix.toLowerCase() !== '0x') {\n        return '';\n    }\n    const hds = readHexDigits(text, cursor);\n    if (hds === '') {\n        return '';\n    }\n    return prefix + hds;\n}\nconst readNonDecimalIntegerLiteral = combineReader([\n    readBinaryIntegerLiteral,\n    readOctalIntegerLiteral,\n    readHexIntegerLiteral,\n]);\nconst readNumericLiteral = combineReader([\n    readNonDecimalIntegerLiteral,\n    readDecimalLiteral,\n]);\n\nfunction parseLiteral(text, cursor) {\n    const num = readNumericLiteral(text, cursor);\n    cursor += num.length;\n    if (num === '') {\n        return null;\n    }\n    return {\n        evaluable: new NumberLiteralNode(num),\n        cursor: cursor,\n    };\n}\nfunction parseParenthesizedExpression(text, cursor) {\n    const op = text.substr(cursor, 1);\n    cursor += op.length;\n    if (op !== '(') {\n        return null;\n    }\n    const expr = parseExpression(text, cursor);\n    if (!expr) {\n        return null;\n    }\n    cursor = expr.cursor;\n    cursor += readWhitespace(text, cursor).length;\n    const cl = text.substr(cursor, 1);\n    cursor += cl.length;\n    if (cl !== ')') {\n        return null;\n    }\n    return {\n        evaluable: expr.evaluable,\n        cursor: cursor,\n    };\n}\nfunction parsePrimaryExpression(text, cursor) {\n    var _a;\n    return ((_a = parseLiteral(text, cursor)) !== null && _a !== void 0 ? _a : parseParenthesizedExpression(text, cursor));\n}\nfunction parseUnaryExpression(text, cursor) {\n    const expr = parsePrimaryExpression(text, cursor);\n    if (expr) {\n        return expr;\n    }\n    const op = text.substr(cursor, 1);\n    cursor += op.length;\n    if (op !== '+' && op !== '-' && op !== '~') {\n        return null;\n    }\n    const num = parseUnaryExpression(text, cursor);\n    if (!num) {\n        return null;\n    }\n    cursor = num.cursor;\n    return {\n        cursor: cursor,\n        evaluable: new UnaryOperationNode(op, num.evaluable),\n    };\n}\nfunction readBinaryOperator(ops, text, cursor) {\n    cursor += readWhitespace(text, cursor).length;\n    const op = ops.filter((op) => text.startsWith(op, cursor))[0];\n    if (!op) {\n        return null;\n    }\n    cursor += op.length;\n    cursor += readWhitespace(text, cursor).length;\n    return {\n        cursor: cursor,\n        operator: op,\n    };\n}\nfunction createBinaryOperationExpressionParser(exprParser, ops) {\n    return (text, cursor) => {\n        const firstExpr = exprParser(text, cursor);\n        if (!firstExpr) {\n            return null;\n        }\n        cursor = firstExpr.cursor;\n        let expr = firstExpr.evaluable;\n        for (;;) {\n            const op = readBinaryOperator(ops, text, cursor);\n            if (!op) {\n                break;\n            }\n            cursor = op.cursor;\n            const nextExpr = exprParser(text, cursor);\n            if (!nextExpr) {\n                return null;\n            }\n            cursor = nextExpr.cursor;\n            expr = new BinaryOperationNode(op.operator, expr, nextExpr.evaluable);\n        }\n        return expr\n            ? {\n                cursor: cursor,\n                evaluable: expr,\n            }\n            : null;\n    };\n}\nconst parseBinaryOperationExpression = [\n    ['**'],\n    ['*', '/', '%'],\n    ['+', '-'],\n    ['<<', '>>>', '>>'],\n    ['&'],\n    ['^'],\n    ['|'],\n].reduce((parser, ops) => {\n    return createBinaryOperationExpressionParser(parser, ops);\n}, parseUnaryExpression);\nfunction parseExpression(text, cursor) {\n    cursor += readWhitespace(text, cursor).length;\n    return parseBinaryOperationExpression(text, cursor);\n}\nfunction parseEcmaNumberExpression(text) {\n    const expr = parseExpression(text, 0);\n    if (!expr) {\n        return null;\n    }\n    const cursor = expr.cursor + readWhitespace(text, expr.cursor).length;\n    if (cursor !== text.length) {\n        return null;\n    }\n    return expr.evaluable;\n}\n\nfunction parseNumber(text) {\n    var _a;\n    const r = parseEcmaNumberExpression(text);\n    return (_a = r === null || r === void 0 ? void 0 : r.evaluate()) !== null && _a !== void 0 ? _a : null;\n}\nfunction numberFromUnknown(value) {\n    if (typeof value === 'number') {\n        return value;\n    }\n    if (typeof value === 'string') {\n        const pv = parseNumber(value);\n        if (!isEmpty(pv)) {\n            return pv;\n        }\n    }\n    return 0;\n}\nfunction numberToString(value) {\n    return String(value);\n}\nfunction createNumberFormatter(digits) {\n    return (value) => {\n        return value.toFixed(Math.max(Math.min(digits, 20), 0));\n    };\n}\n\nfunction mapRange(value, start1, end1, start2, end2) {\n    const p = (value - start1) / (end1 - start1);\n    return start2 + p * (end2 - start2);\n}\nfunction getDecimalDigits(value) {\n    const text = String(value.toFixed(10));\n    const frac = text.split('.')[1];\n    return frac.replace(/0+$/, '').length;\n}\nfunction constrainRange(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n}\nfunction loopRange(value, max) {\n    return ((value % max) + max) % max;\n}\nfunction getSuitableDecimalDigits(params, rawValue) {\n    return !isEmpty(params.step)\n        ? getDecimalDigits(params.step)\n        : Math.max(getDecimalDigits(rawValue), 2);\n}\nfunction getSuitableKeyScale(params) {\n    var _a;\n    return (_a = params.step) !== null && _a !== void 0 ? _a : 1;\n}\nfunction getSuitablePointerScale(params, rawValue) {\n    var _a;\n    const base = Math.abs((_a = params.step) !== null && _a !== void 0 ? _a : rawValue);\n    return base === 0 ? 0.1 : Math.pow(10, Math.floor(Math.log10(base)) - 1);\n}\nfunction createStepConstraint(params, initialValue) {\n    if (!isEmpty(params.step)) {\n        return new StepConstraint(params.step, initialValue);\n    }\n    return null;\n}\nfunction createRangeConstraint(params) {\n    if (!isEmpty(params.max) && !isEmpty(params.min)) {\n        return new DefiniteRangeConstraint({\n            max: params.max,\n            min: params.min,\n        });\n    }\n    if (!isEmpty(params.max) || !isEmpty(params.min)) {\n        return new RangeConstraint({\n            max: params.max,\n            min: params.min,\n        });\n    }\n    return null;\n}\nfunction createNumberTextPropsObject(params, initialValue) {\n    var _a, _b, _c;\n    return {\n        formatter: (_a = params.format) !== null && _a !== void 0 ? _a : createNumberFormatter(getSuitableDecimalDigits(params, initialValue)),\n        keyScale: (_b = params.keyScale) !== null && _b !== void 0 ? _b : getSuitableKeyScale(params),\n        pointerScale: (_c = params.pointerScale) !== null && _c !== void 0 ? _c : getSuitablePointerScale(params, initialValue),\n    };\n}\nfunction createNumberTextInputParamsParser(p) {\n    return {\n        format: p.optional.function,\n        keyScale: p.optional.number,\n        max: p.optional.number,\n        min: p.optional.number,\n        pointerScale: p.optional.number,\n        step: p.optional.number,\n    };\n}\n\nfunction createPointAxis(config) {\n    return {\n        constraint: config.constraint,\n        textProps: ValueMap.fromObject(createNumberTextPropsObject(config.params, config.initialValue)),\n    };\n}\n\nclass BladeApi {\n    constructor(controller) {\n        this.controller = controller;\n    }\n    get element() {\n        return this.controller.view.element;\n    }\n    get disabled() {\n        return this.controller.viewProps.get('disabled');\n    }\n    set disabled(disabled) {\n        this.controller.viewProps.set('disabled', disabled);\n    }\n    get hidden() {\n        return this.controller.viewProps.get('hidden');\n    }\n    set hidden(hidden) {\n        this.controller.viewProps.set('hidden', hidden);\n    }\n    dispose() {\n        this.controller.viewProps.set('disposed', true);\n    }\n    importState(state) {\n        return this.controller.importState(state);\n    }\n    exportState() {\n        return this.controller.exportState();\n    }\n}\n\nclass TpEvent {\n    constructor(target) {\n        this.target = target;\n    }\n}\nclass TpChangeEvent extends TpEvent {\n    constructor(target, value, last) {\n        super(target);\n        this.value = value;\n        this.last = last !== null && last !== void 0 ? last : true;\n    }\n}\nclass TpFoldEvent extends TpEvent {\n    constructor(target, expanded) {\n        super(target);\n        this.expanded = expanded;\n    }\n}\nclass TpTabSelectEvent extends TpEvent {\n    constructor(target, index) {\n        super(target);\n        this.index = index;\n    }\n}\n\nclass BindingApi extends BladeApi {\n    constructor(controller) {\n        super(controller);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', this.onValueChange_);\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get key() {\n        return this.controller.value.binding.target.key;\n    }\n    get tag() {\n        return this.controller.tag;\n    }\n    set tag(tag) {\n        this.controller.tag = tag;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        });\n        return this;\n    }\n    refresh() {\n        this.controller.value.fetch();\n    }\n    onValueChange_(ev) {\n        const value = this.controller.value;\n        this.emitter_.emit('change', new TpChangeEvent(this, forceCast(value.binding.target.read()), ev.options.last));\n    }\n}\n\nclass InputBindingValue {\n    constructor(value, binding) {\n        this.onValueBeforeChange_ = this.onValueBeforeChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.binding = binding;\n        this.value_ = value;\n        this.value_.emitter.on('beforechange', this.onValueBeforeChange_);\n        this.value_.emitter.on('change', this.onValueChange_);\n        this.emitter = new Emitter();\n    }\n    get rawValue() {\n        return this.value_.rawValue;\n    }\n    set rawValue(rawValue) {\n        this.value_.rawValue = rawValue;\n    }\n    setRawValue(rawValue, options) {\n        this.value_.setRawValue(rawValue, options);\n    }\n    fetch() {\n        this.value_.rawValue = this.binding.read();\n    }\n    push() {\n        this.binding.write(this.value_.rawValue);\n    }\n    onValueBeforeChange_(ev) {\n        this.emitter.emit('beforechange', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n    onValueChange_(ev) {\n        this.push();\n        this.emitter.emit('change', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n}\nfunction isInputBindingValue(v) {\n    if (!('binding' in v)) {\n        return false;\n    }\n    const b = v['binding'];\n    return isBinding(b) && 'read' in b && 'write' in b;\n}\n\nfunction parseObject(value, keyToParserMap) {\n    const keys = Object.keys(keyToParserMap);\n    const result = keys.reduce((tmp, key) => {\n        if (tmp === undefined) {\n            return undefined;\n        }\n        const parser = keyToParserMap[key];\n        const result = parser(value[key]);\n        return result.succeeded\n            ? Object.assign(Object.assign({}, tmp), { [key]: result.value }) : undefined;\n    }, {});\n    return forceCast(result);\n}\nfunction parseArray(value, parseItem) {\n    return value.reduce((tmp, item) => {\n        if (tmp === undefined) {\n            return undefined;\n        }\n        const result = parseItem(item);\n        if (!result.succeeded || result.value === undefined) {\n            return undefined;\n        }\n        return [...tmp, result.value];\n    }, []);\n}\nfunction isObject(value) {\n    if (value === null) {\n        return false;\n    }\n    return typeof value === 'object';\n}\nfunction createMicroParserBuilder(parse) {\n    return (optional) => (v) => {\n        if (!optional && v === undefined) {\n            return {\n                succeeded: false,\n                value: undefined,\n            };\n        }\n        if (optional && v === undefined) {\n            return {\n                succeeded: true,\n                value: undefined,\n            };\n        }\n        const result = parse(v);\n        return result !== undefined\n            ? {\n                succeeded: true,\n                value: result,\n            }\n            : {\n                succeeded: false,\n                value: undefined,\n            };\n    };\n}\nfunction createMicroParserBuilders(optional) {\n    return {\n        custom: (parse) => createMicroParserBuilder(parse)(optional),\n        boolean: createMicroParserBuilder((v) => typeof v === 'boolean' ? v : undefined)(optional),\n        number: createMicroParserBuilder((v) => typeof v === 'number' ? v : undefined)(optional),\n        string: createMicroParserBuilder((v) => typeof v === 'string' ? v : undefined)(optional),\n        function: createMicroParserBuilder((v) =>\n        typeof v === 'function' ? v : undefined)(optional),\n        constant: (value) => createMicroParserBuilder((v) => (v === value ? value : undefined))(optional),\n        raw: createMicroParserBuilder((v) => v)(optional),\n        object: (keyToParserMap) => createMicroParserBuilder((v) => {\n            if (!isObject(v)) {\n                return undefined;\n            }\n            return parseObject(v, keyToParserMap);\n        })(optional),\n        array: (itemParser) => createMicroParserBuilder((v) => {\n            if (!Array.isArray(v)) {\n                return undefined;\n            }\n            return parseArray(v, itemParser);\n        })(optional),\n    };\n}\nconst MicroParsers = {\n    optional: createMicroParserBuilders(true),\n    required: createMicroParserBuilders(false),\n};\nfunction parseRecord(value, keyToParserMap) {\n    const map = keyToParserMap(MicroParsers);\n    const result = MicroParsers.required.object(map)(value);\n    return result.succeeded ? result.value : undefined;\n}\n\nfunction importBladeState(state, superImport, parser, callback) {\n    if (superImport && !superImport(state)) {\n        return false;\n    }\n    const result = parseRecord(state, parser);\n    return result ? callback(result) : false;\n}\nfunction exportBladeState(superExport, thisState) {\n    var _a;\n    return deepMerge((_a = superExport === null || superExport === void 0 ? void 0 : superExport()) !== null && _a !== void 0 ? _a : {}, thisState);\n}\n\nfunction isValueBladeController(bc) {\n    return 'value' in bc;\n}\n\nfunction isBindingValue(v) {\n    if (!isObject$1(v) || !('binding' in v)) {\n        return false;\n    }\n    const b = v.binding;\n    return isBinding(b);\n}\n\nconst SVG_NS = 'http://www.w3.org/2000/svg';\nfunction forceReflow(element) {\n    element.offsetHeight;\n}\nfunction disableTransitionTemporarily(element, callback) {\n    const t = element.style.transition;\n    element.style.transition = 'none';\n    callback();\n    element.style.transition = t;\n}\nfunction supportsTouch(doc) {\n    return doc.ontouchstart !== undefined;\n}\nfunction getGlobalObject() {\n    return globalThis;\n}\nfunction getWindowDocument() {\n    const globalObj = forceCast(getGlobalObject());\n    return globalObj.document;\n}\nfunction getCanvasContext(canvasElement) {\n    const win = canvasElement.ownerDocument.defaultView;\n    if (!win) {\n        return null;\n    }\n    const isBrowser = 'document' in win;\n    return isBrowser\n        ? canvasElement.getContext('2d', {\n            willReadFrequently: true,\n        })\n        : null;\n}\nconst ICON_ID_TO_INNER_HTML_MAP = {\n    check: '<path d=\"M2 8l4 4l8 -8\"/>',\n    dropdown: '<path d=\"M5 7h6l-3 3 z\"/>',\n    p2dpad: '<path d=\"M8 4v8\"/><path d=\"M4 8h8\"/><circle cx=\"12\" cy=\"12\" r=\"1.2\"/>',\n};\nfunction createSvgIconElement(document, iconId) {\n    const elem = document.createElementNS(SVG_NS, 'svg');\n    elem.innerHTML = ICON_ID_TO_INNER_HTML_MAP[iconId];\n    return elem;\n}\nfunction insertElementAt(parentElement, element, index) {\n    parentElement.insertBefore(element, parentElement.children[index]);\n}\nfunction removeElement(element) {\n    if (element.parentElement) {\n        element.parentElement.removeChild(element);\n    }\n}\nfunction removeChildElements(element) {\n    while (element.children.length > 0) {\n        element.removeChild(element.children[0]);\n    }\n}\nfunction removeChildNodes(element) {\n    while (element.childNodes.length > 0) {\n        element.removeChild(element.childNodes[0]);\n    }\n}\nfunction findNextTarget(ev) {\n    if (ev.relatedTarget) {\n        return forceCast(ev.relatedTarget);\n    }\n    if ('explicitOriginalTarget' in ev) {\n        return ev.explicitOriginalTarget;\n    }\n    return null;\n}\n\nfunction bindValue(value, applyValue) {\n    value.emitter.on('change', (ev) => {\n        applyValue(ev.rawValue);\n    });\n    applyValue(value.rawValue);\n}\nfunction bindValueMap(valueMap, key, applyValue) {\n    bindValue(valueMap.value(key), applyValue);\n}\n\nconst PREFIX = 'tp';\nfunction ClassName(viewName) {\n    const fn = (opt_elementName, opt_modifier) => {\n        return [\n            PREFIX,\n            '-',\n            viewName,\n            'v',\n            opt_elementName ? `_${opt_elementName}` : '',\n            opt_modifier ? `-${opt_modifier}` : '',\n        ].join('');\n    };\n    return fn;\n}\n\nconst cn$r = ClassName('lbl');\nfunction createLabelNode(doc, label) {\n    const frag = doc.createDocumentFragment();\n    const lineNodes = label.split('\\n').map((line) => {\n        return doc.createTextNode(line);\n    });\n    lineNodes.forEach((lineNode, index) => {\n        if (index > 0) {\n            frag.appendChild(doc.createElement('br'));\n        }\n        frag.appendChild(lineNode);\n    });\n    return frag;\n}\nclass LabelView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$r());\n        config.viewProps.bindClassModifiers(this.element);\n        const labelElem = doc.createElement('div');\n        labelElem.classList.add(cn$r('l'));\n        bindValueMap(config.props, 'label', (value) => {\n            if (isEmpty(value)) {\n                this.element.classList.add(cn$r(undefined, 'nol'));\n            }\n            else {\n                this.element.classList.remove(cn$r(undefined, 'nol'));\n                removeChildNodes(labelElem);\n                labelElem.appendChild(createLabelNode(doc, value));\n            }\n        });\n        this.element.appendChild(labelElem);\n        this.labelElement = labelElem;\n        const valueElem = doc.createElement('div');\n        valueElem.classList.add(cn$r('v'));\n        this.element.appendChild(valueElem);\n        this.valueElement = valueElem;\n    }\n}\n\nclass LabelController {\n    constructor(doc, config) {\n        this.props = config.props;\n        this.valueController = config.valueController;\n        this.viewProps = config.valueController.viewProps;\n        this.view = new LabelView(doc, {\n            props: config.props,\n            viewProps: this.viewProps,\n        });\n        this.view.valueElement.appendChild(this.valueController.view.element);\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            label: p.optional.string,\n        }), (result) => {\n            this.props.set('label', result.label);\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            label: this.props.get('label'),\n        });\n    }\n}\n\nfunction getAllBladePositions() {\n    return ['veryfirst', 'first', 'last', 'verylast'];\n}\n\nconst cn$q = ClassName('');\nconst POS_TO_CLASS_NAME_MAP = {\n    veryfirst: 'vfst',\n    first: 'fst',\n    last: 'lst',\n    verylast: 'vlst',\n};\nclass BladeController {\n    constructor(config) {\n        this.parent_ = null;\n        this.blade = config.blade;\n        this.view = config.view;\n        this.viewProps = config.viewProps;\n        const elem = this.view.element;\n        this.blade.value('positions').emitter.on('change', () => {\n            getAllBladePositions().forEach((pos) => {\n                elem.classList.remove(cn$q(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n            });\n            this.blade.get('positions').forEach((pos) => {\n                elem.classList.add(cn$q(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n            });\n        });\n        this.viewProps.handleDispose(() => {\n            removeElement(elem);\n        });\n    }\n    get parent() {\n        return this.parent_;\n    }\n    set parent(parent) {\n        this.parent_ = parent;\n        this.viewProps.set('parent', this.parent_ ? this.parent_.viewProps : null);\n    }\n    importState(state) {\n        return importBladeState(state, null, (p) => ({\n            disabled: p.required.boolean,\n            hidden: p.required.boolean,\n        }), (result) => {\n            this.viewProps.importState(result);\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(null, Object.assign({}, this.viewProps.exportState()));\n    }\n}\n\nclass LabeledValueBladeController extends BladeController {\n    constructor(doc, config) {\n        if (config.value !== config.valueController.value) {\n            throw TpError.shouldNeverHappen();\n        }\n        const viewProps = config.valueController.viewProps;\n        const lc = new LabelController(doc, {\n            blade: config.blade,\n            props: config.props,\n            valueController: config.valueController,\n        });\n        super(Object.assign(Object.assign({}, config), { view: new LabelView(doc, {\n                props: config.props,\n                viewProps: viewProps,\n            }), viewProps: viewProps }));\n        this.labelController = lc;\n        this.value = config.value;\n        this.valueController = config.valueController;\n        this.view.valueElement.appendChild(this.valueController.view.element);\n    }\n    importState(state) {\n        return importBladeState(state, (s) => {\n            var _a, _b, _c;\n            return super.importState(s) &&\n                this.labelController.importProps(s) &&\n                ((_c = (_b = (_a = this.valueController).importProps) === null || _b === void 0 ? void 0 : _b.call(_a, state)) !== null && _c !== void 0 ? _c : true);\n        }, (p) => ({\n            value: p.optional.raw,\n        }), (result) => {\n            if (result.value) {\n                this.value.rawValue = result.value;\n            }\n            return true;\n        });\n    }\n    exportState() {\n        var _a, _b, _c;\n        return exportBladeState(() => super.exportState(), Object.assign(Object.assign({ value: this.value.rawValue }, this.labelController.exportProps()), ((_c = (_b = (_a = this.valueController).exportProps) === null || _b === void 0 ? void 0 : _b.call(_a)) !== null && _c !== void 0 ? _c : {})));\n    }\n}\n\nfunction excludeValue(state) {\n    const result = Object.assign({}, state);\n    delete result.value;\n    return result;\n}\nclass BindingController extends LabeledValueBladeController {\n    constructor(doc, config) {\n        super(doc, config);\n        this.tag = config.tag;\n    }\n    importState(state) {\n        return importBladeState(state,\n        (_s) => super.importState(excludeValue(state)), (p) => ({\n            tag: p.optional.string,\n        }), (result) => {\n            this.tag = result.tag;\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(() => excludeValue(super.exportState()), {\n            binding: {\n                key: this.value.binding.target.key,\n                value: this.value.binding.target.read(),\n            },\n            tag: this.tag,\n        });\n    }\n}\nfunction isBindingController(bc) {\n    return isValueBladeController(bc) && isBindingValue(bc.value);\n}\n\nclass InputBindingController extends BindingController {\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            binding: p.required.object({\n                value: p.required.raw,\n            }),\n        }), (result) => {\n            this.value.binding.inject(result.binding.value);\n            this.value.fetch();\n            return true;\n        });\n    }\n}\nfunction isInputBindingController(bc) {\n    return isValueBladeController(bc) && isInputBindingValue(bc.value);\n}\n\nfunction fillBuffer(buffer, bufferSize) {\n    while (buffer.length < bufferSize) {\n        buffer.push(undefined);\n    }\n}\nfunction initializeBuffer(bufferSize) {\n    const buffer = [];\n    fillBuffer(buffer, bufferSize);\n    return buffer;\n}\nfunction createTrimmedBuffer(buffer) {\n    const index = buffer.indexOf(undefined);\n    return forceCast(index < 0 ? buffer : buffer.slice(0, index));\n}\nfunction createPushedBuffer(buffer, newValue) {\n    const newBuffer = [...createTrimmedBuffer(buffer), newValue];\n    if (newBuffer.length > buffer.length) {\n        newBuffer.splice(0, newBuffer.length - buffer.length);\n    }\n    else {\n        fillBuffer(newBuffer, buffer.length);\n    }\n    return newBuffer;\n}\n\nclass MonitorBindingValue {\n    constructor(config) {\n        this.emitter = new Emitter();\n        this.onTick_ = this.onTick_.bind(this);\n        this.onValueBeforeChange_ = this.onValueBeforeChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.binding = config.binding;\n        this.value_ = createValue(initializeBuffer(config.bufferSize));\n        this.value_.emitter.on('beforechange', this.onValueBeforeChange_);\n        this.value_.emitter.on('change', this.onValueChange_);\n        this.ticker = config.ticker;\n        this.ticker.emitter.on('tick', this.onTick_);\n        this.fetch();\n    }\n    get rawValue() {\n        return this.value_.rawValue;\n    }\n    set rawValue(rawValue) {\n        this.value_.rawValue = rawValue;\n    }\n    setRawValue(rawValue, options) {\n        this.value_.setRawValue(rawValue, options);\n    }\n    fetch() {\n        this.value_.rawValue = createPushedBuffer(this.value_.rawValue, this.binding.read());\n    }\n    onTick_() {\n        this.fetch();\n    }\n    onValueBeforeChange_(ev) {\n        this.emitter.emit('beforechange', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n    onValueChange_(ev) {\n        this.emitter.emit('change', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n}\nfunction isMonitorBindingValue(v) {\n    if (!('binding' in v)) {\n        return false;\n    }\n    const b = v['binding'];\n    return isBinding(b) && 'read' in b && !('write' in b);\n}\n\nclass MonitorBindingController extends BindingController {\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            binding: {\n                readonly: true,\n            },\n        });\n    }\n}\nfunction isMonitorBindingController(bc) {\n    return (isValueBladeController(bc) &&\n        isMonitorBindingValue(bc.value));\n}\n\nclass ButtonApi extends BladeApi {\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get title() {\n        var _a;\n        return (_a = this.controller.buttonController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n    }\n    set title(title) {\n        this.controller.buttonController.props.set('title', title);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        const emitter = this.controller.buttonController.emitter;\n        emitter.on(eventName, () => {\n            bh(new TpEvent(this));\n        });\n        return this;\n    }\n}\n\nfunction applyClass(elem, className, active) {\n    if (active) {\n        elem.classList.add(className);\n    }\n    else {\n        elem.classList.remove(className);\n    }\n}\nfunction valueToClassName(elem, className) {\n    return (value) => {\n        applyClass(elem, className, value);\n    };\n}\nfunction bindValueToTextContent(value, elem) {\n    bindValue(value, (text) => {\n        elem.textContent = text !== null && text !== void 0 ? text : '';\n    });\n}\n\nconst cn$p = ClassName('btn');\nclass ButtonView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$p());\n        config.viewProps.bindClassModifiers(this.element);\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$p('b'));\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(cn$p('t'));\n        bindValueToTextContent(config.props.value('title'), titleElem);\n        this.buttonElement.appendChild(titleElem);\n    }\n}\n\nclass ButtonController {\n    constructor(doc, config) {\n        this.emitter = new Emitter();\n        this.onClick_ = this.onClick_.bind(this);\n        this.props = config.props;\n        this.viewProps = config.viewProps;\n        this.view = new ButtonView(doc, {\n            props: this.props,\n            viewProps: this.viewProps,\n        });\n        this.view.buttonElement.addEventListener('click', this.onClick_);\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            title: p.optional.string,\n        }), (result) => {\n            this.props.set('title', result.title);\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            title: this.props.get('title'),\n        });\n    }\n    onClick_() {\n        this.emitter.emit('click', {\n            sender: this,\n        });\n    }\n}\n\nclass ButtonBladeController extends BladeController {\n    constructor(doc, config) {\n        const bc = new ButtonController(doc, {\n            props: config.buttonProps,\n            viewProps: config.viewProps,\n        });\n        const lc = new LabelController(doc, {\n            blade: config.blade,\n            props: config.labelProps,\n            valueController: bc,\n        });\n        super({\n            blade: config.blade,\n            view: lc.view,\n            viewProps: config.viewProps,\n        });\n        this.buttonController = bc;\n        this.labelController = lc;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s) &&\n            this.buttonController.importProps(s) &&\n            this.labelController.importProps(s), () => ({}), () => true);\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), Object.assign(Object.assign({}, this.buttonController.exportProps()), this.labelController.exportProps()));\n    }\n}\n\nclass Semver {\n    constructor(text) {\n        const [core, prerelease] = text.split('-');\n        const coreComps = core.split('.');\n        this.major = parseInt(coreComps[0], 10);\n        this.minor = parseInt(coreComps[1], 10);\n        this.patch = parseInt(coreComps[2], 10);\n        this.prerelease = prerelease !== null && prerelease !== void 0 ? prerelease : null;\n    }\n    toString() {\n        const core = [this.major, this.minor, this.patch].join('.');\n        return this.prerelease !== null ? [core, this.prerelease].join('-') : core;\n    }\n}\n\nconst VERSION$1 = new Semver('2.0.1');\n\nfunction createPlugin(plugin) {\n    return Object.assign({ core: VERSION$1 }, plugin);\n}\n\nconst ButtonBladePlugin = createPlugin({\n    id: 'button',\n    type: 'blade',\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            title: p.required.string,\n            view: p.required.constant('button'),\n            label: p.optional.string,\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        return new ButtonBladeController(args.document, {\n            blade: args.blade,\n            buttonProps: ValueMap.fromObject({\n                title: args.params.title,\n            }),\n            labelProps: ValueMap.fromObject({\n                label: args.params.label,\n            }),\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (args.controller instanceof ButtonBladeController) {\n            return new ButtonApi(args.controller);\n        }\n        return null;\n    },\n});\n\nfunction addButtonAsBlade(api, params) {\n    return api.addBlade(Object.assign(Object.assign({}, params), { view: 'button' }));\n}\nfunction addFolderAsBlade(api, params) {\n    return api.addBlade(Object.assign(Object.assign({}, params), { view: 'folder' }));\n}\nfunction addTabAsBlade(api, params) {\n    return api.addBlade(Object.assign(Object.assign({}, params), { view: 'tab' }));\n}\n\nfunction isRefreshable(value) {\n    if (!isObject$1(value)) {\n        return false;\n    }\n    return 'refresh' in value && typeof value.refresh === 'function';\n}\n\nfunction createBindingTarget(obj, key) {\n    if (!BindingTarget.isBindable(obj)) {\n        throw TpError.notBindable();\n    }\n    return new BindingTarget(obj, key);\n}\nclass RackApi {\n    constructor(controller, pool) {\n        this.onRackValueChange_ = this.onRackValueChange_.bind(this);\n        this.controller_ = controller;\n        this.emitter_ = new Emitter();\n        this.pool_ = pool;\n        const rack = this.controller_.rack;\n        rack.emitter.on('valuechange', this.onRackValueChange_);\n    }\n    get children() {\n        return this.controller_.rack.children.map((bc) => this.pool_.createApi(bc));\n    }\n    addBinding(object, key, opt_params) {\n        const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n        const doc = this.controller_.element.ownerDocument;\n        const bc = this.pool_.createBinding(doc, createBindingTarget(object, key), params);\n        const api = this.pool_.createBindingApi(bc);\n        return this.add(api, params.index);\n    }\n    addFolder(params) {\n        return addFolderAsBlade(this, params);\n    }\n    addButton(params) {\n        return addButtonAsBlade(this, params);\n    }\n    addTab(params) {\n        return addTabAsBlade(this, params);\n    }\n    add(api, opt_index) {\n        const bc = api.controller;\n        this.controller_.rack.add(bc, opt_index);\n        return api;\n    }\n    remove(api) {\n        this.controller_.rack.remove(api.controller);\n    }\n    addBlade(params) {\n        const doc = this.controller_.element.ownerDocument;\n        const bc = this.pool_.createBlade(doc, params);\n        const api = this.pool_.createApi(bc);\n        return this.add(api, params.index);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        });\n        return this;\n    }\n    refresh() {\n        this.children.forEach((c) => {\n            if (isRefreshable(c)) {\n                c.refresh();\n            }\n        });\n    }\n    onRackValueChange_(ev) {\n        const bc = ev.bladeController;\n        const api = this.pool_.createApi(bc);\n        const binding = isBindingValue(bc.value) ? bc.value.binding : null;\n        this.emitter_.emit('change', new TpChangeEvent(api, binding ? binding.target.read() : bc.value.rawValue, ev.options.last));\n    }\n}\n\nclass ContainerBladeApi extends BladeApi {\n    constructor(controller, pool) {\n        super(controller);\n        this.rackApi_ = new RackApi(controller.rackController, pool);\n    }\n    refresh() {\n        this.rackApi_.refresh();\n    }\n}\n\nclass ContainerBladeController extends BladeController {\n    constructor(config) {\n        super({\n            blade: config.blade,\n            view: config.view,\n            viewProps: config.rackController.viewProps,\n        });\n        this.rackController = config.rackController;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            children: p.required.array(p.required.raw),\n        }), (result) => {\n            return this.rackController.rack.children.every((c, index) => {\n                return c.importState(result.children[index]);\n            });\n        });\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            children: this.rackController.rack.children.map((c) => c.exportState()),\n        });\n    }\n}\nfunction isContainerBladeController(bc) {\n    return 'rackController' in bc;\n}\n\nclass NestedOrderedSet {\n    constructor(extract) {\n        this.emitter = new Emitter();\n        this.items_ = [];\n        this.cache_ = new Set();\n        this.onSubListAdd_ = this.onSubListAdd_.bind(this);\n        this.onSubListRemove_ = this.onSubListRemove_.bind(this);\n        this.extract_ = extract;\n    }\n    get items() {\n        return this.items_;\n    }\n    allItems() {\n        return Array.from(this.cache_);\n    }\n    find(callback) {\n        for (const item of this.allItems()) {\n            if (callback(item)) {\n                return item;\n            }\n        }\n        return null;\n    }\n    includes(item) {\n        return this.cache_.has(item);\n    }\n    add(item, opt_index) {\n        if (this.includes(item)) {\n            throw TpError.shouldNeverHappen();\n        }\n        const index = opt_index !== undefined ? opt_index : this.items_.length;\n        this.items_.splice(index, 0, item);\n        this.cache_.add(item);\n        const subList = this.extract_(item);\n        if (subList) {\n            subList.emitter.on('add', this.onSubListAdd_);\n            subList.emitter.on('remove', this.onSubListRemove_);\n            subList.allItems().forEach((i) => {\n                this.cache_.add(i);\n            });\n        }\n        this.emitter.emit('add', {\n            index: index,\n            item: item,\n            root: this,\n            target: this,\n        });\n    }\n    remove(item) {\n        const index = this.items_.indexOf(item);\n        if (index < 0) {\n            return;\n        }\n        this.items_.splice(index, 1);\n        this.cache_.delete(item);\n        const subList = this.extract_(item);\n        if (subList) {\n            subList.allItems().forEach((i) => {\n                this.cache_.delete(i);\n            });\n            subList.emitter.off('add', this.onSubListAdd_);\n            subList.emitter.off('remove', this.onSubListRemove_);\n        }\n        this.emitter.emit('remove', {\n            index: index,\n            item: item,\n            root: this,\n            target: this,\n        });\n    }\n    onSubListAdd_(ev) {\n        this.cache_.add(ev.item);\n        this.emitter.emit('add', {\n            index: ev.index,\n            item: ev.item,\n            root: this,\n            target: ev.target,\n        });\n    }\n    onSubListRemove_(ev) {\n        this.cache_.delete(ev.item);\n        this.emitter.emit('remove', {\n            index: ev.index,\n            item: ev.item,\n            root: this,\n            target: ev.target,\n        });\n    }\n}\n\nfunction findValueBladeController(bcs, v) {\n    for (let i = 0; i < bcs.length; i++) {\n        const bc = bcs[i];\n        if (isValueBladeController(bc) && bc.value === v) {\n            return bc;\n        }\n    }\n    return null;\n}\nfunction findSubBladeControllerSet(bc) {\n    return isContainerBladeController(bc)\n        ? bc.rackController.rack['bcSet_']\n        : null;\n}\nclass Rack {\n    constructor(config) {\n        var _a, _b;\n        this.emitter = new Emitter();\n        this.onBladePositionsChange_ = this.onBladePositionsChange_.bind(this);\n        this.onSetAdd_ = this.onSetAdd_.bind(this);\n        this.onSetRemove_ = this.onSetRemove_.bind(this);\n        this.onChildDispose_ = this.onChildDispose_.bind(this);\n        this.onChildPositionsChange_ = this.onChildPositionsChange_.bind(this);\n        this.onChildValueChange_ = this.onChildValueChange_.bind(this);\n        this.onChildViewPropsChange_ = this.onChildViewPropsChange_.bind(this);\n        this.onRackLayout_ = this.onRackLayout_.bind(this);\n        this.onRackValueChange_ = this.onRackValueChange_.bind(this);\n        this.blade_ = (_a = config.blade) !== null && _a !== void 0 ? _a : null;\n        (_b = this.blade_) === null || _b === void 0 ? void 0 : _b.value('positions').emitter.on('change', this.onBladePositionsChange_);\n        this.viewProps = config.viewProps;\n        this.bcSet_ = new NestedOrderedSet(findSubBladeControllerSet);\n        this.bcSet_.emitter.on('add', this.onSetAdd_);\n        this.bcSet_.emitter.on('remove', this.onSetRemove_);\n    }\n    get children() {\n        return this.bcSet_.items;\n    }\n    add(bc, opt_index) {\n        var _a;\n        (_a = bc.parent) === null || _a === void 0 ? void 0 : _a.remove(bc);\n        bc.parent = this;\n        this.bcSet_.add(bc, opt_index);\n    }\n    remove(bc) {\n        bc.parent = null;\n        this.bcSet_.remove(bc);\n    }\n    find(finder) {\n        return this.bcSet_.allItems().filter(finder);\n    }\n    onSetAdd_(ev) {\n        this.updatePositions_();\n        const root = ev.target === ev.root;\n        this.emitter.emit('add', {\n            bladeController: ev.item,\n            index: ev.index,\n            root: root,\n            sender: this,\n        });\n        if (!root) {\n            return;\n        }\n        const bc = ev.item;\n        bc.viewProps.emitter.on('change', this.onChildViewPropsChange_);\n        bc.blade\n            .value('positions')\n            .emitter.on('change', this.onChildPositionsChange_);\n        bc.viewProps.handleDispose(this.onChildDispose_);\n        if (isValueBladeController(bc)) {\n            bc.value.emitter.on('change', this.onChildValueChange_);\n        }\n        else if (isContainerBladeController(bc)) {\n            const rack = bc.rackController.rack;\n            if (rack) {\n                const emitter = rack.emitter;\n                emitter.on('layout', this.onRackLayout_);\n                emitter.on('valuechange', this.onRackValueChange_);\n            }\n        }\n    }\n    onSetRemove_(ev) {\n        this.updatePositions_();\n        const root = ev.target === ev.root;\n        this.emitter.emit('remove', {\n            bladeController: ev.item,\n            root: root,\n            sender: this,\n        });\n        if (!root) {\n            return;\n        }\n        const bc = ev.item;\n        if (isValueBladeController(bc)) {\n            bc.value.emitter.off('change', this.onChildValueChange_);\n        }\n        else if (isContainerBladeController(bc)) {\n            const rack = bc.rackController.rack;\n            if (rack) {\n                const emitter = rack.emitter;\n                emitter.off('layout', this.onRackLayout_);\n                emitter.off('valuechange', this.onRackValueChange_);\n            }\n        }\n    }\n    updatePositions_() {\n        const visibleItems = this.bcSet_.items.filter((bc) => !bc.viewProps.get('hidden'));\n        const firstVisibleItem = visibleItems[0];\n        const lastVisibleItem = visibleItems[visibleItems.length - 1];\n        this.bcSet_.items.forEach((bc) => {\n            const ps = [];\n            if (bc === firstVisibleItem) {\n                ps.push('first');\n                if (!this.blade_ ||\n                    this.blade_.get('positions').includes('veryfirst')) {\n                    ps.push('veryfirst');\n                }\n            }\n            if (bc === lastVisibleItem) {\n                ps.push('last');\n                if (!this.blade_ || this.blade_.get('positions').includes('verylast')) {\n                    ps.push('verylast');\n                }\n            }\n            bc.blade.set('positions', ps);\n        });\n    }\n    onChildPositionsChange_() {\n        this.updatePositions_();\n        this.emitter.emit('layout', {\n            sender: this,\n        });\n    }\n    onChildViewPropsChange_(_ev) {\n        this.updatePositions_();\n        this.emitter.emit('layout', {\n            sender: this,\n        });\n    }\n    onChildDispose_() {\n        const disposedUcs = this.bcSet_.items.filter((bc) => {\n            return bc.viewProps.get('disposed');\n        });\n        disposedUcs.forEach((bc) => {\n            this.bcSet_.remove(bc);\n        });\n    }\n    onChildValueChange_(ev) {\n        const bc = findValueBladeController(this.find(isValueBladeController), ev.sender);\n        if (!bc) {\n            throw TpError.alreadyDisposed();\n        }\n        this.emitter.emit('valuechange', {\n            bladeController: bc,\n            options: ev.options,\n            sender: this,\n        });\n    }\n    onRackLayout_(_) {\n        this.updatePositions_();\n        this.emitter.emit('layout', {\n            sender: this,\n        });\n    }\n    onRackValueChange_(ev) {\n        this.emitter.emit('valuechange', {\n            bladeController: ev.bladeController,\n            options: ev.options,\n            sender: this,\n        });\n    }\n    onBladePositionsChange_() {\n        this.updatePositions_();\n    }\n}\n\nclass RackController {\n    constructor(config) {\n        this.onRackAdd_ = this.onRackAdd_.bind(this);\n        this.onRackRemove_ = this.onRackRemove_.bind(this);\n        this.element = config.element;\n        this.viewProps = config.viewProps;\n        const rack = new Rack({\n            blade: config.root ? undefined : config.blade,\n            viewProps: config.viewProps,\n        });\n        rack.emitter.on('add', this.onRackAdd_);\n        rack.emitter.on('remove', this.onRackRemove_);\n        this.rack = rack;\n        this.viewProps.handleDispose(() => {\n            for (let i = this.rack.children.length - 1; i >= 0; i--) {\n                const bc = this.rack.children[i];\n                bc.viewProps.set('disposed', true);\n            }\n        });\n    }\n    onRackAdd_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        insertElementAt(this.element, ev.bladeController.view.element, ev.index);\n    }\n    onRackRemove_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        removeElement(ev.bladeController.view.element);\n    }\n}\n\nfunction createBlade() {\n    return new ValueMap({\n        positions: createValue([], {\n            equals: deepEqualsArray,\n        }),\n    });\n}\n\nclass Foldable extends ValueMap {\n    constructor(valueMap) {\n        super(valueMap);\n    }\n    static create(expanded) {\n        const coreObj = {\n            completed: true,\n            expanded: expanded,\n            expandedHeight: null,\n            shouldFixHeight: false,\n            temporaryExpanded: null,\n        };\n        const core = ValueMap.createCore(coreObj);\n        return new Foldable(core);\n    }\n    get styleExpanded() {\n        var _a;\n        return (_a = this.get('temporaryExpanded')) !== null && _a !== void 0 ? _a : this.get('expanded');\n    }\n    get styleHeight() {\n        if (!this.styleExpanded) {\n            return '0';\n        }\n        const exHeight = this.get('expandedHeight');\n        if (this.get('shouldFixHeight') && !isEmpty(exHeight)) {\n            return `${exHeight}px`;\n        }\n        return 'auto';\n    }\n    bindExpandedClass(elem, expandedClassName) {\n        const onExpand = () => {\n            const expanded = this.styleExpanded;\n            if (expanded) {\n                elem.classList.add(expandedClassName);\n            }\n            else {\n                elem.classList.remove(expandedClassName);\n            }\n        };\n        bindValueMap(this, 'expanded', onExpand);\n        bindValueMap(this, 'temporaryExpanded', onExpand);\n    }\n    cleanUpTransition() {\n        this.set('shouldFixHeight', false);\n        this.set('expandedHeight', null);\n        this.set('completed', true);\n    }\n}\nfunction computeExpandedFolderHeight(folder, containerElement) {\n    let height = 0;\n    disableTransitionTemporarily(containerElement, () => {\n        folder.set('expandedHeight', null);\n        folder.set('temporaryExpanded', true);\n        forceReflow(containerElement);\n        height = containerElement.clientHeight;\n        folder.set('temporaryExpanded', null);\n        forceReflow(containerElement);\n    });\n    return height;\n}\nfunction applyHeight(foldable, elem) {\n    elem.style.height = foldable.styleHeight;\n}\nfunction bindFoldable(foldable, elem) {\n    foldable.value('expanded').emitter.on('beforechange', () => {\n        foldable.set('completed', false);\n        if (isEmpty(foldable.get('expandedHeight'))) {\n            const h = computeExpandedFolderHeight(foldable, elem);\n            if (h > 0) {\n                foldable.set('expandedHeight', h);\n            }\n        }\n        foldable.set('shouldFixHeight', true);\n        forceReflow(elem);\n    });\n    foldable.emitter.on('change', () => {\n        applyHeight(foldable, elem);\n    });\n    applyHeight(foldable, elem);\n    elem.addEventListener('transitionend', (ev) => {\n        if (ev.propertyName !== 'height') {\n            return;\n        }\n        foldable.cleanUpTransition();\n    });\n}\n\nclass FolderApi extends ContainerBladeApi {\n    constructor(controller, pool) {\n        super(controller, pool);\n        this.emitter_ = new Emitter();\n        this.controller.foldable\n            .value('expanded')\n            .emitter.on('change', (ev) => {\n            this.emitter_.emit('fold', new TpFoldEvent(this, ev.sender.rawValue));\n        });\n        this.rackApi_.on('change', (ev) => {\n            this.emitter_.emit('change', ev);\n        });\n    }\n    get expanded() {\n        return this.controller.foldable.get('expanded');\n    }\n    set expanded(expanded) {\n        this.controller.foldable.set('expanded', expanded);\n    }\n    get title() {\n        return this.controller.props.get('title');\n    }\n    set title(title) {\n        this.controller.props.set('title', title);\n    }\n    get children() {\n        return this.rackApi_.children;\n    }\n    addBinding(object, key, opt_params) {\n        return this.rackApi_.addBinding(object, key, opt_params);\n    }\n    addFolder(params) {\n        return this.rackApi_.addFolder(params);\n    }\n    addButton(params) {\n        return this.rackApi_.addButton(params);\n    }\n    addTab(params) {\n        return this.rackApi_.addTab(params);\n    }\n    add(api, opt_index) {\n        return this.rackApi_.add(api, opt_index);\n    }\n    remove(api) {\n        this.rackApi_.remove(api);\n    }\n    addBlade(params) {\n        return this.rackApi_.addBlade(params);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        });\n        return this;\n    }\n}\n\nconst bladeContainerClassName = ClassName('cnt');\n\nclass FolderView {\n    constructor(doc, config) {\n        var _a;\n        this.className_ = ClassName((_a = config.viewName) !== null && _a !== void 0 ? _a : 'fld');\n        this.element = doc.createElement('div');\n        this.element.classList.add(this.className_(), bladeContainerClassName());\n        config.viewProps.bindClassModifiers(this.element);\n        this.foldable_ = config.foldable;\n        this.foldable_.bindExpandedClass(this.element, this.className_(undefined, 'expanded'));\n        bindValueMap(this.foldable_, 'completed', valueToClassName(this.element, this.className_(undefined, 'cpl')));\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(this.className_('b'));\n        bindValueMap(config.props, 'title', (title) => {\n            if (isEmpty(title)) {\n                this.element.classList.add(this.className_(undefined, 'not'));\n            }\n            else {\n                this.element.classList.remove(this.className_(undefined, 'not'));\n            }\n        });\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const indentElem = doc.createElement('div');\n        indentElem.classList.add(this.className_('i'));\n        this.element.appendChild(indentElem);\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(this.className_('t'));\n        bindValueToTextContent(config.props.value('title'), titleElem);\n        this.buttonElement.appendChild(titleElem);\n        this.titleElement = titleElem;\n        const markElem = doc.createElement('div');\n        markElem.classList.add(this.className_('m'));\n        this.buttonElement.appendChild(markElem);\n        const containerElem = doc.createElement('div');\n        containerElem.classList.add(this.className_('c'));\n        this.element.appendChild(containerElem);\n        this.containerElement = containerElem;\n    }\n}\n\nclass FolderController extends ContainerBladeController {\n    constructor(doc, config) {\n        var _a;\n        const foldable = Foldable.create((_a = config.expanded) !== null && _a !== void 0 ? _a : true);\n        const view = new FolderView(doc, {\n            foldable: foldable,\n            props: config.props,\n            viewName: config.root ? 'rot' : undefined,\n            viewProps: config.viewProps,\n        });\n        super(Object.assign(Object.assign({}, config), { rackController: new RackController({\n                blade: config.blade,\n                element: view.containerElement,\n                root: config.root,\n                viewProps: config.viewProps,\n            }), view: view }));\n        this.onTitleClick_ = this.onTitleClick_.bind(this);\n        this.props = config.props;\n        this.foldable = foldable;\n        bindFoldable(this.foldable, this.view.containerElement);\n        this.rackController.rack.emitter.on('add', () => {\n            this.foldable.cleanUpTransition();\n        });\n        this.rackController.rack.emitter.on('remove', () => {\n            this.foldable.cleanUpTransition();\n        });\n        this.view.buttonElement.addEventListener('click', this.onTitleClick_);\n    }\n    get document() {\n        return this.view.element.ownerDocument;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            expanded: p.required.boolean,\n            title: p.optional.string,\n        }), (result) => {\n            this.foldable.set('expanded', result.expanded);\n            this.props.set('title', result.title);\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            expanded: this.foldable.get('expanded'),\n            title: this.props.get('title'),\n        });\n    }\n    onTitleClick_() {\n        this.foldable.set('expanded', !this.foldable.get('expanded'));\n    }\n}\n\nconst FolderBladePlugin = createPlugin({\n    id: 'folder',\n    type: 'blade',\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            title: p.required.string,\n            view: p.required.constant('folder'),\n            expanded: p.optional.boolean,\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        return new FolderController(args.document, {\n            blade: args.blade,\n            expanded: args.params.expanded,\n            props: ValueMap.fromObject({\n                title: args.params.title,\n            }),\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (!(args.controller instanceof FolderController)) {\n            return null;\n        }\n        return new FolderApi(args.controller, args.pool);\n    },\n});\n\nconst cn$o = ClassName('');\nfunction valueToModifier(elem, modifier) {\n    return valueToClassName(elem, cn$o(undefined, modifier));\n}\nclass ViewProps extends ValueMap {\n    constructor(valueMap) {\n        var _a;\n        super(valueMap);\n        this.onDisabledChange_ = this.onDisabledChange_.bind(this);\n        this.onParentChange_ = this.onParentChange_.bind(this);\n        this.onParentGlobalDisabledChange_ =\n            this.onParentGlobalDisabledChange_.bind(this);\n        [this.globalDisabled_, this.setGlobalDisabled_] = createReadonlyValue(createValue(this.getGlobalDisabled_()));\n        this.value('disabled').emitter.on('change', this.onDisabledChange_);\n        this.value('parent').emitter.on('change', this.onParentChange_);\n        (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n    }\n    static create(opt_initialValue) {\n        var _a, _b, _c;\n        const initialValue = opt_initialValue !== null && opt_initialValue !== void 0 ? opt_initialValue : {};\n        return new ViewProps(ValueMap.createCore({\n            disabled: (_a = initialValue.disabled) !== null && _a !== void 0 ? _a : false,\n            disposed: false,\n            hidden: (_b = initialValue.hidden) !== null && _b !== void 0 ? _b : false,\n            parent: (_c = initialValue.parent) !== null && _c !== void 0 ? _c : null,\n        }));\n    }\n    get globalDisabled() {\n        return this.globalDisabled_;\n    }\n    bindClassModifiers(elem) {\n        bindValue(this.globalDisabled_, valueToModifier(elem, 'disabled'));\n        bindValueMap(this, 'hidden', valueToModifier(elem, 'hidden'));\n    }\n    bindDisabled(target) {\n        bindValue(this.globalDisabled_, (disabled) => {\n            target.disabled = disabled;\n        });\n    }\n    bindTabIndex(elem) {\n        bindValue(this.globalDisabled_, (disabled) => {\n            elem.tabIndex = disabled ? -1 : 0;\n        });\n    }\n    handleDispose(callback) {\n        this.value('disposed').emitter.on('change', (disposed) => {\n            if (disposed) {\n                callback();\n            }\n        });\n    }\n    importState(state) {\n        this.set('disabled', state.disabled);\n        this.set('hidden', state.hidden);\n    }\n    exportState() {\n        return {\n            disabled: this.get('disabled'),\n            hidden: this.get('hidden'),\n        };\n    }\n    getGlobalDisabled_() {\n        const parent = this.get('parent');\n        const parentDisabled = parent ? parent.globalDisabled.rawValue : false;\n        return parentDisabled || this.get('disabled');\n    }\n    updateGlobalDisabled_() {\n        this.setGlobalDisabled_(this.getGlobalDisabled_());\n    }\n    onDisabledChange_() {\n        this.updateGlobalDisabled_();\n    }\n    onParentGlobalDisabledChange_() {\n        this.updateGlobalDisabled_();\n    }\n    onParentChange_(ev) {\n        var _a;\n        const prevParent = ev.previousRawValue;\n        prevParent === null || prevParent === void 0 ? void 0 : prevParent.globalDisabled.emitter.off('change', this.onParentGlobalDisabledChange_);\n        (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n        this.updateGlobalDisabled_();\n    }\n}\n\nconst cn$n = ClassName('tbp');\nclass TabPageView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$n());\n        config.viewProps.bindClassModifiers(this.element);\n        const containerElem = doc.createElement('div');\n        containerElem.classList.add(cn$n('c'));\n        this.element.appendChild(containerElem);\n        this.containerElement = containerElem;\n    }\n}\n\nconst cn$m = ClassName('tbi');\nclass TabItemView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$m());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValueMap(config.props, 'selected', (selected) => {\n            if (selected) {\n                this.element.classList.add(cn$m(undefined, 'sel'));\n            }\n            else {\n                this.element.classList.remove(cn$m(undefined, 'sel'));\n            }\n        });\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$m('b'));\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(cn$m('t'));\n        bindValueToTextContent(config.props.value('title'), titleElem);\n        this.buttonElement.appendChild(titleElem);\n        this.titleElement = titleElem;\n    }\n}\n\nclass TabItemController {\n    constructor(doc, config) {\n        this.emitter = new Emitter();\n        this.onClick_ = this.onClick_.bind(this);\n        this.props = config.props;\n        this.viewProps = config.viewProps;\n        this.view = new TabItemView(doc, {\n            props: config.props,\n            viewProps: config.viewProps,\n        });\n        this.view.buttonElement.addEventListener('click', this.onClick_);\n    }\n    onClick_() {\n        this.emitter.emit('click', {\n            sender: this,\n        });\n    }\n}\n\nclass TabPageController extends ContainerBladeController {\n    constructor(doc, config) {\n        const view = new TabPageView(doc, {\n            viewProps: config.viewProps,\n        });\n        super(Object.assign(Object.assign({}, config), { rackController: new RackController({\n                blade: config.blade,\n                element: view.containerElement,\n                viewProps: config.viewProps,\n            }), view: view }));\n        this.onItemClick_ = this.onItemClick_.bind(this);\n        this.ic_ = new TabItemController(doc, {\n            props: config.itemProps,\n            viewProps: ViewProps.create(),\n        });\n        this.ic_.emitter.on('click', this.onItemClick_);\n        this.props = config.props;\n        bindValueMap(this.props, 'selected', (selected) => {\n            this.itemController.props.set('selected', selected);\n            this.viewProps.set('hidden', !selected);\n        });\n    }\n    get itemController() {\n        return this.ic_;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            selected: p.required.boolean,\n            title: p.required.string,\n        }), (result) => {\n            this.ic_.props.set('selected', result.selected);\n            this.ic_.props.set('title', result.title);\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            selected: this.ic_.props.get('selected'),\n            title: this.ic_.props.get('title'),\n        });\n    }\n    onItemClick_() {\n        this.props.set('selected', true);\n    }\n}\n\nclass TabApi extends ContainerBladeApi {\n    constructor(controller, pool) {\n        super(controller, pool);\n        this.emitter_ = new Emitter();\n        this.onSelect_ = this.onSelect_.bind(this);\n        this.pool_ = pool;\n        this.rackApi_.on('change', (ev) => {\n            this.emitter_.emit('change', ev);\n        });\n        this.controller.tab.selectedIndex.emitter.on('change', this.onSelect_);\n    }\n    get pages() {\n        return this.rackApi_.children;\n    }\n    addPage(params) {\n        const doc = this.controller.view.element.ownerDocument;\n        const pc = new TabPageController(doc, {\n            blade: createBlade(),\n            itemProps: ValueMap.fromObject({\n                selected: false,\n                title: params.title,\n            }),\n            props: ValueMap.fromObject({\n                selected: false,\n            }),\n            viewProps: ViewProps.create(),\n        });\n        const papi = this.pool_.createApi(pc);\n        return this.rackApi_.add(papi, params.index);\n    }\n    removePage(index) {\n        this.rackApi_.remove(this.rackApi_.children[index]);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        });\n        return this;\n    }\n    onSelect_(ev) {\n        this.emitter_.emit('select', new TpTabSelectEvent(this, ev.rawValue));\n    }\n}\n\nclass TabPageApi extends ContainerBladeApi {\n    get title() {\n        var _a;\n        return (_a = this.controller.itemController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n    }\n    set title(title) {\n        this.controller.itemController.props.set('title', title);\n    }\n    get selected() {\n        return this.controller.props.get('selected');\n    }\n    set selected(selected) {\n        this.controller.props.set('selected', selected);\n    }\n    get children() {\n        return this.rackApi_.children;\n    }\n    addButton(params) {\n        return this.rackApi_.addButton(params);\n    }\n    addFolder(params) {\n        return this.rackApi_.addFolder(params);\n    }\n    addTab(params) {\n        return this.rackApi_.addTab(params);\n    }\n    add(api, opt_index) {\n        this.rackApi_.add(api, opt_index);\n    }\n    remove(api) {\n        this.rackApi_.remove(api);\n    }\n    addBinding(object, key, opt_params) {\n        return this.rackApi_.addBinding(object, key, opt_params);\n    }\n    addBlade(params) {\n        return this.rackApi_.addBlade(params);\n    }\n}\n\nconst INDEX_NOT_SELECTED = -1;\nclass Tab {\n    constructor() {\n        this.onItemSelectedChange_ = this.onItemSelectedChange_.bind(this);\n        this.empty = createValue(true);\n        this.selectedIndex = createValue(INDEX_NOT_SELECTED);\n        this.items_ = [];\n    }\n    add(item, opt_index) {\n        const index = opt_index !== null && opt_index !== void 0 ? opt_index : this.items_.length;\n        this.items_.splice(index, 0, item);\n        item.emitter.on('change', this.onItemSelectedChange_);\n        this.keepSelection_();\n    }\n    remove(item) {\n        const index = this.items_.indexOf(item);\n        if (index < 0) {\n            return;\n        }\n        this.items_.splice(index, 1);\n        item.emitter.off('change', this.onItemSelectedChange_);\n        this.keepSelection_();\n    }\n    keepSelection_() {\n        if (this.items_.length === 0) {\n            this.selectedIndex.rawValue = INDEX_NOT_SELECTED;\n            this.empty.rawValue = true;\n            return;\n        }\n        const firstSelIndex = this.items_.findIndex((s) => s.rawValue);\n        if (firstSelIndex < 0) {\n            this.items_.forEach((s, i) => {\n                s.rawValue = i === 0;\n            });\n            this.selectedIndex.rawValue = 0;\n        }\n        else {\n            this.items_.forEach((s, i) => {\n                s.rawValue = i === firstSelIndex;\n            });\n            this.selectedIndex.rawValue = firstSelIndex;\n        }\n        this.empty.rawValue = false;\n    }\n    onItemSelectedChange_(ev) {\n        if (ev.rawValue) {\n            const index = this.items_.findIndex((s) => s === ev.sender);\n            this.items_.forEach((s, i) => {\n                s.rawValue = i === index;\n            });\n            this.selectedIndex.rawValue = index;\n        }\n        else {\n            this.keepSelection_();\n        }\n    }\n}\n\nconst cn$l = ClassName('tab');\nclass TabView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$l(), bladeContainerClassName());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValue(config.empty, valueToClassName(this.element, cn$l(undefined, 'nop')));\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(cn$l('t'));\n        this.element.appendChild(titleElem);\n        this.itemsElement = titleElem;\n        const indentElem = doc.createElement('div');\n        indentElem.classList.add(cn$l('i'));\n        this.element.appendChild(indentElem);\n        const contentsElem = doc.createElement('div');\n        contentsElem.classList.add(cn$l('c'));\n        this.element.appendChild(contentsElem);\n        this.contentsElement = contentsElem;\n    }\n}\n\nclass TabController extends ContainerBladeController {\n    constructor(doc, config) {\n        const tab = new Tab();\n        const view = new TabView(doc, {\n            empty: tab.empty,\n            viewProps: config.viewProps,\n        });\n        super({\n            blade: config.blade,\n            rackController: new RackController({\n                blade: config.blade,\n                element: view.contentsElement,\n                viewProps: config.viewProps,\n            }),\n            view: view,\n        });\n        this.onRackAdd_ = this.onRackAdd_.bind(this);\n        this.onRackRemove_ = this.onRackRemove_.bind(this);\n        const rack = this.rackController.rack;\n        rack.emitter.on('add', this.onRackAdd_);\n        rack.emitter.on('remove', this.onRackRemove_);\n        this.tab = tab;\n    }\n    add(pc, opt_index) {\n        this.rackController.rack.add(pc, opt_index);\n    }\n    remove(index) {\n        this.rackController.rack.remove(this.rackController.rack.children[index]);\n    }\n    onRackAdd_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        const pc = ev.bladeController;\n        insertElementAt(this.view.itemsElement, pc.itemController.view.element, ev.index);\n        pc.itemController.viewProps.set('parent', this.viewProps);\n        this.tab.add(pc.props.value('selected'));\n    }\n    onRackRemove_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        const pc = ev.bladeController;\n        removeElement(pc.itemController.view.element);\n        pc.itemController.viewProps.set('parent', null);\n        this.tab.remove(pc.props.value('selected'));\n    }\n}\n\nconst TabBladePlugin = createPlugin({\n    id: 'tab',\n    type: 'blade',\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            pages: p.required.array(p.required.object({ title: p.required.string })),\n            view: p.required.constant('tab'),\n        }));\n        if (!result || result.pages.length === 0) {\n            return null;\n        }\n        return { params: result };\n    },\n    controller(args) {\n        const c = new TabController(args.document, {\n            blade: args.blade,\n            viewProps: args.viewProps,\n        });\n        args.params.pages.forEach((p) => {\n            const pc = new TabPageController(args.document, {\n                blade: createBlade(),\n                itemProps: ValueMap.fromObject({\n                    selected: false,\n                    title: p.title,\n                }),\n                props: ValueMap.fromObject({\n                    selected: false,\n                }),\n                viewProps: ViewProps.create(),\n            });\n            c.add(pc);\n        });\n        return c;\n    },\n    api(args) {\n        if (args.controller instanceof TabController) {\n            return new TabApi(args.controller, args.pool);\n        }\n        if (args.controller instanceof TabPageController) {\n            return new TabPageApi(args.controller, args.pool);\n        }\n        return null;\n    },\n});\n\nfunction createBladeController(plugin, args) {\n    const ac = plugin.accept(args.params);\n    if (!ac) {\n        return null;\n    }\n    const params = parseRecord(args.params, (p) => ({\n        disabled: p.optional.boolean,\n        hidden: p.optional.boolean,\n    }));\n    return plugin.controller({\n        blade: createBlade(),\n        document: args.document,\n        params: forceCast(Object.assign(Object.assign({}, ac.params), { disabled: params === null || params === void 0 ? void 0 : params.disabled, hidden: params === null || params === void 0 ? void 0 : params.hidden })),\n        viewProps: ViewProps.create({\n            disabled: params === null || params === void 0 ? void 0 : params.disabled,\n            hidden: params === null || params === void 0 ? void 0 : params.hidden,\n        }),\n    });\n}\n\nclass ListInputBindingApi extends BindingApi {\n    get options() {\n        return this.controller.valueController.props.get('options');\n    }\n    set options(options) {\n        this.controller.valueController.props.set('options', options);\n    }\n}\n\nclass ManualTicker {\n    constructor() {\n        this.disabled = false;\n        this.emitter = new Emitter();\n    }\n    dispose() { }\n    tick() {\n        if (this.disabled) {\n            return;\n        }\n        this.emitter.emit('tick', {\n            sender: this,\n        });\n    }\n}\n\nclass IntervalTicker {\n    constructor(doc, interval) {\n        this.disabled_ = false;\n        this.timerId_ = null;\n        this.onTick_ = this.onTick_.bind(this);\n        this.doc_ = doc;\n        this.emitter = new Emitter();\n        this.interval_ = interval;\n        this.setTimer_();\n    }\n    get disabled() {\n        return this.disabled_;\n    }\n    set disabled(inactive) {\n        this.disabled_ = inactive;\n        if (this.disabled_) {\n            this.clearTimer_();\n        }\n        else {\n            this.setTimer_();\n        }\n    }\n    dispose() {\n        this.clearTimer_();\n    }\n    clearTimer_() {\n        if (this.timerId_ === null) {\n            return;\n        }\n        const win = this.doc_.defaultView;\n        if (win) {\n            win.clearInterval(this.timerId_);\n        }\n        this.timerId_ = null;\n    }\n    setTimer_() {\n        this.clearTimer_();\n        if (this.interval_ <= 0) {\n            return;\n        }\n        const win = this.doc_.defaultView;\n        if (win) {\n            this.timerId_ = win.setInterval(this.onTick_, this.interval_);\n        }\n    }\n    onTick_() {\n        if (this.disabled_) {\n            return;\n        }\n        this.emitter.emit('tick', {\n            sender: this,\n        });\n    }\n}\n\nclass CompositeConstraint {\n    constructor(constraints) {\n        this.constraints = constraints;\n    }\n    constrain(value) {\n        return this.constraints.reduce((result, c) => {\n            return c.constrain(result);\n        }, value);\n    }\n}\nfunction findConstraint(c, constraintClass) {\n    if (c instanceof constraintClass) {\n        return c;\n    }\n    if (c instanceof CompositeConstraint) {\n        const result = c.constraints.reduce((tmpResult, sc) => {\n            if (tmpResult) {\n                return tmpResult;\n            }\n            return sc instanceof constraintClass ? sc : null;\n        }, null);\n        if (result) {\n            return result;\n        }\n    }\n    return null;\n}\n\nclass ListConstraint {\n    constructor(options) {\n        this.values = ValueMap.fromObject({\n            options: options,\n        });\n    }\n    constrain(value) {\n        const opts = this.values.get('options');\n        if (opts.length === 0) {\n            return value;\n        }\n        const matched = opts.filter((item) => {\n            return item.value === value;\n        }).length > 0;\n        return matched ? value : opts[0].value;\n    }\n}\n\nfunction parseListOptions(value) {\n    var _a;\n    const p = MicroParsers;\n    if (Array.isArray(value)) {\n        return (_a = parseRecord({ items: value }, (p) => ({\n            items: p.required.array(p.required.object({\n                text: p.required.string,\n                value: p.required.raw,\n            })),\n        }))) === null || _a === void 0 ? void 0 : _a.items;\n    }\n    if (typeof value === 'object') {\n        return p.required.raw(value)\n            .value;\n    }\n    return undefined;\n}\nfunction normalizeListOptions(options) {\n    if (Array.isArray(options)) {\n        return options;\n    }\n    const items = [];\n    Object.keys(options).forEach((text) => {\n        items.push({ text: text, value: options[text] });\n    });\n    return items;\n}\nfunction createListConstraint(options) {\n    return !isEmpty(options)\n        ? new ListConstraint(normalizeListOptions(forceCast(options)))\n        : null;\n}\n\nconst cn$k = ClassName('lst');\nclass ListView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.props_ = config.props;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$k());\n        config.viewProps.bindClassModifiers(this.element);\n        const selectElem = doc.createElement('select');\n        selectElem.classList.add(cn$k('s'));\n        config.viewProps.bindDisabled(selectElem);\n        this.element.appendChild(selectElem);\n        this.selectElement = selectElem;\n        const markElem = doc.createElement('div');\n        markElem.classList.add(cn$k('m'));\n        markElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n        this.element.appendChild(markElem);\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value_ = config.value;\n        bindValueMap(this.props_, 'options', (opts) => {\n            removeChildElements(this.selectElement);\n            opts.forEach((item) => {\n                const optionElem = doc.createElement('option');\n                optionElem.textContent = item.text;\n                this.selectElement.appendChild(optionElem);\n            });\n            this.update_();\n        });\n    }\n    update_() {\n        const values = this.props_.get('options').map((o) => o.value);\n        this.selectElement.selectedIndex = values.indexOf(this.value_.rawValue);\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass ListController {\n    constructor(doc, config) {\n        this.onSelectChange_ = this.onSelectChange_.bind(this);\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new ListView(doc, {\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.selectElement.addEventListener('change', this.onSelectChange_);\n    }\n    onSelectChange_(e) {\n        const selectElem = forceCast(e.currentTarget);\n        this.value.rawValue =\n            this.props.get('options')[selectElem.selectedIndex].value;\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            options: p.required.custom(parseListOptions),\n        }), (result) => {\n            this.props.set('options', normalizeListOptions(result.options));\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            options: this.props.get('options'),\n        });\n    }\n}\n\nconst cn$j = ClassName('pop');\nclass PopupView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$j());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValue(config.shows, valueToClassName(this.element, cn$j(undefined, 'v')));\n    }\n}\n\nclass PopupController {\n    constructor(doc, config) {\n        this.shows = createValue(false);\n        this.viewProps = config.viewProps;\n        this.view = new PopupView(doc, {\n            shows: this.shows,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nconst cn$i = ClassName('txt');\nclass TextView {\n    constructor(doc, config) {\n        this.onChange_ = this.onChange_.bind(this);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$i());\n        config.viewProps.bindClassModifiers(this.element);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onChange_);\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$i('i'));\n        inputElem.type = 'text';\n        config.viewProps.bindDisabled(inputElem);\n        this.element.appendChild(inputElem);\n        this.inputElement = inputElem;\n        config.value.emitter.on('change', this.onChange_);\n        this.value_ = config.value;\n        this.refresh();\n    }\n    refresh() {\n        const formatter = this.props_.get('formatter');\n        this.inputElement.value = formatter(this.value_.rawValue);\n    }\n    onChange_() {\n        this.refresh();\n    }\n}\n\nclass TextController {\n    constructor(doc, config) {\n        this.onInputChange_ = this.onInputChange_.bind(this);\n        this.parser_ = config.parser;\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new TextView(doc, {\n            props: config.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.inputElement.addEventListener('change', this.onInputChange_);\n    }\n    onInputChange_(e) {\n        const inputElem = forceCast(e.currentTarget);\n        const value = inputElem.value;\n        const parsedValue = this.parser_(value);\n        if (!isEmpty(parsedValue)) {\n            this.value.rawValue = parsedValue;\n        }\n        this.view.refresh();\n    }\n}\n\nfunction boolToString(value) {\n    return String(value);\n}\nfunction boolFromUnknown(value) {\n    if (value === 'false') {\n        return false;\n    }\n    return !!value;\n}\nfunction BooleanFormatter(value) {\n    return boolToString(value);\n}\n\nfunction composeParsers(parsers) {\n    return (text) => {\n        return parsers.reduce((result, parser) => {\n            if (result !== null) {\n                return result;\n            }\n            return parser(text);\n        }, null);\n    };\n}\n\nconst innerFormatter = createNumberFormatter(0);\nfunction formatPercentage(value) {\n    return innerFormatter(value) + '%';\n}\n\nfunction stringFromUnknown(value) {\n    return String(value);\n}\nfunction formatString(value) {\n    return value;\n}\n\nfunction connectValues({ primary, secondary, forward, backward, }) {\n    let changing = false;\n    function preventFeedback(callback) {\n        if (changing) {\n            return;\n        }\n        changing = true;\n        callback();\n        changing = false;\n    }\n    primary.emitter.on('change', (ev) => {\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary.rawValue, secondary.rawValue), ev.options);\n        });\n    });\n    secondary.emitter.on('change', (ev) => {\n        preventFeedback(() => {\n            primary.setRawValue(backward(primary.rawValue, secondary.rawValue), ev.options);\n        });\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary.rawValue, secondary.rawValue), ev.options);\n        });\n    });\n    preventFeedback(() => {\n        secondary.setRawValue(forward(primary.rawValue, secondary.rawValue), {\n            forceEmit: false,\n            last: true,\n        });\n    });\n}\n\nfunction getStepForKey(keyScale, keys) {\n    const step = keyScale * (keys.altKey ? 0.1 : 1) * (keys.shiftKey ? 10 : 1);\n    if (keys.upKey) {\n        return +step;\n    }\n    else if (keys.downKey) {\n        return -step;\n    }\n    return 0;\n}\nfunction getVerticalStepKeys(ev) {\n    return {\n        altKey: ev.altKey,\n        downKey: ev.key === 'ArrowDown',\n        shiftKey: ev.shiftKey,\n        upKey: ev.key === 'ArrowUp',\n    };\n}\nfunction getHorizontalStepKeys(ev) {\n    return {\n        altKey: ev.altKey,\n        downKey: ev.key === 'ArrowLeft',\n        shiftKey: ev.shiftKey,\n        upKey: ev.key === 'ArrowRight',\n    };\n}\nfunction isVerticalArrowKey(key) {\n    return key === 'ArrowUp' || key === 'ArrowDown';\n}\nfunction isArrowKey(key) {\n    return isVerticalArrowKey(key) || key === 'ArrowLeft' || key === 'ArrowRight';\n}\n\nfunction computeOffset$1(ev, elem) {\n    var _a, _b;\n    const win = elem.ownerDocument.defaultView;\n    const rect = elem.getBoundingClientRect();\n    return {\n        x: ev.pageX - (((_a = (win && win.scrollX)) !== null && _a !== void 0 ? _a : 0) + rect.left),\n        y: ev.pageY - (((_b = (win && win.scrollY)) !== null && _b !== void 0 ? _b : 0) + rect.top),\n    };\n}\nclass PointerHandler {\n    constructor(element) {\n        this.lastTouch_ = null;\n        this.onDocumentMouseMove_ = this.onDocumentMouseMove_.bind(this);\n        this.onDocumentMouseUp_ = this.onDocumentMouseUp_.bind(this);\n        this.onMouseDown_ = this.onMouseDown_.bind(this);\n        this.onTouchEnd_ = this.onTouchEnd_.bind(this);\n        this.onTouchMove_ = this.onTouchMove_.bind(this);\n        this.onTouchStart_ = this.onTouchStart_.bind(this);\n        this.elem_ = element;\n        this.emitter = new Emitter();\n        element.addEventListener('touchstart', this.onTouchStart_, {\n            passive: false,\n        });\n        element.addEventListener('touchmove', this.onTouchMove_, {\n            passive: true,\n        });\n        element.addEventListener('touchend', this.onTouchEnd_);\n        element.addEventListener('mousedown', this.onMouseDown_);\n    }\n    computePosition_(offset) {\n        const rect = this.elem_.getBoundingClientRect();\n        return {\n            bounds: {\n                width: rect.width,\n                height: rect.height,\n            },\n            point: offset\n                ? {\n                    x: offset.x,\n                    y: offset.y,\n                }\n                : null,\n        };\n    }\n    onMouseDown_(ev) {\n        var _a;\n        ev.preventDefault();\n        (_a = ev.currentTarget) === null || _a === void 0 ? void 0 : _a.focus();\n        const doc = this.elem_.ownerDocument;\n        doc.addEventListener('mousemove', this.onDocumentMouseMove_);\n        doc.addEventListener('mouseup', this.onDocumentMouseUp_);\n        this.emitter.emit('down', {\n            altKey: ev.altKey,\n            data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n    onDocumentMouseMove_(ev) {\n        this.emitter.emit('move', {\n            altKey: ev.altKey,\n            data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n    onDocumentMouseUp_(ev) {\n        const doc = this.elem_.ownerDocument;\n        doc.removeEventListener('mousemove', this.onDocumentMouseMove_);\n        doc.removeEventListener('mouseup', this.onDocumentMouseUp_);\n        this.emitter.emit('up', {\n            altKey: ev.altKey,\n            data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n    onTouchStart_(ev) {\n        ev.preventDefault();\n        const touch = ev.targetTouches.item(0);\n        const rect = this.elem_.getBoundingClientRect();\n        this.emitter.emit('down', {\n            altKey: ev.altKey,\n            data: this.computePosition_(touch\n                ? {\n                    x: touch.clientX - rect.left,\n                    y: touch.clientY - rect.top,\n                }\n                : undefined),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n        this.lastTouch_ = touch;\n    }\n    onTouchMove_(ev) {\n        const touch = ev.targetTouches.item(0);\n        const rect = this.elem_.getBoundingClientRect();\n        this.emitter.emit('move', {\n            altKey: ev.altKey,\n            data: this.computePosition_(touch\n                ? {\n                    x: touch.clientX - rect.left,\n                    y: touch.clientY - rect.top,\n                }\n                : undefined),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n        this.lastTouch_ = touch;\n    }\n    onTouchEnd_(ev) {\n        var _a;\n        const touch = (_a = ev.targetTouches.item(0)) !== null && _a !== void 0 ? _a : this.lastTouch_;\n        const rect = this.elem_.getBoundingClientRect();\n        this.emitter.emit('up', {\n            altKey: ev.altKey,\n            data: this.computePosition_(touch\n                ? {\n                    x: touch.clientX - rect.left,\n                    y: touch.clientY - rect.top,\n                }\n                : undefined),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n}\n\nconst cn$h = ClassName('txt');\nclass NumberTextView {\n    constructor(doc, config) {\n        this.onChange_ = this.onChange_.bind(this);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$h(), cn$h(undefined, 'num'));\n        if (config.arrayPosition) {\n            this.element.classList.add(cn$h(undefined, config.arrayPosition));\n        }\n        config.viewProps.bindClassModifiers(this.element);\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$h('i'));\n        inputElem.type = 'text';\n        config.viewProps.bindDisabled(inputElem);\n        this.element.appendChild(inputElem);\n        this.inputElement = inputElem;\n        this.onDraggingChange_ = this.onDraggingChange_.bind(this);\n        this.dragging_ = config.dragging;\n        this.dragging_.emitter.on('change', this.onDraggingChange_);\n        this.element.classList.add(cn$h());\n        this.inputElement.classList.add(cn$h('i'));\n        const knobElem = doc.createElement('div');\n        knobElem.classList.add(cn$h('k'));\n        this.element.appendChild(knobElem);\n        this.knobElement = knobElem;\n        const guideElem = doc.createElementNS(SVG_NS, 'svg');\n        guideElem.classList.add(cn$h('g'));\n        this.knobElement.appendChild(guideElem);\n        const bodyElem = doc.createElementNS(SVG_NS, 'path');\n        bodyElem.classList.add(cn$h('gb'));\n        guideElem.appendChild(bodyElem);\n        this.guideBodyElem_ = bodyElem;\n        const headElem = doc.createElementNS(SVG_NS, 'path');\n        headElem.classList.add(cn$h('gh'));\n        guideElem.appendChild(headElem);\n        this.guideHeadElem_ = headElem;\n        const tooltipElem = doc.createElement('div');\n        tooltipElem.classList.add(ClassName('tt')());\n        this.knobElement.appendChild(tooltipElem);\n        this.tooltipElem_ = tooltipElem;\n        config.value.emitter.on('change', this.onChange_);\n        this.value = config.value;\n        this.refresh();\n    }\n    onDraggingChange_(ev) {\n        if (ev.rawValue === null) {\n            this.element.classList.remove(cn$h(undefined, 'drg'));\n            return;\n        }\n        this.element.classList.add(cn$h(undefined, 'drg'));\n        const x = ev.rawValue / this.props_.get('pointerScale');\n        const aox = x + (x > 0 ? -1 : x < 0 ? +1 : 0);\n        const adx = constrainRange(-aox, -4, +4);\n        this.guideHeadElem_.setAttributeNS(null, 'd', [`M ${aox + adx},0 L${aox},4 L${aox + adx},8`, `M ${x},-1 L${x},9`].join(' '));\n        this.guideBodyElem_.setAttributeNS(null, 'd', `M 0,4 L${x},4`);\n        const formatter = this.props_.get('formatter');\n        this.tooltipElem_.textContent = formatter(this.value.rawValue);\n        this.tooltipElem_.style.left = `${x}px`;\n    }\n    refresh() {\n        const formatter = this.props_.get('formatter');\n        this.inputElement.value = formatter(this.value.rawValue);\n    }\n    onChange_() {\n        this.refresh();\n    }\n}\n\nclass NumberTextController {\n    constructor(doc, config) {\n        var _a;\n        this.originRawValue_ = 0;\n        this.onInputChange_ = this.onInputChange_.bind(this);\n        this.onInputKeyDown_ = this.onInputKeyDown_.bind(this);\n        this.onInputKeyUp_ = this.onInputKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.parser_ = config.parser;\n        this.props = config.props;\n        this.sliderProps_ = (_a = config.sliderProps) !== null && _a !== void 0 ? _a : null;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.dragging_ = createValue(null);\n        this.view = new NumberTextView(doc, {\n            arrayPosition: config.arrayPosition,\n            dragging: this.dragging_,\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.inputElement.addEventListener('change', this.onInputChange_);\n        this.view.inputElement.addEventListener('keydown', this.onInputKeyDown_);\n        this.view.inputElement.addEventListener('keyup', this.onInputKeyUp_);\n        const ph = new PointerHandler(this.view.knobElement);\n        ph.emitter.on('down', this.onPointerDown_);\n        ph.emitter.on('move', this.onPointerMove_);\n        ph.emitter.on('up', this.onPointerUp_);\n    }\n    constrainValue_(value) {\n        var _a, _b;\n        const min = (_a = this.sliderProps_) === null || _a === void 0 ? void 0 : _a.get('min');\n        const max = (_b = this.sliderProps_) === null || _b === void 0 ? void 0 : _b.get('max');\n        let v = value;\n        if (min !== undefined) {\n            v = Math.max(v, min);\n        }\n        if (max !== undefined) {\n            v = Math.min(v, max);\n        }\n        return v;\n    }\n    onInputChange_(e) {\n        const inputElem = forceCast(e.currentTarget);\n        const value = inputElem.value;\n        const parsedValue = this.parser_(value);\n        if (!isEmpty(parsedValue)) {\n            this.value.rawValue = this.constrainValue_(parsedValue);\n        }\n        this.view.refresh();\n    }\n    onInputKeyDown_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getVerticalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.constrainValue_(this.value.rawValue + step), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onInputKeyUp_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getVerticalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onPointerDown_() {\n        this.originRawValue_ = this.value.rawValue;\n        this.dragging_.rawValue = 0;\n    }\n    computeDraggingValue_(data) {\n        if (!data.point) {\n            return null;\n        }\n        const dx = data.point.x - data.bounds.width / 2;\n        return this.constrainValue_(this.originRawValue_ + dx * this.props.get('pointerScale'));\n    }\n    onPointerMove_(ev) {\n        const v = this.computeDraggingValue_(ev.data);\n        if (v === null) {\n            return;\n        }\n        this.value.setRawValue(v, {\n            forceEmit: false,\n            last: false,\n        });\n        this.dragging_.rawValue = this.value.rawValue - this.originRawValue_;\n    }\n    onPointerUp_(ev) {\n        const v = this.computeDraggingValue_(ev.data);\n        if (v === null) {\n            return;\n        }\n        this.value.setRawValue(v, {\n            forceEmit: true,\n            last: true,\n        });\n        this.dragging_.rawValue = null;\n    }\n}\n\nconst cn$g = ClassName('sld');\nclass SliderView {\n    constructor(doc, config) {\n        this.onChange_ = this.onChange_.bind(this);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$g());\n        config.viewProps.bindClassModifiers(this.element);\n        const trackElem = doc.createElement('div');\n        trackElem.classList.add(cn$g('t'));\n        config.viewProps.bindTabIndex(trackElem);\n        this.element.appendChild(trackElem);\n        this.trackElement = trackElem;\n        const knobElem = doc.createElement('div');\n        knobElem.classList.add(cn$g('k'));\n        this.trackElement.appendChild(knobElem);\n        this.knobElement = knobElem;\n        config.value.emitter.on('change', this.onChange_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        const p = constrainRange(mapRange(this.value.rawValue, this.props_.get('min'), this.props_.get('max'), 0, 100), 0, 100);\n        this.knobElement.style.width = `${p}%`;\n    }\n    onChange_() {\n        this.update_();\n    }\n}\n\nclass SliderController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDownOrMove_ = this.onPointerDownOrMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.props = config.props;\n        this.view = new SliderView(doc, {\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.trackElement);\n        this.ptHandler_.emitter.on('down', this.onPointerDownOrMove_);\n        this.ptHandler_.emitter.on('move', this.onPointerDownOrMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.trackElement.addEventListener('keydown', this.onKeyDown_);\n        this.view.trackElement.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        this.value.setRawValue(mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, this.props.get('min'), this.props.get('max')), opts);\n    }\n    onPointerDownOrMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue + step, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nconst cn$f = ClassName('sldtxt');\nclass SliderTextView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$f());\n        const sliderElem = doc.createElement('div');\n        sliderElem.classList.add(cn$f('s'));\n        this.sliderView_ = config.sliderView;\n        sliderElem.appendChild(this.sliderView_.element);\n        this.element.appendChild(sliderElem);\n        const textElem = doc.createElement('div');\n        textElem.classList.add(cn$f('t'));\n        this.textView_ = config.textView;\n        textElem.appendChild(this.textView_.element);\n        this.element.appendChild(textElem);\n    }\n}\n\nclass SliderTextController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.sliderC_ = new SliderController(doc, {\n            props: config.sliderProps,\n            value: config.value,\n            viewProps: this.viewProps,\n        });\n        this.textC_ = new NumberTextController(doc, {\n            parser: config.parser,\n            props: config.textProps,\n            sliderProps: config.sliderProps,\n            value: config.value,\n            viewProps: config.viewProps,\n        });\n        this.view = new SliderTextView(doc, {\n            sliderView: this.sliderC_.view,\n            textView: this.textC_.view,\n        });\n    }\n    get sliderController() {\n        return this.sliderC_;\n    }\n    get textController() {\n        return this.textC_;\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            max: p.required.number,\n            min: p.required.number,\n        }), (result) => {\n            const sliderProps = this.sliderC_.props;\n            sliderProps.set('max', result.max);\n            sliderProps.set('min', result.min);\n            return true;\n        });\n    }\n    exportProps() {\n        const sliderProps = this.sliderC_.props;\n        return exportBladeState(null, {\n            max: sliderProps.get('max'),\n            min: sliderProps.get('min'),\n        });\n    }\n}\nfunction createSliderTextProps(config) {\n    return {\n        sliderProps: new ValueMap({\n            keyScale: config.keyScale,\n            max: config.max,\n            min: config.min,\n        }),\n        textProps: new ValueMap({\n            formatter: createValue(config.formatter),\n            keyScale: config.keyScale,\n            pointerScale: createValue(config.pointerScale),\n        }),\n    };\n}\n\nconst CSS_VAR_MAP = {\n    containerUnitSize: 'cnt-usz',\n};\nfunction getCssVar(key) {\n    return `--${CSS_VAR_MAP[key]}`;\n}\n\nfunction createPointDimensionParser(p) {\n    return createNumberTextInputParamsParser(p);\n}\nfunction parsePointDimensionParams(value) {\n    if (!isRecord(value)) {\n        return undefined;\n    }\n    return parseRecord(value, createPointDimensionParser);\n}\nfunction createDimensionConstraint(params, initialValue) {\n    if (!params) {\n        return undefined;\n    }\n    const constraints = [];\n    const cs = createStepConstraint(params, initialValue);\n    if (cs) {\n        constraints.push(cs);\n    }\n    const rs = createRangeConstraint(params);\n    if (rs) {\n        constraints.push(rs);\n    }\n    return new CompositeConstraint(constraints);\n}\n\nfunction isCompatible(ver) {\n    if (!ver) {\n        return false;\n    }\n    return ver.major === VERSION$1.major;\n}\n\nfunction parsePickerLayout(value) {\n    if (value === 'inline' || value === 'popup') {\n        return value;\n    }\n    return undefined;\n}\n\nfunction writePrimitive(target, value) {\n    target.write(value);\n}\n\nconst cn$e = ClassName('ckb');\nclass CheckboxView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$e());\n        config.viewProps.bindClassModifiers(this.element);\n        const labelElem = doc.createElement('label');\n        labelElem.classList.add(cn$e('l'));\n        this.element.appendChild(labelElem);\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$e('i'));\n        inputElem.type = 'checkbox';\n        labelElem.appendChild(inputElem);\n        this.inputElement = inputElem;\n        config.viewProps.bindDisabled(this.inputElement);\n        const wrapperElem = doc.createElement('div');\n        wrapperElem.classList.add(cn$e('w'));\n        labelElem.appendChild(wrapperElem);\n        const markElem = createSvgIconElement(doc, 'check');\n        wrapperElem.appendChild(markElem);\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        this.inputElement.checked = this.value.rawValue;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass CheckboxController {\n    constructor(doc, config) {\n        this.onInputChange_ = this.onInputChange_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new CheckboxView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.inputElement.addEventListener('change', this.onInputChange_);\n    }\n    onInputChange_(e) {\n        const inputElem = forceCast(e.currentTarget);\n        this.value.rawValue = inputElem.checked;\n    }\n}\n\nfunction createConstraint$6(params) {\n    const constraints = [];\n    const lc = createListConstraint(params.options);\n    if (lc) {\n        constraints.push(lc);\n    }\n    return new CompositeConstraint(constraints);\n}\nconst BooleanInputPlugin = createPlugin({\n    id: 'input-bool',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'boolean') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            options: p.optional.custom(parseListOptions),\n            readonly: p.optional.constant(false),\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => boolFromUnknown,\n        constraint: (args) => createConstraint$6(args.params),\n        writer: (_args) => writePrimitive,\n    },\n    controller: (args) => {\n        const doc = args.document;\n        const value = args.value;\n        const c = args.constraint;\n        const lc = c && findConstraint(c, ListConstraint);\n        if (lc) {\n            return new ListController(doc, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new CheckboxController(doc, {\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (typeof args.controller.value.rawValue !== 'boolean') {\n            return null;\n        }\n        if (args.controller.valueController instanceof ListController) {\n            return new ListInputBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nconst cn$d = ClassName('col');\nclass ColorView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$d());\n        config.foldable.bindExpandedClass(this.element, cn$d(undefined, 'expanded'));\n        bindValueMap(config.foldable, 'completed', valueToClassName(this.element, cn$d(undefined, 'cpl')));\n        const headElem = doc.createElement('div');\n        headElem.classList.add(cn$d('h'));\n        this.element.appendChild(headElem);\n        const swatchElem = doc.createElement('div');\n        swatchElem.classList.add(cn$d('s'));\n        headElem.appendChild(swatchElem);\n        this.swatchElement = swatchElem;\n        const textElem = doc.createElement('div');\n        textElem.classList.add(cn$d('t'));\n        headElem.appendChild(textElem);\n        this.textElement = textElem;\n        if (config.pickerLayout === 'inline') {\n            const pickerElem = doc.createElement('div');\n            pickerElem.classList.add(cn$d('p'));\n            this.element.appendChild(pickerElem);\n            this.pickerElement = pickerElem;\n        }\n        else {\n            this.pickerElement = null;\n        }\n    }\n}\n\nfunction rgbToHslInt(r, g, b) {\n    const rp = constrainRange(r / 255, 0, 1);\n    const gp = constrainRange(g / 255, 0, 1);\n    const bp = constrainRange(b / 255, 0, 1);\n    const cmax = Math.max(rp, gp, bp);\n    const cmin = Math.min(rp, gp, bp);\n    const c = cmax - cmin;\n    let h = 0;\n    let s = 0;\n    const l = (cmin + cmax) / 2;\n    if (c !== 0) {\n        s = c / (1 - Math.abs(cmax + cmin - 1));\n        if (rp === cmax) {\n            h = (gp - bp) / c;\n        }\n        else if (gp === cmax) {\n            h = 2 + (bp - rp) / c;\n        }\n        else {\n            h = 4 + (rp - gp) / c;\n        }\n        h = h / 6 + (h < 0 ? 1 : 0);\n    }\n    return [h * 360, s * 100, l * 100];\n}\nfunction hslToRgbInt(h, s, l) {\n    const hp = ((h % 360) + 360) % 360;\n    const sp = constrainRange(s / 100, 0, 1);\n    const lp = constrainRange(l / 100, 0, 1);\n    const c = (1 - Math.abs(2 * lp - 1)) * sp;\n    const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n    const m = lp - c / 2;\n    let rp, gp, bp;\n    if (hp >= 0 && hp < 60) {\n        [rp, gp, bp] = [c, x, 0];\n    }\n    else if (hp >= 60 && hp < 120) {\n        [rp, gp, bp] = [x, c, 0];\n    }\n    else if (hp >= 120 && hp < 180) {\n        [rp, gp, bp] = [0, c, x];\n    }\n    else if (hp >= 180 && hp < 240) {\n        [rp, gp, bp] = [0, x, c];\n    }\n    else if (hp >= 240 && hp < 300) {\n        [rp, gp, bp] = [x, 0, c];\n    }\n    else {\n        [rp, gp, bp] = [c, 0, x];\n    }\n    return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n}\nfunction rgbToHsvInt(r, g, b) {\n    const rp = constrainRange(r / 255, 0, 1);\n    const gp = constrainRange(g / 255, 0, 1);\n    const bp = constrainRange(b / 255, 0, 1);\n    const cmax = Math.max(rp, gp, bp);\n    const cmin = Math.min(rp, gp, bp);\n    const d = cmax - cmin;\n    let h;\n    if (d === 0) {\n        h = 0;\n    }\n    else if (cmax === rp) {\n        h = 60 * (((((gp - bp) / d) % 6) + 6) % 6);\n    }\n    else if (cmax === gp) {\n        h = 60 * ((bp - rp) / d + 2);\n    }\n    else {\n        h = 60 * ((rp - gp) / d + 4);\n    }\n    const s = cmax === 0 ? 0 : d / cmax;\n    const v = cmax;\n    return [h, s * 100, v * 100];\n}\nfunction hsvToRgbInt(h, s, v) {\n    const hp = loopRange(h, 360);\n    const sp = constrainRange(s / 100, 0, 1);\n    const vp = constrainRange(v / 100, 0, 1);\n    const c = vp * sp;\n    const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n    const m = vp - c;\n    let rp, gp, bp;\n    if (hp >= 0 && hp < 60) {\n        [rp, gp, bp] = [c, x, 0];\n    }\n    else if (hp >= 60 && hp < 120) {\n        [rp, gp, bp] = [x, c, 0];\n    }\n    else if (hp >= 120 && hp < 180) {\n        [rp, gp, bp] = [0, c, x];\n    }\n    else if (hp >= 180 && hp < 240) {\n        [rp, gp, bp] = [0, x, c];\n    }\n    else if (hp >= 240 && hp < 300) {\n        [rp, gp, bp] = [x, 0, c];\n    }\n    else {\n        [rp, gp, bp] = [c, 0, x];\n    }\n    return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n}\nfunction hslToHsvInt(h, s, l) {\n    const sd = l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100);\n    return [\n        h,\n        sd !== 0 ? (s * (100 - Math.abs(2 * l - 100))) / sd : 0,\n        l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100),\n    ];\n}\nfunction hsvToHslInt(h, s, v) {\n    const sd = 100 - Math.abs((v * (200 - s)) / 100 - 100);\n    return [h, sd !== 0 ? (s * v) / sd : 0, (v * (200 - s)) / (2 * 100)];\n}\nfunction removeAlphaComponent(comps) {\n    return [comps[0], comps[1], comps[2]];\n}\nfunction appendAlphaComponent(comps, alpha) {\n    return [comps[0], comps[1], comps[2], alpha];\n}\nconst MODE_CONVERTER_MAP = {\n    hsl: {\n        hsl: (h, s, l) => [h, s, l],\n        hsv: hslToHsvInt,\n        rgb: hslToRgbInt,\n    },\n    hsv: {\n        hsl: hsvToHslInt,\n        hsv: (h, s, v) => [h, s, v],\n        rgb: hsvToRgbInt,\n    },\n    rgb: {\n        hsl: rgbToHslInt,\n        hsv: rgbToHsvInt,\n        rgb: (r, g, b) => [r, g, b],\n    },\n};\nfunction getColorMaxComponents(mode, type) {\n    return [\n        type === 'float' ? 1 : mode === 'rgb' ? 255 : 360,\n        type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n        type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n    ];\n}\nfunction loopHueRange(hue, max) {\n    return hue === max ? max : loopRange(hue, max);\n}\nfunction constrainColorComponents(components, mode, type) {\n    var _a;\n    const ms = getColorMaxComponents(mode, type);\n    return [\n        mode === 'rgb'\n            ? constrainRange(components[0], 0, ms[0])\n            : loopHueRange(components[0], ms[0]),\n        constrainRange(components[1], 0, ms[1]),\n        constrainRange(components[2], 0, ms[2]),\n        constrainRange((_a = components[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n    ];\n}\nfunction convertColorType(comps, mode, from, to) {\n    const fms = getColorMaxComponents(mode, from);\n    const tms = getColorMaxComponents(mode, to);\n    return comps.map((c, index) => (c / fms[index]) * tms[index]);\n}\nfunction convertColor(components, from, to) {\n    const intComps = convertColorType(components, from.mode, from.type, 'int');\n    const result = MODE_CONVERTER_MAP[from.mode][to.mode](...intComps);\n    return convertColorType(result, to.mode, 'int', to.type);\n}\n\nclass IntColor {\n    static black() {\n        return new IntColor([0, 0, 0], 'rgb');\n    }\n    constructor(comps, mode) {\n        this.type = 'int';\n        this.mode = mode;\n        this.comps_ = constrainColorComponents(comps, mode, this.type);\n    }\n    getComponents(opt_mode) {\n        return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_), { mode: this.mode, type: this.type }, { mode: opt_mode !== null && opt_mode !== void 0 ? opt_mode : this.mode, type: this.type }), this.comps_[3]);\n    }\n    toRgbaObject() {\n        const rgbComps = this.getComponents('rgb');\n        return {\n            r: rgbComps[0],\n            g: rgbComps[1],\n            b: rgbComps[2],\n            a: rgbComps[3],\n        };\n    }\n}\n\nconst cn$c = ClassName('colp');\nclass ColorPickerView {\n    constructor(doc, config) {\n        this.alphaViews_ = null;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$c());\n        config.viewProps.bindClassModifiers(this.element);\n        const hsvElem = doc.createElement('div');\n        hsvElem.classList.add(cn$c('hsv'));\n        const svElem = doc.createElement('div');\n        svElem.classList.add(cn$c('sv'));\n        this.svPaletteView_ = config.svPaletteView;\n        svElem.appendChild(this.svPaletteView_.element);\n        hsvElem.appendChild(svElem);\n        const hElem = doc.createElement('div');\n        hElem.classList.add(cn$c('h'));\n        this.hPaletteView_ = config.hPaletteView;\n        hElem.appendChild(this.hPaletteView_.element);\n        hsvElem.appendChild(hElem);\n        this.element.appendChild(hsvElem);\n        const rgbElem = doc.createElement('div');\n        rgbElem.classList.add(cn$c('rgb'));\n        this.textsView_ = config.textsView;\n        rgbElem.appendChild(this.textsView_.element);\n        this.element.appendChild(rgbElem);\n        if (config.alphaViews) {\n            this.alphaViews_ = {\n                palette: config.alphaViews.palette,\n                text: config.alphaViews.text,\n            };\n            const aElem = doc.createElement('div');\n            aElem.classList.add(cn$c('a'));\n            const apElem = doc.createElement('div');\n            apElem.classList.add(cn$c('ap'));\n            apElem.appendChild(this.alphaViews_.palette.element);\n            aElem.appendChild(apElem);\n            const atElem = doc.createElement('div');\n            atElem.classList.add(cn$c('at'));\n            atElem.appendChild(this.alphaViews_.text.element);\n            aElem.appendChild(atElem);\n            this.element.appendChild(aElem);\n        }\n    }\n    get allFocusableElements() {\n        const elems = [\n            this.svPaletteView_.element,\n            this.hPaletteView_.element,\n            this.textsView_.modeSelectElement,\n            ...this.textsView_.inputViews.map((v) => v.inputElement),\n        ];\n        if (this.alphaViews_) {\n            elems.push(this.alphaViews_.palette.element, this.alphaViews_.text.inputElement);\n        }\n        return elems;\n    }\n}\n\nfunction parseColorType(value) {\n    return value === 'int' ? 'int' : value === 'float' ? 'float' : undefined;\n}\nfunction parseColorInputParams(params) {\n    return parseRecord(params, (p) => ({\n        color: p.optional.object({\n            alpha: p.optional.boolean,\n            type: p.optional.custom(parseColorType),\n        }),\n        expanded: p.optional.boolean,\n        picker: p.optional.custom(parsePickerLayout),\n        readonly: p.optional.constant(false),\n    }));\n}\nfunction getKeyScaleForColor(forAlpha) {\n    return forAlpha ? 0.1 : 1;\n}\nfunction extractColorType(params) {\n    var _a;\n    return (_a = params.color) === null || _a === void 0 ? void 0 : _a.type;\n}\n\nclass FloatColor {\n    constructor(comps, mode) {\n        this.type = 'float';\n        this.mode = mode;\n        this.comps_ = constrainColorComponents(comps, mode, this.type);\n    }\n    getComponents(opt_mode) {\n        return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_), { mode: this.mode, type: this.type }, { mode: opt_mode !== null && opt_mode !== void 0 ? opt_mode : this.mode, type: this.type }), this.comps_[3]);\n    }\n    toRgbaObject() {\n        const rgbComps = this.getComponents('rgb');\n        return {\n            r: rgbComps[0],\n            g: rgbComps[1],\n            b: rgbComps[2],\n            a: rgbComps[3],\n        };\n    }\n}\n\nconst TYPE_TO_CONSTRUCTOR_MAP = {\n    int: (comps, mode) => new IntColor(comps, mode),\n    float: (comps, mode) => new FloatColor(comps, mode),\n};\nfunction createColor(comps, mode, type) {\n    return TYPE_TO_CONSTRUCTOR_MAP[type](comps, mode);\n}\nfunction isFloatColor(c) {\n    return c.type === 'float';\n}\nfunction isIntColor(c) {\n    return c.type === 'int';\n}\nfunction convertFloatToInt(cf) {\n    const comps = cf.getComponents();\n    const ms = getColorMaxComponents(cf.mode, 'int');\n    return new IntColor([\n        Math.round(mapRange(comps[0], 0, 1, 0, ms[0])),\n        Math.round(mapRange(comps[1], 0, 1, 0, ms[1])),\n        Math.round(mapRange(comps[2], 0, 1, 0, ms[2])),\n        comps[3],\n    ], cf.mode);\n}\nfunction convertIntToFloat(ci) {\n    const comps = ci.getComponents();\n    const ms = getColorMaxComponents(ci.mode, 'int');\n    return new FloatColor([\n        mapRange(comps[0], 0, ms[0], 0, 1),\n        mapRange(comps[1], 0, ms[1], 0, 1),\n        mapRange(comps[2], 0, ms[2], 0, 1),\n        comps[3],\n    ], ci.mode);\n}\nfunction mapColorType(c, type) {\n    if (c.type === type) {\n        return c;\n    }\n    if (isIntColor(c) && type === 'float') {\n        return convertIntToFloat(c);\n    }\n    if (isFloatColor(c) && type === 'int') {\n        return convertFloatToInt(c);\n    }\n    throw TpError.shouldNeverHappen();\n}\n\nfunction equalsStringColorFormat(f1, f2) {\n    return (f1.alpha === f2.alpha &&\n        f1.mode === f2.mode &&\n        f1.notation === f2.notation &&\n        f1.type === f2.type);\n}\nfunction parseCssNumberOrPercentage(text, max) {\n    const m = text.match(/^(.+)%$/);\n    if (!m) {\n        return Math.min(parseFloat(text), max);\n    }\n    return Math.min(parseFloat(m[1]) * 0.01 * max, max);\n}\nconst ANGLE_TO_DEG_MAP = {\n    deg: (angle) => angle,\n    grad: (angle) => (angle * 360) / 400,\n    rad: (angle) => (angle * 360) / (2 * Math.PI),\n    turn: (angle) => angle * 360,\n};\nfunction parseCssNumberOrAngle(text) {\n    const m = text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);\n    if (!m) {\n        return parseFloat(text);\n    }\n    const angle = parseFloat(m[1]);\n    const unit = m[2];\n    return ANGLE_TO_DEG_MAP[unit](angle);\n}\nfunction parseFunctionalRgbColorComponents(text) {\n    const m = text.match(/^rgb\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrPercentage(m[1], 255),\n        parseCssNumberOrPercentage(m[2], 255),\n        parseCssNumberOrPercentage(m[3], 255),\n    ];\n    if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalRgbColor(text) {\n    const comps = parseFunctionalRgbColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseFunctionalRgbaColorComponents(text) {\n    const m = text.match(/^rgba\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrPercentage(m[1], 255),\n        parseCssNumberOrPercentage(m[2], 255),\n        parseCssNumberOrPercentage(m[3], 255),\n        parseCssNumberOrPercentage(m[4], 1),\n    ];\n    if (isNaN(comps[0]) ||\n        isNaN(comps[1]) ||\n        isNaN(comps[2]) ||\n        isNaN(comps[3])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalRgbaColor(text) {\n    const comps = parseFunctionalRgbaColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseFunctionalHslColorComponents(text) {\n    const m = text.match(/^hsl\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrAngle(m[1]),\n        parseCssNumberOrPercentage(m[2], 100),\n        parseCssNumberOrPercentage(m[3], 100),\n    ];\n    if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalHslColor(text) {\n    const comps = parseFunctionalHslColorComponents(text);\n    return comps ? new IntColor(comps, 'hsl') : null;\n}\nfunction parseHslaColorComponents(text) {\n    const m = text.match(/^hsla\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrAngle(m[1]),\n        parseCssNumberOrPercentage(m[2], 100),\n        parseCssNumberOrPercentage(m[3], 100),\n        parseCssNumberOrPercentage(m[4], 1),\n    ];\n    if (isNaN(comps[0]) ||\n        isNaN(comps[1]) ||\n        isNaN(comps[2]) ||\n        isNaN(comps[3])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalHslaColor(text) {\n    const comps = parseHslaColorComponents(text);\n    return comps ? new IntColor(comps, 'hsl') : null;\n}\nfunction parseHexRgbColorComponents(text) {\n    const mRgb = text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n    if (mRgb) {\n        return [\n            parseInt(mRgb[1] + mRgb[1], 16),\n            parseInt(mRgb[2] + mRgb[2], 16),\n            parseInt(mRgb[3] + mRgb[3], 16),\n        ];\n    }\n    const mRrggbb = text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n    if (mRrggbb) {\n        return [\n            parseInt(mRrggbb[1], 16),\n            parseInt(mRrggbb[2], 16),\n            parseInt(mRrggbb[3], 16),\n        ];\n    }\n    return null;\n}\nfunction parseHexRgbColor(text) {\n    const comps = parseHexRgbColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseHexRgbaColorComponents(text) {\n    const mRgb = text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n    if (mRgb) {\n        return [\n            parseInt(mRgb[1] + mRgb[1], 16),\n            parseInt(mRgb[2] + mRgb[2], 16),\n            parseInt(mRgb[3] + mRgb[3], 16),\n            mapRange(parseInt(mRgb[4] + mRgb[4], 16), 0, 255, 0, 1),\n        ];\n    }\n    const mRrggbb = text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n    if (mRrggbb) {\n        return [\n            parseInt(mRrggbb[1], 16),\n            parseInt(mRrggbb[2], 16),\n            parseInt(mRrggbb[3], 16),\n            mapRange(parseInt(mRrggbb[4], 16), 0, 255, 0, 1),\n        ];\n    }\n    return null;\n}\nfunction parseHexRgbaColor(text) {\n    const comps = parseHexRgbaColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseObjectRgbColorComponents(text) {\n    const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseFloat(m[1]),\n        parseFloat(m[2]),\n        parseFloat(m[3]),\n    ];\n    if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n        return null;\n    }\n    return comps;\n}\nfunction createObjectRgbColorParser(type) {\n    return (text) => {\n        const comps = parseObjectRgbColorComponents(text);\n        return comps ? createColor(comps, 'rgb', type) : null;\n    };\n}\nfunction parseObjectRgbaColorComponents(text) {\n    const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*a\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseFloat(m[1]),\n        parseFloat(m[2]),\n        parseFloat(m[3]),\n        parseFloat(m[4]),\n    ];\n    if (isNaN(comps[0]) ||\n        isNaN(comps[1]) ||\n        isNaN(comps[2]) ||\n        isNaN(comps[3])) {\n        return null;\n    }\n    return comps;\n}\nfunction createObjectRgbaColorParser(type) {\n    return (text) => {\n        const comps = parseObjectRgbaColorComponents(text);\n        return comps ? createColor(comps, 'rgb', type) : null;\n    };\n}\nconst PARSER_AND_RESULT = [\n    {\n        parser: parseHexRgbColorComponents,\n        result: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'hex',\n        },\n    },\n    {\n        parser: parseHexRgbaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'hex',\n        },\n    },\n    {\n        parser: parseFunctionalRgbColorComponents,\n        result: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseFunctionalRgbaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseFunctionalHslColorComponents,\n        result: {\n            alpha: false,\n            mode: 'hsl',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseHslaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'hsl',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseObjectRgbColorComponents,\n        result: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'object',\n        },\n    },\n    {\n        parser: parseObjectRgbaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'object',\n        },\n    },\n];\nfunction detectStringColor(text) {\n    return PARSER_AND_RESULT.reduce((prev, { parser, result: detection }) => {\n        if (prev) {\n            return prev;\n        }\n        return parser(text) ? detection : null;\n    }, null);\n}\nfunction detectStringColorFormat(text, type = 'int') {\n    const r = detectStringColor(text);\n    if (!r) {\n        return null;\n    }\n    if (r.notation === 'hex' && type !== 'float') {\n        return Object.assign(Object.assign({}, r), { type: 'int' });\n    }\n    if (r.notation === 'func') {\n        return Object.assign(Object.assign({}, r), { type: type });\n    }\n    return null;\n}\nfunction createColorStringParser(type) {\n    const parsers = [\n        parseHexRgbColor,\n        parseHexRgbaColor,\n        parseFunctionalRgbColor,\n        parseFunctionalRgbaColor,\n        parseFunctionalHslColor,\n        parseFunctionalHslaColor,\n    ];\n    if (type === 'int') {\n        parsers.push(createObjectRgbColorParser('int'), createObjectRgbaColorParser('int'));\n    }\n    if (type === 'float') {\n        parsers.push(createObjectRgbColorParser('float'), createObjectRgbaColorParser('float'));\n    }\n    const parser = composeParsers(parsers);\n    return (text) => {\n        const result = parser(text);\n        return result ? mapColorType(result, type) : null;\n    };\n}\nfunction readIntColorString(value) {\n    const parser = createColorStringParser('int');\n    if (typeof value !== 'string') {\n        return IntColor.black();\n    }\n    const result = parser(value);\n    return result !== null && result !== void 0 ? result : IntColor.black();\n}\nfunction zerofill(comp) {\n    const hex = constrainRange(Math.floor(comp), 0, 255).toString(16);\n    return hex.length === 1 ? `0${hex}` : hex;\n}\nfunction colorToHexRgbString(value, prefix = '#') {\n    const hexes = removeAlphaComponent(value.getComponents('rgb'))\n        .map(zerofill)\n        .join('');\n    return `${prefix}${hexes}`;\n}\nfunction colorToHexRgbaString(value, prefix = '#') {\n    const rgbaComps = value.getComponents('rgb');\n    const hexes = [rgbaComps[0], rgbaComps[1], rgbaComps[2], rgbaComps[3] * 255]\n        .map(zerofill)\n        .join('');\n    return `${prefix}${hexes}`;\n}\nfunction colorToFunctionalRgbString(value) {\n    const formatter = createNumberFormatter(0);\n    const ci = mapColorType(value, 'int');\n    const comps = removeAlphaComponent(ci.getComponents('rgb')).map((comp) => formatter(comp));\n    return `rgb(${comps.join(', ')})`;\n}\nfunction colorToFunctionalRgbaString(value) {\n    const aFormatter = createNumberFormatter(2);\n    const rgbFormatter = createNumberFormatter(0);\n    const ci = mapColorType(value, 'int');\n    const comps = ci.getComponents('rgb').map((comp, index) => {\n        const formatter = index === 3 ? aFormatter : rgbFormatter;\n        return formatter(comp);\n    });\n    return `rgba(${comps.join(', ')})`;\n}\nfunction colorToFunctionalHslString(value) {\n    const formatters = [\n        createNumberFormatter(0),\n        formatPercentage,\n        formatPercentage,\n    ];\n    const ci = mapColorType(value, 'int');\n    const comps = removeAlphaComponent(ci.getComponents('hsl')).map((comp, index) => formatters[index](comp));\n    return `hsl(${comps.join(', ')})`;\n}\nfunction colorToFunctionalHslaString(value) {\n    const formatters = [\n        createNumberFormatter(0),\n        formatPercentage,\n        formatPercentage,\n        createNumberFormatter(2),\n    ];\n    const ci = mapColorType(value, 'int');\n    const comps = ci\n        .getComponents('hsl')\n        .map((comp, index) => formatters[index](comp));\n    return `hsla(${comps.join(', ')})`;\n}\nfunction colorToObjectRgbString(value, type) {\n    const formatter = createNumberFormatter(type === 'float' ? 2 : 0);\n    const names = ['r', 'g', 'b'];\n    const cc = mapColorType(value, type);\n    const comps = removeAlphaComponent(cc.getComponents('rgb')).map((comp, index) => `${names[index]}: ${formatter(comp)}`);\n    return `{${comps.join(', ')}}`;\n}\nfunction createObjectRgbColorFormatter(type) {\n    return (value) => colorToObjectRgbString(value, type);\n}\nfunction colorToObjectRgbaString(value, type) {\n    const aFormatter = createNumberFormatter(2);\n    const rgbFormatter = createNumberFormatter(type === 'float' ? 2 : 0);\n    const names = ['r', 'g', 'b', 'a'];\n    const cc = mapColorType(value, type);\n    const comps = cc.getComponents('rgb').map((comp, index) => {\n        const formatter = index === 3 ? aFormatter : rgbFormatter;\n        return `${names[index]}: ${formatter(comp)}`;\n    });\n    return `{${comps.join(', ')}}`;\n}\nfunction createObjectRgbaColorFormatter(type) {\n    return (value) => colorToObjectRgbaString(value, type);\n}\nconst FORMAT_AND_STRINGIFIERS = [\n    {\n        format: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'hex',\n            type: 'int',\n        },\n        stringifier: colorToHexRgbString,\n    },\n    {\n        format: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'hex',\n            type: 'int',\n        },\n        stringifier: colorToHexRgbaString,\n    },\n    {\n        format: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalRgbString,\n    },\n    {\n        format: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalRgbaString,\n    },\n    {\n        format: {\n            alpha: false,\n            mode: 'hsl',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalHslString,\n    },\n    {\n        format: {\n            alpha: true,\n            mode: 'hsl',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalHslaString,\n    },\n    ...['int', 'float'].reduce((prev, type) => {\n        return [\n            ...prev,\n            {\n                format: {\n                    alpha: false,\n                    mode: 'rgb',\n                    notation: 'object',\n                    type: type,\n                },\n                stringifier: createObjectRgbColorFormatter(type),\n            },\n            {\n                format: {\n                    alpha: true,\n                    mode: 'rgb',\n                    notation: 'object',\n                    type: type,\n                },\n                stringifier: createObjectRgbaColorFormatter(type),\n            },\n        ];\n    }, []),\n];\nfunction findColorStringifier(format) {\n    return FORMAT_AND_STRINGIFIERS.reduce((prev, fas) => {\n        if (prev) {\n            return prev;\n        }\n        return equalsStringColorFormat(fas.format, format)\n            ? fas.stringifier\n            : null;\n    }, null);\n}\n\nconst cn$b = ClassName('apl');\nclass APaletteView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value = config.value;\n        this.value.emitter.on('change', this.onValueChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$b());\n        config.viewProps.bindClassModifiers(this.element);\n        config.viewProps.bindTabIndex(this.element);\n        const barElem = doc.createElement('div');\n        barElem.classList.add(cn$b('b'));\n        this.element.appendChild(barElem);\n        const colorElem = doc.createElement('div');\n        colorElem.classList.add(cn$b('c'));\n        barElem.appendChild(colorElem);\n        this.colorElem_ = colorElem;\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$b('m'));\n        this.element.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        const previewElem = doc.createElement('div');\n        previewElem.classList.add(cn$b('p'));\n        this.markerElem_.appendChild(previewElem);\n        this.previewElem_ = previewElem;\n        this.update_();\n    }\n    update_() {\n        const c = this.value.rawValue;\n        const rgbaComps = c.getComponents('rgb');\n        const leftColor = new IntColor([rgbaComps[0], rgbaComps[1], rgbaComps[2], 0], 'rgb');\n        const rightColor = new IntColor([rgbaComps[0], rgbaComps[1], rgbaComps[2], 255], 'rgb');\n        const gradientComps = [\n            'to right',\n            colorToFunctionalRgbaString(leftColor),\n            colorToFunctionalRgbaString(rightColor),\n        ];\n        this.colorElem_.style.background = `linear-gradient(${gradientComps.join(',')})`;\n        this.previewElem_.style.backgroundColor = colorToFunctionalRgbaString(c);\n        const left = mapRange(rgbaComps[3], 0, 1, 0, 100);\n        this.markerElem_.style.left = `${left}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass APaletteController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new APaletteView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.element);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.element.addEventListener('keydown', this.onKeyDown_);\n        this.view.element.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const alpha = d.point.x / d.bounds.width;\n        const c = this.value.rawValue;\n        const [h, s, v] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h, s, v, alpha], 'hsv'), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(true), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        const c = this.value.rawValue;\n        const [h, s, v, a] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h, s, v, a + step], 'hsv'), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(true), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nconst cn$a = ClassName('coltxt');\nfunction createModeSelectElement(doc) {\n    const selectElem = doc.createElement('select');\n    const items = [\n        { text: 'RGB', value: 'rgb' },\n        { text: 'HSL', value: 'hsl' },\n        { text: 'HSV', value: 'hsv' },\n        { text: 'HEX', value: 'hex' },\n    ];\n    selectElem.appendChild(items.reduce((frag, item) => {\n        const optElem = doc.createElement('option');\n        optElem.textContent = item.text;\n        optElem.value = item.value;\n        frag.appendChild(optElem);\n        return frag;\n    }, doc.createDocumentFragment()));\n    return selectElem;\n}\nclass ColorTextsView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$a());\n        config.viewProps.bindClassModifiers(this.element);\n        const modeElem = doc.createElement('div');\n        modeElem.classList.add(cn$a('m'));\n        this.modeElem_ = createModeSelectElement(doc);\n        this.modeElem_.classList.add(cn$a('ms'));\n        modeElem.appendChild(this.modeSelectElement);\n        config.viewProps.bindDisabled(this.modeElem_);\n        const modeMarkerElem = doc.createElement('div');\n        modeMarkerElem.classList.add(cn$a('mm'));\n        modeMarkerElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n        modeElem.appendChild(modeMarkerElem);\n        this.element.appendChild(modeElem);\n        const inputsElem = doc.createElement('div');\n        inputsElem.classList.add(cn$a('w'));\n        this.element.appendChild(inputsElem);\n        this.inputsElem_ = inputsElem;\n        this.inputViews_ = config.inputViews;\n        this.applyInputViews_();\n        bindValue(config.mode, (mode) => {\n            this.modeElem_.value = mode;\n        });\n    }\n    get modeSelectElement() {\n        return this.modeElem_;\n    }\n    get inputViews() {\n        return this.inputViews_;\n    }\n    set inputViews(inputViews) {\n        this.inputViews_ = inputViews;\n        this.applyInputViews_();\n    }\n    applyInputViews_() {\n        removeChildElements(this.inputsElem_);\n        const doc = this.element.ownerDocument;\n        this.inputViews_.forEach((v) => {\n            const compElem = doc.createElement('div');\n            compElem.classList.add(cn$a('c'));\n            compElem.appendChild(v.element);\n            this.inputsElem_.appendChild(compElem);\n        });\n    }\n}\n\nfunction createFormatter$2(type) {\n    return createNumberFormatter(type === 'float' ? 2 : 0);\n}\nfunction createConstraint$5(mode, type, index) {\n    const max = getColorMaxComponents(mode, type)[index];\n    return new DefiniteRangeConstraint({\n        min: 0,\n        max: max,\n    });\n}\nfunction createComponentController(doc, config, index) {\n    return new NumberTextController(doc, {\n        arrayPosition: index === 0 ? 'fst' : index === 3 - 1 ? 'lst' : 'mid',\n        parser: config.parser,\n        props: ValueMap.fromObject({\n            formatter: createFormatter$2(config.colorType),\n            keyScale: getKeyScaleForColor(false),\n            pointerScale: config.colorType === 'float' ? 0.01 : 1,\n        }),\n        value: createValue(0, {\n            constraint: createConstraint$5(config.colorMode, config.colorType, index),\n        }),\n        viewProps: config.viewProps,\n    });\n}\nfunction createComponentControllers(doc, config) {\n    const cc = {\n        colorMode: config.colorMode,\n        colorType: config.colorType,\n        parser: parseNumber,\n        viewProps: config.viewProps,\n    };\n    return [0, 1, 2].map((i) => {\n        const c = createComponentController(doc, cc, i);\n        connectValues({\n            primary: config.value,\n            secondary: c.value,\n            forward(p) {\n                const mc = mapColorType(p, config.colorType);\n                return mc.getComponents(config.colorMode)[i];\n            },\n            backward(p, s) {\n                const pickedMode = config.colorMode;\n                const mc = mapColorType(p, config.colorType);\n                const comps = mc.getComponents(pickedMode);\n                comps[i] = s;\n                const c = createColor(appendAlphaComponent(removeAlphaComponent(comps), comps[3]), pickedMode, config.colorType);\n                return mapColorType(c, 'int');\n            },\n        });\n        return c;\n    });\n}\nfunction createHexController(doc, config) {\n    const c = new TextController(doc, {\n        parser: createColorStringParser('int'),\n        props: ValueMap.fromObject({\n            formatter: colorToHexRgbString,\n        }),\n        value: createValue(IntColor.black()),\n        viewProps: config.viewProps,\n    });\n    connectValues({\n        primary: config.value,\n        secondary: c.value,\n        forward: (p) => new IntColor(removeAlphaComponent(p.getComponents()), p.mode),\n        backward: (p, s) => new IntColor(appendAlphaComponent(removeAlphaComponent(s.getComponents(p.mode)), p.getComponents()[3]), p.mode),\n    });\n    return [c];\n}\nfunction isColorMode(mode) {\n    return mode !== 'hex';\n}\nclass ColorTextsController {\n    constructor(doc, config) {\n        this.onModeSelectChange_ = this.onModeSelectChange_.bind(this);\n        this.colorType_ = config.colorType;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.colorMode = createValue(this.value.rawValue.mode);\n        this.ccs_ = this.createComponentControllers_(doc);\n        this.view = new ColorTextsView(doc, {\n            mode: this.colorMode,\n            inputViews: [this.ccs_[0].view, this.ccs_[1].view, this.ccs_[2].view],\n            viewProps: this.viewProps,\n        });\n        this.view.modeSelectElement.addEventListener('change', this.onModeSelectChange_);\n    }\n    createComponentControllers_(doc) {\n        const mode = this.colorMode.rawValue;\n        if (isColorMode(mode)) {\n            return createComponentControllers(doc, {\n                colorMode: mode,\n                colorType: this.colorType_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n        return createHexController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n    onModeSelectChange_(ev) {\n        const selectElem = ev.currentTarget;\n        this.colorMode.rawValue = selectElem.value;\n        this.ccs_ = this.createComponentControllers_(this.view.element.ownerDocument);\n        this.view.inputViews = this.ccs_.map((cc) => cc.view);\n    }\n}\n\nconst cn$9 = ClassName('hpl');\nclass HPaletteView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value = config.value;\n        this.value.emitter.on('change', this.onValueChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$9());\n        config.viewProps.bindClassModifiers(this.element);\n        config.viewProps.bindTabIndex(this.element);\n        const colorElem = doc.createElement('div');\n        colorElem.classList.add(cn$9('c'));\n        this.element.appendChild(colorElem);\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$9('m'));\n        this.element.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        this.update_();\n    }\n    update_() {\n        const c = this.value.rawValue;\n        const [h] = c.getComponents('hsv');\n        this.markerElem_.style.backgroundColor = colorToFunctionalRgbString(new IntColor([h, 100, 100], 'hsv'));\n        const left = mapRange(h, 0, 360, 0, 100);\n        this.markerElem_.style.left = `${left}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass HPaletteController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new HPaletteView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.element);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.element.addEventListener('keydown', this.onKeyDown_);\n        this.view.element.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const hue = mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, 0, 360);\n        const c = this.value.rawValue;\n        const [, s, v, a] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([hue, s, v, a], 'hsv'), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(false), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        const c = this.value.rawValue;\n        const [h, s, v, a] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h + step, s, v, a], 'hsv'), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(false), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nconst cn$8 = ClassName('svp');\nconst CANVAS_RESOL = 64;\nclass SvPaletteView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value = config.value;\n        this.value.emitter.on('change', this.onValueChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$8());\n        config.viewProps.bindClassModifiers(this.element);\n        config.viewProps.bindTabIndex(this.element);\n        const canvasElem = doc.createElement('canvas');\n        canvasElem.height = CANVAS_RESOL;\n        canvasElem.width = CANVAS_RESOL;\n        canvasElem.classList.add(cn$8('c'));\n        this.element.appendChild(canvasElem);\n        this.canvasElement = canvasElem;\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$8('m'));\n        this.element.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        this.update_();\n    }\n    update_() {\n        const ctx = getCanvasContext(this.canvasElement);\n        if (!ctx) {\n            return;\n        }\n        const c = this.value.rawValue;\n        const hsvComps = c.getComponents('hsv');\n        const width = this.canvasElement.width;\n        const height = this.canvasElement.height;\n        const imgData = ctx.getImageData(0, 0, width, height);\n        const data = imgData.data;\n        for (let iy = 0; iy < height; iy++) {\n            for (let ix = 0; ix < width; ix++) {\n                const s = mapRange(ix, 0, width, 0, 100);\n                const v = mapRange(iy, 0, height, 100, 0);\n                const rgbComps = hsvToRgbInt(hsvComps[0], s, v);\n                const i = (iy * width + ix) * 4;\n                data[i] = rgbComps[0];\n                data[i + 1] = rgbComps[1];\n                data[i + 2] = rgbComps[2];\n                data[i + 3] = 255;\n            }\n        }\n        ctx.putImageData(imgData, 0, 0);\n        const left = mapRange(hsvComps[1], 0, 100, 0, 100);\n        this.markerElem_.style.left = `${left}%`;\n        const top = mapRange(hsvComps[2], 0, 100, 100, 0);\n        this.markerElem_.style.top = `${top}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass SvPaletteController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new SvPaletteView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.element);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.element.addEventListener('keydown', this.onKeyDown_);\n        this.view.element.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const saturation = mapRange(d.point.x, 0, d.bounds.width, 0, 100);\n        const value = mapRange(d.point.y, 0, d.bounds.height, 100, 0);\n        const [h, , , a] = this.value.rawValue.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h, saturation, value, a], 'hsv'), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        if (isArrowKey(ev.key)) {\n            ev.preventDefault();\n        }\n        const [h, s, v, a] = this.value.rawValue.getComponents('hsv');\n        const keyScale = getKeyScaleForColor(false);\n        const ds = getStepForKey(keyScale, getHorizontalStepKeys(ev));\n        const dv = getStepForKey(keyScale, getVerticalStepKeys(ev));\n        if (ds === 0 && dv === 0) {\n            return;\n        }\n        this.value.setRawValue(new IntColor([h, s + ds, v + dv, a], 'hsv'), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const keyScale = getKeyScaleForColor(false);\n        const ds = getStepForKey(keyScale, getHorizontalStepKeys(ev));\n        const dv = getStepForKey(keyScale, getVerticalStepKeys(ev));\n        if (ds === 0 && dv === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nclass ColorPickerController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.hPaletteC_ = new HPaletteController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.svPaletteC_ = new SvPaletteController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.alphaIcs_ = config.supportsAlpha\n            ? {\n                palette: new APaletteController(doc, {\n                    value: this.value,\n                    viewProps: this.viewProps,\n                }),\n                text: new NumberTextController(doc, {\n                    parser: parseNumber,\n                    props: ValueMap.fromObject({\n                        pointerScale: 0.01,\n                        keyScale: 0.1,\n                        formatter: createNumberFormatter(2),\n                    }),\n                    value: createValue(0, {\n                        constraint: new DefiniteRangeConstraint({ min: 0, max: 1 }),\n                    }),\n                    viewProps: this.viewProps,\n                }),\n            }\n            : null;\n        if (this.alphaIcs_) {\n            connectValues({\n                primary: this.value,\n                secondary: this.alphaIcs_.text.value,\n                forward: (p) => p.getComponents()[3],\n                backward: (p, s) => {\n                    const comps = p.getComponents();\n                    comps[3] = s;\n                    return new IntColor(comps, p.mode);\n                },\n            });\n        }\n        this.textsC_ = new ColorTextsController(doc, {\n            colorType: config.colorType,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view = new ColorPickerView(doc, {\n            alphaViews: this.alphaIcs_\n                ? {\n                    palette: this.alphaIcs_.palette.view,\n                    text: this.alphaIcs_.text.view,\n                }\n                : null,\n            hPaletteView: this.hPaletteC_.view,\n            supportsAlpha: config.supportsAlpha,\n            svPaletteView: this.svPaletteC_.view,\n            textsView: this.textsC_.view,\n            viewProps: this.viewProps,\n        });\n    }\n    get textsController() {\n        return this.textsC_;\n    }\n}\n\nconst cn$7 = ClassName('colsw');\nclass ColorSwatchView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value = config.value;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$7());\n        config.viewProps.bindClassModifiers(this.element);\n        const swatchElem = doc.createElement('div');\n        swatchElem.classList.add(cn$7('sw'));\n        this.element.appendChild(swatchElem);\n        this.swatchElem_ = swatchElem;\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$7('b'));\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        this.update_();\n    }\n    update_() {\n        const value = this.value.rawValue;\n        this.swatchElem_.style.backgroundColor = colorToHexRgbaString(value);\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass ColorSwatchController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new ColorSwatchView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nclass ColorController {\n    constructor(doc, config) {\n        this.onButtonBlur_ = this.onButtonBlur_.bind(this);\n        this.onButtonClick_ = this.onButtonClick_.bind(this);\n        this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n        this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.foldable_ = Foldable.create(config.expanded);\n        this.swatchC_ = new ColorSwatchController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        const buttonElem = this.swatchC_.view.buttonElement;\n        buttonElem.addEventListener('blur', this.onButtonBlur_);\n        buttonElem.addEventListener('click', this.onButtonClick_);\n        this.textC_ = new TextController(doc, {\n            parser: config.parser,\n            props: ValueMap.fromObject({\n                formatter: config.formatter,\n            }),\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view = new ColorView(doc, {\n            foldable: this.foldable_,\n            pickerLayout: config.pickerLayout,\n        });\n        this.view.swatchElement.appendChild(this.swatchC_.view.element);\n        this.view.textElement.appendChild(this.textC_.view.element);\n        this.popC_ =\n            config.pickerLayout === 'popup'\n                ? new PopupController(doc, {\n                    viewProps: this.viewProps,\n                })\n                : null;\n        const pickerC = new ColorPickerController(doc, {\n            colorType: config.colorType,\n            supportsAlpha: config.supportsAlpha,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        pickerC.view.allFocusableElements.forEach((elem) => {\n            elem.addEventListener('blur', this.onPopupChildBlur_);\n            elem.addEventListener('keydown', this.onPopupChildKeydown_);\n        });\n        this.pickerC_ = pickerC;\n        if (this.popC_) {\n            this.view.element.appendChild(this.popC_.view.element);\n            this.popC_.view.element.appendChild(pickerC.view.element);\n            connectValues({\n                primary: this.foldable_.value('expanded'),\n                secondary: this.popC_.shows,\n                forward: (p) => p,\n                backward: (_, s) => s,\n            });\n        }\n        else if (this.view.pickerElement) {\n            this.view.pickerElement.appendChild(this.pickerC_.view.element);\n            bindFoldable(this.foldable_, this.view.pickerElement);\n        }\n    }\n    get textController() {\n        return this.textC_;\n    }\n    onButtonBlur_(e) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.view.element;\n        const nextTarget = forceCast(e.relatedTarget);\n        if (!nextTarget || !elem.contains(nextTarget)) {\n            this.popC_.shows.rawValue = false;\n        }\n    }\n    onButtonClick_() {\n        this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n        if (this.foldable_.get('expanded')) {\n            this.pickerC_.view.allFocusableElements[0].focus();\n        }\n    }\n    onPopupChildBlur_(ev) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.popC_.view.element;\n        const nextTarget = findNextTarget(ev);\n        if (nextTarget && elem.contains(nextTarget)) {\n            return;\n        }\n        if (nextTarget &&\n            nextTarget === this.swatchC_.view.buttonElement &&\n            !supportsTouch(elem.ownerDocument)) {\n            return;\n        }\n        this.popC_.shows.rawValue = false;\n    }\n    onPopupChildKeydown_(ev) {\n        if (this.popC_) {\n            if (ev.key === 'Escape') {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        else if (this.view.pickerElement) {\n            if (ev.key === 'Escape') {\n                this.swatchC_.view.buttonElement.focus();\n            }\n        }\n    }\n}\n\nfunction colorToRgbNumber(value) {\n    return removeAlphaComponent(value.getComponents('rgb')).reduce((result, comp) => {\n        return (result << 8) | (Math.floor(comp) & 0xff);\n    }, 0);\n}\nfunction colorToRgbaNumber(value) {\n    return (value.getComponents('rgb').reduce((result, comp, index) => {\n        const hex = Math.floor(index === 3 ? comp * 255 : comp) & 0xff;\n        return (result << 8) | hex;\n    }, 0) >>> 0);\n}\nfunction numberToRgbColor(num) {\n    return new IntColor([(num >> 16) & 0xff, (num >> 8) & 0xff, num & 0xff], 'rgb');\n}\nfunction numberToRgbaColor(num) {\n    return new IntColor([\n        (num >> 24) & 0xff,\n        (num >> 16) & 0xff,\n        (num >> 8) & 0xff,\n        mapRange(num & 0xff, 0, 255, 0, 1),\n    ], 'rgb');\n}\nfunction colorFromRgbNumber(value) {\n    if (typeof value !== 'number') {\n        return IntColor.black();\n    }\n    return numberToRgbColor(value);\n}\nfunction colorFromRgbaNumber(value) {\n    if (typeof value !== 'number') {\n        return IntColor.black();\n    }\n    return numberToRgbaColor(value);\n}\n\nfunction isRgbColorComponent(obj, key) {\n    if (typeof obj !== 'object' || isEmpty(obj)) {\n        return false;\n    }\n    return key in obj && typeof obj[key] === 'number';\n}\nfunction isRgbColorObject(obj) {\n    return (isRgbColorComponent(obj, 'r') &&\n        isRgbColorComponent(obj, 'g') &&\n        isRgbColorComponent(obj, 'b'));\n}\nfunction isRgbaColorObject(obj) {\n    return isRgbColorObject(obj) && isRgbColorComponent(obj, 'a');\n}\nfunction isColorObject(obj) {\n    return isRgbColorObject(obj);\n}\nfunction equalsColor(v1, v2) {\n    if (v1.mode !== v2.mode) {\n        return false;\n    }\n    if (v1.type !== v2.type) {\n        return false;\n    }\n    const comps1 = v1.getComponents();\n    const comps2 = v2.getComponents();\n    for (let i = 0; i < comps1.length; i++) {\n        if (comps1[i] !== comps2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction createColorComponentsFromRgbObject(obj) {\n    return 'a' in obj ? [obj.r, obj.g, obj.b, obj.a] : [obj.r, obj.g, obj.b];\n}\n\nfunction createColorStringWriter(format) {\n    const stringify = findColorStringifier(format);\n    return stringify\n        ? (target, value) => {\n            writePrimitive(target, stringify(value));\n        }\n        : null;\n}\nfunction createColorNumberWriter(supportsAlpha) {\n    const colorToNumber = supportsAlpha ? colorToRgbaNumber : colorToRgbNumber;\n    return (target, value) => {\n        writePrimitive(target, colorToNumber(value));\n    };\n}\nfunction writeRgbaColorObject(target, value, type) {\n    const cc = mapColorType(value, type);\n    const obj = cc.toRgbaObject();\n    target.writeProperty('r', obj.r);\n    target.writeProperty('g', obj.g);\n    target.writeProperty('b', obj.b);\n    target.writeProperty('a', obj.a);\n}\nfunction writeRgbColorObject(target, value, type) {\n    const cc = mapColorType(value, type);\n    const obj = cc.toRgbaObject();\n    target.writeProperty('r', obj.r);\n    target.writeProperty('g', obj.g);\n    target.writeProperty('b', obj.b);\n}\nfunction createColorObjectWriter(supportsAlpha, type) {\n    return (target, inValue) => {\n        if (supportsAlpha) {\n            writeRgbaColorObject(target, inValue, type);\n        }\n        else {\n            writeRgbColorObject(target, inValue, type);\n        }\n    };\n}\n\nfunction shouldSupportAlpha$1(inputParams) {\n    var _a;\n    if ((_a = inputParams === null || inputParams === void 0 ? void 0 : inputParams.color) === null || _a === void 0 ? void 0 : _a.alpha) {\n        return true;\n    }\n    return false;\n}\nfunction createFormatter$1(supportsAlpha) {\n    return supportsAlpha\n        ? (v) => colorToHexRgbaString(v, '0x')\n        : (v) => colorToHexRgbString(v, '0x');\n}\nfunction isForColor(params) {\n    if ('color' in params) {\n        return true;\n    }\n    if (params.view === 'color') {\n        return true;\n    }\n    return false;\n}\nconst NumberColorInputPlugin = createPlugin({\n    id: 'input-color-number',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'number') {\n            return null;\n        }\n        if (!isForColor(params)) {\n            return null;\n        }\n        const result = parseColorInputParams(params);\n        return result\n            ? {\n                initialValue: value,\n                params: Object.assign(Object.assign({}, result), { supportsAlpha: shouldSupportAlpha$1(params) }),\n            }\n            : null;\n    },\n    binding: {\n        reader: (args) => {\n            return args.params.supportsAlpha\n                ? colorFromRgbaNumber\n                : colorFromRgbNumber;\n        },\n        equals: equalsColor,\n        writer: (args) => {\n            return createColorNumberWriter(args.params.supportsAlpha);\n        },\n    },\n    controller: (args) => {\n        var _a, _b;\n        return new ColorController(args.document, {\n            colorType: 'int',\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            formatter: createFormatter$1(args.params.supportsAlpha),\n            parser: createColorStringParser('int'),\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            supportsAlpha: args.params.supportsAlpha,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nfunction colorFromObject(value, type) {\n    if (!isColorObject(value)) {\n        return mapColorType(IntColor.black(), type);\n    }\n    if (type === 'int') {\n        const comps = createColorComponentsFromRgbObject(value);\n        return new IntColor(comps, 'rgb');\n    }\n    if (type === 'float') {\n        const comps = createColorComponentsFromRgbObject(value);\n        return new FloatColor(comps, 'rgb');\n    }\n    return mapColorType(IntColor.black(), 'int');\n}\n\nfunction shouldSupportAlpha(initialValue) {\n    return isRgbaColorObject(initialValue);\n}\nfunction createColorObjectBindingReader(type) {\n    return (value) => {\n        const c = colorFromObject(value, type);\n        return mapColorType(c, 'int');\n    };\n}\nfunction createColorObjectFormatter(supportsAlpha, type) {\n    return (value) => {\n        if (supportsAlpha) {\n            return colorToObjectRgbaString(value, type);\n        }\n        return colorToObjectRgbString(value, type);\n    };\n}\nconst ObjectColorInputPlugin = createPlugin({\n    id: 'input-color-object',\n    type: 'input',\n    accept: (value, params) => {\n        var _a;\n        if (!isColorObject(value)) {\n            return null;\n        }\n        const result = parseColorInputParams(params);\n        return result\n            ? {\n                initialValue: value,\n                params: Object.assign(Object.assign({}, result), { colorType: (_a = extractColorType(params)) !== null && _a !== void 0 ? _a : 'int' }),\n            }\n            : null;\n    },\n    binding: {\n        reader: (args) => createColorObjectBindingReader(args.params.colorType),\n        equals: equalsColor,\n        writer: (args) => createColorObjectWriter(shouldSupportAlpha(args.initialValue), args.params.colorType),\n    },\n    controller: (args) => {\n        var _a, _b;\n        const supportsAlpha = isRgbaColorObject(args.initialValue);\n        return new ColorController(args.document, {\n            colorType: args.params.colorType,\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            formatter: createColorObjectFormatter(supportsAlpha, args.params.colorType),\n            parser: createColorStringParser('int'),\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            supportsAlpha: supportsAlpha,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nconst StringColorInputPlugin = createPlugin({\n    id: 'input-color-string',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'string') {\n            return null;\n        }\n        if (params.view === 'text') {\n            return null;\n        }\n        const format = detectStringColorFormat(value, extractColorType(params));\n        if (!format) {\n            return null;\n        }\n        const stringifier = findColorStringifier(format);\n        if (!stringifier) {\n            return null;\n        }\n        const result = parseColorInputParams(params);\n        return result\n            ? {\n                initialValue: value,\n                params: Object.assign(Object.assign({}, result), { format: format, stringifier: stringifier }),\n            }\n            : null;\n    },\n    binding: {\n        reader: () => readIntColorString,\n        equals: equalsColor,\n        writer: (args) => {\n            const writer = createColorStringWriter(args.params.format);\n            if (!writer) {\n                throw TpError.notBindable();\n            }\n            return writer;\n        },\n    },\n    controller: (args) => {\n        var _a, _b;\n        return new ColorController(args.document, {\n            colorType: args.params.format.type,\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            formatter: args.params.stringifier,\n            parser: createColorStringParser('int'),\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            supportsAlpha: args.params.format.alpha,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass PointNdConstraint {\n    constructor(config) {\n        this.components = config.components;\n        this.asm_ = config.assembly;\n    }\n    constrain(value) {\n        const comps = this.asm_\n            .toComponents(value)\n            .map((comp, index) => { var _a, _b; return (_b = (_a = this.components[index]) === null || _a === void 0 ? void 0 : _a.constrain(comp)) !== null && _b !== void 0 ? _b : comp; });\n        return this.asm_.fromComponents(comps);\n    }\n}\n\nconst cn$6 = ClassName('pndtxt');\nclass PointNdTextView {\n    constructor(doc, config) {\n        this.textViews = config.textViews;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$6());\n        this.textViews.forEach((v) => {\n            const axisElem = doc.createElement('div');\n            axisElem.classList.add(cn$6('a'));\n            axisElem.appendChild(v.element);\n            this.element.appendChild(axisElem);\n        });\n    }\n}\n\nfunction createAxisController(doc, config, index) {\n    return new NumberTextController(doc, {\n        arrayPosition: index === 0 ? 'fst' : index === config.axes.length - 1 ? 'lst' : 'mid',\n        parser: config.parser,\n        props: config.axes[index].textProps,\n        value: createValue(0, {\n            constraint: config.axes[index].constraint,\n        }),\n        viewProps: config.viewProps,\n    });\n}\nclass PointNdTextController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.acs_ = config.axes.map((_, index) => createAxisController(doc, config, index));\n        this.acs_.forEach((c, index) => {\n            connectValues({\n                primary: this.value,\n                secondary: c.value,\n                forward: (p) => config.assembly.toComponents(p)[index],\n                backward: (p, s) => {\n                    const comps = config.assembly.toComponents(p);\n                    comps[index] = s;\n                    return config.assembly.fromComponents(comps);\n                },\n            });\n        });\n        this.view = new PointNdTextView(doc, {\n            textViews: this.acs_.map((ac) => ac.view),\n        });\n    }\n    get textControllers() {\n        return this.acs_;\n    }\n}\n\nclass SliderInputBindingApi extends BindingApi {\n    get max() {\n        return this.controller.valueController.sliderController.props.get('max');\n    }\n    set max(max) {\n        this.controller.valueController.sliderController.props.set('max', max);\n    }\n    get min() {\n        return this.controller.valueController.sliderController.props.get('min');\n    }\n    set min(max) {\n        this.controller.valueController.sliderController.props.set('min', max);\n    }\n}\n\nfunction createConstraint$4(params, initialValue) {\n    const constraints = [];\n    const sc = createStepConstraint(params, initialValue);\n    if (sc) {\n        constraints.push(sc);\n    }\n    const rc = createRangeConstraint(params);\n    if (rc) {\n        constraints.push(rc);\n    }\n    const lc = createListConstraint(params.options);\n    if (lc) {\n        constraints.push(lc);\n    }\n    return new CompositeConstraint(constraints);\n}\nconst NumberInputPlugin = createPlugin({\n    id: 'input-number',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'number') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createNumberTextInputParamsParser(p)), { options: p.optional.custom(parseListOptions), readonly: p.optional.constant(false) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => numberFromUnknown,\n        constraint: (args) => createConstraint$4(args.params, args.initialValue),\n        writer: (_args) => writePrimitive,\n    },\n    controller: (args) => {\n        const value = args.value;\n        const c = args.constraint;\n        const lc = c && findConstraint(c, ListConstraint);\n        if (lc) {\n            return new ListController(args.document, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        const textPropsObj = createNumberTextPropsObject(args.params, value.rawValue);\n        const drc = c && findConstraint(c, DefiniteRangeConstraint);\n        if (drc) {\n            return new SliderTextController(args.document, Object.assign(Object.assign({}, createSliderTextProps(Object.assign(Object.assign({}, textPropsObj), { keyScale: createValue(textPropsObj.keyScale), max: drc.values.value('max'), min: drc.values.value('min') }))), { parser: parseNumber, value: value, viewProps: args.viewProps }));\n        }\n        return new NumberTextController(args.document, {\n            parser: parseNumber,\n            props: ValueMap.fromObject(textPropsObj),\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (typeof args.controller.value.rawValue !== 'number') {\n            return null;\n        }\n        if (args.controller.valueController instanceof SliderTextController) {\n            return new SliderInputBindingApi(args.controller);\n        }\n        if (args.controller.valueController instanceof ListController) {\n            return new ListInputBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nclass Point2d {\n    constructor(x = 0, y = 0) {\n        this.x = x;\n        this.y = y;\n    }\n    getComponents() {\n        return [this.x, this.y];\n    }\n    static isObject(obj) {\n        if (isEmpty(obj)) {\n            return false;\n        }\n        const x = obj.x;\n        const y = obj.y;\n        if (typeof x !== 'number' || typeof y !== 'number') {\n            return false;\n        }\n        return true;\n    }\n    static equals(v1, v2) {\n        return v1.x === v2.x && v1.y === v2.y;\n    }\n    toObject() {\n        return {\n            x: this.x,\n            y: this.y,\n        };\n    }\n}\nconst Point2dAssembly = {\n    toComponents: (p) => p.getComponents(),\n    fromComponents: (comps) => new Point2d(...comps),\n};\n\nconst cn$5 = ClassName('p2d');\nclass Point2dView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$5());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValue(config.expanded, valueToClassName(this.element, cn$5(undefined, 'expanded')));\n        const headElem = doc.createElement('div');\n        headElem.classList.add(cn$5('h'));\n        this.element.appendChild(headElem);\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$5('b'));\n        buttonElem.appendChild(createSvgIconElement(doc, 'p2dpad'));\n        config.viewProps.bindDisabled(buttonElem);\n        headElem.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const textElem = doc.createElement('div');\n        textElem.classList.add(cn$5('t'));\n        headElem.appendChild(textElem);\n        this.textElement = textElem;\n        if (config.pickerLayout === 'inline') {\n            const pickerElem = doc.createElement('div');\n            pickerElem.classList.add(cn$5('p'));\n            this.element.appendChild(pickerElem);\n            this.pickerElement = pickerElem;\n        }\n        else {\n            this.pickerElement = null;\n        }\n    }\n}\n\nconst cn$4 = ClassName('p2dp');\nclass Point2dPickerView {\n    constructor(doc, config) {\n        this.onFoldableChange_ = this.onFoldableChange_.bind(this);\n        this.onPropsChange_ = this.onPropsChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onPropsChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$4());\n        if (config.layout === 'popup') {\n            this.element.classList.add(cn$4(undefined, 'p'));\n        }\n        config.viewProps.bindClassModifiers(this.element);\n        const padElem = doc.createElement('div');\n        padElem.classList.add(cn$4('p'));\n        config.viewProps.bindTabIndex(padElem);\n        this.element.appendChild(padElem);\n        this.padElement = padElem;\n        const svgElem = doc.createElementNS(SVG_NS, 'svg');\n        svgElem.classList.add(cn$4('g'));\n        this.padElement.appendChild(svgElem);\n        this.svgElem_ = svgElem;\n        const xAxisElem = doc.createElementNS(SVG_NS, 'line');\n        xAxisElem.classList.add(cn$4('ax'));\n        xAxisElem.setAttributeNS(null, 'x1', '0');\n        xAxisElem.setAttributeNS(null, 'y1', '50%');\n        xAxisElem.setAttributeNS(null, 'x2', '100%');\n        xAxisElem.setAttributeNS(null, 'y2', '50%');\n        this.svgElem_.appendChild(xAxisElem);\n        const yAxisElem = doc.createElementNS(SVG_NS, 'line');\n        yAxisElem.classList.add(cn$4('ax'));\n        yAxisElem.setAttributeNS(null, 'x1', '50%');\n        yAxisElem.setAttributeNS(null, 'y1', '0');\n        yAxisElem.setAttributeNS(null, 'x2', '50%');\n        yAxisElem.setAttributeNS(null, 'y2', '100%');\n        this.svgElem_.appendChild(yAxisElem);\n        const lineElem = doc.createElementNS(SVG_NS, 'line');\n        lineElem.classList.add(cn$4('l'));\n        lineElem.setAttributeNS(null, 'x1', '50%');\n        lineElem.setAttributeNS(null, 'y1', '50%');\n        this.svgElem_.appendChild(lineElem);\n        this.lineElem_ = lineElem;\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$4('m'));\n        this.padElement.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value = config.value;\n        this.update_();\n    }\n    get allFocusableElements() {\n        return [this.padElement];\n    }\n    update_() {\n        const [x, y] = this.value.rawValue.getComponents();\n        const max = this.props_.get('max');\n        const px = mapRange(x, -max, +max, 0, 100);\n        const py = mapRange(y, -max, +max, 0, 100);\n        const ipy = this.props_.get('invertsY') ? 100 - py : py;\n        this.lineElem_.setAttributeNS(null, 'x2', `${px}%`);\n        this.lineElem_.setAttributeNS(null, 'y2', `${ipy}%`);\n        this.markerElem_.style.left = `${px}%`;\n        this.markerElem_.style.top = `${ipy}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n    onPropsChange_() {\n        this.update_();\n    }\n    onFoldableChange_() {\n        this.update_();\n    }\n}\n\nfunction computeOffset(ev, keyScales, invertsY) {\n    return [\n        getStepForKey(keyScales[0], getHorizontalStepKeys(ev)),\n        getStepForKey(keyScales[1], getVerticalStepKeys(ev)) * (invertsY ? 1 : -1),\n    ];\n}\nclass Point2dPickerController {\n    constructor(doc, config) {\n        this.onPadKeyDown_ = this.onPadKeyDown_.bind(this);\n        this.onPadKeyUp_ = this.onPadKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new Point2dPickerView(doc, {\n            layout: config.layout,\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.padElement);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.padElement.addEventListener('keydown', this.onPadKeyDown_);\n        this.view.padElement.addEventListener('keyup', this.onPadKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const max = this.props.get('max');\n        const px = mapRange(d.point.x, 0, d.bounds.width, -max, +max);\n        const py = mapRange(this.props.get('invertsY') ? d.bounds.height - d.point.y : d.point.y, 0, d.bounds.height, -max, +max);\n        this.value.setRawValue(new Point2d(px, py), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onPadKeyDown_(ev) {\n        if (isArrowKey(ev.key)) {\n            ev.preventDefault();\n        }\n        const [dx, dy] = computeOffset(ev, [this.props.get('xKeyScale'), this.props.get('yKeyScale')], this.props.get('invertsY'));\n        if (dx === 0 && dy === 0) {\n            return;\n        }\n        this.value.setRawValue(new Point2d(this.value.rawValue.x + dx, this.value.rawValue.y + dy), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPadKeyUp_(ev) {\n        const [dx, dy] = computeOffset(ev, [this.props.get('xKeyScale'), this.props.get('yKeyScale')], this.props.get('invertsY'));\n        if (dx === 0 && dy === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nclass Point2dController {\n    constructor(doc, config) {\n        var _a, _b;\n        this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n        this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n        this.onPadButtonBlur_ = this.onPadButtonBlur_.bind(this);\n        this.onPadButtonClick_ = this.onPadButtonClick_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.foldable_ = Foldable.create(config.expanded);\n        this.popC_ =\n            config.pickerLayout === 'popup'\n                ? new PopupController(doc, {\n                    viewProps: this.viewProps,\n                })\n                : null;\n        const padC = new Point2dPickerController(doc, {\n            layout: config.pickerLayout,\n            props: new ValueMap({\n                invertsY: createValue(config.invertsY),\n                max: createValue(config.max),\n                xKeyScale: config.axes[0].textProps.value('keyScale'),\n                yKeyScale: config.axes[1].textProps.value('keyScale'),\n            }),\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        padC.view.allFocusableElements.forEach((elem) => {\n            elem.addEventListener('blur', this.onPopupChildBlur_);\n            elem.addEventListener('keydown', this.onPopupChildKeydown_);\n        });\n        this.pickerC_ = padC;\n        this.textC_ = new PointNdTextController(doc, {\n            assembly: Point2dAssembly,\n            axes: config.axes,\n            parser: config.parser,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view = new Point2dView(doc, {\n            expanded: this.foldable_.value('expanded'),\n            pickerLayout: config.pickerLayout,\n            viewProps: this.viewProps,\n        });\n        this.view.textElement.appendChild(this.textC_.view.element);\n        (_a = this.view.buttonElement) === null || _a === void 0 ? void 0 : _a.addEventListener('blur', this.onPadButtonBlur_);\n        (_b = this.view.buttonElement) === null || _b === void 0 ? void 0 : _b.addEventListener('click', this.onPadButtonClick_);\n        if (this.popC_) {\n            this.view.element.appendChild(this.popC_.view.element);\n            this.popC_.view.element.appendChild(this.pickerC_.view.element);\n            connectValues({\n                primary: this.foldable_.value('expanded'),\n                secondary: this.popC_.shows,\n                forward: (p) => p,\n                backward: (_, s) => s,\n            });\n        }\n        else if (this.view.pickerElement) {\n            this.view.pickerElement.appendChild(this.pickerC_.view.element);\n            bindFoldable(this.foldable_, this.view.pickerElement);\n        }\n    }\n    get textController() {\n        return this.textC_;\n    }\n    onPadButtonBlur_(e) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.view.element;\n        const nextTarget = forceCast(e.relatedTarget);\n        if (!nextTarget || !elem.contains(nextTarget)) {\n            this.popC_.shows.rawValue = false;\n        }\n    }\n    onPadButtonClick_() {\n        this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n        if (this.foldable_.get('expanded')) {\n            this.pickerC_.view.allFocusableElements[0].focus();\n        }\n    }\n    onPopupChildBlur_(ev) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.popC_.view.element;\n        const nextTarget = findNextTarget(ev);\n        if (nextTarget && elem.contains(nextTarget)) {\n            return;\n        }\n        if (nextTarget &&\n            nextTarget === this.view.buttonElement &&\n            !supportsTouch(elem.ownerDocument)) {\n            return;\n        }\n        this.popC_.shows.rawValue = false;\n    }\n    onPopupChildKeydown_(ev) {\n        if (this.popC_) {\n            if (ev.key === 'Escape') {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        else if (this.view.pickerElement) {\n            if (ev.key === 'Escape') {\n                this.view.buttonElement.focus();\n            }\n        }\n    }\n}\n\nfunction point2dFromUnknown(value) {\n    return Point2d.isObject(value)\n        ? new Point2d(value.x, value.y)\n        : new Point2d();\n}\nfunction writePoint2d(target, value) {\n    target.writeProperty('x', value.x);\n    target.writeProperty('y', value.y);\n}\n\nfunction createConstraint$3(params, initialValue) {\n    return new PointNdConstraint({\n        assembly: Point2dAssembly,\n        components: [\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.x), initialValue.x),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.y), initialValue.y),\n        ],\n    });\n}\nfunction getSuitableMaxDimensionValue(params, rawValue) {\n    var _a, _b;\n    if (!isEmpty(params.min) || !isEmpty(params.max)) {\n        return Math.max(Math.abs((_a = params.min) !== null && _a !== void 0 ? _a : 0), Math.abs((_b = params.max) !== null && _b !== void 0 ? _b : 0));\n    }\n    const step = getSuitableKeyScale(params);\n    return Math.max(Math.abs(step) * 10, Math.abs(rawValue) * 10);\n}\nfunction getSuitableMax(params, initialValue) {\n    var _a, _b;\n    const xr = getSuitableMaxDimensionValue(deepMerge(params, ((_a = params.x) !== null && _a !== void 0 ? _a : {})), initialValue.x);\n    const yr = getSuitableMaxDimensionValue(deepMerge(params, ((_b = params.y) !== null && _b !== void 0 ? _b : {})), initialValue.y);\n    return Math.max(xr, yr);\n}\nfunction shouldInvertY(params) {\n    if (!('y' in params)) {\n        return false;\n    }\n    const yParams = params.y;\n    if (!yParams) {\n        return false;\n    }\n    return 'inverted' in yParams ? !!yParams.inverted : false;\n}\nconst Point2dInputPlugin = createPlugin({\n    id: 'input-point2d',\n    type: 'input',\n    accept: (value, params) => {\n        if (!Point2d.isObject(value)) {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createPointDimensionParser(p)), { expanded: p.optional.boolean, picker: p.optional.custom(parsePickerLayout), readonly: p.optional.constant(false), x: p.optional.custom(parsePointDimensionParams), y: p.optional.object(Object.assign(Object.assign({}, createPointDimensionParser(p)), { inverted: p.optional.boolean })) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: () => point2dFromUnknown,\n        constraint: (args) => createConstraint$3(args.params, args.initialValue),\n        equals: Point2d.equals,\n        writer: () => writePoint2d,\n    },\n    controller: (args) => {\n        var _a, _b;\n        const doc = args.document;\n        const value = args.value;\n        const c = args.constraint;\n        const dParams = [args.params.x, args.params.y];\n        return new Point2dController(doc, {\n            axes: value.rawValue.getComponents().map((comp, i) => {\n                var _a;\n                return createPointAxis({\n                    constraint: c.components[i],\n                    initialValue: comp,\n                    params: deepMerge(args.params, ((_a = dParams[i]) !== null && _a !== void 0 ? _a : {})),\n                });\n            }),\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            invertsY: shouldInvertY(args.params),\n            max: getSuitableMax(args.params, value.rawValue),\n            parser: parseNumber,\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass Point3d {\n    constructor(x = 0, y = 0, z = 0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n    getComponents() {\n        return [this.x, this.y, this.z];\n    }\n    static isObject(obj) {\n        if (isEmpty(obj)) {\n            return false;\n        }\n        const x = obj.x;\n        const y = obj.y;\n        const z = obj.z;\n        if (typeof x !== 'number' ||\n            typeof y !== 'number' ||\n            typeof z !== 'number') {\n            return false;\n        }\n        return true;\n    }\n    static equals(v1, v2) {\n        return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z;\n    }\n    toObject() {\n        return {\n            x: this.x,\n            y: this.y,\n            z: this.z,\n        };\n    }\n}\nconst Point3dAssembly = {\n    toComponents: (p) => p.getComponents(),\n    fromComponents: (comps) => new Point3d(...comps),\n};\n\nfunction point3dFromUnknown(value) {\n    return Point3d.isObject(value)\n        ? new Point3d(value.x, value.y, value.z)\n        : new Point3d();\n}\nfunction writePoint3d(target, value) {\n    target.writeProperty('x', value.x);\n    target.writeProperty('y', value.y);\n    target.writeProperty('z', value.z);\n}\n\nfunction createConstraint$2(params, initialValue) {\n    return new PointNdConstraint({\n        assembly: Point3dAssembly,\n        components: [\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.x), initialValue.x),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.y), initialValue.y),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.z), initialValue.z),\n        ],\n    });\n}\nconst Point3dInputPlugin = createPlugin({\n    id: 'input-point3d',\n    type: 'input',\n    accept: (value, params) => {\n        if (!Point3d.isObject(value)) {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createPointDimensionParser(p)), { readonly: p.optional.constant(false), x: p.optional.custom(parsePointDimensionParams), y: p.optional.custom(parsePointDimensionParams), z: p.optional.custom(parsePointDimensionParams) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => point3dFromUnknown,\n        constraint: (args) => createConstraint$2(args.params, args.initialValue),\n        equals: Point3d.equals,\n        writer: (_args) => writePoint3d,\n    },\n    controller: (args) => {\n        const value = args.value;\n        const c = args.constraint;\n        const dParams = [args.params.x, args.params.y, args.params.z];\n        return new PointNdTextController(args.document, {\n            assembly: Point3dAssembly,\n            axes: value.rawValue.getComponents().map((comp, i) => {\n                var _a;\n                return createPointAxis({\n                    constraint: c.components[i],\n                    initialValue: comp,\n                    params: deepMerge(args.params, ((_a = dParams[i]) !== null && _a !== void 0 ? _a : {})),\n                });\n            }),\n            parser: parseNumber,\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass Point4d {\n    constructor(x = 0, y = 0, z = 0, w = 0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.w = w;\n    }\n    getComponents() {\n        return [this.x, this.y, this.z, this.w];\n    }\n    static isObject(obj) {\n        if (isEmpty(obj)) {\n            return false;\n        }\n        const x = obj.x;\n        const y = obj.y;\n        const z = obj.z;\n        const w = obj.w;\n        if (typeof x !== 'number' ||\n            typeof y !== 'number' ||\n            typeof z !== 'number' ||\n            typeof w !== 'number') {\n            return false;\n        }\n        return true;\n    }\n    static equals(v1, v2) {\n        return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z && v1.w === v2.w;\n    }\n    toObject() {\n        return {\n            x: this.x,\n            y: this.y,\n            z: this.z,\n            w: this.w,\n        };\n    }\n}\nconst Point4dAssembly = {\n    toComponents: (p) => p.getComponents(),\n    fromComponents: (comps) => new Point4d(...comps),\n};\n\nfunction point4dFromUnknown(value) {\n    return Point4d.isObject(value)\n        ? new Point4d(value.x, value.y, value.z, value.w)\n        : new Point4d();\n}\nfunction writePoint4d(target, value) {\n    target.writeProperty('x', value.x);\n    target.writeProperty('y', value.y);\n    target.writeProperty('z', value.z);\n    target.writeProperty('w', value.w);\n}\n\nfunction createConstraint$1(params, initialValue) {\n    return new PointNdConstraint({\n        assembly: Point4dAssembly,\n        components: [\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.x), initialValue.x),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.y), initialValue.y),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.z), initialValue.z),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.w), initialValue.w),\n        ],\n    });\n}\nconst Point4dInputPlugin = createPlugin({\n    id: 'input-point4d',\n    type: 'input',\n    accept: (value, params) => {\n        if (!Point4d.isObject(value)) {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createPointDimensionParser(p)), { readonly: p.optional.constant(false), w: p.optional.custom(parsePointDimensionParams), x: p.optional.custom(parsePointDimensionParams), y: p.optional.custom(parsePointDimensionParams), z: p.optional.custom(parsePointDimensionParams) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => point4dFromUnknown,\n        constraint: (args) => createConstraint$1(args.params, args.initialValue),\n        equals: Point4d.equals,\n        writer: (_args) => writePoint4d,\n    },\n    controller: (args) => {\n        const value = args.value;\n        const c = args.constraint;\n        const dParams = [\n            args.params.x,\n            args.params.y,\n            args.params.z,\n            args.params.w,\n        ];\n        return new PointNdTextController(args.document, {\n            assembly: Point4dAssembly,\n            axes: value.rawValue.getComponents().map((comp, i) => {\n                var _a;\n                return createPointAxis({\n                    constraint: c.components[i],\n                    initialValue: comp,\n                    params: deepMerge(args.params, ((_a = dParams[i]) !== null && _a !== void 0 ? _a : {})),\n                });\n            }),\n            parser: parseNumber,\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nfunction createConstraint(params) {\n    const constraints = [];\n    const lc = createListConstraint(params.options);\n    if (lc) {\n        constraints.push(lc);\n    }\n    return new CompositeConstraint(constraints);\n}\nconst StringInputPlugin = createPlugin({\n    id: 'input-string',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'string') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            readonly: p.optional.constant(false),\n            options: p.optional.custom(parseListOptions),\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => stringFromUnknown,\n        constraint: (args) => createConstraint(args.params),\n        writer: (_args) => writePrimitive,\n    },\n    controller: (args) => {\n        const doc = args.document;\n        const value = args.value;\n        const c = args.constraint;\n        const lc = c && findConstraint(c, ListConstraint);\n        if (lc) {\n            return new ListController(doc, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new TextController(doc, {\n            parser: (v) => v,\n            props: ValueMap.fromObject({\n                formatter: formatString,\n            }),\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (typeof args.controller.value.rawValue !== 'string') {\n            return null;\n        }\n        if (args.controller.valueController instanceof ListController) {\n            return new ListInputBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nconst Constants = {\n    monitor: {\n        defaultInterval: 200,\n        defaultRows: 3,\n    },\n};\n\nconst cn$3 = ClassName('mll');\nclass MultiLogView {\n    constructor(doc, config) {\n        this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n        this.formatter_ = config.formatter;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$3());\n        config.viewProps.bindClassModifiers(this.element);\n        const textareaElem = doc.createElement('textarea');\n        textareaElem.classList.add(cn$3('i'));\n        textareaElem.style.height = `calc(var(${getCssVar('containerUnitSize')}) * ${config.rows})`;\n        textareaElem.readOnly = true;\n        config.viewProps.bindDisabled(textareaElem);\n        this.element.appendChild(textareaElem);\n        this.textareaElem_ = textareaElem;\n        config.value.emitter.on('change', this.onValueUpdate_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        const elem = this.textareaElem_;\n        const shouldScroll = elem.scrollTop === elem.scrollHeight - elem.clientHeight;\n        const lines = [];\n        this.value.rawValue.forEach((value) => {\n            if (value !== undefined) {\n                lines.push(this.formatter_(value));\n            }\n        });\n        elem.textContent = lines.join('\\n');\n        if (shouldScroll) {\n            elem.scrollTop = elem.scrollHeight;\n        }\n    }\n    onValueUpdate_() {\n        this.update_();\n    }\n}\n\nclass MultiLogController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new MultiLogView(doc, {\n            formatter: config.formatter,\n            rows: config.rows,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nconst cn$2 = ClassName('sgl');\nclass SingleLogView {\n    constructor(doc, config) {\n        this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n        this.formatter_ = config.formatter;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$2());\n        config.viewProps.bindClassModifiers(this.element);\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$2('i'));\n        inputElem.readOnly = true;\n        inputElem.type = 'text';\n        config.viewProps.bindDisabled(inputElem);\n        this.element.appendChild(inputElem);\n        this.inputElement = inputElem;\n        config.value.emitter.on('change', this.onValueUpdate_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        const values = this.value.rawValue;\n        const lastValue = values[values.length - 1];\n        this.inputElement.value =\n            lastValue !== undefined ? this.formatter_(lastValue) : '';\n    }\n    onValueUpdate_() {\n        this.update_();\n    }\n}\n\nclass SingleLogController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new SingleLogView(doc, {\n            formatter: config.formatter,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nconst BooleanMonitorPlugin = createPlugin({\n    id: 'monitor-bool',\n    type: 'monitor',\n    accept: (value, params) => {\n        if (typeof value !== 'boolean') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            readonly: p.required.constant(true),\n            rows: p.optional.number,\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => boolFromUnknown,\n    },\n    controller: (args) => {\n        var _a;\n        if (args.value.rawValue.length === 1) {\n            return new SingleLogController(args.document, {\n                formatter: BooleanFormatter,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new MultiLogController(args.document, {\n            formatter: BooleanFormatter,\n            rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass GraphLogMonitorBindingApi extends BindingApi {\n    get max() {\n        return this.controller.valueController.props.get('max');\n    }\n    set max(max) {\n        this.controller.valueController.props.set('max', max);\n    }\n    get min() {\n        return this.controller.valueController.props.get('min');\n    }\n    set min(min) {\n        this.controller.valueController.props.set('min', min);\n    }\n}\n\nconst cn$1 = ClassName('grl');\nclass GraphLogView {\n    constructor(doc, config) {\n        this.onCursorChange_ = this.onCursorChange_.bind(this);\n        this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$1());\n        config.viewProps.bindClassModifiers(this.element);\n        this.formatter_ = config.formatter;\n        this.props_ = config.props;\n        this.cursor_ = config.cursor;\n        this.cursor_.emitter.on('change', this.onCursorChange_);\n        const svgElem = doc.createElementNS(SVG_NS, 'svg');\n        svgElem.classList.add(cn$1('g'));\n        svgElem.style.height = `calc(var(${getCssVar('containerUnitSize')}) * ${config.rows})`;\n        this.element.appendChild(svgElem);\n        this.svgElem_ = svgElem;\n        const lineElem = doc.createElementNS(SVG_NS, 'polyline');\n        this.svgElem_.appendChild(lineElem);\n        this.lineElem_ = lineElem;\n        const tooltipElem = doc.createElement('div');\n        tooltipElem.classList.add(cn$1('t'), ClassName('tt')());\n        this.element.appendChild(tooltipElem);\n        this.tooltipElem_ = tooltipElem;\n        config.value.emitter.on('change', this.onValueUpdate_);\n        this.value = config.value;\n        this.update_();\n    }\n    get graphElement() {\n        return this.svgElem_;\n    }\n    update_() {\n        const bounds = this.svgElem_.getBoundingClientRect();\n        const maxIndex = this.value.rawValue.length - 1;\n        const min = this.props_.get('min');\n        const max = this.props_.get('max');\n        const points = [];\n        this.value.rawValue.forEach((v, index) => {\n            if (v === undefined) {\n                return;\n            }\n            const x = mapRange(index, 0, maxIndex, 0, bounds.width);\n            const y = mapRange(v, min, max, bounds.height, 0);\n            points.push([x, y].join(','));\n        });\n        this.lineElem_.setAttributeNS(null, 'points', points.join(' '));\n        const tooltipElem = this.tooltipElem_;\n        const value = this.value.rawValue[this.cursor_.rawValue];\n        if (value === undefined) {\n            tooltipElem.classList.remove(cn$1('t', 'a'));\n            return;\n        }\n        const tx = mapRange(this.cursor_.rawValue, 0, maxIndex, 0, bounds.width);\n        const ty = mapRange(value, min, max, bounds.height, 0);\n        tooltipElem.style.left = `${tx}px`;\n        tooltipElem.style.top = `${ty}px`;\n        tooltipElem.textContent = `${this.formatter_(value)}`;\n        if (!tooltipElem.classList.contains(cn$1('t', 'a'))) {\n            tooltipElem.classList.add(cn$1('t', 'a'), cn$1('t', 'in'));\n            forceReflow(tooltipElem);\n            tooltipElem.classList.remove(cn$1('t', 'in'));\n        }\n    }\n    onValueUpdate_() {\n        this.update_();\n    }\n    onCursorChange_() {\n        this.update_();\n    }\n}\n\nclass GraphLogController {\n    constructor(doc, config) {\n        this.onGraphMouseMove_ = this.onGraphMouseMove_.bind(this);\n        this.onGraphMouseLeave_ = this.onGraphMouseLeave_.bind(this);\n        this.onGraphPointerDown_ = this.onGraphPointerDown_.bind(this);\n        this.onGraphPointerMove_ = this.onGraphPointerMove_.bind(this);\n        this.onGraphPointerUp_ = this.onGraphPointerUp_.bind(this);\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.cursor_ = createValue(-1);\n        this.view = new GraphLogView(doc, {\n            cursor: this.cursor_,\n            formatter: config.formatter,\n            rows: config.rows,\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        if (!supportsTouch(doc)) {\n            this.view.element.addEventListener('mousemove', this.onGraphMouseMove_);\n            this.view.element.addEventListener('mouseleave', this.onGraphMouseLeave_);\n        }\n        else {\n            const ph = new PointerHandler(this.view.element);\n            ph.emitter.on('down', this.onGraphPointerDown_);\n            ph.emitter.on('move', this.onGraphPointerMove_);\n            ph.emitter.on('up', this.onGraphPointerUp_);\n        }\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            max: p.required.number,\n            min: p.required.number,\n        }), (result) => {\n            this.props.set('max', result.max);\n            this.props.set('min', result.min);\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            max: this.props.get('max'),\n            min: this.props.get('min'),\n        });\n    }\n    onGraphMouseLeave_() {\n        this.cursor_.rawValue = -1;\n    }\n    onGraphMouseMove_(ev) {\n        const bounds = this.view.element.getBoundingClientRect();\n        this.cursor_.rawValue = Math.floor(mapRange(ev.offsetX, 0, bounds.width, 0, this.value.rawValue.length));\n    }\n    onGraphPointerDown_(ev) {\n        this.onGraphPointerMove_(ev);\n    }\n    onGraphPointerMove_(ev) {\n        if (!ev.data.point) {\n            this.cursor_.rawValue = -1;\n            return;\n        }\n        this.cursor_.rawValue = Math.floor(mapRange(ev.data.point.x, 0, ev.data.bounds.width, 0, this.value.rawValue.length));\n    }\n    onGraphPointerUp_() {\n        this.cursor_.rawValue = -1;\n    }\n}\n\nfunction createFormatter(params) {\n    return !isEmpty(params.format) ? params.format : createNumberFormatter(2);\n}\nfunction createTextMonitor(args) {\n    var _a;\n    if (args.value.rawValue.length === 1) {\n        return new SingleLogController(args.document, {\n            formatter: createFormatter(args.params),\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    return new MultiLogController(args.document, {\n        formatter: createFormatter(args.params),\n        rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n        value: args.value,\n        viewProps: args.viewProps,\n    });\n}\nfunction createGraphMonitor(args) {\n    var _a, _b, _c;\n    return new GraphLogController(args.document, {\n        formatter: createFormatter(args.params),\n        rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n        props: ValueMap.fromObject({\n            max: (_b = args.params.max) !== null && _b !== void 0 ? _b : 100,\n            min: (_c = args.params.min) !== null && _c !== void 0 ? _c : 0,\n        }),\n        value: args.value,\n        viewProps: args.viewProps,\n    });\n}\nfunction shouldShowGraph(params) {\n    return params.view === 'graph';\n}\nconst NumberMonitorPlugin = createPlugin({\n    id: 'monitor-number',\n    type: 'monitor',\n    accept: (value, params) => {\n        if (typeof value !== 'number') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            format: p.optional.function,\n            max: p.optional.number,\n            min: p.optional.number,\n            readonly: p.required.constant(true),\n            rows: p.optional.number,\n            view: p.optional.string,\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        defaultBufferSize: (params) => (shouldShowGraph(params) ? 64 : 1),\n        reader: (_args) => numberFromUnknown,\n    },\n    controller: (args) => {\n        if (shouldShowGraph(args.params)) {\n            return createGraphMonitor(args);\n        }\n        return createTextMonitor(args);\n    },\n    api: (args) => {\n        if (args.controller.valueController instanceof GraphLogController) {\n            return new GraphLogMonitorBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nconst StringMonitorPlugin = createPlugin({\n    id: 'monitor-string',\n    type: 'monitor',\n    accept: (value, params) => {\n        if (typeof value !== 'string') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            multiline: p.optional.boolean,\n            readonly: p.required.constant(true),\n            rows: p.optional.number,\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => stringFromUnknown,\n    },\n    controller: (args) => {\n        var _a;\n        const value = args.value;\n        const multiline = value.rawValue.length > 1 || args.params.multiline;\n        if (multiline) {\n            return new MultiLogController(args.document, {\n                formatter: formatString,\n                rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new SingleLogController(args.document, {\n            formatter: formatString,\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass BladeApiCache {\n    constructor() {\n        this.map_ = new Map();\n    }\n    get(bc) {\n        var _a;\n        return (_a = this.map_.get(bc)) !== null && _a !== void 0 ? _a : null;\n    }\n    has(bc) {\n        return this.map_.has(bc);\n    }\n    add(bc, api) {\n        this.map_.set(bc, api);\n        bc.viewProps.handleDispose(() => {\n            this.map_.delete(bc);\n        });\n        return api;\n    }\n}\n\nclass ReadWriteBinding {\n    constructor(config) {\n        this.target = config.target;\n        this.reader_ = config.reader;\n        this.writer_ = config.writer;\n    }\n    read() {\n        return this.reader_(this.target.read());\n    }\n    write(value) {\n        this.writer_(this.target, value);\n    }\n    inject(value) {\n        this.write(this.reader_(value));\n    }\n}\n\nfunction createInputBindingController(plugin, args) {\n    var _a;\n    const result = plugin.accept(args.target.read(), args.params);\n    if (isEmpty(result)) {\n        return null;\n    }\n    const valueArgs = {\n        target: args.target,\n        initialValue: result.initialValue,\n        params: result.params,\n    };\n    const params = parseRecord(args.params, (p) => ({\n        disabled: p.optional.boolean,\n        hidden: p.optional.boolean,\n        label: p.optional.string,\n        tag: p.optional.string,\n    }));\n    const reader = plugin.binding.reader(valueArgs);\n    const constraint = plugin.binding.constraint\n        ? plugin.binding.constraint(valueArgs)\n        : undefined;\n    const binding = new ReadWriteBinding({\n        reader: reader,\n        target: args.target,\n        writer: plugin.binding.writer(valueArgs),\n    });\n    const value = new InputBindingValue(createValue(reader(result.initialValue), {\n        constraint: constraint,\n        equals: plugin.binding.equals,\n    }), binding);\n    const controller = plugin.controller({\n        constraint: constraint,\n        document: args.document,\n        initialValue: result.initialValue,\n        params: result.params,\n        value: value,\n        viewProps: ViewProps.create({\n            disabled: params === null || params === void 0 ? void 0 : params.disabled,\n            hidden: params === null || params === void 0 ? void 0 : params.hidden,\n        }),\n    });\n    return new InputBindingController(args.document, {\n        blade: createBlade(),\n        props: ValueMap.fromObject({\n            label: 'label' in args.params ? (_a = params === null || params === void 0 ? void 0 : params.label) !== null && _a !== void 0 ? _a : null : args.target.key,\n        }),\n        tag: params === null || params === void 0 ? void 0 : params.tag,\n        value: value,\n        valueController: controller,\n    });\n}\n\nclass ReadonlyBinding {\n    constructor(config) {\n        this.target = config.target;\n        this.reader_ = config.reader;\n    }\n    read() {\n        return this.reader_(this.target.read());\n    }\n}\n\nfunction createTicker(document, interval) {\n    return interval === 0\n        ? new ManualTicker()\n        : new IntervalTicker(document, interval !== null && interval !== void 0 ? interval : Constants.monitor.defaultInterval);\n}\nfunction createMonitorBindingController(plugin, args) {\n    var _a, _b, _c;\n    const result = plugin.accept(args.target.read(), args.params);\n    if (isEmpty(result)) {\n        return null;\n    }\n    const bindingArgs = {\n        target: args.target,\n        initialValue: result.initialValue,\n        params: result.params,\n    };\n    const params = parseRecord(args.params, (p) => ({\n        bufferSize: p.optional.number,\n        disabled: p.optional.boolean,\n        hidden: p.optional.boolean,\n        interval: p.optional.number,\n        label: p.optional.string,\n    }));\n    const reader = plugin.binding.reader(bindingArgs);\n    const bufferSize = (_b = (_a = params === null || params === void 0 ? void 0 : params.bufferSize) !== null && _a !== void 0 ? _a : (plugin.binding.defaultBufferSize &&\n        plugin.binding.defaultBufferSize(result.params))) !== null && _b !== void 0 ? _b : 1;\n    const value = new MonitorBindingValue({\n        binding: new ReadonlyBinding({\n            reader: reader,\n            target: args.target,\n        }),\n        bufferSize: bufferSize,\n        ticker: createTicker(args.document, params === null || params === void 0 ? void 0 : params.interval),\n    });\n    const controller = plugin.controller({\n        document: args.document,\n        params: result.params,\n        value: value,\n        viewProps: ViewProps.create({\n            disabled: params === null || params === void 0 ? void 0 : params.disabled,\n            hidden: params === null || params === void 0 ? void 0 : params.hidden,\n        }),\n    });\n    controller.viewProps.bindDisabled(value.ticker);\n    controller.viewProps.handleDispose(() => {\n        value.ticker.dispose();\n    });\n    return new MonitorBindingController(args.document, {\n        blade: createBlade(),\n        props: ValueMap.fromObject({\n            label: 'label' in args.params ? (_c = params === null || params === void 0 ? void 0 : params.label) !== null && _c !== void 0 ? _c : null : args.target.key,\n        }),\n        value: value,\n        valueController: controller,\n    });\n}\n\nclass PluginPool {\n    constructor(apiCache) {\n        this.pluginsMap_ = {\n            blades: [],\n            inputs: [],\n            monitors: [],\n        };\n        this.apiCache_ = apiCache;\n    }\n    getAll() {\n        return [\n            ...this.pluginsMap_.blades,\n            ...this.pluginsMap_.inputs,\n            ...this.pluginsMap_.monitors,\n        ];\n    }\n    register(bundleId, r) {\n        if (!isCompatible(r.core)) {\n            throw TpError.notCompatible(bundleId, r.id);\n        }\n        if (r.type === 'blade') {\n            this.pluginsMap_.blades.unshift(r);\n        }\n        else if (r.type === 'input') {\n            this.pluginsMap_.inputs.unshift(r);\n        }\n        else if (r.type === 'monitor') {\n            this.pluginsMap_.monitors.unshift(r);\n        }\n    }\n    createInput_(document, target, params) {\n        return this.pluginsMap_.inputs.reduce((result, plugin) => result !== null && result !== void 0 ? result : createInputBindingController(plugin, {\n            document: document,\n            target: target,\n            params: params,\n        }), null);\n    }\n    createMonitor_(document, target, params) {\n        return this.pluginsMap_.monitors.reduce((result, plugin) => result !== null && result !== void 0 ? result : createMonitorBindingController(plugin, {\n            document: document,\n            params: params,\n            target: target,\n        }), null);\n    }\n    createBinding(doc, target, params) {\n        const initialValue = target.read();\n        if (isEmpty(initialValue)) {\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        const ic = this.createInput_(doc, target, params);\n        if (ic) {\n            return ic;\n        }\n        const mc = this.createMonitor_(doc, target, params);\n        if (mc) {\n            return mc;\n        }\n        throw new TpError({\n            context: {\n                key: target.key,\n            },\n            type: 'nomatchingcontroller',\n        });\n    }\n    createBlade(document, params) {\n        const bc = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : createBladeController(plugin, {\n            document: document,\n            params: params,\n        }), null);\n        if (!bc) {\n            throw new TpError({\n                type: 'nomatchingview',\n                context: {\n                    params: params,\n                },\n            });\n        }\n        return bc;\n    }\n    createInputBindingApi_(bc) {\n        const api = this.pluginsMap_.inputs.reduce((result, plugin) => {\n            var _a, _b;\n            if (result) {\n                return result;\n            }\n            return ((_b = (_a = plugin.api) === null || _a === void 0 ? void 0 : _a.call(plugin, {\n                controller: bc,\n            })) !== null && _b !== void 0 ? _b : null);\n        }, null);\n        return this.apiCache_.add(bc, api !== null && api !== void 0 ? api : new BindingApi(bc));\n    }\n    createMonitorBindingApi_(bc) {\n        const api = this.pluginsMap_.monitors.reduce((result, plugin) => {\n            var _a, _b;\n            if (result) {\n                return result;\n            }\n            return ((_b = (_a = plugin.api) === null || _a === void 0 ? void 0 : _a.call(plugin, {\n                controller: bc,\n            })) !== null && _b !== void 0 ? _b : null);\n        }, null);\n        return this.apiCache_.add(bc, api !== null && api !== void 0 ? api : new BindingApi(bc));\n    }\n    createBindingApi(bc) {\n        if (this.apiCache_.has(bc)) {\n            return this.apiCache_.get(bc);\n        }\n        if (isInputBindingController(bc)) {\n            return this.createInputBindingApi_(bc);\n        }\n        if (isMonitorBindingController(bc)) {\n            return this.createMonitorBindingApi_(bc);\n        }\n        throw TpError.shouldNeverHappen();\n    }\n    createApi(bc) {\n        if (this.apiCache_.has(bc)) {\n            return this.apiCache_.get(bc);\n        }\n        if (isBindingController(bc)) {\n            return this.createBindingApi(bc);\n        }\n        const api = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : plugin.api({\n            controller: bc,\n            pool: this,\n        }), null);\n        if (!api) {\n            throw TpError.shouldNeverHappen();\n        }\n        return this.apiCache_.add(bc, api);\n    }\n}\n\nconst sharedCache = new BladeApiCache();\nfunction createDefaultPluginPool() {\n    const pool = new PluginPool(sharedCache);\n    [\n        Point2dInputPlugin,\n        Point3dInputPlugin,\n        Point4dInputPlugin,\n        StringInputPlugin,\n        NumberInputPlugin,\n        StringColorInputPlugin,\n        ObjectColorInputPlugin,\n        NumberColorInputPlugin,\n        BooleanInputPlugin,\n        BooleanMonitorPlugin,\n        StringMonitorPlugin,\n        NumberMonitorPlugin,\n        ButtonBladePlugin,\n        FolderBladePlugin,\n        TabBladePlugin,\n    ].forEach((p) => {\n        pool.register('core', p);\n    });\n    return pool;\n}\n\nclass ListBladeApi extends BladeApi {\n    /**\n     * @hidden\n     */\n    constructor(controller) {\n        super(controller);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', (ev) => {\n            this.emitter_.emit('change', new TpChangeEvent(this, ev.rawValue));\n        });\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get options() {\n        return this.controller.valueController.props.get('options');\n    }\n    set options(options) {\n        this.controller.valueController.props.set('options', options);\n    }\n    get value() {\n        return this.controller.value.rawValue;\n    }\n    set value(value) {\n        this.controller.value.rawValue = value;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        });\n        return this;\n    }\n}\n\nclass SeparatorBladeApi extends BladeApi {\n}\n\nclass SliderBladeApi extends BladeApi {\n    /**\n     * @hidden\n     */\n    constructor(controller) {\n        super(controller);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', (ev) => {\n            this.emitter_.emit('change', new TpChangeEvent(this, ev.rawValue));\n        });\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get max() {\n        return this.controller.valueController.sliderController.props.get('max');\n    }\n    set max(max) {\n        this.controller.valueController.sliderController.props.set('max', max);\n    }\n    get min() {\n        return this.controller.valueController.sliderController.props.get('min');\n    }\n    set min(min) {\n        this.controller.valueController.sliderController.props.set('min', min);\n    }\n    get value() {\n        return this.controller.value.rawValue;\n    }\n    set value(value) {\n        this.controller.value.rawValue = value;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        });\n        return this;\n    }\n}\n\nclass TextBladeApi extends BladeApi {\n    /**\n     * @hidden\n     */\n    constructor(controller) {\n        super(controller);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', (ev) => {\n            this.emitter_.emit('change', new TpChangeEvent(this, ev.rawValue));\n        });\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get formatter() {\n        return this.controller.valueController.props.get('formatter');\n    }\n    set formatter(formatter) {\n        this.controller.valueController.props.set('formatter', formatter);\n    }\n    get value() {\n        return this.controller.value.rawValue;\n    }\n    set value(value) {\n        this.controller.value.rawValue = value;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        });\n        return this;\n    }\n}\n\nconst ListBladePlugin = (function () {\n    return {\n        id: 'list',\n        type: 'blade',\n        core: VERSION$1,\n        accept(params) {\n            const result = parseRecord(params, (p) => ({\n                options: p.required.custom(parseListOptions),\n                value: p.required.raw,\n                view: p.required.constant('list'),\n                label: p.optional.string,\n            }));\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            const lc = new ListConstraint(normalizeListOptions(args.params.options));\n            const value = createValue(args.params.value, {\n                constraint: lc,\n            });\n            const ic = new ListController(args.document, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueBladeController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                value: value,\n                valueController: ic,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueBladeController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof ListController)) {\n                return null;\n            }\n            return new ListBladeApi(args.controller);\n        },\n    };\n})();\n\nclass RootApi extends FolderApi {\n    /**\n     * @hidden\n     */\n    constructor(controller, pool) {\n        super(controller, pool);\n    }\n    get element() {\n        return this.controller.view.element;\n    }\n}\n\n/**\n * @hidden\n */\nclass RootController extends FolderController {\n    constructor(doc, config) {\n        super(doc, {\n            expanded: config.expanded,\n            blade: config.blade,\n            props: config.props,\n            root: true,\n            viewProps: config.viewProps,\n        });\n    }\n}\n\nconst cn = ClassName('spr');\n/**\n * @hidden\n */\nclass SeparatorView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn());\n        config.viewProps.bindClassModifiers(this.element);\n        const hrElem = doc.createElement('hr');\n        hrElem.classList.add(cn('r'));\n        this.element.appendChild(hrElem);\n    }\n}\n\n/**\n * @hidden\n */\nclass SeparatorController extends BladeController {\n    /**\n     * @hidden\n     */\n    constructor(doc, config) {\n        super(Object.assign(Object.assign({}, config), { view: new SeparatorView(doc, {\n                viewProps: config.viewProps,\n            }) }));\n    }\n}\n\nconst SeparatorBladePlugin = {\n    id: 'separator',\n    type: 'blade',\n    core: VERSION$1,\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            view: p.required.constant('separator'),\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        return new SeparatorController(args.document, {\n            blade: args.blade,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (!(args.controller instanceof SeparatorController)) {\n            return null;\n        }\n        return new SeparatorBladeApi(args.controller);\n    },\n};\n\nconst SliderBladePlugin = {\n    id: 'slider',\n    type: 'blade',\n    core: VERSION$1,\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            max: p.required.number,\n            min: p.required.number,\n            view: p.required.constant('slider'),\n            format: p.optional.function,\n            label: p.optional.string,\n            value: p.optional.number,\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        var _a, _b;\n        const initialValue = (_a = args.params.value) !== null && _a !== void 0 ? _a : 0;\n        const drc = new DefiniteRangeConstraint({\n            max: args.params.max,\n            min: args.params.min,\n        });\n        const v = createValue(initialValue, {\n            constraint: drc,\n        });\n        const vc = new SliderTextController(args.document, Object.assign(Object.assign({}, createSliderTextProps({\n            formatter: (_b = args.params.format) !== null && _b !== void 0 ? _b : numberToString,\n            keyScale: createValue(1),\n            max: drc.values.value('max'),\n            min: drc.values.value('min'),\n            pointerScale: getSuitablePointerScale(args.params, initialValue),\n        })), { parser: parseNumber, value: v, viewProps: args.viewProps }));\n        return new LabeledValueBladeController(args.document, {\n            blade: args.blade,\n            props: ValueMap.fromObject({\n                label: args.params.label,\n            }),\n            value: v,\n            valueController: vc,\n        });\n    },\n    api(args) {\n        if (!(args.controller instanceof LabeledValueBladeController)) {\n            return null;\n        }\n        if (!(args.controller.valueController instanceof SliderTextController)) {\n            return null;\n        }\n        return new SliderBladeApi(args.controller);\n    },\n};\n\nconst TextBladePlugin = (function () {\n    return {\n        id: 'text',\n        type: 'blade',\n        core: VERSION$1,\n        accept(params) {\n            const result = parseRecord(params, (p) => ({\n                parse: p.required.function,\n                value: p.required.raw,\n                view: p.required.constant('text'),\n                format: p.optional.function,\n                label: p.optional.string,\n            }));\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            var _a;\n            const v = createValue(args.params.value);\n            const ic = new TextController(args.document, {\n                parser: args.params.parse,\n                props: ValueMap.fromObject({\n                    formatter: (_a = args.params.format) !== null && _a !== void 0 ? _a : ((v) => String(v)),\n                }),\n                value: v,\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueBladeController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                value: v,\n                valueController: ic,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueBladeController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof TextController)) {\n                return null;\n            }\n            return new TextBladeApi(args.controller);\n        },\n    };\n})();\n\nfunction createDefaultWrapperElement(doc) {\n    const elem = doc.createElement('div');\n    elem.classList.add(ClassName('dfw')());\n    if (doc.body) {\n        doc.body.appendChild(elem);\n    }\n    return elem;\n}\nfunction embedStyle(doc, id, css) {\n    if (doc.querySelector(`style[data-tp-style=${id}]`)) {\n        return;\n    }\n    const styleElem = doc.createElement('style');\n    styleElem.dataset.tpStyle = id;\n    styleElem.textContent = css;\n    doc.head.appendChild(styleElem);\n}\n/**\n * The root pane of Tweakpane.\n */\nclass Pane extends RootApi {\n    constructor(opt_config) {\n        var _a, _b;\n        const config = opt_config !== null && opt_config !== void 0 ? opt_config : {};\n        const doc = (_a = config.document) !== null && _a !== void 0 ? _a : getWindowDocument();\n        const pool = createDefaultPluginPool();\n        const rootController = new RootController(doc, {\n            expanded: config.expanded,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                title: config.title,\n            }),\n            viewProps: ViewProps.create(),\n        });\n        super(rootController, pool);\n        this.pool_ = pool;\n        this.containerElem_ = (_b = config.container) !== null && _b !== void 0 ? _b : createDefaultWrapperElement(doc);\n        this.containerElem_.appendChild(this.element);\n        this.doc_ = doc;\n        this.usesDefaultWrapper_ = !config.container;\n        this.setUpDefaultPlugins_();\n    }\n    get document() {\n        if (!this.doc_) {\n            throw TpError.alreadyDisposed();\n        }\n        return this.doc_;\n    }\n    dispose() {\n        const containerElem = this.containerElem_;\n        if (!containerElem) {\n            throw TpError.alreadyDisposed();\n        }\n        if (this.usesDefaultWrapper_) {\n            const parentElem = containerElem.parentElement;\n            if (parentElem) {\n                parentElem.removeChild(containerElem);\n            }\n        }\n        this.containerElem_ = null;\n        this.doc_ = null;\n        super.dispose();\n    }\n    registerPlugin(bundle) {\n        if (bundle.css) {\n            embedStyle(this.document, `plugin-${bundle.id}`, bundle.css);\n        }\n        const plugins = 'plugin' in bundle\n            ? [bundle.plugin]\n            : 'plugins' in bundle\n                ? bundle.plugins\n                : [];\n        plugins.forEach((p) => {\n            this.pool_.register(bundle.id, p);\n        });\n    }\n    setUpDefaultPlugins_() {\n        this.registerPlugin({\n            id: 'default',\n            // NOTE: This string literal will be replaced with the default CSS by Rollup at the compilation time\n            css: '.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(\t\t2px * 2 + var(--cnt-usz) + var(--cnt-hp)\t);position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:\"\";display:block;height:6px;right:calc(\t\tvar(--cnt-hp) + (\t\t\t\tvar(--cnt-usz) + 4px - 6px\t\t\t) / 2 - 2px\t);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-hp));right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(\t\t\tvar(--cnt-vp) + 2px\t\t);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:\"\";height:2px;left:calc(-1 * var(--cnt-hp));position:absolute;right:calc(-1 * var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:\"\";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz) * 3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-hp));right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:\"\";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:\"\";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:\"\";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:\"\";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(\t\t\tvar(--bld-hp) - 5px\t\t);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:\"\";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(\t\t\t2px * 2 + var(--cnt-usz) + var(--cnt-hp)\t\t);text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',\n            plugins: [\n                ListBladePlugin,\n                SeparatorBladePlugin,\n                SliderBladePlugin,\n                TabBladePlugin,\n                TextBladePlugin,\n            ],\n        });\n    }\n}\n\nconst VERSION = new Semver('4.0.1');\n\nexport { BladeApi, ButtonApi, FolderApi, ListBladeApi, ListInputBindingApi, Pane, Semver, SeparatorBladeApi, SliderBladeApi, SliderInputBindingApi, TabApi, TabPageApi, TextBladeApi, TpChangeEvent, VERSION };\n", "import { World } from \"bagelecs\";\r\nimport { Pane } from \"tweakpane\";\r\n\r\n(Symbol as any).metadata ??= Symbol.for(\"Symbol.metadata\");\r\n\r\nconst unit = (unit: string) => (target: any, name: string) => {\r\n    if (!target[Symbol.metadata]) {\r\n        Object.defineProperty(target, Symbol.metadata, {\r\n            value: {},\r\n            enumerable: false,\r\n        });\r\n    }\r\n\r\n    target[Symbol.metadata][name] = formatLabel(name) + ` (${unit})`;\r\n};\r\n\r\nexport class Diagnostics {\r\n    // Rendering FPS (ideally totally handled by pixi)\r\n    static FPS = 0;\r\n\r\n    // How long the last tick lasted\r\n    @unit(\"ms\")\r\n    static logicTick = 0;\r\n\r\n    // Whether or not artificial lag is being applied\r\n    static artificialLag = false;\r\n\r\n    // Which connection is the worst\r\n    static worstRemoteConnection = \"\";\r\n\r\n    // The latency (received - sent) of the last packet in milliseconds\r\n    @unit(\"ms\")\r\n    static worstRemotePing = 0;\r\n\r\n    // The latency (received - sent) of the last packet in physics frames\r\n    @unit(\"frames\")\r\n    static worstRemoteLatency = 0;\r\n}\r\n\r\n// Turns camelCase into Title Case and returns it\r\nfunction formatLabel(camelCase: string): string {\r\n    camelCase = camelCase.replace(/([a-z])([A-Z])/g, \"$1 $2\");\r\n    camelCase = camelCase.replace(/^./, (str) => str.toUpperCase());\r\n    return camelCase;\r\n}\r\n\r\ndeclare global {\r\n    interface ObjectConstructor {\r\n        keys<T>(obj: T): (keyof T)[];\r\n    }\r\n}\r\n\r\nexport function diagnosticsPlugin(world: World) {\r\n    const pane = world.get(Pane);\r\n\r\n    const folder = pane.addFolder({ title: \"Stats\" });\r\n\r\n    Object.keys(Diagnostics).forEach((key) => {\r\n        const label = Diagnostics[Symbol.metadata]?.[key]\r\n            ? (Diagnostics[Symbol.metadata]![key] as string)\r\n            : formatLabel(key);\r\n\r\n        switch (typeof Diagnostics[key]) {\r\n            case \"boolean\":\r\n                folder.addBinding(Diagnostics, key, { label });\r\n                break;\r\n            case \"number\":\r\n            default:\r\n                folder.addBinding(Diagnostics, key, {\r\n                    label,\r\n                    readonly: true,\r\n                });\r\n        }\r\n    });\r\n}\r\n", "import { Class, System, World } from \"bagelecs\";\r\n\r\nexport function ResourceUpdaterSystem(resource: Class<{ update(): any }>) {\r\n    return class ResourceUpdater extends System({}) {\r\n        update(): void {\r\n            this.world.get(resource)?.update();\r\n        }\r\n    };\r\n}\r\n\r\nexport function ResourceUpdaterPlugin<\r\n    T extends {\r\n        new (world: World, ...args: any): { update(): any };\r\n    }\r\n>(\r\n    resource: T,\r\n    addNew?: boolean,\r\n    ...args: ConstructorParameters<T> extends [World, ...infer rest]\r\n        ? rest\r\n        : never\r\n) {\r\n    return async function (world: World) {\r\n        if (addNew) {\r\n            const res = new resource(world, ...args);\r\n            world.add(res);\r\n            // if (typeof res.init === \"function\") await res.init();\r\n        }\r\n        world.addSystem(ResourceUpdaterSystem(resource));\r\n    };\r\n}\r\n", "import { Component, Logger, Type, World } from \"bagelecs\";\r\nimport { Peer, DataConnection } from \"peerjs\";\r\nimport { Diagnostics } from \"engine/diagnostics\";\r\nimport { ResourceUpdaterPlugin } from \"engine/resource\";\r\n\r\nenum NetworkEvent {\r\n    ACCEPT_CONNECTION,\r\n    DECLINE_CONNECTION,\r\n    DATA,\r\n    FETCH,\r\n    FETCH_RESPONSE,\r\n}\r\n\r\ntype RawNetworkPacket<T = never> = {\r\n    event: NetworkEvent;\r\n    data: T;\r\n    subEvent?: string;\r\n    id?: number;\r\n};\r\n\r\ndeclare global {\r\n    // Override this to add stuff\r\n    interface NetworkFetchPoints {}\r\n}\r\n\r\nexport const PeerId = Component(Type.string);\r\n\r\nexport class NetworkConnection {\r\n    private readonly logger = new Logger(\"Network\");\r\n\r\n    private static readonly idPrefix = \"drivegame-beta-\"; // \"drivegame-prod-\"\r\n    private static readonly idLength = 1;\r\n    private static generateId(): string {\r\n        return new Array(NetworkConnection.idLength)\r\n            .fill(0) // Make array w/ length of 5\r\n            .map((_) => Math.floor(Math.random() * 2)) // Fill the array with random numbers 0 - 25\r\n            .map((num) => String.fromCharCode(\"A\".charCodeAt(0) + num)) // Map numbers to capital letters\r\n            .join(\"\"); // Turn it into a string\r\n    }\r\n\r\n    private readonly peer!: Peer;\r\n    public readonly id!: string;\r\n\r\n    public readonly waitForServerConnection: Promise<void>;\r\n    constructor(public readonly world: World) {\r\n        this.waitForServerConnection = this.connectToBrokageServer();\r\n        this.waitForServerConnection.then(() => {\r\n            this.logger.log(\"Connected to brokage server, id is\", this.id);\r\n            this.handleIncomingConnections();\r\n\r\n            window.addEventListener(\"beforeunload\", () => {\r\n                this.close();\r\n            });\r\n        });\r\n        // this.id = NetworkConnection.generateId();\r\n        // this.peer = new Peer(this.id);\r\n        this.onConnect = this.onConnect.bind(this);\r\n        this.onClose = this.onClose.bind(this);\r\n    }\r\n\r\n    //#region Server Connection\r\n    private tryFindId() {\r\n        const id = NetworkConnection.generateId();\r\n        const peer = new Peer(NetworkConnection.idPrefix + id);\r\n        this.logger.log(\"Trying to connect with id\", id);\r\n        return new Promise<{ id: string; peer: Peer }>((res, rej) => {\r\n            peer.on(\"open\", () => {\r\n                res({ id, peer });\r\n            });\r\n            peer.on(\"error\", async (error) => {\r\n                if (error.type === \"unavailable-id\") {\r\n                    peer.disconnect();\r\n                    this.logger.log(\"Failed to connect with id\", id);\r\n                    res(await this.tryFindId());\r\n                    return;\r\n                    // testssffasd\r\n                }\r\n                this.logger.error(error);\r\n                // This shouldn't happen (really shouldn't get any other errors than in-use id)\r\n                rej(error);\r\n            });\r\n        });\r\n    }\r\n\r\n    async connectToBrokageServer() {\r\n        const { id, peer } = await this.tryFindId();\r\n        //@ts-expect-error\r\n        this.id = id;\r\n        //@ts-expect-error\r\n        this.peer = peer;\r\n    }\r\n    //#endregion\r\n\r\n    //#region Connections\r\n    public readonly isConnected: boolean = false;\r\n    private readonly dummyConnection = new DummyDataConnection();\r\n    private remoteConnection: DataConnection = this.dummyConnection as any;\r\n\r\n    public readonly remoteId!: string;\r\n\r\n    private resolvePromisesWaitingForConnection!: () => void;\r\n    public waitForConnection: Promise<void> = new Promise((res) => {\r\n        this.resolvePromisesWaitingForConnection = res;\r\n    });\r\n\r\n    public readonly connectionStartTime: number = null as any;\r\n    public framesConnected: number = null as any;\r\n\r\n    private onConnect(openTime: number) {\r\n        //@ts-expect-error\r\n        this.isConnected = true;\r\n        //@ts-expect-error\r\n        this.connectionStartTime = openTime;\r\n        //@ts-expect-error\r\n        this.remoteId = this.remoteConnection.peer.replace(\r\n            NetworkConnection.idPrefix,\r\n            \"\"\r\n        );\r\n\r\n        this.framesConnected = 0;\r\n\r\n        this.remoteConnection.on(\"close\", this.onClose);\r\n\r\n        this.logger.log(\"Connection opened to\", this.remoteId);\r\n        this.resolvePromisesWaitingForConnection();\r\n    }\r\n\r\n    private onClose() {\r\n        //@ts-expect-error\r\n        this.remoteConnection = this.dummyConnection.fromDataConnection(\r\n            this.remoteConnection\r\n        );\r\n\r\n        //@ts-expect-error\r\n        this.isConnected = false;\r\n\r\n        this.framesConnected = null as any;\r\n\r\n        this.waitForConnection = new Promise((res) => {\r\n            this.resolvePromisesWaitingForConnection = res;\r\n        });\r\n        this.logger.log(\"Closed connection to\", this.remoteId);\r\n    }\r\n\r\n    close() {\r\n        this.remoteConnection.close();\r\n    }\r\n\r\n    // Established locally\r\n    async connect(id: string, timeout = 5000) {\r\n        if (this.isConnected) {\r\n            this.logger.log(\r\n                \"Can not connect to\",\r\n                id,\r\n                \"(Already connected to\",\r\n                this.remoteId,\r\n                \")\"\r\n            );\r\n            return Promise.reject();\r\n        }\r\n        const remoteConnection = this.peer.connect(NetworkConnection.idPrefix + id, {\r\n            metadata: {\r\n                id: this.id,\r\n            },\r\n        });\r\n        this.logger.log(\r\n            \"Establishing connection with\",\r\n            id,\r\n            \"... (Initiated locally)\"\r\n        );\r\n\r\n        return new Promise<void>((res, rej) => {\r\n            setTimeout(() => {\r\n                if (this.isConnected) return;\r\n                remoteConnection.close();\r\n                rej(\"timeout\");\r\n            }, timeout);\r\n            remoteConnection.on(\"open\", () => {\r\n                // Save the open time in case this connection was accepted\r\n                const tempStartTime = Date.now();\r\n\r\n                // We have to wait for a response (either accept or reject)\r\n                remoteConnection.once(\"data\", (({\r\n                    event,\r\n                    data,\r\n                }: RawNetworkPacket<{ id: string }>) => {\r\n                    if (event === NetworkEvent.ACCEPT_CONNECTION) {\r\n                        this.logger.log(\"Connection with\", data.id, \"was accepted\");\r\n                        this.remoteConnection =\r\n                            this.dummyConnection.morphToRealConnection(\r\n                                remoteConnection\r\n                            );\r\n                        this.onConnect(tempStartTime);\r\n                        res();\r\n                    } else if (event === NetworkEvent.DECLINE_CONNECTION) {\r\n                        this.logger.log(\r\n                            \"Connection with\",\r\n                            data.id,\r\n                            \"was declined, closing connection\"\r\n                        );\r\n                        remoteConnection.close();\r\n                        rej();\r\n                    }\r\n                }) as any);\r\n            });\r\n        });\r\n    }\r\n\r\n    // Established remotely\r\n    private handleIncomingConnections() {\r\n        this.peer.on(\"connection\", async (connection) => {\r\n            this.logger.log(\r\n                \"Establishing connection with\",\r\n                connection.metadata.id,\r\n                \"... (Initiated remotely)\"\r\n            );\r\n\r\n            if (!connection.open) await this.waitForConnectionCB(connection, \"open\");\r\n            const tempStartTime = Date.now();\r\n\r\n            if (this.isConnected) {\r\n                this.logger.log(\r\n                    \"Declining connection with\",\r\n                    connection.metadata.id,\r\n                    \"(Already connected)\"\r\n                );\r\n                // Send a bad message then close\r\n                connection.send({\r\n                    event: NetworkEvent.DECLINE_CONNECTION,\r\n                    data: {\r\n                        id: this.id,\r\n                    },\r\n                } satisfies RawNetworkPacket<{ id: string }>);\r\n                connection.on(\"close\", () => {\r\n                    this.logger.log(\r\n                        \"Closed connection with\",\r\n                        connection.metadata.id\r\n                    );\r\n                });\r\n                return;\r\n            }\r\n\r\n            this.logger.log(\r\n                \"Accepting connection with\",\r\n                connection.metadata.id,\r\n                \"...\"\r\n            );\r\n            // Send an accept\r\n            connection.send({\r\n                event: NetworkEvent.ACCEPT_CONNECTION,\r\n                data: {\r\n                    id: this.id,\r\n                },\r\n            } satisfies RawNetworkPacket<{ id: string }>);\r\n            this.remoteConnection =\r\n                this.dummyConnection.morphToRealConnection(connection);\r\n            this.onConnect(tempStartTime);\r\n        });\r\n    }\r\n    //#endregion\r\n\r\n    //#region Simple Data Transfer\r\n    on<T>(eventName: string | \"ALL\", cb: (data: T) => any) {\r\n        const wrapper = (packet: RawNetworkPacket<T>) => {\r\n            // if (packet.event !== NetworkEvent.DATA) return;\r\n            if (eventName !== \"ALL\" && packet.subEvent !== eventName) return;\r\n\r\n            return cb(packet.data);\r\n        };\r\n        // this.dataListeners.push(wrapper);\r\n        this.remoteConnection.on(\"data\", wrapper as any);\r\n    }\r\n\r\n    async send(eventName: string, data: any) {\r\n        if (Diagnostics.artificialLag) await Promise.timeout(60);\r\n\r\n        this.remoteConnection.send({\r\n            event: NetworkEvent.DATA,\r\n            subEvent: eventName,\r\n            data,\r\n        } satisfies RawNetworkPacket<any>);\r\n    }\r\n    //#endregion\r\n\r\n    //#region Fetch / Response\r\n    private nextFetchId = 0;\r\n    fetch<T extends keyof NetworkFetchPoints>(\r\n        endpoint: T\r\n    ): Promise<NetworkFetchPoints[T]> {\r\n        const transactionId = this.nextFetchId++;\r\n        this.remoteConnection.send({\r\n            event: NetworkEvent.FETCH,\r\n            subEvent: endpoint,\r\n            id: transactionId,\r\n        });\r\n\r\n        return new Promise((res) => {\r\n            const tempFn = (packet: RawNetworkPacket<any>) => {\r\n                if (packet.event !== NetworkEvent.FETCH_RESPONSE) return;\r\n                if (packet.id !== transactionId) return;\r\n                this.remoteConnection.off(\"data\", tempFn as any);\r\n                res(packet.data);\r\n            };\r\n\r\n            this.remoteConnection.on(\"data\", tempFn as any);\r\n        });\r\n    }\r\n\r\n    addResponse<T extends keyof NetworkFetchPoints>(\r\n        endpoint: T,\r\n        respond: () => NetworkFetchPoints[T] | Promise<NetworkFetchPoints[T]>\r\n    ) {\r\n        this.remoteConnection.on(\"data\", (async (packet: RawNetworkPacket) => {\r\n            if (packet.event !== NetworkEvent.FETCH || packet.subEvent !== endpoint)\r\n                return;\r\n\r\n            const data = await respond();\r\n\r\n            this.remoteConnection.send({\r\n                event: NetworkEvent.FETCH_RESPONSE,\r\n                id: packet.id!,\r\n                data,\r\n            } satisfies RawNetworkPacket<any>);\r\n        }) as any);\r\n    }\r\n\r\n    //#region Utils\r\n    private waitForConnectionCB<\r\n        T extends \"open\" | \"data\" | \"error\" | \"close\" | \"iceStateChanged\"\r\n    >(connection: DataConnection, ev: T) {\r\n        return new Promise<void>((res) => {\r\n            connection.once(ev, (...args) => res());\r\n        });\r\n    }\r\n\r\n    update() {\r\n        if (this.framesConnected !== null) {\r\n            this.framesConnected++;\r\n        }\r\n    }\r\n}\r\n\r\n// The \"DummyDataConnection\" class has the same *general* shape as a data connection, but with no actual remote peer\r\n// Instead, it is used when we dont have a connection to store listeners for when someone does connect\r\nclass DummyDataConnection {\r\n    private readonly cbs: any[] = [];\r\n\r\n    on(ev: string, cb: any) {\r\n        if (ev !== \"data\")\r\n            console.warn(\r\n                \"Dummy listener captured unexpected event\",\r\n                ev,\r\n                '(Only \"data\" event is expected with a dummy)'\r\n            );\r\n        this.cbs.push(cb);\r\n    }\r\n\r\n    send(...args: any) {\r\n        console.warn(\r\n            \"Send was called with a dummy data connection. Data can not be sent without an actual data connection and remote peer. Make sure client is connected before sending data\"\r\n        );\r\n    }\r\n\r\n    close() {}\r\n\r\n    // Used for when a client connects\r\n    morphToRealConnection(connection: DataConnection) {\r\n        this.cbs.forEach((cb) => connection.on(\"data\", cb));\r\n        return connection;\r\n    }\r\n\r\n    // Used for when a client disconnects\r\n    fromDataConnection(connection: DataConnection) {\r\n        this.cbs.length = 0;\r\n        this.cbs.push(...connection.listeners(\"data\"));\r\n        return this;\r\n    }\r\n}\r\n\r\nexport const networkConnectionPlugin = ResourceUpdaterPlugin(\r\n    NetworkConnection,\r\n    true\r\n);\r\n", "import \"./engine/polyfills\";\r\nimport { NetworkConnection } from \"engine/multiplayer/network\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        nc: NetworkConnection;\r\n    }\r\n}\r\nconst nc = (window.nc = new NetworkConnection(null as any));\r\nPromise.resolve().then(() => {\r\n    nc.on<[number, number]>(\"ping\", ([frame, time]) => {\r\n        document.body.innerHTML = `Lag: ${nc.framesConnected - frame}frames, ${\r\n            Date.now() - (nc.connectionStartTime + time)\r\n        }ms`;\r\n    });\r\n\r\n    nc.waitForConnection.then(() => {\r\n        setInterval(() => {\r\n            nc.update();\r\n            nc.send(\"ping\", [\r\n                nc.framesConnected,\r\n                Date.now() - nc.connectionStartTime,\r\n            ]);\r\n            console.log(\"updating\");\r\n        }, 1000 / 60);\r\n    });\r\n});\r\n"],
  "mappings": "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",
  "names": ["SDPUtils", "sdp", "j", "IS_WORKER", "Logger", "context", "seed", "val", "data", "emoji", "type", "bgColor", "col", "extra", "logger", "Archetype", "id", "components", "expectedSize", "entity", "i", "size", "newArr", "ArchetypeManager", "world", "archetype", "newArchetype", "_", "hasAll", "needed", "from", "to", "component", "firstArchetype", "candidateArchetype", "c", "x", "maxEnts", "walk", "fn", "initialData", "res", "findGetter", "obj", "prop", "desc", "findSetter", "StorageManager", "storage", "COMPONENT_STORAGES", "storageId", "StorageClass", "StorageKind", "addStorageKind", "name", "ComponentStorage", "object", "property", "slowBackwardsLink", "getter", "setter", "v", "AnyComponentStorage", "createNumberComponentStorage", "id", "constructor", "NumberComponentStorage", "ComponentStorage", "maxEnts", "newTarget", "ent", "amount", "modulo", "old", "val", "F64ComponentStorage", "StorageKind", "F32ComponentStorage", "I8ComponentStorage", "I16ComponentStorage", "I32ComponentStorage", "U8ComponentStorage", "U16ComponentStorage", "U32ComponentStorage", "BooleanComponentStorage", "COMPONENT_STORAGES", "AnyComponentStorage", "logger", "Logger", "CUSTOM_COMPONENT_STORAGES", "customComponentStorageCache", "addStorageKind", "customStorageFactories", "createLoggedStorage", "createEnumComponentStorage", "createNullableComponentStorage", "createRangedComponentStorage", "registerCustomStorage", "options", "optionsStr", "customComponentStorageCache", "id", "COMPONENT_STORAGES", "constructor", "customStorageFactories", "CUSTOM_COMPONENT_STORAGES", "createLoggedStorage", "backingStorageId", "bufferSize", "superStorage", "StorageKind", "val", "map", "numFrames", "logger", "i", "ent", "createEnumComponentStorage", "newId", "EnumStorage", "ComponentStorage", "maxEnts", "value", "old", "createNullableComponentStorage", "createRangedComponentStorage", "capacity", "asTypeId", "_TypeIdBuilder", "length", "TypeBuilder", "TypeIdBuilder", "__publicField", "#type", "type", "key", "t", "obj", "TypeBuilderConstructor", "_BaseTypes", "BaseTypes", "ComplexTypes", "component", "_FirstClassTypes", "FirstClassTypes", "Type", "Logger", "CACHED_HASH", "nextComponentId", "getUniqueComponentId", "ID_MAP", "setObjectIdImplementation", "method", "logger", "CACHED_HASH", "string", "h", "i", "ID_MAP", "getUniqueComponentId", "loadComponentMethods", "setObjectIdImplementation", "ID_MAP", "getUniqueComponentId", "logger", "EntityComponent", "cache", "schema", "__publicField", "PODComponent", "v", "world", "ent", "RecordComponent", "data", "i", "key", "type", "id", "NestedComponent", "queue", "walk", "add", "target", "Component", "realSchema", "convertTypeTreeToTypeIdTree", "CustomComponent", "isTypeIdRecord", "isTypeId", "schema", "isTypeIdBuilder", "TypeIdBuilder", "isTypeIdRecord", "t", "isTypeBuilder", "TypeBuilder", "convertTypeTreeToTypeIdTree", "obj", "key", "val", "loadSetMethods", "others", "newSet", "other", "s", "fn", "v", "set", "value", "isClass", "Query", "componentTester", "stepSize", "offset", "archetype", "i", "j", "ent", "state", "addedFn", "removedFn", "lastFrame", "QueryManager", "world", "modifiers", "query", "All", "id", "With", "components", "c", "test", "All", "modifiers", "fn", "components", "narrowers", "modifier", "f", "ent", "i", "BagelSystem", "world", "stepSize", "offset", "obj", "Query", "val", "__publicField", "System", "queries", "realQueries", "queryModifierToQuery", "CustomSystemClass", "isIntoQueryModifier", "tree", "intoQueryModifierToQueryModifier", "query", "With", "isClass", "key", "SystemType", "SystemManager", "schedule", "copy", "working", "first", "standard", "last", "x", "id", "type", "name", "systems", "ordering", "enabled", "scheduleArr", "kind", "relativeTo", "arr", "idx", "system", "registerQueryTree", "arg", "promises", "systemId", "awaitMessage", "worker", "messageType", "resolve", "reject", "listen", "data", "MessageType", "logger", "Logger", "WorkerProxy", "url", "numThreads", "emitData", "waitFor", "indexProp", "WorkerManager", "systemData", "triggerArray", "ID_MAP", "CUSTOM_COMPONENT_STORAGES", "archetype", "getBits", "number", "start", "end", "RELATIONSHIP_SHIFT", "Relationship", "entity", "loadRelationshipMethods", "extraMethods", "by", "to", "component", "CHILD", "PARENT", "loadHierarchyMethods", "methodLoaders", "getUniqueComponentId", "child", "logger", "Logger", "_World", "internalMaxEntities", "StorageManager", "QueryManager", "WorkerManager", "SystemManager", "ArchetypeManager", "v", "components", "ent", "component", "modifiers", "system", "schedule", "enable", "ordering", "BagelSystem", "sys", "url", "numThreads", "id", "name", "systems", "enabled", "arg", "i", "resource", "EntityComponent", "World", "__publicField", "extraEntityMethodLoaders", "loadRelationshipMethods", "loadHierarchyMethods", "loadEntityMethods", "valOrId", "archetypes", "entityArchetypes", "tag", "target", "p", "receiver", "newValue", "amount", "modulo", "method", "logger", "Logger", "loadEntityMethods", "loadComponentMethods", "loadSetMethods", "c", "j", "v", "window", "navigator", "window", "navigator", "c", "b", "d", "window", "window", "f", "te", "sdp", "shimGetDisplayMedia", "shimGetUserMedia", "shimOnTrack", "shimPeerConnection", "shimGetUserMedia", "window", "navigator", "b", "c", "shimGetDisplayMedia", "window", "shimOnTrack", "window", "shimPeerConnection", "shimGetUserMedia", "window", "f", "shimGetUserMedia", "navigator", "RTCPeerConnection", "window", "SDPUtils", "sdp", "d", "window", "logging", "adapter", "shimPeerConnection", "shimGetUserMedia", "shimOnTrack", "k", "v", "structure", "k", "unit", "b", "c", "d", "f", "g", "h", "j", "k", "l", "m", "l", "read", "target", "b", "Buffer", "position", "bundledStrings", "referenceMap", "packedObjectMap", "sharedPackedObjectMap", "l", "sharedValues", "j", "packedValues", "encode", "options", "maxBytes", "k", "isLittleEndianMachine", "Buffer", "b", "b", "fr", "once", "l", "ee", "listeners", "j", "sdp", "data", "blob", "k", "v", "id", "message", "_", "v", "m", "op", "p", "target", "result", "isObject", "v", "b", "document", "p", "p", "c", "v", "_", "h", "target", "c", "p", "x", "v", "d", "target", "p", "c", "g", "b", "h", "l", "x", "m", "d", "v", "unit", "_", "y", "_a", "z", "w", "p", "p", "v", "unit", "target", "_"]
}
